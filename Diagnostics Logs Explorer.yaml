dependencies: []
modules: []
exported_table_schema: []
services:
- source: /runtime/services/tables.yml
  client_config: {}
  server_config: {}
forms:
- is_package: true
  container:
    type: HtmlTemplate
    properties: {html: '@theme:standard-page.html'}
  components:
  - type: ColumnPanel
    properties: {col_widths: '{}'}
    name: content_panel
    layout_properties: {slot: default}
    components:
    - type: ColumnPanel
      properties: {col_widths: '{}'}
      name: column_panel_1
      layout_properties: {grid_position: 'HGDUSW,DPVHRB'}
      components:
      - type: DataGrid
        properties:
          role: null
          columns:
          - {id: WZFMNN, title: <No data>, data_key: column_1, $$hashKey: 'object:25541'}
          auto_header: true
          tooltip: ''
          border: ''
          foreground: ''
          rows_per_page: 3
          visible: true
          wrap_on: never
          show_page_controls: true
          spacing_above: small
          spacing_below: small
          background: ''
        name: dg_result
        layout_properties: {grid_position: 'JFRWCS,IFCXEK', full_width_row: true}
        components:
        - type: RepeatingPanel
          properties: {spacing_above: none, spacing_below: none, item_template: MainForm.RowTemplate1}
          name: repeating_panel_1
          layout_properties: {}
        data_bindings: []
    - type: Label
      properties: {role: null, align: left, tooltip: '', border: '', foreground: '',
        visible: true, text: Az container SAS URL, font_size: null, font: '', spacing_above: small,
        icon_align: left, spacing_below: small, italic: false, background: '', bold: false,
        underline: false, icon: 'fa:thumbs-o-up'}
      name: label_1
      layout_properties: {grid_position: 'LPWDFQ,MFDECC'}
    - type: Label
      properties: {role: null, align: left, tooltip: '', border: '', foreground: '',
        visible: true, text: <No storage account selected>, font_size: null, font: '',
        spacing_above: small, icon_align: left, spacing_below: small, italic: false,
        background: '', bold: false, underline: false, icon: ''}
      name: lbl_az_containerurl
      layout_properties: {grid_position: 'LPWDFQ,WKMULO'}
    - type: Button
      properties: {role: null, align: center, tooltip: '', border: '', enabled: true,
        foreground: '', visible: true, text: Select Az Storage Account, font_size: null,
        font: '', spacing_above: small, icon_align: left, spacing_below: small, italic: false,
        background: '', bold: false, underline: false, icon: ''}
      name: btn_select_az_storage_account
      layout_properties: {grid_position: 'LPWDFQ,TDYVWL'}
      event_bindings: {click: btn_select_az_storage_account_click}
    - type: Label
      properties: {role: null, align: left, tooltip: '', border: '', foreground: '',
        visible: true, text: From datetime, font_size: null, font: '', spacing_above: small,
        icon_align: left, spacing_below: small, italic: false, background: '', bold: false,
        underline: false, icon: ''}
      name: lbl_dt_from
      layout_properties: {grid_position: 'PKGHLL,BJSYUW'}
    - type: DatePicker
      properties: {}
      name: dt_from
      layout_properties: {grid_position: 'PKGHLL,DMWXOV'}
    - type: Label
      properties: {role: null, align: left, tooltip: '', border: '', foreground: '',
        visible: true, text: To datetime, font_size: null, font: '', spacing_above: small,
        icon_align: left, spacing_below: small, italic: false, background: '', bold: false,
        underline: false, icon: ''}
      name: lbl_dt_to
      layout_properties: {grid_position: 'XYMFZV,RVQKRQ'}
    - type: DatePicker
      properties: {}
      name: dt_to
      layout_properties: {grid_position: 'XYMFZV,SKYXCY'}
    - type: Label
      properties: {role: null, align: left, tooltip: '', border: '', foreground: '',
        visible: true, text: Fetch data operation, font_size: null, font: '', spacing_above: small,
        icon_align: left, spacing_below: small, italic: false, background: '', bold: false,
        underline: false, icon: 'fa:thumbs-o-up'}
      name: label_2
      layout_properties: {grid_position: 'BZLTKI,FLWRCU'}
    - type: Button
      properties: {role: null, align: center, tooltip: '', border: '', enabled: true,
        foreground: '', visible: true, text: Fetch, font_size: null, font: '', spacing_above: small,
        icon_align: left, spacing_below: small, italic: false, background: '', bold: false,
        underline: false, icon: ''}
      name: btn_fetch
      layout_properties: {grid_position: 'BZLTKI,QOOBMW'}
      event_bindings: {click: btn_fetch_click}
  - type: FlowPanel
    properties: {}
    name: navbar_links
    layout_properties: {slot: nav-right}
  code: "from ._anvil_designer import MainFormTemplate\nfrom anvil import *\nimport\
    \ anvil.server\n\nclass MainForm(MainFormTemplate):\n  def __init__(self, **properties):\n\
    \    # Set Form properties and Data Bindings.\n    self.init_components(**properties)\n\
    \    print(\"[INFO] properties\", properties)\n    self.handle_az_storage_account(properties)\n\
    \    self.dg_result.role = 'wide'\n\n    import datetime\n    now = datetime.datetime.now()\n\
    \    # format = '%Y-%m-%d %H:%M'\n    format = '%Y-%m-%d'\n    self.dt_from.format\
    \ = format\n    self.dt_to.format = format\n    self.dt_from.date = now.strftime(format)\n\
    \    self.dt_to.date = now.strftime(format)\n    # Any code you write here will\
    \ run before the form opens.\n\n  def btn_select_az_storage_account_click(self,\
    \ **event_args):\n    \"\"\"This method is called when the button is clicked\"\
    \"\"\n    # CPPXAXA - Uncomment\n    open_form('SelectStorageAccount')\n    pass\n\
    \n  def handle_az_storage_account(self, properties):\n    self.az_containerurl\
    \ = None\n\n    if \"containerurl\" in properties:\n      self.az_containerurl\
    \ = properties[\"containerurl\"]\n      self.lbl_az_containerurl.text = self.az_containerurl[:50]\
    \ + \" ...\"\n\n  def btn_fetch_click(self, **event_args):\n    \"\"\"This method\
    \ is called when the button is clicked\"\"\"\n    from anvil.js.window import\
    \ alerter\n    from anvil.js.window import list_files\n    # alerter()\n    \n\
    \    if self.dt_from.date is None:\n      alerter(\"From date cannot be blank\"\
    )\n      return\n    if self.dt_to.date is None:\n      alerter(\"To date cannot\
    \ be blank\")\n      return\n\n    if self.dt_to.date <= self.dt_from.date:\n\
    \      alerter(\"To date cannot be less than or equals from date\")\n      return\n\
    \      \n    \n    self.clear_table()\n    # self.add_to_table({\"name\": \"abc\"\
    , \"roll\": \"123\"})\n    # self.add_to_table({\"name\": \"def\"})\n    from_date\
    \ = str(self.dt_from.date) + \" 00:00\"\n    to_date = str(self.dt_to.date) +\
    \ \" 00:00\"\n    \n    list_files(\\\n      self.az_containerurl,\\\n      from_date,\\\
    \n      to_date,\\\n      self.clear_table,\\\n      self.add_to_table)\n    pass\n\
    \    \n  def clear_table(self):\n    self.dg_result.clear()\n    self.records\
    \ = []\n    self.record_columns = set()\n\n  def __update_columns(self, record):\n\
    \    for k in record:\n      if not (k in self.record_columns):\n        self.record_columns.add(k)\n\
    \n    widths = {\n      \"time\": 250,\n      \"category\": 100,\n      \"operationName\"\
    : 130,\n      \"correlationId\": 300,\n      \"callerIpAddress\": 130,\n     \
    \ \"operationVersion\": 130,\n      \"resultSignature\": 130,\n      \"durationMs\"\
    : 100,\n      \"properties\": 500,\n      \"resultType\": 130\n    }\n    \n \
    \   new_columns = []\n    for k in self.record_columns:\n      width = 350\n \
    \     if k in widths:\n        width = widths[k]\n      new_columns.append({ \"\
    id\": k, \"title\": k, \"data_key\": k, \"width\": width })\n\n    self.dg_result.clear()\n\
    \    self.dg_result.columns = new_columns\n\n    for val in self.records:\n  \
    \    self.__add_to_table_helper(val)\n  \n  def __add_to_table_helper(self, record):\n\
    \    row = DataRowPanel(item=record)\n    self.dg_result.add_component(row)\n\n\
    \  def add_to_table(self, record):\n    print(\"[INFO] add_to_table\", record)\n\
    \    record = dict(record)\n    self.__update_columns(record)\n    self.records.append(record)\n\
    \    self.__add_to_table_helper(record)\n  "
  class_name: MainForm
  id: KDSHKD4EDWHHO3NYB3WJILPKI4W4OPWA
- container: {type: DataRowPanel}
  components: []
  is_package: true
  code: "from ._anvil_designer import RowTemplate1Template\nfrom anvil import *\n\
    import anvil.server\n\nclass RowTemplate1(RowTemplate1Template):\n  def __init__(self,\
    \ **properties):\n    # Set Form properties and Data Bindings.\n    self.init_components(**properties)\n\
    \n    # Any code you write here will run before the form opens.\n"
  class_name: MainForm.RowTemplate1
  id: '1670741779283137494120672.51764'
- is_package: true
  container:
    type: HtmlTemplate
    properties: {html: '@theme:standard-page.html'}
  components:
  - type: ColumnPanel
    properties: {col_widths: '{}'}
    name: content_panel
    layout_properties: {slot: default}
    components:
    - type: Label
      properties: {role: null, align: left, tooltip: '', border: '', foreground: '',
        visible: true, text: Enter container SAS URL, font_size: null, font: '', spacing_above: small,
        icon_align: left, spacing_below: small, italic: false, background: '', bold: false,
        underline: false, icon: ''}
      name: label_1
      layout_properties: {grid_position: 'EMYEEX,FZEGUC'}
    - type: TextBox
      properties: {role: null, align: left, hide_text: false, tooltip: '', placeholder: Enter container SAS URL ...,
        border: '', enabled: true, foreground: '', visible: true, text: '', font_size: null,
        font: '', spacing_above: small, type: text, spacing_below: small, italic: false,
        background: '', bold: false, underline: false}
      name: txt_containerurl
      layout_properties: {grid_position: 'FULXUF,WNZGQP'}
    - type: Button
      properties: {role: null, align: center, tooltip: '', border: '', enabled: true,
        foreground: '', visible: true, text: Select, font_size: null, font: '', spacing_above: small,
        icon_align: left, spacing_below: small, italic: false, background: '', bold: false,
        underline: false, icon: ''}
      name: btn_select
      layout_properties: {grid_position: 'SBWRYR,SRAHTK'}
      event_bindings: {click: btn_select_click}
  - type: FlowPanel
    properties: {}
    name: navbar_links
    layout_properties: {slot: nav-right}
  code: "from ._anvil_designer import SelectStorageAccountTemplate\nfrom anvil import\
    \ *\nimport anvil.server\n\nclass SelectStorageAccount(SelectStorageAccountTemplate):\n\
    \  def __init__(self, **properties):\n    # Set Form properties and Data Bindings.\n\
    \    self.init_components(**properties)\n\n    # Any code you write here will\
    \ run before the form opens.\n\n  def btn_select_click(self, **event_args):\n\
    \    \"\"\"This method is called when the button is clicked\"\"\"\n    open_form('MainForm',\
    \ containerurl=self.txt_containerurl.text)\n    pass\n\n"
  class_name: SelectStorageAccount
  id: '1670741910924555714715713.8068'
startup: {type: form, module: MainForm}
package_name: Diagnostics_Logs_Explorer
allow_embedding: false
name: Diagnostics Logs Explorer
runtime_options: {version: 2, client_version: '3', server_version: python3-sandbox,
  server_spec: null}
metadata: {title: Diagnostics Logs Explorer}
startup_form: null
native_deps: {head_html: "<!-- <script src=\"https://cdn.jsdelivr.net/npm/@azure/storage-blob@12.12.0/dist/index.min.js\"\
    ></script> -->\n<script src=\"_/theme/azure-storage-blob.js\"></script>\n<script>\n\
    \  function alerter(message) {\n    alert(message);\n  }\n\n//   var blobServiceClient\
    \ = new BlobServiceClient(\"https://px0storage.blob.core.windows.net/?sv=2021-06-08&ss=bfqt&srt=c&sp=rwdlacupiytfx&se=2022-12-31T00:46:13Z&st=2022-12-11T16:46:13Z&spr=https&sig=YvW6Lp1sfhforMzHC4SUoqadySdzoh56Bvo6SroqmP0%3D\"\
    );\n    \n\n  function list_files(containerurl, dt_from, dt_to, clear_callback,\
    \ add_callback) {\n    console.log(\"[INFO] callback can be called as callback().\
    \ It will handle the self part.\", containerurl, dt_from, dt_to);\n    clear_callback();\n\
    \n    async function blobToString(blob) {\n      const fileReader = new FileReader();\n\
    \      return new Promise((resolve, reject) => {\n        fileReader.onloadend\
    \ = (ev) => {\n          resolve(ev.target.result);\n        };\n        fileReader.onerror\
    \ = reject;\n        fileReader.readAsText(blob);\n      });\n    }\n\n    function\
    \ isRoiBlob(blob_name, dt_from, dt_to) {\n      toks = blob_name.split('/');\n\
    \      var shortlisted = [];\n      for (var tok of toks) {\n        if (tok.length\
    \ > 0 && tok.includes(\"=\") && tok[tok.length - 1] != \"=\") {\n          shortlisted.push(tok);\n\
    \        }\n      }\n      console.log(\"shortlisted\", shortlisted);\n\n    \
    \  var timestampVals = [];\n      for (var pair of shortlisted) {\n        tuple\
    \ = pair.split(\"=\");\n        timestampVals.push(tuple[1]);\n      }\n     \
    \ var timestamp = timestampVals[0] + '-' + timestampVals[1] + '-' + timestampVals[2]\
    \ + ' ' + timestampVals[3] + ':' + timestampVals[4];\n      console.log(\"timestamp\"\
    , timestamp);\n\n      var result = timestamp >= dt_from && timestamp <= dt_to;\n\
    \      console.log(\"isRoiBlob\", result, timestamp, dt_from, dt_to);\n      return\
    \ result;\n    }\n    \n    const containerURL = new azblob.ContainerURL(\n  \
    \    // \"https://px0storage.blob.core.windows.net/insights-logs-auditevent?sp=rl&st=2022-12-11T17:53:07Z&se=2022-12-31T01:53:07Z&spr=https&sv=2021-06-08&sr=c&sig=JBFQ5ltH2T7GeVLkRbJmOSBJy%2Bni6b%2FabkNkg7PIeZ8%3D\"\
    ,\n      containerurl,\n      azblob.StorageURL.newPipeline(new azblob.AnonymousCredential));\n\
    \  \n    const listFiles = async () => {\n      try {\n        console.log(\"\
    Retrieving file list...\");\n        let marker = undefined;\n        do {\n \
    \         const listBlobsResponse = await containerURL.listBlobFlatSegment(\n\
    \            azblob.Aborter.none, marker);\n          marker = listBlobsResponse.nextMarker;\n\
    \          const items = listBlobsResponse.segment.blobItems;\n          for (const\
    \ blob of items) {\n            console.log(`Blob name`, blob.name);\n\n     \
    \       if (! isRoiBlob(blob.name, dt_from, dt_to)) {\n              continue;\n\
    \            }\n            \n            var blobURL = azblob.BlobURL.fromContainerURL(containerURL,\
    \ blob.name);\n            console.log(\"blobURL\", blobURL);\n            blobURL.url\
    \ = azblob.BlobURL.fromContainerURL(containerURL, \"\").url + blob.name;\n   \
    \         console.log(\"### blobURL\", blobURL);\n\n            var baseLineImage\
    \ = await blobURL.download();\n            console.log(\"baseLineImage\", baseLineImage);\n\
    \n            const downloaded = await blobToString(await baseLineImage.blobBody);\n\
    \            console.log(\"Downloaded blob content\", downloaded.split(\"\\r\\\
    n\"));\n\n            for (var serializedLog of downloaded.split(\"\\r\\n\"))\
    \ {\n              if (serializedLog != \"\") {\n                console.log(serializedLog);\n\
    \                var value = JSON.parse(serializedLog.toString());\n\n       \
    \         add_callback(value);\n              }\n            }\n\n           \
    \ // CPPXAXA.\n            // break;\n          }\n        } while (marker);\n\
    \      } catch (error) {\n        console.log(\"error\", error);\n      }\n  \
    \  };\n    \n    listFiles();\n  }\n</script>"}
dependency_order: []
extra_files: {__init__.py: IwojIFRoaXMgcmVwb3NpdG9yeSBpcyBhbiBBbnZpbCBhcHAuIExlYXJuIG1vcmUgYXQgaHR0cHM6Ly9hbnZpbC53b3Jrcy8KIyBUbyBydW4gdGhlIHNlcnZlci1zaWRlIGNvZGUgb24geW91ciBvd24gbWFjaGluZSwgcnVuOgojIHBpcCBpbnN0YWxsIGFudmlsLXVwbGluawojIHB5dGhvbiAtbSBhbnZpbC5ydW5fYXBwX3ZpYV91cGxpbmsgWW91ckFwcFBhY2thZ2VOYW1lCgpfX3BhdGhfXyA9IFtfX3BhdGhfX1swXSArICIvc2VydmVyX2NvZGUiLCBfX3BhdGhfX1swXSArICIvY2xpZW50X2NvZGUiXQo=}
dependency_code: {}
theme:
  templates:
  - name: Standard Page
    description: A page with an app bar and an optional sidebar.
    img: img/form-templates/material-design-3.png
    form:
      class_name: Form
      is_package: true
      container:
        type: HtmlTemplate
        properties: {html: '@theme:standard-page.html'}
      components:
      - type: ColumnPanel
        properties: {}
        name: content_panel
        layout_properties: {slot: default}
      - type: FlowPanel
        properties: {}
        name: navbar_links
        layout_properties: {slot: nav-right}
      code: "from ._anvil_designer import $NAME$Template\nfrom anvil import *\n\n\
        class $NAME$($NAME$Template):\n\n  def __init__(self, **properties):\n   \
        \ # Set Form properties and Data Bindings.\n    self.init_components(**properties)\n\
        \n    # Any code you write here will run before the form opens.\n    \n"
  parameters:
    roles:
    - name: input-prompt
      components: [Label]
    - name: selected
      components: [Link]
    - name: outlined-card
      components: [ColumnPanel, LinearPanel, XYPanel, RepeatingPanel]
      display_in_toolbox: true
      title: Outlined Card
    - name: elevated-card
      components: [ColumnPanel, LinearPanel, XYPanel, RepeatingPanel]
      display_in_toolbox: false
      title: Elevated Card
    - name: tonal-card
      components: [ColumnPanel, LinearPanel, XYPanel, RepeatingPanel]
      display_in_toolbox: false
      title: Tonal Card
    - name: outlined-button
      components: [Button, FileLoader]
      display_in_toolbox: true
      title: Outlined Button
    - name: filled-button
      components: [Button, FileLoader]
      display_in_toolbox: false
      title: Filled Button
    - name: elevated-button
      components: [Button, FileLoader]
      display_in_toolbox: false
      title: Elevated Button
    - name: tonal-button
      components: [Button, FileLoader]
      display_in_toolbox: false
      title: Tonal Button
    - name: outlined
      components: [TextBox, TextArea, DatePicker, DropDown]
      display_in_toolbox: true
      title: Outlined TextBox
    - name: display
      components: [Label, Link]
    - name: headline
      components: [Label, Link]
    - name: title
      components: [Label, Link]
    - name: body
      components: [Label, Link]
    - name: tonal-data-grid
      components: [DataGrid]
    - name: outlined-error
      components: [TextBox, TextArea, DatePicker, DropDown]
    - name: input-error
      components: [TextBox, TextArea, DatePicker, DropDown]
    color_scheme:
      preset_groups:
      - name: Colour Scheme
        options:
        - name: Material Light
          colors:
          - {name: Primary, color: '#6750A4'}
          - {name: Primary Container, color: '#EADDFF'}
          - {name: On Primary, color: '#FFFFFF'}
          - {name: On Primary Container, color: '#21005E'}
          - {name: Secondary, color: '#625B71'}
          - {name: Secondary Container, color: '#E8DEF8'}
          - {name: On Secondary, color: '#FFFFFF'}
          - {name: On Secondary Container, color: '#1E192B'}
          - {name: Tertiary, color: '#7D5260'}
          - {name: Tertiary Container, color: '#FFD8E4'}
          - {name: On Tertiary, color: '#FFFFFF'}
          - {name: On Tertiary Container, color: '#370B1E'}
          - {name: Error, color: '#B3261E'}
          - {name: Background, color: '#FFFBFE'}
          - {name: Surface, color: '#FFFBFE'}
          - {name: On Background, color: '#1C1B1F'}
          - {name: On Surface, color: '#1C1B1F'}
          - {name: Surface Variant, color: '#E7E0EC'}
          - {name: On Surface Variant, color: '#49454E'}
          - {name: Outline, color: '#79747E'}
          - {name: On Disabled, color: 'rgba(28, 27, 31, 0.38)'}
          - {name: Disabled Container, color: 'rgba(28, 27, 31, 0.12)'}
          - {name: Light Overlay 1, color: 'rgba(255, 255, 255, 0.08)'}
          - {name: Light Overlay 2, color: 'rgba(255, 255, 255, 0.12)'}
          - {name: Dark Overlay 1, color: 'rgba(30, 25, 43, 0.08)'}
          - {name: Dark Overlay 2, color: 'rgba(30, 25, 43, 0.12)'}
          - {name: Primary Overlay 1, color: 'rgba(103, 80, 164, 0.05)'}
          - {name: Primary Overlay 2, color: 'rgba(103, 80, 164, 0.08)'}
          - {name: Primary Overlay 3, color: 'rgba(103, 80, 164, 0.11)'}
        - name: Material Dark
          colors:
          - {name: Primary, color: '#D0BCFF'}
          - {name: Primary Container, color: '#4F378B'}
          - {name: On Primary, color: '#371E73'}
          - {name: On Primary Container, color: '#EADDFF'}
          - {name: Secondary, color: '#CCC2DC'}
          - {name: Secondary Container, color: '#4A4458'}
          - {name: On Secondary, color: '#332D41'}
          - {name: On Secondary Container, color: '#E8DEF8'}
          - {name: Tertiary, color: '#EFB8C8'}
          - {name: Tertiary Container, color: '#633B48'}
          - {name: On Tertiary, color: '#492532'}
          - {name: On Tertiary Container, color: '#FFD8E4'}
          - {name: Error, color: '#F2B8B5'}
          - {name: Background, color: '#1C1B1F'}
          - {name: Surface, color: '#1C1B1F'}
          - {name: On Background, color: '#E6E1E5'}
          - {name: On Surface, color: '#E6E1E5'}
          - {name: Surface Variant, color: '#49454F'}
          - {name: On Surface Variant, color: '#CAC4D0'}
          - {name: Outline, color: '#938F99'}
          - {name: On Disabled, color: 'rgba(230, 225, 229, 0.38)'}
          - {name: Disabled Container, color: 'rgba(230, 225, 229, 0.12)'}
          - {name: Light Overlay 1, color: 'rgba(232, 222, 248, 0.08)'}
          - {name: Light Overlay 2, color: 'rgba(232, 222, 248, 0.12)'}
          - {name: Dark Overlay 1, color: 'rgba(232, 222, 248, 0.08)'}
          - {name: Dark Overlay 2, color: 'rgba(232, 222, 248, 0.12)'}
          - {name: Primary Overlay 1, color: 'rgba(208, 188, 255, 0.05)'}
          - {name: Primary Overlay 2, color: 'rgba(208, 188, 255, 0.08)'}
          - {name: Primary Overlay 3, color: 'rgba(208, 188, 255, 0.11)'}
        - name: Rally Dark
          colors:
          - {name: Primary, color: '#1EB980'}
          - {name: Primary Container, color: '#005235'}
          - {name: On Primary, color: '#003824'}
          - {name: On Primary Container, color: '#73FBBC'}
          - {name: Secondary, color: '#B4CCBC'}
          - {name: Secondary Container, color: '#364B3F'}
          - {name: On Secondary, color: '#20352A'}
          - {name: On Secondary Container, color: '#D0E8D8'}
          - {name: Tertiary, color: '#A4CDDD'}
          - {name: Tertiary Container, color: '#234C5A'}
          - {name: On Tertiary, color: '#063542'}
          - {name: On Tertiary Container, color: '#C0E9FA'}
          - {name: Error, color: '#D64D47'}
          - {name: Background, color: '#191C1A'}
          - {name: Surface, color: '#191C1A'}
          - {name: On Background, color: '#E1E3DF'}
          - {name: On Surface, color: '#E1E3DF'}
          - {name: Surface Variant, color: '#404943'}
          - {name: On Surface Variant, color: '#C0C9C1'}
          - {name: Outline, color: '#8A938C'}
          - {name: Dark Overlay 1, color: 'rgba(208, 232, 216, 0.2)'}
          - {name: Dark Overlay 2, color: 'rgba(208, 232, 216, 0.5)'}
          - {name: Light Overlay 1, color: 'rgba(208, 232, 216, 0.2)'}
          - {name: Light Overlay 2, color: 'rgba(208, 232, 216, 0.5)'}
          - {name: Disabled Container, color: 'rgba(133, 133, 139, 0.12)'}
          - {name: On Disabled, color: '#85858B'}
          - {name: Primary Overlay 1, color: 'rgba(30, 185, 128, 0.05)'}
          - {name: Primary Overlay 2, color: 'rgba(30, 185, 128, 0.08)'}
          - {name: Primary Overlay 3, color: 'rgba(30, 185, 128, 0.11)'}
        - name: Rally Light
          colors:
          - {name: Primary, color: '#006C48'}
          - {name: Primary Container, color: '#00A36C'}
          - {name: On Primary, color: '#FFFFFF'}
          - {name: On Primary Container, color: '#002113'}
          - {name: Secondary, color: '#496455'}
          - {name: Secondary Container, color: '#CBEAD6'}
          - {name: On Secondary, color: '#FFFFFF'}
          - {name: On Secondary Container, color: '#052014'}
          - {name: Tertiary, color: '#326576'}
          - {name: Tertiary Container, color: '#B8EAFF'}
          - {name: On Tertiary, color: '#FFFFFF'}
          - {name: On Tertiary Container, color: '#001F28'}
          - {name: Error, color: '#D64D47'}
          - {name: Background, color: '#FBFDF8'}
          - {name: Surface, color: '#FBFDF8'}
          - {name: On Background, color: '#191C1A'}
          - {name: On Surface, color: '#191C1A'}
          - {name: Surface Variant, color: '#DCE5DD'}
          - {name: On Surface Variant, color: '#404943'}
          - {name: Outline, color: '#707973'}
          - {name: Dark Overlay 1, color: 'rgba(5, 32, 20, 0.8)'}
          - {name: Dark Overlay 2, color: 'rgba(51, 51, 61, 0.12)'}
          - {name: Light Overlay 1, color: 'rgba(255, 255, 255, 0.8)'}
          - {name: Light Overlay 2, color: 'rgba(255, 255, 255, 0.12)'}
          - {name: Disabled Container, color: 'rgba(25, 28, 26, 0.12)'}
          - {name: On Disabled, color: 'rgba(25, 28, 26, 0.38)'}
          - {name: Primary Overlay 1, color: 'rgba(0, 108, 72, 0.05)'}
          - {name: Primary Overlay 2, color: 'rgba(0, 108, 72, 0.08)'}
          - {name: Primary Overlay 3, color: 'rgba(0, 108, 72, 0.11)'}
        - name: Mykonos Light
          colors:
          - {name: Primary, color: '#006874'}
          - {name: Primary Container, color: '#96F0FF'}
          - {name: On Primary, color: '#FFFFFF'}
          - {name: On Primary Container, color: '#001F24'}
          - {name: Secondary, color: '#486367'}
          - {name: Secondary Container, color: '#CBE8ED'}
          - {name: On Secondary, color: '#FFFFFF'}
          - {name: On Secondary Container, color: '#031F23'}
          - {name: Tertiary, color: '#515E80'}
          - {name: Tertiary Container, color: '#DAE2FF'}
          - {name: On Tertiary, color: '#FFFFFF'}
          - {name: On Tertiary Container, color: '#0C1A39'}
          - {name: Error, color: '#BA1A1A'}
          - {name: Background, color: '#FAFDFD'}
          - {name: Surface, color: '#FAFDFD'}
          - {name: On Background, color: '#191C1D'}
          - {name: On Surface, color: '#191C1D'}
          - {name: Surface Variant, color: '#DBE4E6'}
          - {name: On Surface Variant, color: '#3F484A'}
          - {name: Outline, color: '#6F797A'}
          - {name: On Disabled, color: 'rgba(25, 28, 29, 0.38)'}
          - {name: Disabled Container, color: 'rgba(25, 28, 29, 0.12)'}
          - {name: Light Overlay 1, color: 'rgba(255, 255, 255, 0.08)'}
          - {name: Light Overlay 2, color: 'rgba(255, 255, 255, 0.12)'}
          - {name: Dark Overlay 1, color: 'rgba(3, 31, 35, 0.08)'}
          - {name: Dark Overlay 2, color: 'rgba(3, 31, 35, 0.12)'}
          - {name: Primary Overlay 1, color: 'rgba(0, 104, 116, 0.05)'}
          - {name: Primary Overlay 2, color: 'rgba(0, 104, 116, 0.08)'}
          - {name: Primary Overlay 3, color: 'rgba(0, 104, 116, 0.11)'}
        - name: Mykonos Dark
          colors:
          - {name: Primary, color: '#3CD9ED'}
          - {name: Primary Container, color: '#004F57'}
          - {name: On Primary, color: '#00363D'}
          - {name: On Primary Container, color: '#96F0FF'}
          - {name: Secondary, color: '#AFCBD0'}
          - {name: Secondary Container, color: '#314B4F'}
          - {name: On Secondary, color: '#1A3438'}
          - {name: On Secondary Container, color: '#CBE8ED'}
          - {name: Tertiary, color: '#B9C6ED'}
          - {name: Tertiary Container, color: '#394667'}
          - {name: On Tertiary, color: '#23304F'}
          - {name: On Tertiary Container, color: '##DAE2FF'}
          - {name: Error, color: '#FFB4AB'}
          - {name: Background, color: '#191C1D'}
          - {name: Surface, color: '#191C1D'}
          - {name: On Background, color: '#E1E3E3'}
          - {name: On Surface, color: '#E1E3E3'}
          - {name: Surface Variant, color: '#3F484A'}
          - {name: On Surface Variant, color: '#BFC8CA'}
          - {name: Outline, color: '#899294'}
          - {name: On Disabled, color: 'rgba(225, 227, 227, 0.38)'}
          - {name: Disabled Container, color: 'rgba(225, 227, 227, 0.12)'}
          - {name: Light Overlay 1, color: 'rgba(203, 232, 237, 0.08)'}
          - {name: Light Overlay 2, color: 'rgba(203, 232, 237, 0.12)'}
          - {name: Dark Overlay 1, color: 'rgba(203, 232, 237, 0.08)'}
          - {name: Dark Overlay 2, color: 'rgba(203, 232, 237, 0.12)'}
          - {name: Primary Overlay 1, color: 'rgba(60, 217, 237, 0.05)'}
          - {name: Primary Overlay 2, color: 'rgba(60, 217, 237, 0.08)'}
          - {name: Primary Overlay 3, color: 'rgba(60, 217, 237, 0.11)'}
        - name: Manarola Light
          colors:
          - {name: Primary, color: '#9A4523'}
          - {name: Primary Container, color: '#FFDBCF'}
          - {name: On Primary, color: '#FFFFFF'}
          - {name: On Primary Container, color: '#380D00'}
          - {name: Secondary, color: '#77574C'}
          - {name: Secondary Container, color: '#FFDBCF'}
          - {name: On Secondary, color: '#FFFFFF'}
          - {name: On Secondary Container, color: '#2C160D'}
          - {name: Tertiary, color: '#695E2F'}
          - {name: Tertiary Container, color: '#F2E2A7'}
          - {name: On Tertiary, color: '#FFFFFF'}
          - {name: On Tertiary Container, color: '#221B00'}
          - {name: Error, color: '#BA1A1A'}
          - {name: Background, color: '#FFFBFF'}
          - {name: Surface, color: '#FFFBFF'}
          - {name: On Background, color: '#201A18'}
          - {name: On Surface, color: '#201A18'}
          - {name: Surface Variant, color: '#F5DED6'}
          - {name: On Surface Variant, color: '#53433E'}
          - {name: Outline, color: '#85736D'}
          - {name: On Disabled, color: 'rgba(32, 26, 24, 0.38)'}
          - {name: Disabled Container, color: 'rgba(32, 26, 24, 0.12)'}
          - {name: Light Overlay 1, color: 'rgba(255, 255, 255, 0.08)'}
          - {name: Light Overlay 2, color: 'rgba(255, 255, 255, 0.12)'}
          - {name: Dark Overlay 1, color: 'rgba(44, 22, 13, 0.08)'}
          - {name: Dark Overlay 2, color: 'rgba(44, 22, 13, 0.12)'}
          - {name: Primary Overlay 1, color: 'rgba(154, 69, 35, 0.05)'}
          - {name: Primary Overlay 2, color: 'rgba(154, 69, 35, 0.08)'}
          - {name: Primary Overlay 3, color: 'rgba(154, 69, 35, 0.11)'}
        - name: Manarola Dark
          colors:
          - {name: Primary, color: '#FFB59B'}
          - {name: Primary Container, color: '#7B2E0E'}
          - {name: On Primary, color: '#5B1A00'}
          - {name: On Primary Container, color: '#FFDBCF'}
          - {name: Secondary, color: '#E7BDB0'}
          - {name: Secondary Container, color: '#5D4036'}
          - {name: On Secondary, color: '#442A21'}
          - {name: On Secondary Container, color: '#FFDBCF'}
          - {name: Tertiary, color: '#D5C68E'}
          - {name: Tertiary Container, color: '#50461A'}
          - {name: On Tertiary, color: '#393005'}
          - {name: On Tertiary Container, color: '#F2E2A7'}
          - {name: Error, color: '#FFB4AB'}
          - {name: Background, color: '#201A18'}
          - {name: Surface, color: '#201A18'}
          - {name: On Background, color: '#EDE0DC'}
          - {name: On Surface, color: '#EDE0DC'}
          - {name: Surface Variant, color: '#53433E'}
          - {name: On Surface Variant, color: '#D8C2BB'}
          - {name: Outline, color: '#A08D86'}
          - {name: On Disabled, color: 'rgba(237, 224, 220, 0.38)'}
          - {name: Disabled Container, color: 'rgba(237, 224, 220, 0.12)'}
          - {name: Light Overlay 1, color: 'rgba(255, 219, 207, 0.08)'}
          - {name: Light Overlay 2, color: 'rgba(255, 219, 207, 0.12)'}
          - {name: Dark Overlay 1, color: 'rgba(255, 219, 207, 0.08)'}
          - {name: Dark Overlay 2, color: 'rgba(255, 219, 207, 0.12)'}
          - {name: Primary Overlay 1, color: 'rgba(255, 181, 155, 0.05)'}
          - {name: Primary Overlay 2, color: 'rgba(255, 181, 155, 0.08)'}
          - {name: Primary Overlay 3, color: 'rgba(255, 181, 155, 0.11)'}
      colors:
      - {name: Primary, color: '#6750A4'}
      - {name: Primary Container, color: '#EADDFF'}
      - {name: On Primary, color: '#FFFFFF'}
      - {name: On Primary Container, color: '#21005E'}
      - {name: Secondary, color: '#625B71'}
      - {name: Secondary Container, color: '#E8DEF8'}
      - {name: On Secondary, color: '#FFFFFF'}
      - {name: On Secondary Container, color: '#1E192B'}
      - {name: Tertiary, color: '#7D5260'}
      - {name: Tertiary Container, color: '#FFD8E4'}
      - {name: On Tertiary, color: '#FFFFFF'}
      - {name: On Tertiary Container, color: '#370B1E'}
      - {name: Error, color: '#B3261E'}
      - {name: Background, color: '#FFFBFE'}
      - {name: Surface, color: '#FFFBFE'}
      - {name: On Background, color: '#1C1B1F'}
      - {name: On Surface, color: '#1C1B1F'}
      - {name: Surface Variant, color: '#E7E0EC'}
      - {name: On Surface Variant, color: '#49454E'}
      - {name: Outline, color: '#79747E'}
      - {name: On Disabled, color: 'rgba(28, 27, 31, 0.38)'}
      - {name: Disabled Container, color: 'rgba(28, 27, 31, 0.12)'}
      - {name: Light Overlay 1, color: 'rgba(255, 255, 255, 0.08)'}
      - {name: Light Overlay 2, color: 'rgba(255, 255, 255, 0.12)'}
      - {name: Dark Overlay 1, color: 'rgba(30, 25, 43, 0.08)'}
      - {name: Dark Overlay 2, color: 'rgba(30, 25, 43, 0.12)'}
      - {name: Primary Overlay 1, color: 'rgba(103, 80, 164, 0.05)'}
      - {name: Primary Overlay 2, color: 'rgba(103, 80, 164, 0.08)'}
      - {name: Primary Overlay 3, color: 'rgba(103, 80, 164, 0.11)'}
  assets:
  - {name: azure-storage-blob.js, content: LyohCiAqIEF6dXJlIFN0b3JhZ2UgU0RLIGZvciBKYXZhU2NyaXB0IC0gQmxvYiwgMTAuNS4wCiAqIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IGFuZCBjb250cmlidXRvcnMuIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqLwooZnVuY3Rpb24gKGdsb2JhbCwgZmFjdG9yeSkgewogICAgdHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnID8gZmFjdG9yeShleHBvcnRzKSA6CiAgICB0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQgPyBkZWZpbmUoWydleHBvcnRzJ10sIGZhY3RvcnkpIDoKICAgIChnbG9iYWwgPSBnbG9iYWwgfHwgc2VsZiwgZmFjdG9yeShnbG9iYWwuYXpibG9iID0ge30pKTsKfSh0aGlzLCBmdW5jdGlvbiAoZXhwb3J0cykgeyAndXNlIHN0cmljdCc7CgogICAgLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAgICAvLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLgogICAgLyoqCiAgICAgKiBBIGNvbGxlY3Rpb24gb2YgSHR0cEhlYWRlcnMgdGhhdCBjYW4gYmUgc2VudCB3aXRoIGEgSFRUUCByZXF1ZXN0LgogICAgICovCiAgICBmdW5jdGlvbiBnZXRIZWFkZXJLZXkoaGVhZGVyTmFtZSkgewogICAgICAgIHJldHVybiBoZWFkZXJOYW1lLnRvTG93ZXJDYXNlKCk7CiAgICB9CiAgICAvKioKICAgICAqIEEgY29sbGVjdGlvbiBvZiBIVFRQIGhlYWRlciBrZXkvdmFsdWUgcGFpcnMuCiAgICAgKi8KICAgIHZhciBIdHRwSGVhZGVycyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBIdHRwSGVhZGVycyhyYXdIZWFkZXJzKSB7CiAgICAgICAgICAgIHRoaXMuX2hlYWRlcnNNYXAgPSB7fTsKICAgICAgICAgICAgaWYgKHJhd0hlYWRlcnMpIHsKICAgICAgICAgICAgICAgIGZvciAodmFyIGhlYWRlck5hbWUgaW4gcmF3SGVhZGVycykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0KGhlYWRlck5hbWUsIHJhd0hlYWRlcnNbaGVhZGVyTmFtZV0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNldCBhIGhlYWRlciBpbiB0aGlzIGNvbGxlY3Rpb24gd2l0aCB0aGUgcHJvdmlkZWQgbmFtZSBhbmQgdmFsdWUuIFRoZSBuYW1lIGlzCiAgICAgICAgICogY2FzZS1pbnNlbnNpdGl2ZS4KICAgICAgICAgKiBAcGFyYW0gaGVhZGVyTmFtZSBUaGUgbmFtZSBvZiB0aGUgaGVhZGVyIHRvIHNldC4gVGhpcyB2YWx1ZSBpcyBjYXNlLWluc2Vuc2l0aXZlLgogICAgICAgICAqIEBwYXJhbSBoZWFkZXJWYWx1ZSBUaGUgdmFsdWUgb2YgdGhlIGhlYWRlciB0byBzZXQuCiAgICAgICAgICovCiAgICAgICAgSHR0cEhlYWRlcnMucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uIChoZWFkZXJOYW1lLCBoZWFkZXJWYWx1ZSkgewogICAgICAgICAgICB0aGlzLl9oZWFkZXJzTWFwW2dldEhlYWRlcktleShoZWFkZXJOYW1lKV0gPSB7IG5hbWU6IGhlYWRlck5hbWUsIHZhbHVlOiBoZWFkZXJWYWx1ZS50b1N0cmluZygpIH07CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBHZXQgdGhlIGhlYWRlciB2YWx1ZSBmb3IgdGhlIHByb3ZpZGVkIGhlYWRlciBuYW1lLCBvciB1bmRlZmluZWQgaWYgbm8gaGVhZGVyIGV4aXN0cyBpbiB0aGlzCiAgICAgICAgICogY29sbGVjdGlvbiB3aXRoIHRoZSBwcm92aWRlZCBuYW1lLgogICAgICAgICAqIEBwYXJhbSBoZWFkZXJOYW1lIFRoZSBuYW1lIG9mIHRoZSBoZWFkZXIuCiAgICAgICAgICovCiAgICAgICAgSHR0cEhlYWRlcnMucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uIChoZWFkZXJOYW1lKSB7CiAgICAgICAgICAgIHZhciBoZWFkZXIgPSB0aGlzLl9oZWFkZXJzTWFwW2dldEhlYWRlcktleShoZWFkZXJOYW1lKV07CiAgICAgICAgICAgIHJldHVybiAhaGVhZGVyID8gdW5kZWZpbmVkIDogaGVhZGVyLnZhbHVlOwogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogR2V0IHdoZXRoZXIgb3Igbm90IHRoaXMgaGVhZGVyIGNvbGxlY3Rpb24gY29udGFpbnMgYSBoZWFkZXIgZW50cnkgZm9yIHRoZSBwcm92aWRlZCBoZWFkZXIgbmFtZS4KICAgICAgICAgKi8KICAgICAgICBIdHRwSGVhZGVycy5wcm90b3R5cGUuY29udGFpbnMgPSBmdW5jdGlvbiAoaGVhZGVyTmFtZSkgewogICAgICAgICAgICByZXR1cm4gISF0aGlzLl9oZWFkZXJzTWFwW2dldEhlYWRlcktleShoZWFkZXJOYW1lKV07CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBSZW1vdmUgdGhlIGhlYWRlciB3aXRoIHRoZSBwcm92aWRlZCBoZWFkZXJOYW1lLiBSZXR1cm4gd2hldGhlciBvciBub3QgdGhlIGhlYWRlciBleGlzdGVkIGFuZAogICAgICAgICAqIHdhcyByZW1vdmVkLgogICAgICAgICAqIEBwYXJhbSBoZWFkZXJOYW1lIFRoZSBuYW1lIG9mIHRoZSBoZWFkZXIgdG8gcmVtb3ZlLgogICAgICAgICAqLwogICAgICAgIEh0dHBIZWFkZXJzLnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbiAoaGVhZGVyTmFtZSkgewogICAgICAgICAgICB2YXIgcmVzdWx0ID0gdGhpcy5jb250YWlucyhoZWFkZXJOYW1lKTsKICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2hlYWRlcnNNYXBbZ2V0SGVhZGVyS2V5KGhlYWRlck5hbWUpXTsKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9OwogICAgICAgIC8qKgogICAgICAgICAqIEdldCB0aGUgaGVhZGVycyB0aGF0IGFyZSBjb250YWluZWQgdGhpcyBjb2xsZWN0aW9uIGFzIGFuIG9iamVjdC4KICAgICAgICAgKi8KICAgICAgICBIdHRwSGVhZGVycy5wcm90b3R5cGUucmF3SGVhZGVycyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHt9OwogICAgICAgICAgICBmb3IgKHZhciBoZWFkZXJLZXkgaW4gdGhpcy5faGVhZGVyc01hcCkgewogICAgICAgICAgICAgICAgdmFyIGhlYWRlciA9IHRoaXMuX2hlYWRlcnNNYXBbaGVhZGVyS2V5XTsKICAgICAgICAgICAgICAgIHJlc3VsdFtoZWFkZXIubmFtZS50b0xvd2VyQ2FzZSgpXSA9IGhlYWRlci52YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogR2V0IHRoZSBoZWFkZXJzIHRoYXQgYXJlIGNvbnRhaW5lZCBpbiB0aGlzIGNvbGxlY3Rpb24gYXMgYW4gYXJyYXkuCiAgICAgICAgICovCiAgICAgICAgSHR0cEhlYWRlcnMucHJvdG90eXBlLmhlYWRlcnNBcnJheSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGhlYWRlcnMgPSBbXTsKICAgICAgICAgICAgZm9yICh2YXIgaGVhZGVyS2V5IGluIHRoaXMuX2hlYWRlcnNNYXApIHsKICAgICAgICAgICAgICAgIGhlYWRlcnMucHVzaCh0aGlzLl9oZWFkZXJzTWFwW2hlYWRlcktleV0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBoZWFkZXJzOwogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogR2V0IHRoZSBoZWFkZXIgbmFtZXMgdGhhdCBhcmUgY29udGFpbmVkIGluIHRoaXMgY29sbGVjdGlvbi4KICAgICAgICAgKi8KICAgICAgICBIdHRwSGVhZGVycy5wcm90b3R5cGUuaGVhZGVyTmFtZXMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBoZWFkZXJOYW1lcyA9IFtdOwogICAgICAgICAgICB2YXIgaGVhZGVycyA9IHRoaXMuaGVhZGVyc0FycmF5KCk7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaGVhZGVycy5sZW5ndGg7ICsraSkgewogICAgICAgICAgICAgICAgaGVhZGVyTmFtZXMucHVzaChoZWFkZXJzW2ldLm5hbWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBoZWFkZXJOYW1lczsKICAgICAgICB9OwogICAgICAgIC8qKgogICAgICAgICAqIEdldCB0aGUgaGVhZGVyIG5hbWVzIHRoYXQgYXJlIGNvbnRhaW5lZCBpbiB0aGlzIGNvbGxlY3Rpb24uCiAgICAgICAgICovCiAgICAgICAgSHR0cEhlYWRlcnMucHJvdG90eXBlLmhlYWRlclZhbHVlcyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGhlYWRlclZhbHVlcyA9IFtdOwogICAgICAgICAgICB2YXIgaGVhZGVycyA9IHRoaXMuaGVhZGVyc0FycmF5KCk7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaGVhZGVycy5sZW5ndGg7ICsraSkgewogICAgICAgICAgICAgICAgaGVhZGVyVmFsdWVzLnB1c2goaGVhZGVyc1tpXS52YWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGhlYWRlclZhbHVlczsKICAgICAgICB9OwogICAgICAgIC8qKgogICAgICAgICAqIEdldCB0aGUgSlNPTiBvYmplY3QgcmVwcmVzZW50YXRpb24gb2YgdGhpcyBIVFRQIGhlYWRlciBjb2xsZWN0aW9uLgogICAgICAgICAqLwogICAgICAgIEh0dHBIZWFkZXJzLnByb3RvdHlwZS50b0pzb24gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnJhd0hlYWRlcnMoKTsKICAgICAgICB9OwogICAgICAgIC8qKgogICAgICAgICAqIEdldCB0aGUgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgSFRUUCBoZWFkZXIgY29sbGVjdGlvbi4KICAgICAgICAgKi8KICAgICAgICBIdHRwSGVhZGVycy5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh0aGlzLnRvSnNvbigpKTsKICAgICAgICB9OwogICAgICAgIC8qKgogICAgICAgICAqIENyZWF0ZSBhIGRlZXAgY2xvbmUvY29weSBvZiB0aGlzIEh0dHBIZWFkZXJzIGNvbGxlY3Rpb24uCiAgICAgICAgICovCiAgICAgICAgSHR0cEhlYWRlcnMucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IEh0dHBIZWFkZXJzKHRoaXMucmF3SGVhZGVycygpKTsKICAgICAgICB9OwogICAgICAgIHJldHVybiBIdHRwSGVhZGVyczsKICAgIH0oKSk7CgogICAgLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAgICAvKioKICAgICAqIEVuY29kZXMgYSBieXRlIGFycmF5IGluIGJhc2U2NCBmb3JtYXQuCiAgICAgKiBAcGFyYW0gdmFsdWUgdGhlIFVpbnQ4QXJheSB0byBlbmNvZGUKICAgICAqLwogICAgZnVuY3Rpb24gZW5jb2RlQnl0ZUFycmF5KHZhbHVlKSB7CiAgICAgICAgdmFyIHN0ciA9ICIiOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmFsdWUubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgc3RyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUodmFsdWVbaV0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYnRvYShzdHIpOwogICAgfQogICAgLyoqCiAgICAgKiBEZWNvZGVzIGEgYmFzZTY0IHN0cmluZyBpbnRvIGEgYnl0ZSBhcnJheS4KICAgICAqIEBwYXJhbSB2YWx1ZSB0aGUgYmFzZTY0IHN0cmluZyB0byBkZWNvZGUKICAgICAqLwogICAgZnVuY3Rpb24gZGVjb2RlU3RyaW5nKHZhbHVlKSB7CiAgICAgICAgdmFyIGJ5dGVTdHJpbmcgPSBhdG9iKHZhbHVlKTsKICAgICAgICB2YXIgYXJyID0gbmV3IFVpbnQ4QXJyYXkoYnl0ZVN0cmluZy5sZW5ndGgpOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYnl0ZVN0cmluZy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBhcnJbaV0gPSBieXRlU3RyaW5nLmNoYXJDb2RlQXQoaSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhcnI7CiAgICB9CgogICAgZnVuY3Rpb24gY3JlYXRlQ29tbW9uanNNb2R1bGUoZm4sIG1vZHVsZSkgewogICAgCXJldHVybiBtb2R1bGUgPSB7IGV4cG9ydHM6IHt9IH0sIGZuKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMpLCBtb2R1bGUuZXhwb3J0czsKICAgIH0KCiAgICB2YXIgcm5nQnJvd3NlciA9IGNyZWF0ZUNvbW1vbmpzTW9kdWxlKGZ1bmN0aW9uIChtb2R1bGUpIHsKICAgIC8vIFVuaXF1ZSBJRCBjcmVhdGlvbiByZXF1aXJlcyBhIGhpZ2ggcXVhbGl0eSByYW5kb20gIyBnZW5lcmF0b3IuICBJbiB0aGUKICAgIC8vIGJyb3dzZXIgdGhpcyBpcyBhIGxpdHRsZSBjb21wbGljYXRlZCBkdWUgdG8gdW5rbm93biBxdWFsaXR5IG9mIE1hdGgucmFuZG9tKCkKICAgIC8vIGFuZCBpbmNvbnNpc3RlbnQgc3VwcG9ydCBmb3IgdGhlIGBjcnlwdG9gIEFQSS4gIFdlIGRvIHRoZSBiZXN0IHdlIGNhbiB2aWEKICAgIC8vIGZlYXR1cmUtZGV0ZWN0aW9uCgogICAgLy8gZ2V0UmFuZG9tVmFsdWVzIG5lZWRzIHRvIGJlIGludm9rZWQgaW4gYSBjb250ZXh0IHdoZXJlICJ0aGlzIiBpcyBhIENyeXB0bwogICAgLy8gaW1wbGVtZW50YXRpb24uIEFsc28sIGZpbmQgdGhlIGNvbXBsZXRlIGltcGxlbWVudGF0aW9uIG9mIGNyeXB0byBvbiBJRTExLgogICAgdmFyIGdldFJhbmRvbVZhbHVlcyA9ICh0eXBlb2YoY3J5cHRvKSAhPSAndW5kZWZpbmVkJyAmJiBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzICYmIGNyeXB0by5nZXRSYW5kb21WYWx1ZXMuYmluZChjcnlwdG8pKSB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICh0eXBlb2YobXNDcnlwdG8pICE9ICd1bmRlZmluZWQnICYmIHR5cGVvZiB3aW5kb3cubXNDcnlwdG8uZ2V0UmFuZG9tVmFsdWVzID09ICdmdW5jdGlvbicgJiYgbXNDcnlwdG8uZ2V0UmFuZG9tVmFsdWVzLmJpbmQobXNDcnlwdG8pKTsKCiAgICBpZiAoZ2V0UmFuZG9tVmFsdWVzKSB7CiAgICAgIC8vIFdIQVRXRyBjcnlwdG8gUk5HIC0gaHR0cDovL3dpa2kud2hhdHdnLm9yZy93aWtpL0NyeXB0bwogICAgICB2YXIgcm5kczggPSBuZXcgVWludDhBcnJheSgxNik7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tdW5kZWYKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gd2hhdHdnUk5HKCkgewogICAgICAgIGdldFJhbmRvbVZhbHVlcyhybmRzOCk7CiAgICAgICAgcmV0dXJuIHJuZHM4OwogICAgICB9OwogICAgfSBlbHNlIHsKICAgICAgLy8gTWF0aC5yYW5kb20oKS1iYXNlZCAoUk5HKQogICAgICAvLwogICAgICAvLyBJZiBhbGwgZWxzZSBmYWlscywgdXNlIE1hdGgucmFuZG9tKCkuICBJdCdzIGZhc3QsIGJ1dCBpcyBvZiB1bnNwZWNpZmllZAogICAgICAvLyBxdWFsaXR5LgogICAgICB2YXIgcm5kcyA9IG5ldyBBcnJheSgxNik7CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIG1hdGhSTkcoKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIHI7IGkgPCAxNjsgaSsrKSB7CiAgICAgICAgICBpZiAoKGkgJiAweDAzKSA9PT0gMCkgciA9IE1hdGgucmFuZG9tKCkgKiAweDEwMDAwMDAwMDsKICAgICAgICAgIHJuZHNbaV0gPSByID4+PiAoKGkgJiAweDAzKSA8PCAzKSAmIDB4ZmY7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcm5kczsKICAgICAgfTsKICAgIH0KICAgIH0pOwoKICAgIC8qKgogICAgICogQ29udmVydCBhcnJheSBvZiAxNiBieXRlIHZhbHVlcyB0byBVVUlEIHN0cmluZyBmb3JtYXQgb2YgdGhlIGZvcm06CiAgICAgKiBYWFhYWFhYWC1YWFhYLVhYWFgtWFhYWC1YWFhYWFhYWFhYWFgKICAgICAqLwogICAgdmFyIGJ5dGVUb0hleCA9IFtdOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCAyNTY7ICsraSkgewogICAgICBieXRlVG9IZXhbaV0gPSAoaSArIDB4MTAwKS50b1N0cmluZygxNikuc3Vic3RyKDEpOwogICAgfQoKICAgIGZ1bmN0aW9uIGJ5dGVzVG9VdWlkKGJ1Ziwgb2Zmc2V0KSB7CiAgICAgIHZhciBpID0gb2Zmc2V0IHx8IDA7CiAgICAgIHZhciBidGggPSBieXRlVG9IZXg7CiAgICAgIC8vIGpvaW4gdXNlZCB0byBmaXggbWVtb3J5IGlzc3VlIGNhdXNlZCBieSBjb25jYXRlbmF0aW9uOiBodHRwczovL2J1Z3MuY2hyb21pdW0ub3JnL3AvdjgvaXNzdWVzL2RldGFpbD9pZD0zMTc1I2M0CiAgICAgIHJldHVybiAoW2J0aFtidWZbaSsrXV0sIGJ0aFtidWZbaSsrXV0sIAogICAgCWJ0aFtidWZbaSsrXV0sIGJ0aFtidWZbaSsrXV0sICctJywKICAgIAlidGhbYnVmW2krK11dLCBidGhbYnVmW2krK11dLCAnLScsCiAgICAJYnRoW2J1ZltpKytdXSwgYnRoW2J1ZltpKytdXSwgJy0nLAogICAgCWJ0aFtidWZbaSsrXV0sIGJ0aFtidWZbaSsrXV0sICctJywKICAgIAlidGhbYnVmW2krK11dLCBidGhbYnVmW2krK11dLAogICAgCWJ0aFtidWZbaSsrXV0sIGJ0aFtidWZbaSsrXV0sCiAgICAJYnRoW2J1ZltpKytdXSwgYnRoW2J1ZltpKytdXV0pLmpvaW4oJycpOwogICAgfQoKICAgIHZhciBieXRlc1RvVXVpZF8xID0gYnl0ZXNUb1V1aWQ7CgogICAgZnVuY3Rpb24gdjQob3B0aW9ucywgYnVmLCBvZmZzZXQpIHsKICAgICAgdmFyIGkgPSBidWYgJiYgb2Zmc2V0IHx8IDA7CgogICAgICBpZiAodHlwZW9mKG9wdGlvbnMpID09ICdzdHJpbmcnKSB7CiAgICAgICAgYnVmID0gb3B0aW9ucyA9PT0gJ2JpbmFyeScgPyBuZXcgQXJyYXkoMTYpIDogbnVsbDsKICAgICAgICBvcHRpb25zID0gbnVsbDsKICAgICAgfQogICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKCiAgICAgIHZhciBybmRzID0gb3B0aW9ucy5yYW5kb20gfHwgKG9wdGlvbnMucm5nIHx8IHJuZ0Jyb3dzZXIpKCk7CgogICAgICAvLyBQZXIgNC40LCBzZXQgYml0cyBmb3IgdmVyc2lvbiBhbmQgYGNsb2NrX3NlcV9oaV9hbmRfcmVzZXJ2ZWRgCiAgICAgIHJuZHNbNl0gPSAocm5kc1s2XSAmIDB4MGYpIHwgMHg0MDsKICAgICAgcm5kc1s4XSA9IChybmRzWzhdICYgMHgzZikgfCAweDgwOwoKICAgICAgLy8gQ29weSBieXRlcyB0byBidWZmZXIsIGlmIHByb3ZpZGVkCiAgICAgIGlmIChidWYpIHsKICAgICAgICBmb3IgKHZhciBpaSA9IDA7IGlpIDwgMTY7ICsraWkpIHsKICAgICAgICAgIGJ1ZltpICsgaWldID0gcm5kc1tpaV07CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gYnVmIHx8IGJ5dGVzVG9VdWlkXzEocm5kcyk7CiAgICB9CgogICAgdmFyIHY0XzEgPSB2NDsKCiAgICAvLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICAgIC8vIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS4gU2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24uCiAgICB2YXIgQ29uc3RhbnRzID0gewogICAgICAgIC8qKgogICAgICAgICAqIFRoZSBtcy1yZXN0IHZlcnNpb24KICAgICAgICAgKiBAY29uc3QKICAgICAgICAgKiBAdHlwZSB7c3RyaW5nfQogICAgICAgICAqLwogICAgICAgIG1zUmVzdFZlcnNpb246ICIyLjAuNCIsCiAgICAgICAgLyoqCiAgICAgICAgICogU3BlY2lmaWVzIEhUVFAuCiAgICAgICAgICoKICAgICAgICAgKiBAY29uc3QKICAgICAgICAgKiBAdHlwZSB7c3RyaW5nfQogICAgICAgICAqLwogICAgICAgIEhUVFA6ICJodHRwOiIsCiAgICAgICAgLyoqCiAgICAgICAgICogU3BlY2lmaWVzIEhUVFBTLgogICAgICAgICAqCiAgICAgICAgICogQGNvbnN0CiAgICAgICAgICogQHR5cGUge3N0cmluZ30KICAgICAgICAgKi8KICAgICAgICBIVFRQUzogImh0dHBzOiIsCiAgICAgICAgLyoqCiAgICAgICAgICogU3BlY2lmaWVzIEhUVFAgUHJveHkuCiAgICAgICAgICoKICAgICAgICAgKiBAY29uc3QKICAgICAgICAgKiBAdHlwZSB7c3RyaW5nfQogICAgICAgICAqLwogICAgICAgIEhUVFBfUFJPWFk6ICJIVFRQX1BST1hZIiwKICAgICAgICAvKioKICAgICAgICAgKiBTcGVjaWZpZXMgSFRUUFMgUHJveHkuCiAgICAgICAgICoKICAgICAgICAgKiBAY29uc3QKICAgICAgICAgKiBAdHlwZSB7c3RyaW5nfQogICAgICAgICAqLwogICAgICAgIEhUVFBTX1BST1hZOiAiSFRUUFNfUFJPWFkiLAogICAgICAgIEh0dHBDb25zdGFudHM6IHsKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIEh0dHAgVmVyYnMKICAgICAgICAgICAgICoKICAgICAgICAgICAgICogQGNvbnN0CiAgICAgICAgICAgICAqIEBlbnVtIHtzdHJpbmd9CiAgICAgICAgICAgICAqLwogICAgICAgICAgICBIdHRwVmVyYnM6IHsKICAgICAgICAgICAgICAgIFBVVDogIlBVVCIsCiAgICAgICAgICAgICAgICBHRVQ6ICJHRVQiLAogICAgICAgICAgICAgICAgREVMRVRFOiAiREVMRVRFIiwKICAgICAgICAgICAgICAgIFBPU1Q6ICJQT1NUIiwKICAgICAgICAgICAgICAgIE1FUkdFOiAiTUVSR0UiLAogICAgICAgICAgICAgICAgSEVBRDogIkhFQUQiLAogICAgICAgICAgICAgICAgUEFUQ0g6ICJQQVRDSCIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU3RhdHVzQ29kZXM6IHsKICAgICAgICAgICAgICAgIFRvb01hbnlSZXF1ZXN0czogNDI5CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIERlZmluZXMgY29uc3RhbnRzIGZvciB1c2Ugd2l0aCBIVFRQIGhlYWRlcnMuCiAgICAgICAgICovCiAgICAgICAgSGVhZGVyQ29uc3RhbnRzOiB7CiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBUaGUgQXV0aG9yaXphdGlvbiBoZWFkZXIuCiAgICAgICAgICAgICAqCiAgICAgICAgICAgICAqIEBjb25zdAogICAgICAgICAgICAgKiBAdHlwZSB7c3RyaW5nfQogICAgICAgICAgICAgKi8KICAgICAgICAgICAgQVVUSE9SSVpBVElPTjogImF1dGhvcml6YXRpb24iLAogICAgICAgICAgICBBVVRIT1JJWkFUSU9OX1NDSEVNRTogIkJlYXJlciIsCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBUaGUgUmV0cnktQWZ0ZXIgcmVzcG9uc2UtaGVhZGVyIGZpZWxkIGNhbiBiZSB1c2VkIHdpdGggYSA1MDMgKFNlcnZpY2UKICAgICAgICAgICAgICogVW5hdmFpbGFibGUpIG9yIDM0OSAoVG9vIE1hbnkgUmVxdWVzdHMpIHJlc3BvbnNlcyB0byBpbmRpY2F0ZSBob3cgbG9uZwogICAgICAgICAgICAgKiB0aGUgc2VydmljZSBpcyBleHBlY3RlZCB0byBiZSB1bmF2YWlsYWJsZSB0byB0aGUgcmVxdWVzdGluZyBjbGllbnQuCiAgICAgICAgICAgICAqCiAgICAgICAgICAgICAqIEBjb25zdAogICAgICAgICAgICAgKiBAdHlwZSB7c3RyaW5nfQogICAgICAgICAgICAgKi8KICAgICAgICAgICAgUkVUUllfQUZURVI6ICJSZXRyeS1BZnRlciIsCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBUaGUgVXNlckFnZW50IGhlYWRlci4KICAgICAgICAgICAgICoKICAgICAgICAgICAgICogQGNvbnN0CiAgICAgICAgICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgICAgICAgICAqLwogICAgICAgICAgICBVU0VSX0FHRU5UOiAiVXNlci1BZ2VudCIKICAgICAgICB9CiAgICB9OwoKICAgIC8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogICAgLyoqCiAgICAgKiBBIGNvbnN0YW50IHRoYXQgaW5kaWNhdGVzIHdoZXRoZXIgdGhlIGVudmlyb25tZW50IGlzIG5vZGUuanMgb3IgYnJvd3NlciBiYXNlZC4KICAgICAqLwogICAgdmFyIGlzTm9kZSA9ICh0eXBlb2YgcHJvY2VzcyAhPT0gInVuZGVmaW5lZCIpICYmICEhcHJvY2Vzcy52ZXJzaW9uICYmICEhcHJvY2Vzcy52ZXJzaW9ucyAmJiAhIXByb2Nlc3MudmVyc2lvbnMubm9kZTsKICAgIC8qKgogICAgICogUmV0dXJucyBhIHN0cmlwcGVkIHZlcnNpb24gb2YgdGhlIEh0dHAgUmVzcG9uc2Ugd2hpY2ggb25seSBjb250YWlucyBib2R5LAogICAgICogaGVhZGVycyBhbmQgdGhlIHN0YXR1cy4KICAgICAqCiAgICAgKiBAcGFyYW0ge0h0dHBPcGVyYXRpb25SZXNwb25zZX0gcmVzcG9uc2UgVGhlIEh0dHAgUmVzcG9uc2UKICAgICAqCiAgICAgKiBAcmV0dXJuIHtvYmplY3R9IFRoZSBzdHJpcHBlZCB2ZXJzaW9uIG9mIEh0dHAgUmVzcG9uc2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHN0cmlwUmVzcG9uc2UocmVzcG9uc2UpIHsKICAgICAgICB2YXIgc3RyaXBwZWRSZXNwb25zZSA9IHt9OwogICAgICAgIHN0cmlwcGVkUmVzcG9uc2UuYm9keSA9IHJlc3BvbnNlLmJvZHlBc1RleHQ7CiAgICAgICAgc3RyaXBwZWRSZXNwb25zZS5oZWFkZXJzID0gcmVzcG9uc2UuaGVhZGVyczsKICAgICAgICBzdHJpcHBlZFJlc3BvbnNlLnN0YXR1cyA9IHJlc3BvbnNlLnN0YXR1czsKICAgICAgICByZXR1cm4gc3RyaXBwZWRSZXNwb25zZTsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyBhIHN0cmlwcGVkIHZlcnNpb24gb2YgdGhlIEh0dHAgUmVxdWVzdCB0aGF0IGRvZXMgbm90IGNvbnRhaW4gdGhlCiAgICAgKiBBdXRob3JpemF0aW9uIGhlYWRlci4KICAgICAqCiAgICAgKiBAcGFyYW0ge1dlYlJlc291cmNlfSByZXF1ZXN0IFRoZSBIdHRwIFJlcXVlc3Qgb2JqZWN0CiAgICAgKgogICAgICogQHJldHVybiB7V2ViUmVzb3VyY2V9IFRoZSBzdHJpcHBlZCB2ZXJzaW9uIG9mIEh0dHAgUmVxdWVzdC4KICAgICAqLwogICAgZnVuY3Rpb24gc3RyaXBSZXF1ZXN0KHJlcXVlc3QpIHsKICAgICAgICB2YXIgc3RyaXBwZWRSZXF1ZXN0ID0gcmVxdWVzdC5jbG9uZSgpOwogICAgICAgIGlmIChzdHJpcHBlZFJlcXVlc3QuaGVhZGVycykgewogICAgICAgICAgICBzdHJpcHBlZFJlcXVlc3QuaGVhZGVycy5yZW1vdmUoImF1dGhvcml6YXRpb24iKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN0cmlwcGVkUmVxdWVzdDsKICAgIH0KICAgIC8qKgogICAgICogVmFsaWRhdGVzIHRoZSBnaXZlbiB1dWlkIGFzIGEgc3RyaW5nCiAgICAgKgogICAgICogQHBhcmFtIHtzdHJpbmd9IHV1aWQgVGhlIHV1aWQgYXMgYSBzdHJpbmcgdGhhdCBuZWVkcyB0byBiZSB2YWxpZGF0ZWQKICAgICAqCiAgICAgKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIHRoZSB1dWlkIGlzIHZhbGlkOyBmYWxzZSBvdGhlcndpc2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGlzVmFsaWRVdWlkKHV1aWQpIHsKICAgICAgICB2YXIgdmFsaWRVdWlkUmVnZXggPSBuZXcgUmVnRXhwKCJeWzAtOWEtZkEtRl17OH0tWzAtOWEtZkEtRl17NH0tWzAtOWEtZkEtRl17NH0tWzAtOWEtZkEtRl17NH0tWzAtOWEtZkEtRl17MTJ9JCIsICJpZyIpOwogICAgICAgIHJldHVybiB2YWxpZFV1aWRSZWdleC50ZXN0KHV1aWQpOwogICAgfQogICAgLyoqCiAgICAgKiBHZW5lcmF0ZWQgVVVJRAogICAgICoKICAgICAqIEByZXR1cm4ge3N0cmluZ30gUkZDNDEyMiB2NCBVVUlELgogICAgICovCiAgICBmdW5jdGlvbiBnZW5lcmF0ZVV1aWQoKSB7CiAgICAgICAgcmV0dXJuIHY0XzEoKTsKICAgIH0KICAgIC8qKgogICAgICogQSB3cmFwcGVyIGZvciBzZXRUaW1lb3V0IHRoYXQgcmVzb2x2ZXMgYSBwcm9taXNlIGFmdGVyIHQgbWlsbGlzZWNvbmRzLgogICAgICogQHBhcmFtIHtudW1iZXJ9IHQgVGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gYmUgZGVsYXllZC4KICAgICAqIEBwYXJhbSB7VH0gdmFsdWUgVGhlIHZhbHVlIHRvIGJlIHJlc29sdmVkIHdpdGggYWZ0ZXIgYSB0aW1lb3V0IG9mIHQgbWlsbGlzZWNvbmRzLgogICAgICogQHJldHVybnMge1Byb21pc2U8VD59IFJlc29sdmVkIHByb21pc2UKICAgICAqLwogICAgZnVuY3Rpb24gZGVsYXkodCwgdmFsdWUpIHsKICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmV0dXJuIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyByZXR1cm4gcmVzb2x2ZSh2YWx1ZSk7IH0sIHQpOyB9KTsKICAgIH0KICAgIGZ1bmN0aW9uIHByZXBhcmVYTUxSb290TGlzdChvYmosIGVsZW1lbnROYW1lKSB7CiAgICAgICAgdmFyIF9hOwogICAgICAgIGlmICghQXJyYXkuaXNBcnJheShvYmopKSB7CiAgICAgICAgICAgIG9iaiA9IFtvYmpdOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX2EgPSB7fSwgX2FbZWxlbWVudE5hbWVdID0gb2JqLCBfYTsKICAgIH0KICAgIHZhciB2YWxpZGF0ZUlTT0R1cmF0aW9uID0gL14oLXxcKyk/UCg/OihbLStdP1swLTksLl0qKVkpPyg/OihbLStdP1swLTksLl0qKU0pPyg/OihbLStdP1swLTksLl0qKVcpPyg/OihbLStdP1swLTksLl0qKUQpPyg/OlQoPzooWy0rXT9bMC05LC5dKilIKT8oPzooWy0rXT9bMC05LC5dKilNKT8oPzooWy0rXT9bMC05LC5dKilTKT8pPyQvOwogICAgLyoqCiAgICAgKiBJbmRpY2F0ZXMgd2hldGhlciB0aGUgZ2l2ZW4gc3RyaW5nIGlzIGluIElTTyA4NjAxIGZvcm1hdC4KICAgICAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZSBUaGUgdmFsdWUgdG8gYmUgdmFsaWRhdGVkIGZvciBJU08gODYwMSBkdXJhdGlvbiBmb3JtYXQuCiAgICAgKiBAcmV0dXJuIHtib29sZWFufSBgdHJ1ZWAgaWYgdmFsaWQsIGBmYWxzZWAgb3RoZXJ3aXNlLgogICAgICovCiAgICBmdW5jdGlvbiBpc0R1cmF0aW9uKHZhbHVlKSB7CiAgICAgICAgcmV0dXJuIHZhbGlkYXRlSVNPRHVyYXRpb24udGVzdCh2YWx1ZSk7CiAgICB9CiAgICAvKioKICAgICAqIFJlcGxhY2UgYWxsIG9mIHRoZSBpbnN0YW5jZXMgb2Ygc2VhcmNoVmFsdWUgaW4gdmFsdWUgd2l0aCB0aGUgcHJvdmlkZWQgcmVwbGFjZVZhbHVlLgogICAgICogQHBhcmFtIHtzdHJpbmcgfCB1bmRlZmluZWR9IHZhbHVlIFRoZSB2YWx1ZSB0byBzZWFyY2ggYW5kIHJlcGxhY2UgaW4uCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gc2VhcmNoVmFsdWUgVGhlIHZhbHVlIHRvIHNlYXJjaCBmb3IgaW4gdGhlIHZhbHVlIGFyZ3VtZW50LgogICAgICogQHBhcmFtIHtzdHJpbmd9IHJlcGxhY2VWYWx1ZSBUaGUgdmFsdWUgdG8gcmVwbGFjZSBzZWFyY2hWYWx1ZSB3aXRoIGluIHRoZSB2YWx1ZSBhcmd1bWVudC4KICAgICAqIEByZXR1cm5zIHtzdHJpbmcgfCB1bmRlZmluZWR9IFRoZSB2YWx1ZSB3aGVyZSBlYWNoIGluc3RhbmNlIG9mIHNlYXJjaFZhbHVlIHdhcyByZXBsYWNlZCB3aXRoIHJlcGxhY2VkVmFsdWUuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJlcGxhY2VBbGwodmFsdWUsIHNlYXJjaFZhbHVlLCByZXBsYWNlVmFsdWUpIHsKICAgICAgICByZXR1cm4gIXZhbHVlIHx8ICFzZWFyY2hWYWx1ZSA/IHZhbHVlIDogdmFsdWUuc3BsaXQoc2VhcmNoVmFsdWUpLmpvaW4ocmVwbGFjZVZhbHVlIHx8ICIiKTsKICAgIH0KICAgIC8qKgogICAgICogRGV0ZXJtaW5lcyB3aGV0aGVyIHRoZSBnaXZlbiBlbml0eSBpcyBhIGJhc2ljL3ByaW1pdGl2ZSB0eXBlCiAgICAgKiAoc3RyaW5nLCBudW1iZXIsIGJvb2xlYW4sIG51bGwsIHVuZGVmaW5lZCkuCiAgICAgKiBAcGFyYW0gdmFsdWUgQW55IGVudGl0eQogICAgICogQHJldHVybiBib29sZWFuIC0gdHJ1ZSBpcyBpdCBpcyBwcmltaXRpdmUgdHlwZSwgZmFsc2Ugb3RoZXJ3aXNlLgogICAgICovCiAgICBmdW5jdGlvbiBpc1ByaW1pdGl2ZVR5cGUodmFsdWUpIHsKICAgICAgICByZXR1cm4gKHR5cGVvZiB2YWx1ZSAhPT0gIm9iamVjdCIgJiYgdHlwZW9mIHZhbHVlICE9PSAiZnVuY3Rpb24iKSB8fCB2YWx1ZSA9PT0gbnVsbDsKICAgIH0KCiAgICAvLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICAgIHZhciBTZXJpYWxpemVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIFNlcmlhbGl6ZXIobW9kZWxNYXBwZXJzLCBpc1hNTCkgewogICAgICAgICAgICBpZiAobW9kZWxNYXBwZXJzID09PSB2b2lkIDApIHsgbW9kZWxNYXBwZXJzID0ge307IH0KICAgICAgICAgICAgdGhpcy5tb2RlbE1hcHBlcnMgPSBtb2RlbE1hcHBlcnM7CiAgICAgICAgICAgIHRoaXMuaXNYTUwgPSBpc1hNTDsKICAgICAgICB9CiAgICAgICAgU2VyaWFsaXplci5wcm90b3R5cGUudmFsaWRhdGVDb25zdHJhaW50cyA9IGZ1bmN0aW9uIChtYXBwZXIsIHZhbHVlLCBvYmplY3ROYW1lKSB7CiAgICAgICAgICAgIHZhciBmYWlsVmFsaWRhdGlvbiA9IGZ1bmN0aW9uIChjb25zdHJhaW50TmFtZSwgY29uc3RyYWludFZhbHVlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlwiIiArIG9iamVjdE5hbWUgKyAiXCIgd2l0aCB2YWx1ZSBcIiIgKyB2YWx1ZSArICJcIiBzaG91bGQgc2F0aXNmeSB0aGUgY29uc3RyYWludCBcIiIgKyBjb25zdHJhaW50TmFtZSArICJcIjogIiArIGNvbnN0cmFpbnRWYWx1ZSArICIuIik7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGlmIChtYXBwZXIuY29uc3RyYWludHMgJiYgKHZhbHVlICE9IHVuZGVmaW5lZCkpIHsKICAgICAgICAgICAgICAgIHZhciBfYSA9IG1hcHBlci5jb25zdHJhaW50cywgRXhjbHVzaXZlTWF4aW11bSA9IF9hLkV4Y2x1c2l2ZU1heGltdW0sIEV4Y2x1c2l2ZU1pbmltdW0gPSBfYS5FeGNsdXNpdmVNaW5pbXVtLCBJbmNsdXNpdmVNYXhpbXVtID0gX2EuSW5jbHVzaXZlTWF4aW11bSwgSW5jbHVzaXZlTWluaW11bSA9IF9hLkluY2x1c2l2ZU1pbmltdW0sIE1heEl0ZW1zID0gX2EuTWF4SXRlbXMsIE1heExlbmd0aCA9IF9hLk1heExlbmd0aCwgTWluSXRlbXMgPSBfYS5NaW5JdGVtcywgTWluTGVuZ3RoID0gX2EuTWluTGVuZ3RoLCBNdWx0aXBsZU9mID0gX2EuTXVsdGlwbGVPZiwgUGF0dGVybiA9IF9hLlBhdHRlcm4sIFVuaXF1ZUl0ZW1zID0gX2EuVW5pcXVlSXRlbXM7CiAgICAgICAgICAgICAgICBpZiAoRXhjbHVzaXZlTWF4aW11bSAhPSB1bmRlZmluZWQgJiYgdmFsdWUgPj0gRXhjbHVzaXZlTWF4aW11bSkgewogICAgICAgICAgICAgICAgICAgIGZhaWxWYWxpZGF0aW9uKCJFeGNsdXNpdmVNYXhpbXVtIiwgRXhjbHVzaXZlTWF4aW11bSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoRXhjbHVzaXZlTWluaW11bSAhPSB1bmRlZmluZWQgJiYgdmFsdWUgPD0gRXhjbHVzaXZlTWluaW11bSkgewogICAgICAgICAgICAgICAgICAgIGZhaWxWYWxpZGF0aW9uKCJFeGNsdXNpdmVNaW5pbXVtIiwgRXhjbHVzaXZlTWluaW11bSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoSW5jbHVzaXZlTWF4aW11bSAhPSB1bmRlZmluZWQgJiYgdmFsdWUgPiBJbmNsdXNpdmVNYXhpbXVtKSB7CiAgICAgICAgICAgICAgICAgICAgZmFpbFZhbGlkYXRpb24oIkluY2x1c2l2ZU1heGltdW0iLCBJbmNsdXNpdmVNYXhpbXVtKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChJbmNsdXNpdmVNaW5pbXVtICE9IHVuZGVmaW5lZCAmJiB2YWx1ZSA8IEluY2x1c2l2ZU1pbmltdW0pIHsKICAgICAgICAgICAgICAgICAgICBmYWlsVmFsaWRhdGlvbigiSW5jbHVzaXZlTWluaW11bSIsIEluY2x1c2l2ZU1pbmltdW0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKE1heEl0ZW1zICE9IHVuZGVmaW5lZCAmJiB2YWx1ZS5sZW5ndGggPiBNYXhJdGVtcykgewogICAgICAgICAgICAgICAgICAgIGZhaWxWYWxpZGF0aW9uKCJNYXhJdGVtcyIsIE1heEl0ZW1zKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChNYXhMZW5ndGggIT0gdW5kZWZpbmVkICYmIHZhbHVlLmxlbmd0aCA+IE1heExlbmd0aCkgewogICAgICAgICAgICAgICAgICAgIGZhaWxWYWxpZGF0aW9uKCJNYXhMZW5ndGgiLCBNYXhMZW5ndGgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKE1pbkl0ZW1zICE9IHVuZGVmaW5lZCAmJiB2YWx1ZS5sZW5ndGggPCBNaW5JdGVtcykgewogICAgICAgICAgICAgICAgICAgIGZhaWxWYWxpZGF0aW9uKCJNaW5JdGVtcyIsIE1pbkl0ZW1zKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChNaW5MZW5ndGggIT0gdW5kZWZpbmVkICYmIHZhbHVlLmxlbmd0aCA8IE1pbkxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgIGZhaWxWYWxpZGF0aW9uKCJNaW5MZW5ndGgiLCBNaW5MZW5ndGgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKE11bHRpcGxlT2YgIT0gdW5kZWZpbmVkICYmIHZhbHVlICUgTXVsdGlwbGVPZiAhPT0gMCkgewogICAgICAgICAgICAgICAgICAgIGZhaWxWYWxpZGF0aW9uKCJNdWx0aXBsZU9mIiwgTXVsdGlwbGVPZik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoUGF0dGVybikgewogICAgICAgICAgICAgICAgICAgIHZhciBwYXR0ZXJuID0gdHlwZW9mIFBhdHRlcm4gPT09ICJzdHJpbmciID8gbmV3IFJlZ0V4cChQYXR0ZXJuKSA6IFBhdHRlcm47CiAgICAgICAgICAgICAgICAgICAgaWYgKCh0eXBlb2YgdmFsdWUgIT09ICJzdHJpbmciKSB8fCAodmFsdWUubWF0Y2gocGF0dGVybikgPT09IG51bGwpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZhaWxWYWxpZGF0aW9uKCJQYXR0ZXJuIiwgUGF0dGVybik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKFVuaXF1ZUl0ZW1zICYmIHZhbHVlLnNvbWUoZnVuY3Rpb24gKGl0ZW0sIGksIGFyKSB7IHJldHVybiBhci5pbmRleE9mKGl0ZW0pICE9PSBpOyB9KSkgewogICAgICAgICAgICAgICAgICAgIGZhaWxWYWxpZGF0aW9uKCJVbmlxdWVJdGVtcyIsIFVuaXF1ZUl0ZW1zKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogU2VyaWFsaXplIHRoZSBnaXZlbiBvYmplY3QgYmFzZWQgb24gaXRzIG1ldGFkYXRhIGRlZmluZWQgaW4gdGhlIG1hcHBlcgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtNYXBwZXJ9IG1hcHBlciBUaGUgbWFwcGVyIHdoaWNoIGRlZmluZXMgdGhlIG1ldGFkYXRhIG9mIHRoZSBzZXJpYWxpemFibGUgb2JqZWN0CiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge29iamVjdHxzdHJpbmd8QXJyYXl8bnVtYmVyfGJvb2xlYW58RGF0ZXxzdHJlYW19IG9iamVjdCBBIHZhbGlkIEphdmFzY3JpcHQgb2JqZWN0IHRvIGJlIHNlcmlhbGl6ZWQKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBvYmplY3ROYW1lIE5hbWUgb2YgdGhlIHNlcmlhbGl6ZWQgb2JqZWN0CiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJucyB7b2JqZWN0fHN0cmluZ3xBcnJheXxudW1iZXJ8Ym9vbGVhbnxEYXRlfHN0cmVhbX0gQSB2YWxpZCBzZXJpYWxpemVkIEphdmFzY3JpcHQgb2JqZWN0CiAgICAgICAgICovCiAgICAgICAgU2VyaWFsaXplci5wcm90b3R5cGUuc2VyaWFsaXplID0gZnVuY3Rpb24gKG1hcHBlciwgb2JqZWN0LCBvYmplY3ROYW1lKSB7CiAgICAgICAgICAgIHZhciBwYXlsb2FkID0ge307CiAgICAgICAgICAgIHZhciBtYXBwZXJUeXBlID0gbWFwcGVyLnR5cGUubmFtZTsKICAgICAgICAgICAgaWYgKCFvYmplY3ROYW1lKSB7CiAgICAgICAgICAgICAgICBvYmplY3ROYW1lID0gbWFwcGVyLnNlcmlhbGl6ZWROYW1lOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChtYXBwZXJUeXBlLm1hdGNoKC9eU2VxdWVuY2UkL2lnKSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgcGF5bG9hZCA9IFtdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChtYXBwZXIuaXNDb25zdGFudCkgewogICAgICAgICAgICAgICAgb2JqZWN0ID0gbWFwcGVyLmRlZmF1bHRWYWx1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBUaGlzIHRhYmxlIG9mIGFsbG93ZWQgdmFsdWVzIHNob3VsZCBoZWxwIGV4cGxhaW4KICAgICAgICAgICAgLy8gdGhlIG1hcHBlci5yZXF1aXJlZCBhbmQgbWFwcGVyLm51bGxhYmxlIHByb3BlcnRpZXMuCiAgICAgICAgICAgIC8vIFggbWVhbnMgIm5laXRoZXIgdW5kZWZpbmVkIG9yIG51bGwgYXJlIGFsbG93ZWQiLgogICAgICAgICAgICAvLyAgICAgICAgICAgfHwgcmVxdWlyZWQKICAgICAgICAgICAgLy8gICAgICAgICAgIHx8IHRydWUgICAgICB8IGZhbHNlCiAgICAgICAgICAgIC8vICBudWxsYWJsZSB8fCA9PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgICAgICAgICAvLyAgICAgIHRydWUgfHwgbnVsbCAgICAgIHwgdW5kZWZpbmVkL251bGwKICAgICAgICAgICAgLy8gICAgIGZhbHNlIHx8IFggICAgICAgICB8IHVuZGVmaW5lZAogICAgICAgICAgICAvLyB1bmRlZmluZWQgfHwgWCAgICAgICAgIHwgdW5kZWZpbmVkL251bGwKICAgICAgICAgICAgdmFyIHJlcXVpcmVkID0gbWFwcGVyLnJlcXVpcmVkLCBudWxsYWJsZSA9IG1hcHBlci5udWxsYWJsZTsKICAgICAgICAgICAgaWYgKHJlcXVpcmVkICYmIG51bGxhYmxlICYmIG9iamVjdCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3Iob2JqZWN0TmFtZSArICIgY2Fubm90IGJlIHVuZGVmaW5lZC4iKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocmVxdWlyZWQgJiYgIW51bGxhYmxlICYmIG9iamVjdCA9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihvYmplY3ROYW1lICsgIiBjYW5ub3QgYmUgbnVsbCBvciB1bmRlZmluZWQuIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFyZXF1aXJlZCAmJiBudWxsYWJsZSA9PT0gZmFsc2UgJiYgb2JqZWN0ID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3Iob2JqZWN0TmFtZSArICIgY2Fubm90IGJlIG51bGwuIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG9iamVjdCA9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHBheWxvYWQgPSBvYmplY3Q7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBWYWxpZGF0ZSBDb25zdHJhaW50cyBpZiBhbnkKICAgICAgICAgICAgICAgIHRoaXMudmFsaWRhdGVDb25zdHJhaW50cyhtYXBwZXIsIG9iamVjdCwgb2JqZWN0TmFtZSk7CiAgICAgICAgICAgICAgICBpZiAobWFwcGVyVHlwZS5tYXRjaCgvXmFueSQvaWcpICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgcGF5bG9hZCA9IG9iamVjdDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKG1hcHBlclR5cGUubWF0Y2goL14oTnVtYmVyfFN0cmluZ3xCb29sZWFufE9iamVjdHxTdHJlYW18VXVpZCkkL2lnKSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHBheWxvYWQgPSBzZXJpYWxpemVCYXNpY1R5cGVzKG1hcHBlclR5cGUsIG9iamVjdE5hbWUsIG9iamVjdCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmIChtYXBwZXJUeXBlLm1hdGNoKC9eRW51bSQvaWcpICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGVudW1NYXBwZXIgPSBtYXBwZXI7CiAgICAgICAgICAgICAgICAgICAgcGF5bG9hZCA9IHNlcmlhbGl6ZUVudW1UeXBlKG9iamVjdE5hbWUsIGVudW1NYXBwZXIudHlwZS5hbGxvd2VkVmFsdWVzLCBvYmplY3QpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSBpZiAobWFwcGVyVHlwZS5tYXRjaCgvXihEYXRlfERhdGVUaW1lfFRpbWVTcGFufERhdGVUaW1lUmZjMTEyM3xVbml4VGltZSkkL2lnKSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHBheWxvYWQgPSBzZXJpYWxpemVEYXRlVHlwZXMobWFwcGVyVHlwZSwgb2JqZWN0LCBvYmplY3ROYW1lKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKG1hcHBlclR5cGUubWF0Y2goL15CeXRlQXJyYXkkL2lnKSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHBheWxvYWQgPSBzZXJpYWxpemVCeXRlQXJyYXlUeXBlKG9iamVjdE5hbWUsIG9iamVjdCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmIChtYXBwZXJUeXBlLm1hdGNoKC9eQmFzZTY0VXJsJC9pZykgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBwYXlsb2FkID0gc2VyaWFsaXplQmFzZTY0VXJsVHlwZShvYmplY3ROYW1lLCBvYmplY3QpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSBpZiAobWFwcGVyVHlwZS5tYXRjaCgvXlNlcXVlbmNlJC9pZykgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBwYXlsb2FkID0gc2VyaWFsaXplU2VxdWVuY2VUeXBlKHRoaXMsIG1hcHBlciwgb2JqZWN0LCBvYmplY3ROYW1lKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKG1hcHBlclR5cGUubWF0Y2goL15EaWN0aW9uYXJ5JC9pZykgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBwYXlsb2FkID0gc2VyaWFsaXplRGljdGlvbmFyeVR5cGUodGhpcywgbWFwcGVyLCBvYmplY3QsIG9iamVjdE5hbWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSBpZiAobWFwcGVyVHlwZS5tYXRjaCgvXkNvbXBvc2l0ZSQvaWcpICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgcGF5bG9hZCA9IHNlcmlhbGl6ZUNvbXBvc2l0ZVR5cGUodGhpcywgbWFwcGVyLCBvYmplY3QsIG9iamVjdE5hbWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBwYXlsb2FkOwogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogRGVzZXJpYWxpemUgdGhlIGdpdmVuIG9iamVjdCBiYXNlZCBvbiBpdHMgbWV0YWRhdGEgZGVmaW5lZCBpbiB0aGUgbWFwcGVyCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge29iamVjdH0gbWFwcGVyIFRoZSBtYXBwZXIgd2hpY2ggZGVmaW5lcyB0aGUgbWV0YWRhdGEgb2YgdGhlIHNlcmlhbGl6YWJsZSBvYmplY3QKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7b2JqZWN0fHN0cmluZ3xBcnJheXxudW1iZXJ8Ym9vbGVhbnxEYXRlfHN0cmVhbX0gcmVzcG9uc2VCb2R5IEEgdmFsaWQgSmF2YXNjcmlwdCBlbnRpdHkgdG8gYmUgZGVzZXJpYWxpemVkCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gb2JqZWN0TmFtZSBOYW1lIG9mIHRoZSBkZXNlcmlhbGl6ZWQgb2JqZWN0CiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJucyB7b2JqZWN0fHN0cmluZ3xBcnJheXxudW1iZXJ8Ym9vbGVhbnxEYXRlfHN0cmVhbX0gQSB2YWxpZCBkZXNlcmlhbGl6ZWQgSmF2YXNjcmlwdCBvYmplY3QKICAgICAgICAgKi8KICAgICAgICBTZXJpYWxpemVyLnByb3RvdHlwZS5kZXNlcmlhbGl6ZSA9IGZ1bmN0aW9uIChtYXBwZXIsIHJlc3BvbnNlQm9keSwgb2JqZWN0TmFtZSkgewogICAgICAgICAgICBpZiAocmVzcG9uc2VCb2R5ID09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNYTUwgJiYgbWFwcGVyLnR5cGUubmFtZSA9PT0gIlNlcXVlbmNlIiAmJiAhbWFwcGVyLnhtbElzV3JhcHBlZCkgewogICAgICAgICAgICAgICAgICAgIC8vIEVkZ2UgY2FzZSBmb3IgZW1wdHkgWE1MIG5vbi13cmFwcGVkIGxpc3RzLiB4bWwyanMgY2FuJ3QgZGlzdGluZ3Vpc2gKICAgICAgICAgICAgICAgICAgICAvLyBiZXR3ZWVuIHRoZSBsaXN0IGJlaW5nIGVtcHR5IHZlcnN1cyBiZWluZyBtaXNzaW5nLAogICAgICAgICAgICAgICAgICAgIC8vIHNvIGxldCdzIGRvIHRoZSBtb3JlIHVzZXItZnJpZW5kbHkgdGhpbmcgYW5kIHJldHVybiBhbiBlbXB0eSBsaXN0LgogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlQm9keSA9IFtdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gc3BlY2lmaWNhbGx5IGNoZWNrIGZvciB1bmRlZmluZWQgYXMgZGVmYXVsdCB2YWx1ZSBjYW4gYmUgYSBmYWxzZXkgdmFsdWUgYDAsICIiLCBmYWxzZSwgbnVsbGAKICAgICAgICAgICAgICAgIGlmIChtYXBwZXIuZGVmYXVsdFZhbHVlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICByZXNwb25zZUJvZHkgPSBtYXBwZXIuZGVmYXVsdFZhbHVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlQm9keTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgcGF5bG9hZDsKICAgICAgICAgICAgdmFyIG1hcHBlclR5cGUgPSBtYXBwZXIudHlwZS5uYW1lOwogICAgICAgICAgICBpZiAoIW9iamVjdE5hbWUpIHsKICAgICAgICAgICAgICAgIG9iamVjdE5hbWUgPSBtYXBwZXIuc2VyaWFsaXplZE5hbWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG1hcHBlclR5cGUubWF0Y2goL15Db21wb3NpdGUkL2lnKSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgcGF5bG9hZCA9IGRlc2VyaWFsaXplQ29tcG9zaXRlVHlwZSh0aGlzLCBtYXBwZXIsIHJlc3BvbnNlQm9keSwgb2JqZWN0TmFtZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc1hNTCkgewogICAgICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICAgICAqIElmIHRoZSBtYXBwZXIgc3BlY2lmaWVzIHRoaXMgYXMgYSBub24tY29tcG9zaXRlIHR5cGUgdmFsdWUgYnV0IHRoZSByZXNwb25zZUJvZHkgY29udGFpbnMKICAgICAgICAgICAgICAgICAgICAgKiBib3RoIGhlYWRlciAoIiQiKSBhbmQgYm9keSAoIl8iKSBwcm9wZXJ0aWVzLCB0aGVuIGp1c3QgcmVkdWNlIHRoZSByZXNwb25zZUJvZHkgdmFsdWUgdG8KICAgICAgICAgICAgICAgICAgICAgKiB0aGUgYm9keSAoIl8iKSBwcm9wZXJ0eS4KICAgICAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2VCb2R5WyIkIl0gIT0gdW5kZWZpbmVkICYmIHJlc3BvbnNlQm9keVsiXyJdICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZUJvZHkgPSByZXNwb25zZUJvZHlbIl8iXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAobWFwcGVyVHlwZS5tYXRjaCgvXk51bWJlciQvaWcpICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgcGF5bG9hZCA9IHBhcnNlRmxvYXQocmVzcG9uc2VCb2R5KTsKICAgICAgICAgICAgICAgICAgICBpZiAoaXNOYU4ocGF5bG9hZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGF5bG9hZCA9IHJlc3BvbnNlQm9keTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmIChtYXBwZXJUeXBlLm1hdGNoKC9eQm9vbGVhbiQvaWcpICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlQm9keSA9PT0gInRydWUiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBheWxvYWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChyZXNwb25zZUJvZHkgPT09ICJmYWxzZSIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGF5bG9hZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGF5bG9hZCA9IHJlc3BvbnNlQm9keTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmIChtYXBwZXJUeXBlLm1hdGNoKC9eKFN0cmluZ3xFbnVtfE9iamVjdHxTdHJlYW18VXVpZHxUaW1lU3BhbnxhbnkpJC9pZykgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBwYXlsb2FkID0gcmVzcG9uc2VCb2R5OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSBpZiAobWFwcGVyVHlwZS5tYXRjaCgvXihEYXRlfERhdGVUaW1lfERhdGVUaW1lUmZjMTEyMykkL2lnKSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHBheWxvYWQgPSBuZXcgRGF0ZShyZXNwb25zZUJvZHkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSBpZiAobWFwcGVyVHlwZS5tYXRjaCgvXlVuaXhUaW1lJC9pZykgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBwYXlsb2FkID0gdW5peFRpbWVUb0RhdGUocmVzcG9uc2VCb2R5KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKG1hcHBlclR5cGUubWF0Y2goL15CeXRlQXJyYXkkL2lnKSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHBheWxvYWQgPSBkZWNvZGVTdHJpbmcocmVzcG9uc2VCb2R5KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKG1hcHBlclR5cGUubWF0Y2goL15CYXNlNjRVcmwkL2lnKSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHBheWxvYWQgPSBiYXNlNjRVcmxUb0J5dGVBcnJheShyZXNwb25zZUJvZHkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSBpZiAobWFwcGVyVHlwZS5tYXRjaCgvXlNlcXVlbmNlJC9pZykgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBwYXlsb2FkID0gZGVzZXJpYWxpemVTZXF1ZW5jZVR5cGUodGhpcywgbWFwcGVyLCByZXNwb25zZUJvZHksIG9iamVjdE5hbWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSBpZiAobWFwcGVyVHlwZS5tYXRjaCgvXkRpY3Rpb25hcnkkL2lnKSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHBheWxvYWQgPSBkZXNlcmlhbGl6ZURpY3Rpb25hcnlUeXBlKHRoaXMsIG1hcHBlciwgcmVzcG9uc2VCb2R5LCBvYmplY3ROYW1lKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobWFwcGVyLmlzQ29uc3RhbnQpIHsKICAgICAgICAgICAgICAgIHBheWxvYWQgPSBtYXBwZXIuZGVmYXVsdFZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBwYXlsb2FkOwogICAgICAgIH07CiAgICAgICAgcmV0dXJuIFNlcmlhbGl6ZXI7CiAgICB9KCkpOwogICAgZnVuY3Rpb24gdHJpbUVuZChzdHIsIGNoKSB7CiAgICAgICAgdmFyIGxlbiA9IHN0ci5sZW5ndGg7CiAgICAgICAgd2hpbGUgKChsZW4gLSAxKSA+PSAwICYmIHN0cltsZW4gLSAxXSA9PT0gY2gpIHsKICAgICAgICAgICAgLS1sZW47CiAgICAgICAgfQogICAgICAgIHJldHVybiBzdHIuc3Vic3RyKDAsIGxlbik7CiAgICB9CiAgICBmdW5jdGlvbiBidWZmZXJUb0Jhc2U2NFVybChidWZmZXIpIHsKICAgICAgICBpZiAoIWJ1ZmZlcikgewogICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgIH0KICAgICAgICBpZiAoIShidWZmZXIgaW5zdGFuY2VvZiBVaW50OEFycmF5KSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlBsZWFzZSBwcm92aWRlIGFuIGlucHV0IG9mIHR5cGUgVWludDhBcnJheSBmb3IgY29udmVydGluZyB0byBCYXNlNjRVcmwuIik7CiAgICAgICAgfQogICAgICAgIC8vIFVpbnQ4QXJyYXkgdG8gQmFzZTY0LgogICAgICAgIHZhciBzdHIgPSBlbmNvZGVCeXRlQXJyYXkoYnVmZmVyKTsKICAgICAgICAvLyBCYXNlNjQgdG8gQmFzZTY0VXJsLgogICAgICAgIHJldHVybiB0cmltRW5kKHN0ciwgIj0iKS5yZXBsYWNlKC9cKy9nLCAiLSIpLnJlcGxhY2UoL1wvL2csICJfIik7CiAgICB9CiAgICBmdW5jdGlvbiBiYXNlNjRVcmxUb0J5dGVBcnJheShzdHIpIHsKICAgICAgICBpZiAoIXN0cikgewogICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgIH0KICAgICAgICBpZiAoc3RyICYmIHR5cGVvZiBzdHIudmFsdWVPZigpICE9PSAic3RyaW5nIikgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlBsZWFzZSBwcm92aWRlIGFuIGlucHV0IG9mIHR5cGUgc3RyaW5nIGZvciBjb252ZXJ0aW5nIHRvIFVpbnQ4QXJyYXkiKTsKICAgICAgICB9CiAgICAgICAgLy8gQmFzZTY0VXJsIHRvIEJhc2U2NC4KICAgICAgICBzdHIgPSBzdHIucmVwbGFjZSgvXC0vZywgIisiKS5yZXBsYWNlKC9cXy9nLCAiLyIpOwogICAgICAgIC8vIEJhc2U2NCB0byBVaW50OEFycmF5LgogICAgICAgIHJldHVybiBkZWNvZGVTdHJpbmcoc3RyKTsKICAgIH0KICAgIGZ1bmN0aW9uIHNwbGl0U2VyaWFsaXplTmFtZShwcm9wKSB7CiAgICAgICAgdmFyIGNsYXNzZXMgPSBbXTsKICAgICAgICB2YXIgcGFydGlhbGNsYXNzID0gIiI7CiAgICAgICAgaWYgKHByb3ApIHsKICAgICAgICAgICAgdmFyIHN1YndvcmRzID0gcHJvcC5zcGxpdCgiLiIpOwogICAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIHN1YndvcmRzXzEgPSBzdWJ3b3JkczsgX2kgPCBzdWJ3b3Jkc18xLmxlbmd0aDsgX2krKykgewogICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBzdWJ3b3Jkc18xW19pXTsKICAgICAgICAgICAgICAgIGlmIChpdGVtLmNoYXJBdChpdGVtLmxlbmd0aCAtIDEpID09PSAiXFwiKSB7CiAgICAgICAgICAgICAgICAgICAgcGFydGlhbGNsYXNzICs9IGl0ZW0uc3Vic3RyKDAsIGl0ZW0ubGVuZ3RoIC0gMSkgKyAiLiI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBwYXJ0aWFsY2xhc3MgKz0gaXRlbTsKICAgICAgICAgICAgICAgICAgICBjbGFzc2VzLnB1c2gocGFydGlhbGNsYXNzKTsKICAgICAgICAgICAgICAgICAgICBwYXJ0aWFsY2xhc3MgPSAiIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gY2xhc3NlczsKICAgIH0KICAgIGZ1bmN0aW9uIGRhdGVUb1VuaXhUaW1lKGQpIHsKICAgICAgICBpZiAoIWQpIHsKICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICB9CiAgICAgICAgaWYgKHR5cGVvZiBkLnZhbHVlT2YoKSA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgZCA9IG5ldyBEYXRlKGQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihkLmdldFRpbWUoKSAvIDEwMDApOwogICAgfQogICAgZnVuY3Rpb24gdW5peFRpbWVUb0RhdGUobikgewogICAgICAgIGlmICghbikgewogICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IERhdGUobiAqIDEwMDApOwogICAgfQogICAgZnVuY3Rpb24gc2VyaWFsaXplQmFzaWNUeXBlcyh0eXBlTmFtZSwgb2JqZWN0TmFtZSwgdmFsdWUpIHsKICAgICAgICBpZiAodmFsdWUgIT09IG51bGwgJiYgdmFsdWUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBpZiAodHlwZU5hbWUubWF0Y2goL15OdW1iZXIkL2lnKSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gIm51bWJlciIpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3Iob2JqZWN0TmFtZSArICIgd2l0aCB2YWx1ZSAiICsgdmFsdWUgKyAiIG11c3QgYmUgb2YgdHlwZSBudW1iZXIuIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAodHlwZU5hbWUubWF0Y2goL15TdHJpbmckL2lnKSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZS52YWx1ZU9mKCkgIT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG9iamVjdE5hbWUgKyAiIHdpdGggdmFsdWUgXCIiICsgdmFsdWUgKyAiXCIgbXVzdCBiZSBvZiB0eXBlIHN0cmluZy4iKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmICh0eXBlTmFtZS5tYXRjaCgvXlV1aWQkL2lnKSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKCEodHlwZW9mIHZhbHVlLnZhbHVlT2YoKSA9PT0gInN0cmluZyIgJiYgaXNWYWxpZFV1aWQodmFsdWUpKSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihvYmplY3ROYW1lICsgIiB3aXRoIHZhbHVlIFwiIiArIHZhbHVlICsgIlwiIG11c3QgYmUgb2YgdHlwZSBzdHJpbmcgYW5kIGEgdmFsaWQgdXVpZC4iKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmICh0eXBlTmFtZS5tYXRjaCgvXkJvb2xlYW4kL2lnKSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gImJvb2xlYW4iKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG9iamVjdE5hbWUgKyAiIHdpdGggdmFsdWUgIiArIHZhbHVlICsgIiBtdXN0IGJlIG9mIHR5cGUgYm9vbGVhbi4iKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmICh0eXBlTmFtZS5tYXRjaCgvXlN0cmVhbSQvaWcpICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICB2YXIgb2JqZWN0VHlwZSA9IHR5cGVvZiB2YWx1ZTsKICAgICAgICAgICAgICAgIGlmIChvYmplY3RUeXBlICE9PSAic3RyaW5nIiAmJgogICAgICAgICAgICAgICAgICAgIG9iamVjdFR5cGUgIT09ICJmdW5jdGlvbiIgJiYKICAgICAgICAgICAgICAgICAgICAhKHZhbHVlIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpICYmCiAgICAgICAgICAgICAgICAgICAgIUFycmF5QnVmZmVyLmlzVmlldyh2YWx1ZSkgJiYKICAgICAgICAgICAgICAgICAgICAhKHR5cGVvZiBCbG9iID09PSAiZnVuY3Rpb24iICYmIHZhbHVlIGluc3RhbmNlb2YgQmxvYikpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3Iob2JqZWN0TmFtZSArICIgbXVzdCBiZSBhIHN0cmluZywgQmxvYiwgQXJyYXlCdWZmZXIsIEFycmF5QnVmZmVyVmlldywgb3IgYSBmdW5jdGlvbiByZXR1cm5pbmcgTm9kZUpTLlJlYWRhYmxlU3RyZWFtLiIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0KICAgIGZ1bmN0aW9uIHNlcmlhbGl6ZUVudW1UeXBlKG9iamVjdE5hbWUsIGFsbG93ZWRWYWx1ZXMsIHZhbHVlKSB7CiAgICAgICAgaWYgKCFhbGxvd2VkVmFsdWVzKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiUGxlYXNlIHByb3ZpZGUgYSBzZXQgb2YgYWxsb3dlZFZhbHVlcyB0byB2YWxpZGF0ZSAiICsgb2JqZWN0TmFtZSArICIgYXMgYW4gRW51bSBUeXBlLiIpOwogICAgICAgIH0KICAgICAgICB2YXIgaXNQcmVzZW50ID0gYWxsb3dlZFZhbHVlcy5zb21lKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgaXRlbS52YWx1ZU9mKCkgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS50b0xvd2VyQ2FzZSgpID09PSB2YWx1ZS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBpdGVtID09PSB2YWx1ZTsKICAgICAgICB9KTsKICAgICAgICBpZiAoIWlzUHJlc2VudCkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IodmFsdWUgKyAiIGlzIG5vdCBhIHZhbGlkIHZhbHVlIGZvciAiICsgb2JqZWN0TmFtZSArICIuIFRoZSB2YWxpZCB2YWx1ZXMgYXJlOiAiICsgSlNPTi5zdHJpbmdpZnkoYWxsb3dlZFZhbHVlcykgKyAiLiIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdmFsdWU7CiAgICB9CiAgICBmdW5jdGlvbiBzZXJpYWxpemVCeXRlQXJyYXlUeXBlKG9iamVjdE5hbWUsIHZhbHVlKSB7CiAgICAgICAgaWYgKHZhbHVlICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICBpZiAoISh2YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3Iob2JqZWN0TmFtZSArICIgbXVzdCBiZSBvZiB0eXBlIFVpbnQ4QXJyYXkuIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFsdWUgPSBlbmNvZGVCeXRlQXJyYXkodmFsdWUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdmFsdWU7CiAgICB9CiAgICBmdW5jdGlvbiBzZXJpYWxpemVCYXNlNjRVcmxUeXBlKG9iamVjdE5hbWUsIHZhbHVlKSB7CiAgICAgICAgaWYgKHZhbHVlICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICBpZiAoISh2YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3Iob2JqZWN0TmFtZSArICIgbXVzdCBiZSBvZiB0eXBlIFVpbnQ4QXJyYXkuIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFsdWUgPSBidWZmZXJUb0Jhc2U2NFVybCh2YWx1ZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0KICAgIGZ1bmN0aW9uIHNlcmlhbGl6ZURhdGVUeXBlcyh0eXBlTmFtZSwgdmFsdWUsIG9iamVjdE5hbWUpIHsKICAgICAgICBpZiAodmFsdWUgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGlmICh0eXBlTmFtZS5tYXRjaCgvXkRhdGUkL2lnKSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKCEodmFsdWUgaW5zdGFuY2VvZiBEYXRlIHx8CiAgICAgICAgICAgICAgICAgICAgKHR5cGVvZiB2YWx1ZS52YWx1ZU9mKCkgPT09ICJzdHJpbmciICYmICFpc05hTihEYXRlLnBhcnNlKHZhbHVlKSkpKSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihvYmplY3ROYW1lICsgIiBtdXN0IGJlIGFuIGluc3RhbmNlb2YgRGF0ZSBvciBhIHN0cmluZyBpbiBJU084NjAxIGZvcm1hdC4iKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhbHVlID0gKHZhbHVlIGluc3RhbmNlb2YgRGF0ZSkgPyB2YWx1ZS50b0lTT1N0cmluZygpLnN1YnN0cmluZygwLCAxMCkgOiBuZXcgRGF0ZSh2YWx1ZSkudG9JU09TdHJpbmcoKS5zdWJzdHJpbmcoMCwgMTApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVOYW1lLm1hdGNoKC9eRGF0ZVRpbWUkL2lnKSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKCEodmFsdWUgaW5zdGFuY2VvZiBEYXRlIHx8CiAgICAgICAgICAgICAgICAgICAgKHR5cGVvZiB2YWx1ZS52YWx1ZU9mKCkgPT09ICJzdHJpbmciICYmICFpc05hTihEYXRlLnBhcnNlKHZhbHVlKSkpKSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihvYmplY3ROYW1lICsgIiBtdXN0IGJlIGFuIGluc3RhbmNlb2YgRGF0ZSBvciBhIHN0cmluZyBpbiBJU084NjAxIGZvcm1hdC4iKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhbHVlID0gKHZhbHVlIGluc3RhbmNlb2YgRGF0ZSkgPyB2YWx1ZS50b0lTT1N0cmluZygpIDogbmV3IERhdGUodmFsdWUpLnRvSVNPU3RyaW5nKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAodHlwZU5hbWUubWF0Y2goL15EYXRlVGltZVJmYzExMjMkL2lnKSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKCEodmFsdWUgaW5zdGFuY2VvZiBEYXRlIHx8CiAgICAgICAgICAgICAgICAgICAgKHR5cGVvZiB2YWx1ZS52YWx1ZU9mKCkgPT09ICJzdHJpbmciICYmICFpc05hTihEYXRlLnBhcnNlKHZhbHVlKSkpKSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihvYmplY3ROYW1lICsgIiBtdXN0IGJlIGFuIGluc3RhbmNlb2YgRGF0ZSBvciBhIHN0cmluZyBpbiBSRkMtMTEyMyBmb3JtYXQuIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB2YWx1ZSA9ICh2YWx1ZSBpbnN0YW5jZW9mIERhdGUpID8gdmFsdWUudG9VVENTdHJpbmcoKSA6IG5ldyBEYXRlKHZhbHVlKS50b1VUQ1N0cmluZygpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVOYW1lLm1hdGNoKC9eVW5peFRpbWUkL2lnKSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKCEodmFsdWUgaW5zdGFuY2VvZiBEYXRlIHx8CiAgICAgICAgICAgICAgICAgICAgKHR5cGVvZiB2YWx1ZS52YWx1ZU9mKCkgPT09ICJzdHJpbmciICYmICFpc05hTihEYXRlLnBhcnNlKHZhbHVlKSkpKSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihvYmplY3ROYW1lICsgIiBtdXN0IGJlIGFuIGluc3RhbmNlb2YgRGF0ZSBvciBhIHN0cmluZyBpbiBSRkMtMTEyMy9JU084NjAxIGZvcm1hdCAiICsKICAgICAgICAgICAgICAgICAgICAgICAgImZvciBpdCB0byBiZSBzZXJpYWxpemVkIGluIFVuaXhUaW1lL0Vwb2NoIGZvcm1hdC4iKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhbHVlID0gZGF0ZVRvVW5peFRpbWUodmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVOYW1lLm1hdGNoKC9eVGltZVNwYW4kL2lnKSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKCFpc0R1cmF0aW9uKHZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihvYmplY3ROYW1lICsgIiBtdXN0IGJlIGEgc3RyaW5nIGluIElTTyA4NjAxIGZvcm1hdC4gSW5zdGVhZCB3YXMgXCIiICsgdmFsdWUgKyAiXCIuIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0KICAgIGZ1bmN0aW9uIHNlcmlhbGl6ZVNlcXVlbmNlVHlwZShzZXJpYWxpemVyLCBtYXBwZXIsIG9iamVjdCwgb2JqZWN0TmFtZSkgewogICAgICAgIGlmICghQXJyYXkuaXNBcnJheShvYmplY3QpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihvYmplY3ROYW1lICsgIiBtdXN0IGJlIG9mIHR5cGUgQXJyYXkuIik7CiAgICAgICAgfQogICAgICAgIHZhciBlbGVtZW50VHlwZSA9IG1hcHBlci50eXBlLmVsZW1lbnQ7CiAgICAgICAgaWYgKCFlbGVtZW50VHlwZSB8fCB0eXBlb2YgZWxlbWVudFR5cGUgIT09ICJvYmplY3QiKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiZWxlbWVudFwiIG1ldGFkYXRhIGZvciBhbiBBcnJheSBtdXN0IGJlIGRlZmluZWQgaW4gdGhlICIgKwogICAgICAgICAgICAgICAgKCJtYXBwZXIgYW5kIGl0IG11c3Qgb2YgdHlwZSBcIm9iamVjdFwiIGluICIgKyBvYmplY3ROYW1lICsgIi4iKSk7CiAgICAgICAgfQogICAgICAgIHZhciB0ZW1wQXJyYXkgPSBbXTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iamVjdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB0ZW1wQXJyYXlbaV0gPSBzZXJpYWxpemVyLnNlcmlhbGl6ZShlbGVtZW50VHlwZSwgb2JqZWN0W2ldLCBvYmplY3ROYW1lKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRlbXBBcnJheTsKICAgIH0KICAgIGZ1bmN0aW9uIHNlcmlhbGl6ZURpY3Rpb25hcnlUeXBlKHNlcmlhbGl6ZXIsIG1hcHBlciwgb2JqZWN0LCBvYmplY3ROYW1lKSB7CiAgICAgICAgaWYgKHR5cGVvZiBvYmplY3QgIT09ICJvYmplY3QiKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihvYmplY3ROYW1lICsgIiBtdXN0IGJlIG9mIHR5cGUgb2JqZWN0LiIpOwogICAgICAgIH0KICAgICAgICB2YXIgdmFsdWVUeXBlID0gbWFwcGVyLnR5cGUudmFsdWU7CiAgICAgICAgaWYgKCF2YWx1ZVR5cGUgfHwgdHlwZW9mIHZhbHVlVHlwZSAhPT0gIm9iamVjdCIpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJcInZhbHVlXCIgbWV0YWRhdGEgZm9yIGEgRGljdGlvbmFyeSBtdXN0IGJlIGRlZmluZWQgaW4gdGhlICIgKwogICAgICAgICAgICAgICAgKCJtYXBwZXIgYW5kIGl0IG11c3Qgb2YgdHlwZSBcIm9iamVjdFwiIGluICIgKyBvYmplY3ROYW1lICsgIi4iKSk7CiAgICAgICAgfQogICAgICAgIHZhciB0ZW1wRGljdGlvbmFyeSA9IHt9OwogICAgICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSBPYmplY3Qua2V5cyhvYmplY3QpOyBfaSA8IF9hLmxlbmd0aDsgX2krKykgewogICAgICAgICAgICB2YXIga2V5ID0gX2FbX2ldOwogICAgICAgICAgICB0ZW1wRGljdGlvbmFyeVtrZXldID0gc2VyaWFsaXplci5zZXJpYWxpemUodmFsdWVUeXBlLCBvYmplY3Rba2V5XSwgb2JqZWN0TmFtZSArICIuIiArIGtleSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0ZW1wRGljdGlvbmFyeTsKICAgIH0KICAgIC8qKgogICAgICogUmVzb2x2ZXMgYSBjb21wb3NpdGUgbWFwcGVyJ3MgbW9kZWxQcm9wZXJ0aWVzLgogICAgICogQHBhcmFtIHNlcmlhbGl6ZXIgdGhlIHNlcmlhbGl6ZXIgY29udGFpbmluZyB0aGUgZW50aXJlIHNldCBvZiBtYXBwZXJzCiAgICAgKiBAcGFyYW0gbWFwcGVyIHRoZSBjb21wb3NpdGUgbWFwcGVyIHRvIHJlc29sdmUKICAgICAqLwogICAgZnVuY3Rpb24gcmVzb2x2ZU1vZGVsUHJvcGVydGllcyhzZXJpYWxpemVyLCBtYXBwZXIsIG9iamVjdE5hbWUpIHsKICAgICAgICB2YXIgbW9kZWxQcm9wcyA9IG1hcHBlci50eXBlLm1vZGVsUHJvcGVydGllczsKICAgICAgICBpZiAoIW1vZGVsUHJvcHMpIHsKICAgICAgICAgICAgdmFyIGNsYXNzTmFtZSA9IG1hcHBlci50eXBlLmNsYXNzTmFtZTsKICAgICAgICAgICAgaWYgKCFjbGFzc05hbWUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQ2xhc3MgbmFtZSBmb3IgbW9kZWwgXCIiICsgb2JqZWN0TmFtZSArICJcIiBpcyBub3QgcHJvdmlkZWQgaW4gdGhlIG1hcHBlciBcIiIgKyBKU09OLnN0cmluZ2lmeShtYXBwZXIsIHVuZGVmaW5lZCwgMikgKyAiXCIuIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIG1vZGVsTWFwcGVyID0gc2VyaWFsaXplci5tb2RlbE1hcHBlcnNbY2xhc3NOYW1lXTsKICAgICAgICAgICAgaWYgKCFtb2RlbE1hcHBlcikgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJtYXBwZXIoKSBjYW5ub3QgYmUgbnVsbCBvciB1bmRlZmluZWQgZm9yIG1vZGVsIFwiIiArIGNsYXNzTmFtZSArICJcIi4iKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBtb2RlbFByb3BzID0gbW9kZWxNYXBwZXIudHlwZS5tb2RlbFByb3BlcnRpZXM7CiAgICAgICAgICAgIGlmICghbW9kZWxQcm9wcykgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJtb2RlbFByb3BlcnRpZXMgY2Fubm90IGJlIG51bGwgb3IgdW5kZWZpbmVkIGluIHRoZSAiICsKICAgICAgICAgICAgICAgICAgICAoIm1hcHBlciBcIiIgKyBKU09OLnN0cmluZ2lmeShtb2RlbE1hcHBlcikgKyAiXCIgb2YgdHlwZSBcIiIgKyBjbGFzc05hbWUgKyAiXCIgZm9yIG9iamVjdCBcIiIgKyBvYmplY3ROYW1lICsgIlwiLiIpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbW9kZWxQcm9wczsKICAgIH0KICAgIGZ1bmN0aW9uIHNlcmlhbGl6ZUNvbXBvc2l0ZVR5cGUoc2VyaWFsaXplciwgbWFwcGVyLCBvYmplY3QsIG9iamVjdE5hbWUpIHsKICAgICAgICB2YXIgX2E7CiAgICAgICAgaWYgKGdldFBvbHltb3JwaGljRGlzY3JpbWluYXRvclJlY3Vyc2l2ZWx5KHNlcmlhbGl6ZXIsIG1hcHBlcikpIHsKICAgICAgICAgICAgbWFwcGVyID0gZ2V0UG9seW1vcnBoaWNNYXBwZXIoc2VyaWFsaXplciwgbWFwcGVyLCBvYmplY3QsICJjbGllbnROYW1lIik7CiAgICAgICAgfQogICAgICAgIGlmIChvYmplY3QgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHZhciBwYXlsb2FkID0ge307CiAgICAgICAgICAgIHZhciBtb2RlbFByb3BzID0gcmVzb2x2ZU1vZGVsUHJvcGVydGllcyhzZXJpYWxpemVyLCBtYXBwZXIsIG9iamVjdE5hbWUpOwogICAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9iID0gT2JqZWN0LmtleXMobW9kZWxQcm9wcyk7IF9pIDwgX2IubGVuZ3RoOyBfaSsrKSB7CiAgICAgICAgICAgICAgICB2YXIga2V5ID0gX2JbX2ldOwogICAgICAgICAgICAgICAgdmFyIHByb3BlcnR5TWFwcGVyID0gbW9kZWxQcm9wc1trZXldOwogICAgICAgICAgICAgICAgaWYgKHByb3BlcnR5TWFwcGVyLnJlYWRPbmx5KSB7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB2YXIgcHJvcE5hbWUgPSB2b2lkIDA7CiAgICAgICAgICAgICAgICB2YXIgcGFyZW50T2JqZWN0ID0gcGF5bG9hZDsKICAgICAgICAgICAgICAgIGlmIChzZXJpYWxpemVyLmlzWE1MKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHByb3BlcnR5TWFwcGVyLnhtbElzV3JhcHBlZCkgewogICAgICAgICAgICAgICAgICAgICAgICBwcm9wTmFtZSA9IHByb3BlcnR5TWFwcGVyLnhtbE5hbWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBwcm9wTmFtZSA9IHByb3BlcnR5TWFwcGVyLnhtbEVsZW1lbnROYW1lIHx8IHByb3BlcnR5TWFwcGVyLnhtbE5hbWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHBhdGhzID0gc3BsaXRTZXJpYWxpemVOYW1lKHByb3BlcnR5TWFwcGVyLnNlcmlhbGl6ZWROYW1lKTsKICAgICAgICAgICAgICAgICAgICBwcm9wTmFtZSA9IHBhdGhzLnBvcCgpOwogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIF9jID0gMCwgcGF0aHNfMSA9IHBhdGhzOyBfYyA8IHBhdGhzXzEubGVuZ3RoOyBfYysrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXRoTmFtZSA9IHBhdGhzXzFbX2NdOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2hpbGRPYmplY3QgPSBwYXJlbnRPYmplY3RbcGF0aE5hbWVdOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGNoaWxkT2JqZWN0ID09IHVuZGVmaW5lZCkgJiYgKG9iamVjdFtrZXldICE9IHVuZGVmaW5lZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudE9iamVjdFtwYXRoTmFtZV0gPSB7fTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRPYmplY3QgPSBwYXJlbnRPYmplY3RbcGF0aE5hbWVdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChwYXJlbnRPYmplY3QgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHByb3BlcnR5T2JqZWN0TmFtZSA9IHByb3BlcnR5TWFwcGVyLnNlcmlhbGl6ZWROYW1lICE9PSAiIgogICAgICAgICAgICAgICAgICAgICAgICA/IG9iamVjdE5hbWUgKyAiLiIgKyBwcm9wZXJ0eU1hcHBlci5zZXJpYWxpemVkTmFtZQogICAgICAgICAgICAgICAgICAgICAgICA6IG9iamVjdE5hbWU7CiAgICAgICAgICAgICAgICAgICAgdmFyIHRvU2VyaWFsaXplID0gb2JqZWN0W2tleV07CiAgICAgICAgICAgICAgICAgICAgdmFyIHBvbHltb3JwaGljRGlzY3JpbWluYXRvciA9IGdldFBvbHltb3JwaGljRGlzY3JpbWluYXRvclJlY3Vyc2l2ZWx5KHNlcmlhbGl6ZXIsIG1hcHBlcik7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBvbHltb3JwaGljRGlzY3JpbWluYXRvciAmJiBwb2x5bW9ycGhpY0Rpc2NyaW1pbmF0b3IuY2xpZW50TmFtZSA9PT0ga2V5ICYmIHRvU2VyaWFsaXplID09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgICB0b1NlcmlhbGl6ZSA9IG1hcHBlci5zZXJpYWxpemVkTmFtZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdmFyIHNlcmlhbGl6ZWRWYWx1ZSA9IHNlcmlhbGl6ZXIuc2VyaWFsaXplKHByb3BlcnR5TWFwcGVyLCB0b1NlcmlhbGl6ZSwgcHJvcGVydHlPYmplY3ROYW1lKTsKICAgICAgICAgICAgICAgICAgICBpZiAoc2VyaWFsaXplZFZhbHVlICE9PSB1bmRlZmluZWQgJiYgcHJvcE5hbWUgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0eU1hcHBlci54bWxJc0F0dHJpYnV0ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gJCBpcyB0aGUga2V5IGF0dHJpYnV0ZXMgYXJlIGtlcHQgdW5kZXIgaW4geG1sMmpzLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBrZWVwcyB0aGluZ3Mgc2ltcGxlIHdoaWxlIHByZXZlbnRpbmcgbmFtZSBjb2xsaXNpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdpdGggbmFtZXMgaW4gdXNlciBkb2N1bWVudHMuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRPYmplY3QuJCA9IHBhcmVudE9iamVjdC4kIHx8IHt9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50T2JqZWN0LiRbcHJvcE5hbWVdID0gc2VyaWFsaXplZFZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHByb3BlcnR5TWFwcGVyLnhtbElzV3JhcHBlZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50T2JqZWN0W3Byb3BOYW1lXSA9IChfYSA9IHt9LCBfYVtwcm9wZXJ0eU1hcHBlci54bWxFbGVtZW50TmFtZV0gPSBzZXJpYWxpemVkVmFsdWUsIF9hKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudE9iamVjdFtwcm9wTmFtZV0gPSBzZXJpYWxpemVkVmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGFkZGl0aW9uYWxQcm9wZXJ0aWVzTWFwcGVyID0gbWFwcGVyLnR5cGUuYWRkaXRpb25hbFByb3BlcnRpZXM7CiAgICAgICAgICAgIGlmIChhZGRpdGlvbmFsUHJvcGVydGllc01hcHBlcikgewogICAgICAgICAgICAgICAgdmFyIHByb3BOYW1lcyA9IE9iamVjdC5rZXlzKG1vZGVsUHJvcHMpOwogICAgICAgICAgICAgICAgdmFyIF9sb29wXzEgPSBmdW5jdGlvbiAoY2xpZW50UHJvcE5hbWUpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgaXNBZGRpdGlvbmFsUHJvcGVydHkgPSBwcm9wTmFtZXMuZXZlcnkoZnVuY3Rpb24gKHBuKSB7IHJldHVybiBwbiAhPT0gY2xpZW50UHJvcE5hbWU7IH0pOwogICAgICAgICAgICAgICAgICAgIGlmIChpc0FkZGl0aW9uYWxQcm9wZXJ0eSkgewogICAgICAgICAgICAgICAgICAgICAgICBwYXlsb2FkW2NsaWVudFByb3BOYW1lXSA9IHNlcmlhbGl6ZXIuc2VyaWFsaXplKGFkZGl0aW9uYWxQcm9wZXJ0aWVzTWFwcGVyLCBvYmplY3RbY2xpZW50UHJvcE5hbWVdLCBvYmplY3ROYW1lICsgJ1siJyArIGNsaWVudFByb3BOYW1lICsgJyJdJyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGZvciAodmFyIGNsaWVudFByb3BOYW1lIGluIG9iamVjdCkgewogICAgICAgICAgICAgICAgICAgIF9sb29wXzEoY2xpZW50UHJvcE5hbWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBwYXlsb2FkOwogICAgICAgIH0KICAgICAgICByZXR1cm4gb2JqZWN0OwogICAgfQogICAgZnVuY3Rpb24gaXNTcGVjaWFsWG1sUHJvcGVydHkocHJvcGVydHlOYW1lKSB7CiAgICAgICAgcmV0dXJuIFsiJCIsICJfIl0uaW5jbHVkZXMocHJvcGVydHlOYW1lKTsKICAgIH0KICAgIGZ1bmN0aW9uIGRlc2VyaWFsaXplQ29tcG9zaXRlVHlwZShzZXJpYWxpemVyLCBtYXBwZXIsIHJlc3BvbnNlQm9keSwgb2JqZWN0TmFtZSkgewogICAgICAgIGlmIChnZXRQb2x5bW9ycGhpY0Rpc2NyaW1pbmF0b3JSZWN1cnNpdmVseShzZXJpYWxpemVyLCBtYXBwZXIpKSB7CiAgICAgICAgICAgIG1hcHBlciA9IGdldFBvbHltb3JwaGljTWFwcGVyKHNlcmlhbGl6ZXIsIG1hcHBlciwgcmVzcG9uc2VCb2R5LCAic2VyaWFsaXplZE5hbWUiKTsKICAgICAgICB9CiAgICAgICAgdmFyIG1vZGVsUHJvcHMgPSByZXNvbHZlTW9kZWxQcm9wZXJ0aWVzKHNlcmlhbGl6ZXIsIG1hcHBlciwgb2JqZWN0TmFtZSk7CiAgICAgICAgdmFyIGluc3RhbmNlID0ge307CiAgICAgICAgdmFyIGhhbmRsZWRQcm9wZXJ0eU5hbWVzID0gW107CiAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IE9iamVjdC5rZXlzKG1vZGVsUHJvcHMpOyBfaSA8IF9hLmxlbmd0aDsgX2krKykgewogICAgICAgICAgICB2YXIga2V5ID0gX2FbX2ldOwogICAgICAgICAgICB2YXIgcHJvcGVydHlNYXBwZXIgPSBtb2RlbFByb3BzW2tleV07CiAgICAgICAgICAgIHZhciBwYXRocyA9IHNwbGl0U2VyaWFsaXplTmFtZShtb2RlbFByb3BzW2tleV0uc2VyaWFsaXplZE5hbWUpOwogICAgICAgICAgICBoYW5kbGVkUHJvcGVydHlOYW1lcy5wdXNoKHBhdGhzWzBdKTsKICAgICAgICAgICAgdmFyIHNlcmlhbGl6ZWROYW1lID0gcHJvcGVydHlNYXBwZXIuc2VyaWFsaXplZE5hbWUsIHhtbE5hbWUgPSBwcm9wZXJ0eU1hcHBlci54bWxOYW1lLCB4bWxFbGVtZW50TmFtZSA9IHByb3BlcnR5TWFwcGVyLnhtbEVsZW1lbnROYW1lOwogICAgICAgICAgICB2YXIgcHJvcGVydHlPYmplY3ROYW1lID0gb2JqZWN0TmFtZTsKICAgICAgICAgICAgaWYgKHNlcmlhbGl6ZWROYW1lICE9PSAiIiAmJiBzZXJpYWxpemVkTmFtZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBwcm9wZXJ0eU9iamVjdE5hbWUgPSBvYmplY3ROYW1lICsgIi4iICsgc2VyaWFsaXplZE5hbWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGhlYWRlckNvbGxlY3Rpb25QcmVmaXggPSBwcm9wZXJ0eU1hcHBlci5oZWFkZXJDb2xsZWN0aW9uUHJlZml4OwogICAgICAgICAgICBpZiAoaGVhZGVyQ29sbGVjdGlvblByZWZpeCkgewogICAgICAgICAgICAgICAgdmFyIGRpY3Rpb25hcnkgPSB7fTsKICAgICAgICAgICAgICAgIGZvciAodmFyIF9iID0gMCwgX2MgPSBPYmplY3Qua2V5cyhyZXNwb25zZUJvZHkpOyBfYiA8IF9jLmxlbmd0aDsgX2IrKykgewogICAgICAgICAgICAgICAgICAgIHZhciBoZWFkZXJLZXkgPSBfY1tfYl07CiAgICAgICAgICAgICAgICAgICAgaWYgKGhlYWRlcktleS5zdGFydHNXaXRoKGhlYWRlckNvbGxlY3Rpb25QcmVmaXgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRpY3Rpb25hcnlbaGVhZGVyS2V5LnN1YnN0cmluZyhoZWFkZXJDb2xsZWN0aW9uUHJlZml4Lmxlbmd0aCldID0gc2VyaWFsaXplci5kZXNlcmlhbGl6ZShwcm9wZXJ0eU1hcHBlci50eXBlLnZhbHVlLCByZXNwb25zZUJvZHlbaGVhZGVyS2V5XSwgcHJvcGVydHlPYmplY3ROYW1lKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaGFuZGxlZFByb3BlcnR5TmFtZXMucHVzaChoZWFkZXJLZXkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaW5zdGFuY2Vba2V5XSA9IGRpY3Rpb25hcnk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAoc2VyaWFsaXplci5pc1hNTCkgewogICAgICAgICAgICAgICAgaWYgKHByb3BlcnR5TWFwcGVyLnhtbElzQXR0cmlidXRlICYmIHJlc3BvbnNlQm9keS4kKSB7CiAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2Vba2V5XSA9IHNlcmlhbGl6ZXIuZGVzZXJpYWxpemUocHJvcGVydHlNYXBwZXIsIHJlc3BvbnNlQm9keS4kW3htbE5hbWVdLCBwcm9wZXJ0eU9iamVjdE5hbWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHByb3BlcnR5TmFtZSA9IHhtbEVsZW1lbnROYW1lIHx8IHhtbE5hbWUgfHwgc2VyaWFsaXplZE5hbWU7CiAgICAgICAgICAgICAgICAgICAgdmFyIHVud3JhcHBlZFByb3BlcnR5ID0gcmVzcG9uc2VCb2R5W3Byb3BlcnR5TmFtZV07CiAgICAgICAgICAgICAgICAgICAgaWYgKHByb3BlcnR5TWFwcGVyLnhtbElzV3JhcHBlZCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXBwZWRQcm9wZXJ0eSA9IHJlc3BvbnNlQm9keVt4bWxOYW1lXTsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwcGVkUHJvcGVydHkgPSB1bndyYXBwZWRQcm9wZXJ0eSAmJiB1bndyYXBwZWRQcm9wZXJ0eVt4bWxFbGVtZW50TmFtZV07CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpc0VtcHR5V3JhcHBlZExpc3QgPSB1bndyYXBwZWRQcm9wZXJ0eSA9PT0gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNFbXB0eVdyYXBwZWRMaXN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bndyYXBwZWRQcm9wZXJ0eSA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGluc3RhbmNlW2tleV0gPSBzZXJpYWxpemVyLmRlc2VyaWFsaXplKHByb3BlcnR5TWFwcGVyLCB1bndyYXBwZWRQcm9wZXJ0eSwgcHJvcGVydHlPYmplY3ROYW1lKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIGRlc2VyaWFsaXplIHRoZSBwcm9wZXJ0eSBpZiBpdCBpcyBwcmVzZW50IGluIHRoZSBwcm92aWRlZCByZXNwb25zZUJvZHkgaW5zdGFuY2UKICAgICAgICAgICAgICAgIHZhciBwcm9wZXJ0eUluc3RhbmNlID0gdm9pZCAwOwogICAgICAgICAgICAgICAgdmFyIHJlcyA9IHJlc3BvbnNlQm9keTsKICAgICAgICAgICAgICAgIC8vIHRyYXZlcnNpbmcgdGhlIG9iamVjdCBzdGVwIGJ5IHN0ZXAuCiAgICAgICAgICAgICAgICBmb3IgKHZhciBfZCA9IDAsIHBhdGhzXzIgPSBwYXRoczsgX2QgPCBwYXRoc18yLmxlbmd0aDsgX2QrKykgewogICAgICAgICAgICAgICAgICAgIHZhciBpdGVtID0gcGF0aHNfMltfZF07CiAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXMpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIHJlcyA9IHJlc1tpdGVtXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHByb3BlcnR5SW5zdGFuY2UgPSByZXM7CiAgICAgICAgICAgICAgICB2YXIgcG9seW1vcnBoaWNEaXNjcmltaW5hdG9yID0gbWFwcGVyLnR5cGUucG9seW1vcnBoaWNEaXNjcmltaW5hdG9yOwogICAgICAgICAgICAgICAgLy8gY2hlY2tpbmcgdGhhdCB0aGUgbW9kZWwgcHJvcGVydHkgbmFtZSAoa2V5KShleDogImZpc2h0eXBlIikgYW5kIHRoZQogICAgICAgICAgICAgICAgLy8gY2xpZW50TmFtZSBvZiB0aGUgcG9seW1vcnBoaWNEaXNjcmltaW5hdG9yIHttZXRhZGF0YX0gKGV4OiAiZmlzaHR5cGUiKQogICAgICAgICAgICAgICAgLy8gaW5zdGVhZCBvZiB0aGUgc2VyaWFsaXplZE5hbWUgb2YgdGhlIHBvbHltb3JwaGljRGlzY3JpbWluYXRvciAoZXg6ICJmaXNoLnR5cGUiKQogICAgICAgICAgICAgICAgLy8gaXMgYSBiZXR0ZXIgYXBwcm9hY2guIFRoZSBnZW5lcmF0b3IgaXMgbm90IGNvbnNpc3RlbnQgd2l0aCBlc2NhcGluZyAnXC4nIGluIHRoZQogICAgICAgICAgICAgICAgLy8gc2VyaWFsaXplZE5hbWUgb2YgdGhlIHByb3BlcnR5IChleDogImZpc2hcLnR5cGUiKSB0aGF0IGlzIG1hcmtlZCBhcyBwb2x5bW9ycGhpYyBkaXNjcmltaW5hdG9yCiAgICAgICAgICAgICAgICAvLyBhbmQgdGhlIHNlcmlhbGl6ZWROYW1lIG9mIHRoZSBtZXRhZGF0YSBwb2x5bW9ycGhpY0Rpc2NyaW1pbmF0b3IgKGV4OiAiZmlzaC50eXBlIikuIEhvd2V2ZXIsCiAgICAgICAgICAgICAgICAvLyB0aGUgY2xpZW50TmFtZSB0cmFuc2Zvcm1hdGlvbiBvZiB0aGUgcG9seW1vcnBoaWNEaXNjcmltaW5hdG9yIChleDogImZpc2h0eXBlIikgYW5kCiAgICAgICAgICAgICAgICAvLyB0aGUgdHJhbnNmb3JtYXRpb24gb2YgbW9kZWwgcHJvcGVydHkgbmFtZSAoZXg6ICJmaXNodHlwZSIpIGlzIGRvbmUgY29uc2lzdGVudGx5LgogICAgICAgICAgICAgICAgLy8gSGVuY2UsIGl0IGlzIGEgc2FmZXIgYmV0IHRvIHJlbHkgb24gdGhlIGNsaWVudE5hbWUgb2YgdGhlIHBvbHltb3JwaGljRGlzY3JpbWluYXRvci4KICAgICAgICAgICAgICAgIGlmIChwb2x5bW9ycGhpY0Rpc2NyaW1pbmF0b3IgJiYga2V5ID09PSBwb2x5bW9ycGhpY0Rpc2NyaW1pbmF0b3IuY2xpZW50TmFtZSAmJiBwcm9wZXJ0eUluc3RhbmNlID09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgIHByb3BlcnR5SW5zdGFuY2UgPSBtYXBwZXIuc2VyaWFsaXplZE5hbWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB2YXIgc2VyaWFsaXplZFZhbHVlID0gdm9pZCAwOwogICAgICAgICAgICAgICAgLy8gcGFnaW5nCiAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShyZXNwb25zZUJvZHlba2V5XSkgJiYgbW9kZWxQcm9wc1trZXldLnNlcmlhbGl6ZWROYW1lID09PSAiIikgewogICAgICAgICAgICAgICAgICAgIHByb3BlcnR5SW5zdGFuY2UgPSByZXNwb25zZUJvZHlba2V5XTsKICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZSA9IHNlcmlhbGl6ZXIuZGVzZXJpYWxpemUocHJvcGVydHlNYXBwZXIsIHByb3BlcnR5SW5zdGFuY2UsIHByb3BlcnR5T2JqZWN0TmFtZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmIChwcm9wZXJ0eUluc3RhbmNlICE9PSB1bmRlZmluZWQgfHwgcHJvcGVydHlNYXBwZXIuZGVmYXVsdFZhbHVlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkVmFsdWUgPSBzZXJpYWxpemVyLmRlc2VyaWFsaXplKHByb3BlcnR5TWFwcGVyLCBwcm9wZXJ0eUluc3RhbmNlLCBwcm9wZXJ0eU9iamVjdE5hbWUpOwogICAgICAgICAgICAgICAgICAgIGluc3RhbmNlW2tleV0gPSBzZXJpYWxpemVkVmFsdWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdmFyIGFkZGl0aW9uYWxQcm9wZXJ0aWVzTWFwcGVyID0gbWFwcGVyLnR5cGUuYWRkaXRpb25hbFByb3BlcnRpZXM7CiAgICAgICAgaWYgKGFkZGl0aW9uYWxQcm9wZXJ0aWVzTWFwcGVyKSB7CiAgICAgICAgICAgIHZhciBpc0FkZGl0aW9uYWxQcm9wZXJ0eSA9IGZ1bmN0aW9uIChyZXNwb25zZVByb3BOYW1lKSB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBjbGllbnRQcm9wTmFtZSBpbiBtb2RlbFByb3BzKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHBhdGhzID0gc3BsaXRTZXJpYWxpemVOYW1lKG1vZGVsUHJvcHNbY2xpZW50UHJvcE5hbWVdLnNlcmlhbGl6ZWROYW1lKTsKICAgICAgICAgICAgICAgICAgICBpZiAocGF0aHNbMF0gPT09IHJlc3BvbnNlUHJvcE5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9OwogICAgICAgICAgICBmb3IgKHZhciByZXNwb25zZVByb3BOYW1lIGluIHJlc3BvbnNlQm9keSkgewogICAgICAgICAgICAgICAgaWYgKGlzQWRkaXRpb25hbFByb3BlcnR5KHJlc3BvbnNlUHJvcE5hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2VbcmVzcG9uc2VQcm9wTmFtZV0gPSBzZXJpYWxpemVyLmRlc2VyaWFsaXplKGFkZGl0aW9uYWxQcm9wZXJ0aWVzTWFwcGVyLCByZXNwb25zZUJvZHlbcmVzcG9uc2VQcm9wTmFtZV0sIG9iamVjdE5hbWUgKyAnWyInICsgcmVzcG9uc2VQcm9wTmFtZSArICciXScpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKHJlc3BvbnNlQm9keSkgewogICAgICAgICAgICBmb3IgKHZhciBfZSA9IDAsIF9mID0gT2JqZWN0LmtleXMocmVzcG9uc2VCb2R5KTsgX2UgPCBfZi5sZW5ndGg7IF9lKyspIHsKICAgICAgICAgICAgICAgIHZhciBrZXkgPSBfZltfZV07CiAgICAgICAgICAgICAgICBpZiAoaW5zdGFuY2Vba2V5XSA9PT0gdW5kZWZpbmVkICYmICFoYW5kbGVkUHJvcGVydHlOYW1lcy5pbmNsdWRlcyhrZXkpICYmICFpc1NwZWNpYWxYbWxQcm9wZXJ0eShrZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2Vba2V5XSA9IHJlc3BvbnNlQm9keVtrZXldOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBpbnN0YW5jZTsKICAgIH0KICAgIGZ1bmN0aW9uIGRlc2VyaWFsaXplRGljdGlvbmFyeVR5cGUoc2VyaWFsaXplciwgbWFwcGVyLCByZXNwb25zZUJvZHksIG9iamVjdE5hbWUpIHsKICAgICAgICAvKmpzaGludCB2YWxpZHRoaXM6IHRydWUgKi8KICAgICAgICB2YXIgdmFsdWUgPSBtYXBwZXIudHlwZS52YWx1ZTsKICAgICAgICBpZiAoIXZhbHVlIHx8IHR5cGVvZiB2YWx1ZSAhPT0gIm9iamVjdCIpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJcInZhbHVlXCIgbWV0YWRhdGEgZm9yIGEgRGljdGlvbmFyeSBtdXN0IGJlIGRlZmluZWQgaW4gdGhlICIgKwogICAgICAgICAgICAgICAgKCJtYXBwZXIgYW5kIGl0IG11c3Qgb2YgdHlwZSBcIm9iamVjdFwiIGluICIgKyBvYmplY3ROYW1lKSk7CiAgICAgICAgfQogICAgICAgIGlmIChyZXNwb25zZUJvZHkpIHsKICAgICAgICAgICAgdmFyIHRlbXBEaWN0aW9uYXJ5ID0ge307CiAgICAgICAgICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSBPYmplY3Qua2V5cyhyZXNwb25zZUJvZHkpOyBfaSA8IF9hLmxlbmd0aDsgX2krKykgewogICAgICAgICAgICAgICAgdmFyIGtleSA9IF9hW19pXTsKICAgICAgICAgICAgICAgIHRlbXBEaWN0aW9uYXJ5W2tleV0gPSBzZXJpYWxpemVyLmRlc2VyaWFsaXplKHZhbHVlLCByZXNwb25zZUJvZHlba2V5XSwgb2JqZWN0TmFtZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRlbXBEaWN0aW9uYXJ5OwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzcG9uc2VCb2R5OwogICAgfQogICAgZnVuY3Rpb24gZGVzZXJpYWxpemVTZXF1ZW5jZVR5cGUoc2VyaWFsaXplciwgbWFwcGVyLCByZXNwb25zZUJvZHksIG9iamVjdE5hbWUpIHsKICAgICAgICAvKmpzaGludCB2YWxpZHRoaXM6IHRydWUgKi8KICAgICAgICB2YXIgZWxlbWVudCA9IG1hcHBlci50eXBlLmVsZW1lbnQ7CiAgICAgICAgaWYgKCFlbGVtZW50IHx8IHR5cGVvZiBlbGVtZW50ICE9PSAib2JqZWN0IikgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImVsZW1lbnRcIiBtZXRhZGF0YSBmb3IgYW4gQXJyYXkgbXVzdCBiZSBkZWZpbmVkIGluIHRoZSAiICsKICAgICAgICAgICAgICAgICgibWFwcGVyIGFuZCBpdCBtdXN0IG9mIHR5cGUgXCJvYmplY3RcIiBpbiAiICsgb2JqZWN0TmFtZSkpOwogICAgICAgIH0KICAgICAgICBpZiAocmVzcG9uc2VCb2R5KSB7CiAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShyZXNwb25zZUJvZHkpKSB7CiAgICAgICAgICAgICAgICAvLyB4bWwyanMgd2lsbCBpbnRlcnByZXQgYSBzaW5nbGUgZWxlbWVudCBhcnJheSBhcyBqdXN0IHRoZSBlbGVtZW50LCBzbyBmb3JjZSBpdCB0byBiZSBhbiBhcnJheQogICAgICAgICAgICAgICAgcmVzcG9uc2VCb2R5ID0gW3Jlc3BvbnNlQm9keV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHRlbXBBcnJheSA9IFtdOwogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJlc3BvbnNlQm9keS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdGVtcEFycmF5W2ldID0gc2VyaWFsaXplci5kZXNlcmlhbGl6ZShlbGVtZW50LCByZXNwb25zZUJvZHlbaV0sIG9iamVjdE5hbWUgKyAiWyIgKyBpICsgIl0iKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGVtcEFycmF5OwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzcG9uc2VCb2R5OwogICAgfQogICAgZnVuY3Rpb24gZ2V0UG9seW1vcnBoaWNNYXBwZXIoc2VyaWFsaXplciwgbWFwcGVyLCBvYmplY3QsIHBvbHltb3JwaGljUHJvcGVydHlOYW1lKSB7CiAgICAgICAgdmFyIHBvbHltb3JwaGljRGlzY3JpbWluYXRvciA9IGdldFBvbHltb3JwaGljRGlzY3JpbWluYXRvclJlY3Vyc2l2ZWx5KHNlcmlhbGl6ZXIsIG1hcHBlcik7CiAgICAgICAgaWYgKHBvbHltb3JwaGljRGlzY3JpbWluYXRvcikgewogICAgICAgICAgICB2YXIgZGlzY3JpbWluYXRvck5hbWUgPSBwb2x5bW9ycGhpY0Rpc2NyaW1pbmF0b3JbcG9seW1vcnBoaWNQcm9wZXJ0eU5hbWVdOwogICAgICAgICAgICBpZiAoZGlzY3JpbWluYXRvck5hbWUgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICB2YXIgZGlzY3JpbWluYXRvclZhbHVlID0gb2JqZWN0W2Rpc2NyaW1pbmF0b3JOYW1lXTsKICAgICAgICAgICAgICAgIGlmIChkaXNjcmltaW5hdG9yVmFsdWUgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHR5cGVOYW1lID0gbWFwcGVyLnR5cGUudWJlclBhcmVudCB8fCBtYXBwZXIudHlwZS5jbGFzc05hbWU7CiAgICAgICAgICAgICAgICAgICAgdmFyIGluZGV4RGlzY3JpbWluYXRvciA9IGRpc2NyaW1pbmF0b3JWYWx1ZSA9PT0gdHlwZU5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgPyBkaXNjcmltaW5hdG9yVmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgOiB0eXBlTmFtZSArICIuIiArIGRpc2NyaW1pbmF0b3JWYWx1ZTsKICAgICAgICAgICAgICAgICAgICB2YXIgcG9seW1vcnBoaWNNYXBwZXIgPSBzZXJpYWxpemVyLm1vZGVsTWFwcGVycy5kaXNjcmltaW5hdG9yc1tpbmRleERpc2NyaW1pbmF0b3JdOwogICAgICAgICAgICAgICAgICAgIGlmIChwb2x5bW9ycGhpY01hcHBlcikgewogICAgICAgICAgICAgICAgICAgICAgICBtYXBwZXIgPSBwb2x5bW9ycGhpY01hcHBlcjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIG1hcHBlcjsKICAgIH0KICAgIGZ1bmN0aW9uIGdldFBvbHltb3JwaGljRGlzY3JpbWluYXRvclJlY3Vyc2l2ZWx5KHNlcmlhbGl6ZXIsIG1hcHBlcikgewogICAgICAgIHJldHVybiBtYXBwZXIudHlwZS5wb2x5bW9ycGhpY0Rpc2NyaW1pbmF0b3IKICAgICAgICAgICAgfHwgZ2V0UG9seW1vcnBoaWNEaXNjcmltaW5hdG9yU2FmZWx5KHNlcmlhbGl6ZXIsIG1hcHBlci50eXBlLnViZXJQYXJlbnQpCiAgICAgICAgICAgIHx8IGdldFBvbHltb3JwaGljRGlzY3JpbWluYXRvclNhZmVseShzZXJpYWxpemVyLCBtYXBwZXIudHlwZS5jbGFzc05hbWUpOwogICAgfQogICAgZnVuY3Rpb24gZ2V0UG9seW1vcnBoaWNEaXNjcmltaW5hdG9yU2FmZWx5KHNlcmlhbGl6ZXIsIHR5cGVOYW1lKSB7CiAgICAgICAgcmV0dXJuICh0eXBlTmFtZSAmJiBzZXJpYWxpemVyLm1vZGVsTWFwcGVyc1t0eXBlTmFtZV0gJiYgc2VyaWFsaXplci5tb2RlbE1hcHBlcnNbdHlwZU5hbWVdLnR5cGUucG9seW1vcnBoaWNEaXNjcmltaW5hdG9yKTsKICAgIH0KICAgIC8qKgogICAgICogVXRpbGl0eSBmdW5jdGlvbiB0byBjcmVhdGUgYSBLOlYgZnJvbSBhIGxpc3Qgb2Ygc3RyaW5ncwogICAgICovCiAgICBmdW5jdGlvbiBzdHJFbnVtKG8pIHsKICAgICAgICB2YXIgcmVzdWx0ID0ge307CiAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBvXzEgPSBvOyBfaSA8IG9fMS5sZW5ndGg7IF9pKyspIHsKICAgICAgICAgICAgdmFyIGtleSA9IG9fMVtfaV07CiAgICAgICAgICAgIHJlc3VsdFtrZXldID0ga2V5OwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgdmFyIE1hcHBlclR5cGUgPSBzdHJFbnVtKFsKICAgICAgICAiQmFzZTY0VXJsIiwKICAgICAgICAiQm9vbGVhbiIsCiAgICAgICAgIkJ5dGVBcnJheSIsCiAgICAgICAgIkNvbXBvc2l0ZSIsCiAgICAgICAgIkRhdGUiLAogICAgICAgICJEYXRlVGltZSIsCiAgICAgICAgIkRhdGVUaW1lUmZjMTEyMyIsCiAgICAgICAgIkRpY3Rpb25hcnkiLAogICAgICAgICJFbnVtIiwKICAgICAgICAiTnVtYmVyIiwKICAgICAgICAiT2JqZWN0IiwKICAgICAgICAiU2VxdWVuY2UiLAogICAgICAgICJTdHJpbmciLAogICAgICAgICJTdHJlYW0iLAogICAgICAgICJUaW1lU3BhbiIsCiAgICAgICAgIlVuaXhUaW1lIgogICAgXSk7CgogICAgLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAgICAvKioKICAgICAqIENyZWF0ZXMgYSBuZXcgV2ViUmVzb3VyY2Ugb2JqZWN0LgogICAgICoKICAgICAqIFRoaXMgY2xhc3MgcHJvdmlkZXMgYW4gYWJzdHJhY3Rpb24gb3ZlciBhIFJFU1QgY2FsbCBieSBiZWluZyBsaWJyYXJ5IC8gaW1wbGVtZW50YXRpb24gYWdub3N0aWMgYW5kIHdyYXBwaW5nIHRoZSBuZWNlc3NhcnkKICAgICAqIHByb3BlcnRpZXMgdG8gaW5pdGlhdGUgYSByZXF1ZXN0LgogICAgICoKICAgICAqIEBjb25zdHJ1Y3RvcgogICAgICovCiAgICB2YXIgV2ViUmVzb3VyY2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CiAgICAgICAgZnVuY3Rpb24gV2ViUmVzb3VyY2UodXJsLCBtZXRob2QsIGJvZHksIHF1ZXJ5LCBoZWFkZXJzLCBzdHJlYW1SZXNwb25zZUJvZHksIHdpdGhDcmVkZW50aWFscywgYWJvcnRTaWduYWwsIHRpbWVvdXQsIG9uVXBsb2FkUHJvZ3Jlc3MsIG9uRG93bmxvYWRQcm9ncmVzcywgcHJveHlTZXR0aW5ncywga2VlcEFsaXZlKSB7CiAgICAgICAgICAgIHRoaXMuc3RyZWFtUmVzcG9uc2VCb2R5ID0gc3RyZWFtUmVzcG9uc2VCb2R5OwogICAgICAgICAgICB0aGlzLnVybCA9IHVybCB8fCAiIjsKICAgICAgICAgICAgdGhpcy5tZXRob2QgPSBtZXRob2QgfHwgIkdFVCI7CiAgICAgICAgICAgIHRoaXMuaGVhZGVycyA9IChoZWFkZXJzIGluc3RhbmNlb2YgSHR0cEhlYWRlcnMgPyBoZWFkZXJzIDogbmV3IEh0dHBIZWFkZXJzKGhlYWRlcnMpKTsKICAgICAgICAgICAgdGhpcy5ib2R5ID0gYm9keTsKICAgICAgICAgICAgdGhpcy5xdWVyeSA9IHF1ZXJ5OwogICAgICAgICAgICB0aGlzLmZvcm1EYXRhID0gdW5kZWZpbmVkOwogICAgICAgICAgICB0aGlzLndpdGhDcmVkZW50aWFscyA9IHdpdGhDcmVkZW50aWFscyB8fCBmYWxzZTsKICAgICAgICAgICAgdGhpcy5hYm9ydFNpZ25hbCA9IGFib3J0U2lnbmFsOwogICAgICAgICAgICB0aGlzLnRpbWVvdXQgPSB0aW1lb3V0IHx8IDA7CiAgICAgICAgICAgIHRoaXMub25VcGxvYWRQcm9ncmVzcyA9IG9uVXBsb2FkUHJvZ3Jlc3M7CiAgICAgICAgICAgIHRoaXMub25Eb3dubG9hZFByb2dyZXNzID0gb25Eb3dubG9hZFByb2dyZXNzOwogICAgICAgICAgICB0aGlzLnByb3h5U2V0dGluZ3MgPSBwcm94eVNldHRpbmdzOwogICAgICAgICAgICB0aGlzLmtlZXBBbGl2ZSA9IGtlZXBBbGl2ZTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogVmFsaWRhdGVzIHRoYXQgdGhlIHJlcXVpcmVkIHByb3BlcnRpZXMgc3VjaCBhcyBtZXRob2QsIHVybCwgaGVhZGVyc1siQ29udGVudC1UeXBlIl0sCiAgICAgICAgICogaGVhZGVyc1siYWNjZXB0LWxhbmd1YWdlIl0gYXJlIGRlZmluZWQuIEl0IHdpbGwgdGhyb3cgYW4gZXJyb3IgaWYgb25lIG9mIHRoZSBhYm92ZQogICAgICAgICAqIG1lbnRpb25lZCBwcm9wZXJ0aWVzIGFyZSBub3QgZGVmaW5lZC4KICAgICAgICAgKi8KICAgICAgICBXZWJSZXNvdXJjZS5wcm90b3R5cGUudmFsaWRhdGVSZXF1ZXN0UHJvcGVydGllcyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLm1ldGhvZCkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJXZWJSZXNvdXJjZS5tZXRob2QgaXMgcmVxdWlyZWQuIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCF0aGlzLnVybCkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJXZWJSZXNvdXJjZS51cmwgaXMgcmVxdWlyZWQuIik7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIC8qKgogICAgICAgICAqIFByZXBhcmVzIHRoZSByZXF1ZXN0LgogICAgICAgICAqIEBwYXJhbSB7UmVxdWVzdFByZXBhcmVPcHRpb25zfSBvcHRpb25zIE9wdGlvbnMgdG8gcHJvdmlkZSBmb3IgcHJlcGFyaW5nIHRoZSByZXF1ZXN0LgogICAgICAgICAqIEByZXR1cm5zIHtXZWJSZXNvdXJjZX0gUmV0dXJucyB0aGUgcHJlcGFyZWQgV2ViUmVzb3VyY2UgKEhUVFAgUmVxdWVzdCkgb2JqZWN0IHRoYXQgbmVlZHMgdG8gYmUgZ2l2ZW4gdG8gdGhlIHJlcXVlc3QgcGlwZWxpbmUuCiAgICAgICAgICovCiAgICAgICAgV2ViUmVzb3VyY2UucHJvdG90eXBlLnByZXBhcmUgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICAgICAgICBpZiAoIW9wdGlvbnMpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigib3B0aW9ucyBvYmplY3QgaXMgcmVxdWlyZWQiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob3B0aW9ucy5tZXRob2QgPT0gdW5kZWZpbmVkIHx8IHR5cGVvZiBvcHRpb25zLm1ldGhvZC52YWx1ZU9mKCkgIT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIm9wdGlvbnMubWV0aG9kIG11c3QgYmUgYSBzdHJpbmcuIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG9wdGlvbnMudXJsICYmIG9wdGlvbnMucGF0aFRlbXBsYXRlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIm9wdGlvbnMudXJsIGFuZCBvcHRpb25zLnBhdGhUZW1wbGF0ZSBhcmUgbXV0dWFsbHkgZXhjbHVzaXZlLiBQbGVhc2UgcHJvdmlkZSBleGFjdGx5IG9uZSBvZiB0aGVtLiIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgob3B0aW9ucy5wYXRoVGVtcGxhdGUgPT0gdW5kZWZpbmVkIHx8IHR5cGVvZiBvcHRpb25zLnBhdGhUZW1wbGF0ZS52YWx1ZU9mKCkgIT09ICJzdHJpbmciKSAmJiAob3B0aW9ucy51cmwgPT0gdW5kZWZpbmVkIHx8IHR5cGVvZiBvcHRpb25zLnVybC52YWx1ZU9mKCkgIT09ICJzdHJpbmciKSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJQbGVhc2UgcHJvdmlkZSBleGFjdGx5IG9uZSBvZiBvcHRpb25zLnBhdGhUZW1wbGF0ZSBvciBvcHRpb25zLnVybC4iKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBzZXQgdGhlIHVybCBpZiBpdCBpcyBwcm92aWRlZC4KICAgICAgICAgICAgaWYgKG9wdGlvbnMudXJsKSB7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMudXJsICE9PSAic3RyaW5nIikgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigib3B0aW9ucy51cmwgbXVzdCBiZSBvZiB0eXBlIFwic3RyaW5nXCIuIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLnVybCA9IG9wdGlvbnMudXJsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIHNldCB0aGUgbWV0aG9kCiAgICAgICAgICAgIGlmIChvcHRpb25zLm1ldGhvZCkgewogICAgICAgICAgICAgICAgdmFyIHZhbGlkTWV0aG9kcyA9IFsiR0VUIiwgIlBVVCIsICJIRUFEIiwgIkRFTEVURSIsICJPUFRJT05TIiwgIlBPU1QiLCAiUEFUQ0giLCAiVFJBQ0UiXTsKICAgICAgICAgICAgICAgIGlmICh2YWxpZE1ldGhvZHMuaW5kZXhPZihvcHRpb25zLm1ldGhvZC50b1VwcGVyQ2FzZSgpKSA9PT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlRoZSBwcm92aWRlZCBtZXRob2QgXCIiICsgb3B0aW9ucy5tZXRob2QgKyAiXCIgaXMgaW52YWxpZC4gU3VwcG9ydGVkIEhUVFAgbWV0aG9kcyBhcmU6ICIgKyBKU09OLnN0cmluZ2lmeSh2YWxpZE1ldGhvZHMpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLm1ldGhvZCA9IG9wdGlvbnMubWV0aG9kLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgICAgIC8vIGNvbnN0cnVjdCB0aGUgdXJsIGlmIHBhdGggdGVtcGxhdGUgaXMgcHJvdmlkZWQKICAgICAgICAgICAgaWYgKG9wdGlvbnMucGF0aFRlbXBsYXRlKSB7CiAgICAgICAgICAgICAgICB2YXIgcGF0aFRlbXBsYXRlXzEgPSBvcHRpb25zLnBhdGhUZW1wbGF0ZSwgcGF0aFBhcmFtZXRlcnNfMSA9IG9wdGlvbnMucGF0aFBhcmFtZXRlcnM7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHBhdGhUZW1wbGF0ZV8xICE9PSAic3RyaW5nIikgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigib3B0aW9ucy5wYXRoVGVtcGxhdGUgbXVzdCBiZSBvZiB0eXBlIFwic3RyaW5nXCIuIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoIW9wdGlvbnMuYmFzZVVybCkgewogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYmFzZVVybCA9ICJodHRwczovL21hbmFnZW1lbnQuYXp1cmUuY29tIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciBiYXNlVXJsID0gb3B0aW9ucy5iYXNlVXJsOwogICAgICAgICAgICAgICAgdmFyIHVybF8xID0gYmFzZVVybCArIChiYXNlVXJsLmVuZHNXaXRoKCIvIikgPyAiIiA6ICIvIikgKyAocGF0aFRlbXBsYXRlXzEuc3RhcnRzV2l0aCgiLyIpID8gcGF0aFRlbXBsYXRlXzEuc2xpY2UoMSkgOiBwYXRoVGVtcGxhdGVfMSk7CiAgICAgICAgICAgICAgICB2YXIgc2VnbWVudHMgPSB1cmxfMS5tYXRjaCgvKHtcdypccypcdyp9KS9pZyk7CiAgICAgICAgICAgICAgICBpZiAoc2VnbWVudHMgJiYgc2VnbWVudHMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFwYXRoUGFyYW1ldGVyc18xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigicGF0aFRlbXBsYXRlOiAiICsgcGF0aFRlbXBsYXRlXzEgKyAiIGhhcyBiZWVuIHByb3ZpZGVkLiBIZW5jZSwgb3B0aW9ucy5wYXRoUGFyYW1ldGVycyBtdXN0IGFsc28gYmUgcHJvdmlkZWQuIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHNlZ21lbnRzLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhdGhQYXJhbU5hbWUgPSBpdGVtLnNsaWNlKDEsIC0xKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhdGhQYXJhbSA9IHBhdGhQYXJhbWV0ZXJzXzFbcGF0aFBhcmFtTmFtZV07CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXRoUGFyYW0gPT09IG51bGwgfHwgcGF0aFBhcmFtID09PSB1bmRlZmluZWQgfHwgISh0eXBlb2YgcGF0aFBhcmFtID09PSAic3RyaW5nIiB8fCB0eXBlb2YgcGF0aFBhcmFtID09PSAib2JqZWN0IikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigicGF0aFRlbXBsYXRlOiAiICsgcGF0aFRlbXBsYXRlXzEgKyAiIGNvbnRhaW5zIHRoZSBwYXRoIHBhcmFtZXRlciAiICsgcGF0aFBhcmFtTmFtZSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCIgaG93ZXZlciwgaXQgaXMgbm90IHByZXNlbnQgaW4gIiArIHBhdGhQYXJhbWV0ZXJzXzEgKyAiIC0gIiArIEpTT04uc3RyaW5naWZ5KHBhdGhQYXJhbWV0ZXJzXzEsIHVuZGVmaW5lZCwgMikgKyAiLiIpICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoIlRoZSB2YWx1ZSBvZiB0aGUgcGF0aCBwYXJhbWV0ZXIgY2FuIGVpdGhlciBiZSBhIFwic3RyaW5nXCIgb2YgdGhlIGZvcm0geyAiICsgcGF0aFBhcmFtTmFtZSArICI6IFwic29tZSBzYW1wbGUgdmFsdWVcIiB9IG9yICIpICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoIml0IGNhbiBiZSBhbiBcIm9iamVjdFwiIG9mIHRoZSBmb3JtIHsgXCIiICsgcGF0aFBhcmFtTmFtZSArICJcIjogeyB2YWx1ZTogXCJzb21lIHNhbXBsZSB2YWx1ZVwiLCBza2lwVXJsRW5jb2Rpbmc6IHRydWUgfSB9LiIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHBhdGhQYXJhbS52YWx1ZU9mKCkgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmxfMSA9IHVybF8xLnJlcGxhY2UoaXRlbSwgZW5jb2RlVVJJQ29tcG9uZW50KHBhdGhQYXJhbSkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgcGF0aFBhcmFtLnZhbHVlT2YoKSA9PT0gIm9iamVjdCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcGF0aFBhcmFtLnZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJvcHRpb25zLnBhdGhQYXJhbWV0ZXJzWyIgKyBwYXRoUGFyYW1OYW1lICsgIl0gaXMgb2YgdHlwZSBcIm9iamVjdFwiIGJ1dCBpdCBkb2VzIG5vdCBjb250YWluIGEgXCJ2YWx1ZVwiIHByb3BlcnR5LiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhdGhQYXJhbS5za2lwVXJsRW5jb2RpbmcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmxfMSA9IHVybF8xLnJlcGxhY2UoaXRlbSwgcGF0aFBhcmFtLnZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybF8xID0gdXJsXzEucmVwbGFjZShpdGVtLCBlbmNvZGVVUklDb21wb25lbnQocGF0aFBhcmFtLnZhbHVlKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMudXJsID0gdXJsXzE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gYXBwZW5kIHF1ZXJ5IHBhcmFtZXRlcnMgdG8gdGhlIHVybCBpZiB0aGV5IGFyZSBwcm92aWRlZC4gVGhleSBjYW4gYmUgcHJvdmlkZWQgd2l0aCBwYXRoVGVtcGxhdGUgb3IgdXJsIG9wdGlvbi4KICAgICAgICAgICAgaWYgKG9wdGlvbnMucXVlcnlQYXJhbWV0ZXJzKSB7CiAgICAgICAgICAgICAgICB2YXIgcXVlcnlQYXJhbWV0ZXJzID0gb3B0aW9ucy5xdWVyeVBhcmFtZXRlcnM7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHF1ZXJ5UGFyYW1ldGVycyAhPT0gIm9iamVjdCIpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIm9wdGlvbnMucXVlcnlQYXJhbWV0ZXJzIG11c3QgYmUgb2YgdHlwZSBvYmplY3QuIEl0IHNob3VsZCBiZSBhIEpTT04gb2JqZWN0ICIgKwogICAgICAgICAgICAgICAgICAgICAgICAib2YgXCJxdWVyeS1wYXJhbWV0ZXItbmFtZVwiIGFzIHRoZSBrZXkgYW5kIHRoZSBcInF1ZXJ5LXBhcmFtZXRlci12YWx1ZVwiIGFzIHRoZSB2YWx1ZS4gIiArCiAgICAgICAgICAgICAgICAgICAgICAgICJUaGUgXCJxdWVyeS1wYXJhbWV0ZXItdmFsdWVcIiBtYXkgYmUgZm8gdHlwZSBcInN0cmluZ1wiIG9yIGFuIFwib2JqZWN0XCIgb2YgdGhlIGZvcm0geyB2YWx1ZTogXCJxdWVyeS1wYXJhbWV0ZXItdmFsdWVcIiwgc2tpcFVybEVuY29kaW5nOiB0cnVlIH0uIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBhcHBlbmQgcXVlc3Rpb24gbWFyayBpZiBpdCBpcyBub3QgcHJlc2VudCBpbiB0aGUgdXJsCiAgICAgICAgICAgICAgICBpZiAodGhpcy51cmwgJiYgdGhpcy51cmwuaW5kZXhPZigiPyIpID09PSAtMSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMudXJsICs9ICI/IjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIGNvbnN0cnVjdCBxdWVyeVN0cmluZwogICAgICAgICAgICAgICAgdmFyIHF1ZXJ5UGFyYW1zID0gW107CiAgICAgICAgICAgICAgICAvLyBXZSBuZWVkIHRvIHBvcHVsYXRlIHRoaXMucXVlcnkgYXMgYSBkaWN0aW9uYXJ5IGlmIHRoZSByZXF1ZXN0IGlzIGJlaW5nIHVzZWQgZm9yIFN3YXkncyB2YWxpZGF0ZVJlcXVlc3QoKS4KICAgICAgICAgICAgICAgIHRoaXMucXVlcnkgPSB7fTsKICAgICAgICAgICAgICAgIGZvciAodmFyIHF1ZXJ5UGFyYW1OYW1lIGluIHF1ZXJ5UGFyYW1ldGVycykgewogICAgICAgICAgICAgICAgICAgIHZhciBxdWVyeVBhcmFtID0gcXVlcnlQYXJhbWV0ZXJzW3F1ZXJ5UGFyYW1OYW1lXTsKICAgICAgICAgICAgICAgICAgICBpZiAocXVlcnlQYXJhbSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHF1ZXJ5UGFyYW0gPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWVyeVBhcmFtcy5wdXNoKHF1ZXJ5UGFyYW1OYW1lICsgIj0iICsgZW5jb2RlVVJJQ29tcG9uZW50KHF1ZXJ5UGFyYW0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucXVlcnlbcXVlcnlQYXJhbU5hbWVdID0gZW5jb2RlVVJJQ29tcG9uZW50KHF1ZXJ5UGFyYW0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBxdWVyeVBhcmFtID09PSAib2JqZWN0IikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFxdWVyeVBhcmFtLnZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJvcHRpb25zLnF1ZXJ5UGFyYW1ldGVyc1siICsgcXVlcnlQYXJhbU5hbWUgKyAiXSBpcyBvZiB0eXBlIFwib2JqZWN0XCIgYnV0IGl0IGRvZXMgbm90IGNvbnRhaW4gYSBcInZhbHVlXCIgcHJvcGVydHkuIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocXVlcnlQYXJhbS5za2lwVXJsRW5jb2RpbmcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWVyeVBhcmFtcy5wdXNoKHF1ZXJ5UGFyYW1OYW1lICsgIj0iICsgcXVlcnlQYXJhbS52YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5xdWVyeVtxdWVyeVBhcmFtTmFtZV0gPSBxdWVyeVBhcmFtLnZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnlQYXJhbXMucHVzaChxdWVyeVBhcmFtTmFtZSArICI9IiArIGVuY29kZVVSSUNvbXBvbmVudChxdWVyeVBhcmFtLnZhbHVlKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5xdWVyeVtxdWVyeVBhcmFtTmFtZV0gPSBlbmNvZGVVUklDb21wb25lbnQocXVlcnlQYXJhbS52YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IC8vIGVuZC1vZi1mb3IKICAgICAgICAgICAgICAgIC8vIGFwcGVuZCB0aGUgcXVlcnlTdHJpbmcKICAgICAgICAgICAgICAgIHRoaXMudXJsICs9IHF1ZXJ5UGFyYW1zLmpvaW4oIiYiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBhZGQgaGVhZGVycyB0byB0aGUgcmVxdWVzdCBpZiB0aGV5IGFyZSBwcm92aWRlZAogICAgICAgICAgICBpZiAob3B0aW9ucy5oZWFkZXJzKSB7CiAgICAgICAgICAgICAgICB2YXIgaGVhZGVycyA9IG9wdGlvbnMuaGVhZGVyczsKICAgICAgICAgICAgICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSBPYmplY3Qua2V5cyhvcHRpb25zLmhlYWRlcnMpOyBfaSA8IF9hLmxlbmd0aDsgX2krKykgewogICAgICAgICAgICAgICAgICAgIHZhciBoZWFkZXJOYW1lID0gX2FbX2ldOwogICAgICAgICAgICAgICAgICAgIHRoaXMuaGVhZGVycy5zZXQoaGVhZGVyTmFtZSwgaGVhZGVyc1toZWFkZXJOYW1lXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gZW5zdXJlIGFjY2VwdC1sYW5ndWFnZSBpcyBzZXQgY29ycmVjdGx5CiAgICAgICAgICAgIGlmICghdGhpcy5oZWFkZXJzLmdldCgiYWNjZXB0LWxhbmd1YWdlIikpIHsKICAgICAgICAgICAgICAgIHRoaXMuaGVhZGVycy5zZXQoImFjY2VwdC1sYW5ndWFnZSIsICJlbi1VUyIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIGVuc3VyZSB0aGUgcmVxdWVzdC1pZCBpcyBzZXQgY29ycmVjdGx5CiAgICAgICAgICAgIGlmICghdGhpcy5oZWFkZXJzLmdldCgieC1tcy1jbGllbnQtcmVxdWVzdC1pZCIpICYmICFvcHRpb25zLmRpc2FibGVDbGllbnRSZXF1ZXN0SWQpIHsKICAgICAgICAgICAgICAgIHRoaXMuaGVhZGVycy5zZXQoIngtbXMtY2xpZW50LXJlcXVlc3QtaWQiLCBnZW5lcmF0ZVV1aWQoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gZGVmYXVsdAogICAgICAgICAgICBpZiAoIXRoaXMuaGVhZGVycy5nZXQoIkNvbnRlbnQtVHlwZSIpKSB7CiAgICAgICAgICAgICAgICB0aGlzLmhlYWRlcnMuc2V0KCJDb250ZW50LVR5cGUiLCAiYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOCIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIHNldCB0aGUgcmVxdWVzdCBib2R5LiByZXF1ZXN0LmpzIGF1dG9tYXRpY2FsbHkgc2V0cyB0aGUgQ29udGVudC1MZW5ndGggcmVxdWVzdCBoZWFkZXIsIHNvIHdlIG5lZWQgbm90IHNldCBpdCBleHBsaWNpbHR5CiAgICAgICAgICAgIHRoaXMuYm9keSA9IG9wdGlvbnMuYm9keTsKICAgICAgICAgICAgaWYgKG9wdGlvbnMuYm9keSAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIC8vIGJvZHkgYXMgYSBzdHJlYW0gc3BlY2lhbCBjYXNlLiBzZXQgdGhlIGJvZHkgYXMtaXMgYW5kIGNoZWNrIGZvciBzb21lIHNwZWNpYWwgcmVxdWVzdCBoZWFkZXJzIHNwZWNpZmljIHRvIHNlbmRpbmcgYSBzdHJlYW0uCiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5ib2R5SXNTdHJlYW0pIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaGVhZGVycy5nZXQoIlRyYW5zZmVyLUVuY29kaW5nIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oZWFkZXJzLnNldCgiVHJhbnNmZXItRW5jb2RpbmciLCAiY2h1bmtlZCIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5oZWFkZXJzLmdldCgiQ29udGVudC1UeXBlIikgIT09ICJhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGVhZGVycy5zZXQoIkNvbnRlbnQtVHlwZSIsICJhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0iKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5zZXJpYWxpemF0aW9uTWFwcGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYm9keSA9IG5ldyBTZXJpYWxpemVyKG9wdGlvbnMubWFwcGVycykuc2VyaWFsaXplKG9wdGlvbnMuc2VyaWFsaXphdGlvbk1hcHBlciwgb3B0aW9ucy5ib2R5LCAicmVxdWVzdEJvZHkiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCFvcHRpb25zLmRpc2FibGVKc29uU3RyaW5naWZ5T25Cb2R5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYm9keSA9IEpTT04uc3RyaW5naWZ5KG9wdGlvbnMuYm9keSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuYWJvcnRTaWduYWwgPSBvcHRpb25zLmFib3J0U2lnbmFsOwogICAgICAgICAgICB0aGlzLm9uRG93bmxvYWRQcm9ncmVzcyA9IG9wdGlvbnMub25Eb3dubG9hZFByb2dyZXNzOwogICAgICAgICAgICB0aGlzLm9uVXBsb2FkUHJvZ3Jlc3MgPSBvcHRpb25zLm9uVXBsb2FkUHJvZ3Jlc3M7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogQ2xvbmUgdGhpcyBXZWJSZXNvdXJjZSBIVFRQIHJlcXVlc3Qgb2JqZWN0LgogICAgICAgICAqIEByZXR1cm5zIHtXZWJSZXNvdXJjZX0gVGhlIGNsb25lIG9mIHRoaXMgV2ViUmVzb3VyY2UgSFRUUCByZXF1ZXN0IG9iamVjdC4KICAgICAgICAgKi8KICAgICAgICBXZWJSZXNvdXJjZS5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciByZXN1bHQgPSBuZXcgV2ViUmVzb3VyY2UodGhpcy51cmwsIHRoaXMubWV0aG9kLCB0aGlzLmJvZHksIHRoaXMucXVlcnksIHRoaXMuaGVhZGVycyAmJiB0aGlzLmhlYWRlcnMuY2xvbmUoKSwgdGhpcy5zdHJlYW1SZXNwb25zZUJvZHksIHRoaXMud2l0aENyZWRlbnRpYWxzLCB0aGlzLmFib3J0U2lnbmFsLCB0aGlzLnRpbWVvdXQsIHRoaXMub25VcGxvYWRQcm9ncmVzcywgdGhpcy5vbkRvd25sb2FkUHJvZ3Jlc3MpOwogICAgICAgICAgICBpZiAodGhpcy5mb3JtRGF0YSkgewogICAgICAgICAgICAgICAgcmVzdWx0LmZvcm1EYXRhID0gdGhpcy5mb3JtRGF0YTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5vcGVyYXRpb25TcGVjKSB7CiAgICAgICAgICAgICAgICByZXN1bHQub3BlcmF0aW9uU3BlYyA9IHRoaXMub3BlcmF0aW9uU3BlYzsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5zaG91bGREZXNlcmlhbGl6ZSkgewogICAgICAgICAgICAgICAgcmVzdWx0LnNob3VsZERlc2VyaWFsaXplID0gdGhpcy5zaG91bGREZXNlcmlhbGl6ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5vcGVyYXRpb25SZXNwb25zZUdldHRlcikgewogICAgICAgICAgICAgICAgcmVzdWx0Lm9wZXJhdGlvblJlc3BvbnNlR2V0dGVyID0gdGhpcy5vcGVyYXRpb25SZXNwb25zZUdldHRlcjsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH07CiAgICAgICAgcmV0dXJuIFdlYlJlc291cmNlOwogICAgfSgpKTsKCiAgICAvKiEgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogICAgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7IHlvdSBtYXkgbm90IHVzZQogICAgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUKICAgIExpY2Vuc2UgYXQgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgogICAgVEhJUyBDT0RFIElTIFBST1ZJREVEIE9OIEFOICpBUyBJUyogQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogICAgS0lORCwgRUlUSEVSIEVYUFJFU1MgT1IgSU1QTElFRCwgSU5DTFVESU5HIFdJVEhPVVQgTElNSVRBVElPTiBBTlkgSU1QTElFRAogICAgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIFRJVExFLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSwKICAgIE1FUkNIQU5UQUJMSVRZIE9SIE5PTi1JTkZSSU5HRU1FTlQuCgogICAgU2VlIHRoZSBBcGFjaGUgVmVyc2lvbiAyLjAgTGljZW5zZSBmb3Igc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zCiAgICBhbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqLwogICAgLyogZ2xvYmFsIFJlZmxlY3QsIFByb21pc2UgKi8KCiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uKGQsIGIpIHsKICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CiAgICB9OwoKICAgIGZ1bmN0aW9uIF9fZXh0ZW5kcyhkLCBiKSB7CiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CiAgICB9CgogICAgdmFyIF9fYXNzaWduID0gZnVuY3Rpb24oKSB7CiAgICAgICAgX19hc3NpZ24gPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uIF9fYXNzaWduKHQpIHsKICAgICAgICAgICAgZm9yICh2YXIgcywgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICAgICAgICBzID0gYXJndW1lbnRzW2ldOwogICAgICAgICAgICAgICAgZm9yICh2YXIgcCBpbiBzKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApKSB0W3BdID0gc1twXTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdDsKICAgICAgICB9OwogICAgICAgIHJldHVybiBfX2Fzc2lnbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfTsKCiAgICBmdW5jdGlvbiBfX2F3YWl0ZXIodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7CiAgICAgICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH0KICAgICAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbInRocm93Il0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfQogICAgICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUocmVzdWx0LnZhbHVlKTsgfSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfQogICAgICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7CiAgICAgICAgfSk7CiAgICB9CgogICAgZnVuY3Rpb24gX19nZW5lcmF0b3IodGhpc0FyZywgYm9keSkgewogICAgICAgIHZhciBfID0geyBsYWJlbDogMCwgc2VudDogZnVuY3Rpb24oKSB7IGlmICh0WzBdICYgMSkgdGhyb3cgdFsxXTsgcmV0dXJuIHRbMV07IH0sIHRyeXM6IFtdLCBvcHM6IFtdIH0sIGYsIHksIHQsIGc7CiAgICAgICAgcmV0dXJuIGcgPSB7IG5leHQ6IHZlcmIoMCksICJ0aHJvdyI6IHZlcmIoMSksICJyZXR1cm4iOiB2ZXJiKDIpIH0sIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgKGdbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSksIGc7CiAgICAgICAgZnVuY3Rpb24gdmVyYihuKSB7IHJldHVybiBmdW5jdGlvbiAodikgeyByZXR1cm4gc3RlcChbbiwgdl0pOyB9OyB9CiAgICAgICAgZnVuY3Rpb24gc3RlcChvcCkgewogICAgICAgICAgICBpZiAoZikgdGhyb3cgbmV3IFR5cGVFcnJvcigiR2VuZXJhdG9yIGlzIGFscmVhZHkgZXhlY3V0aW5nLiIpOwogICAgICAgICAgICB3aGlsZSAoXykgdHJ5IHsKICAgICAgICAgICAgICAgIGlmIChmID0gMSwgeSAmJiAodCA9IG9wWzBdICYgMiA/IHlbInJldHVybiJdIDogb3BbMF0gPyB5WyJ0aHJvdyJdIHx8ICgodCA9IHlbInJldHVybiJdKSAmJiB0LmNhbGwoeSksIDApIDogeS5uZXh0KSAmJiAhKHQgPSB0LmNhbGwoeSwgb3BbMV0pKS5kb25lKSByZXR1cm4gdDsKICAgICAgICAgICAgICAgIGlmICh5ID0gMCwgdCkgb3AgPSBbb3BbMF0gJiAyLCB0LnZhbHVlXTsKICAgICAgICAgICAgICAgIHN3aXRjaCAob3BbMF0pIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIDA6IGNhc2UgMTogdCA9IG9wOyBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6IF8ubGFiZWwrKzsgcmV0dXJuIHsgdmFsdWU6IG9wWzFdLCBkb25lOiBmYWxzZSB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgNTogXy5sYWJlbCsrOyB5ID0gb3BbMV07IG9wID0gWzBdOyBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDc6IG9wID0gXy5vcHMucG9wKCk7IF8udHJ5cy5wb3AoKTsgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEodCA9IF8udHJ5cywgdCA9IHQubGVuZ3RoID4gMCAmJiB0W3QubGVuZ3RoIC0gMV0pICYmIChvcFswXSA9PT0gNiB8fCBvcFswXSA9PT0gMikpIHsgXyA9IDA7IGNvbnRpbnVlOyB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gMyAmJiAoIXQgfHwgKG9wWzFdID4gdFswXSAmJiBvcFsxXSA8IHRbM10pKSkgeyBfLmxhYmVsID0gb3BbMV07IGJyZWFrOyB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gNiAmJiBfLmxhYmVsIDwgdFsxXSkgeyBfLmxhYmVsID0gdFsxXTsgdCA9IG9wOyBicmVhazsgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAodCAmJiBfLmxhYmVsIDwgdFsyXSkgeyBfLmxhYmVsID0gdFsyXTsgXy5vcHMucHVzaChvcCk7IGJyZWFrOyB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0WzJdKSBfLm9wcy5wb3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgXy50cnlzLnBvcCgpOyBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG9wID0gYm9keS5jYWxsKHRoaXNBcmcsIF8pOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7IG9wID0gWzYsIGVdOyB5ID0gMDsgfSBmaW5hbGx5IHsgZiA9IHQgPSAwOyB9CiAgICAgICAgICAgIGlmIChvcFswXSAmIDUpIHRocm93IG9wWzFdOyByZXR1cm4geyB2YWx1ZTogb3BbMF0gPyBvcFsxXSA6IHZvaWQgMCwgZG9uZTogdHJ1ZSB9OwogICAgICAgIH0KICAgIH0KCiAgICAvLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICAgIHZhciBSZXN0RXJyb3IgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CiAgICAgICAgX19leHRlbmRzKFJlc3RFcnJvciwgX3N1cGVyKTsKICAgICAgICBmdW5jdGlvbiBSZXN0RXJyb3IobWVzc2FnZSwgY29kZSwgc3RhdHVzQ29kZSwgcmVxdWVzdCwgcmVzcG9uc2UsIGJvZHkpIHsKICAgICAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgbWVzc2FnZSkgfHwgdGhpczsKICAgICAgICAgICAgX3RoaXMuY29kZSA9IGNvZGU7CiAgICAgICAgICAgIF90aGlzLnN0YXR1c0NvZGUgPSBzdGF0dXNDb2RlOwogICAgICAgICAgICBfdGhpcy5yZXF1ZXN0ID0gcmVxdWVzdDsKICAgICAgICAgICAgX3RoaXMucmVzcG9uc2UgPSByZXNwb25zZTsKICAgICAgICAgICAgX3RoaXMuYm9keSA9IGJvZHk7CiAgICAgICAgICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZihfdGhpcywgUmVzdEVycm9yLnByb3RvdHlwZSk7CiAgICAgICAgICAgIHJldHVybiBfdGhpczsKICAgICAgICB9CiAgICAgICAgUmVzdEVycm9yLlJFUVVFU1RfU0VORF9FUlJPUiA9ICJSRVFVRVNUX1NFTkRfRVJST1IiOwogICAgICAgIFJlc3RFcnJvci5SRVFVRVNUX0FCT1JURURfRVJST1IgPSAiUkVRVUVTVF9BQk9SVEVEX0VSUk9SIjsKICAgICAgICBSZXN0RXJyb3IuUEFSU0VfRVJST1IgPSAiUEFSU0VfRVJST1IiOwogICAgICAgIHJldHVybiBSZXN0RXJyb3I7CiAgICB9KEVycm9yKSk7CgogICAgLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAgICAvKioKICAgICAqIEEgSHR0cENsaWVudCBpbXBsZW1lbnRhdGlvbiB0aGF0IHVzZXMgWE1MSHR0cFJlcXVlc3QgdG8gc2VuZCBIVFRQIHJlcXVlc3RzLgogICAgICovCiAgICB2YXIgWGhySHR0cENsaWVudCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBYaHJIdHRwQ2xpZW50KCkgewogICAgICAgIH0KICAgICAgICBYaHJIdHRwQ2xpZW50LnByb3RvdHlwZS5zZW5kUmVxdWVzdCA9IGZ1bmN0aW9uIChyZXF1ZXN0KSB7CiAgICAgICAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgICAgICAgICAgaWYgKHJlcXVlc3QucHJveHlTZXR0aW5ncykgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJIVFRQIHByb3h5IGlzIG5vdCBzdXBwb3J0ZWQgaW4gYnJvd3NlciBlbnZpcm9ubWVudCIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBhYm9ydFNpZ25hbCA9IHJlcXVlc3QuYWJvcnRTaWduYWw7CiAgICAgICAgICAgIGlmIChhYm9ydFNpZ25hbCkgewogICAgICAgICAgICAgICAgdmFyIGxpc3RlbmVyXzEgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgeGhyLmFib3J0KCk7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgYWJvcnRTaWduYWwuYWRkRXZlbnRMaXN0ZW5lcigiYWJvcnQiLCBsaXN0ZW5lcl8xKTsKICAgICAgICAgICAgICAgIHhoci5hZGRFdmVudExpc3RlbmVyKCJyZWFkeXN0YXRlY2hhbmdlIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIGlmICh4aHIucmVhZHlTdGF0ZSA9PT0gWE1MSHR0cFJlcXVlc3QuRE9ORSkgewogICAgICAgICAgICAgICAgICAgICAgICBhYm9ydFNpZ25hbC5yZW1vdmVFdmVudExpc3RlbmVyKCJhYm9ydCIsIGxpc3RlbmVyXzEpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFkZFByb2dyZXNzTGlzdGVuZXIoeGhyLnVwbG9hZCwgcmVxdWVzdC5vblVwbG9hZFByb2dyZXNzKTsKICAgICAgICAgICAgYWRkUHJvZ3Jlc3NMaXN0ZW5lcih4aHIsIHJlcXVlc3Qub25Eb3dubG9hZFByb2dyZXNzKTsKICAgICAgICAgICAgaWYgKHJlcXVlc3QuZm9ybURhdGEpIHsKICAgICAgICAgICAgICAgIHZhciBmb3JtRGF0YSA9IHJlcXVlc3QuZm9ybURhdGE7CiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdEZvcm1fMSA9IG5ldyBGb3JtRGF0YSgpOwogICAgICAgICAgICAgICAgdmFyIGFwcGVuZEZvcm1WYWx1ZSA9IGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlICYmIHZhbHVlLmhhc093blByb3BlcnR5KCJ2YWx1ZSIpICYmIHZhbHVlLmhhc093blByb3BlcnR5KCJvcHRpb25zIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdEZvcm1fMS5hcHBlbmQoa2V5LCB2YWx1ZS52YWx1ZSwgdmFsdWUub3B0aW9ucyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0Rm9ybV8xLmFwcGVuZChrZXksIHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IE9iamVjdC5rZXlzKGZvcm1EYXRhKTsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZm9ybUtleSA9IF9hW19pXTsKICAgICAgICAgICAgICAgICAgICB2YXIgZm9ybVZhbHVlID0gZm9ybURhdGFbZm9ybUtleV07CiAgICAgICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZm9ybVZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGZvcm1WYWx1ZS5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kRm9ybVZhbHVlKGZvcm1LZXksIGZvcm1WYWx1ZVtqXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZEZvcm1WYWx1ZShmb3JtS2V5LCBmb3JtVmFsdWUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlcXVlc3QuYm9keSA9IHJlcXVlc3RGb3JtXzE7CiAgICAgICAgICAgICAgICByZXF1ZXN0LmZvcm1EYXRhID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgdmFyIGNvbnRlbnRUeXBlID0gcmVxdWVzdC5oZWFkZXJzLmdldCgiQ29udGVudC1UeXBlIik7CiAgICAgICAgICAgICAgICBpZiAoY29udGVudFR5cGUgJiYgY29udGVudFR5cGUuaW5kZXhPZigibXVsdGlwYXJ0L2Zvcm0tZGF0YSIpICE9PSAtMSkgewogICAgICAgICAgICAgICAgICAgIC8vIGJyb3dzZXIgd2lsbCBhdXRvbWF0aWNhbGx5IGFwcGx5IGEgc3VpdGFibGUgY29udGVudC10eXBlIGhlYWRlcgogICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuaGVhZGVycy5yZW1vdmUoIkNvbnRlbnQtVHlwZSIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHhoci5vcGVuKHJlcXVlc3QubWV0aG9kLCByZXF1ZXN0LnVybCk7CiAgICAgICAgICAgIHhoci50aW1lb3V0ID0gcmVxdWVzdC50aW1lb3V0OwogICAgICAgICAgICB4aHIud2l0aENyZWRlbnRpYWxzID0gcmVxdWVzdC53aXRoQ3JlZGVudGlhbHM7CiAgICAgICAgICAgIGZvciAodmFyIF9iID0gMCwgX2MgPSByZXF1ZXN0LmhlYWRlcnMuaGVhZGVyc0FycmF5KCk7IF9iIDwgX2MubGVuZ3RoOyBfYisrKSB7CiAgICAgICAgICAgICAgICB2YXIgaGVhZGVyID0gX2NbX2JdOwogICAgICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoaGVhZGVyLm5hbWUsIGhlYWRlci52YWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgeGhyLnJlc3BvbnNlVHlwZSA9IHJlcXVlc3Quc3RyZWFtUmVzcG9uc2VCb2R5ID8gImJsb2IiIDogInRleHQiOwogICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tbnVsbC1rZXl3b3JkCiAgICAgICAgICAgIHhoci5zZW5kKHJlcXVlc3QuYm9keSA9PT0gdW5kZWZpbmVkID8gbnVsbCA6IHJlcXVlc3QuYm9keSk7CiAgICAgICAgICAgIGlmIChyZXF1ZXN0LnN0cmVhbVJlc3BvbnNlQm9keSkgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgICAgICAgICAgICB4aHIuYWRkRXZlbnRMaXN0ZW5lcigicmVhZHlzdGF0ZWNoYW5nZSIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVzb2x2ZSBhcyBzb29uIGFzIGhlYWRlcnMgYXJlIGxvYWRlZAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoeGhyLnJlYWR5U3RhdGUgPT09IFhNTEh0dHBSZXF1ZXN0LkhFQURFUlNfUkVDRUlWRUQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBibG9iQm9keSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4aHIuYWRkRXZlbnRMaXN0ZW5lcigibG9hZCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh4aHIucmVzcG9uc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdE9uVGVybWluYWxFdmVudChyZXF1ZXN0LCB4aHIsIHJlamVjdCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3Q6IHJlcXVlc3QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiB4aHIuc3RhdHVzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHBhcnNlSGVhZGVycyh4aHIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsb2JCb2R5OiBibG9iQm9keQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICByZWplY3RPblRlcm1pbmFsRXZlbnQocmVxdWVzdCwgeGhyLCByZWplY3QpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgICAgICAgICAgIHhoci5hZGRFdmVudExpc3RlbmVyKCJsb2FkIiwgZnVuY3Rpb24gKCkgeyByZXR1cm4gcmVzb2x2ZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3Q6IHJlcXVlc3QsCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogeGhyLnN0YXR1cywKICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogcGFyc2VIZWFkZXJzKHhociksCiAgICAgICAgICAgICAgICAgICAgICAgIGJvZHlBc1RleHQ6IHhoci5yZXNwb25zZVRleHQKICAgICAgICAgICAgICAgICAgICB9KTsgfSk7CiAgICAgICAgICAgICAgICAgICAgcmVqZWN0T25UZXJtaW5hbEV2ZW50KHJlcXVlc3QsIHhociwgcmVqZWN0KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gWGhySHR0cENsaWVudDsKICAgIH0oKSk7CiAgICBmdW5jdGlvbiBhZGRQcm9ncmVzc0xpc3RlbmVyKHhociwgbGlzdGVuZXIpIHsKICAgICAgICBpZiAobGlzdGVuZXIpIHsKICAgICAgICAgICAgeGhyLmFkZEV2ZW50TGlzdGVuZXIoInByb2dyZXNzIiwgZnVuY3Rpb24gKHJhd0V2ZW50KSB7IHJldHVybiBsaXN0ZW5lcih7CiAgICAgICAgICAgICAgICBsb2FkZWRCeXRlczogcmF3RXZlbnQubG9hZGVkCiAgICAgICAgICAgIH0pOyB9KTsKICAgICAgICB9CiAgICB9CiAgICAvLyBleHBvcnRlZCBsb2NhbGx5IGZvciB0ZXN0aW5nCiAgICBmdW5jdGlvbiBwYXJzZUhlYWRlcnMoeGhyKSB7CiAgICAgICAgdmFyIHJlc3BvbnNlSGVhZGVycyA9IG5ldyBIdHRwSGVhZGVycygpOwogICAgICAgIHZhciBoZWFkZXJMaW5lcyA9IHhoci5nZXRBbGxSZXNwb25zZUhlYWRlcnMoKS50cmltKCkuc3BsaXQoL1tcclxuXSsvKTsKICAgICAgICBmb3IgKHZhciBfaSA9IDAsIGhlYWRlckxpbmVzXzEgPSBoZWFkZXJMaW5lczsgX2kgPCBoZWFkZXJMaW5lc18xLmxlbmd0aDsgX2krKykgewogICAgICAgICAgICB2YXIgbGluZSA9IGhlYWRlckxpbmVzXzFbX2ldOwogICAgICAgICAgICB2YXIgaW5kZXggPSBsaW5lLmluZGV4T2YoIjoiKTsKICAgICAgICAgICAgdmFyIGhlYWRlck5hbWUgPSBsaW5lLnNsaWNlKDAsIGluZGV4KTsKICAgICAgICAgICAgdmFyIGhlYWRlclZhbHVlID0gbGluZS5zbGljZShpbmRleCArIDIpOwogICAgICAgICAgICByZXNwb25zZUhlYWRlcnMuc2V0KGhlYWRlck5hbWUsIGhlYWRlclZhbHVlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3BvbnNlSGVhZGVyczsKICAgIH0KICAgIGZ1bmN0aW9uIHJlamVjdE9uVGVybWluYWxFdmVudChyZXF1ZXN0LCB4aHIsIHJlamVjdCkgewogICAgICAgIHhoci5hZGRFdmVudExpc3RlbmVyKCJlcnJvciIsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIHJlamVjdChuZXcgUmVzdEVycm9yKCJGYWlsZWQgdG8gc2VuZCByZXF1ZXN0IHRvICIgKyByZXF1ZXN0LnVybCwgUmVzdEVycm9yLlJFUVVFU1RfU0VORF9FUlJPUiwgdW5kZWZpbmVkLCByZXF1ZXN0KSk7IH0pOwogICAgICAgIHhoci5hZGRFdmVudExpc3RlbmVyKCJhYm9ydCIsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIHJlamVjdChuZXcgUmVzdEVycm9yKCJUaGUgcmVxdWVzdCB3YXMgYWJvcnRlZCIsIFJlc3RFcnJvci5SRVFVRVNUX0FCT1JURURfRVJST1IsIHVuZGVmaW5lZCwgcmVxdWVzdCkpOyB9KTsKICAgICAgICB4aHIuYWRkRXZlbnRMaXN0ZW5lcigidGltZW91dCIsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIHJlamVjdChuZXcgUmVzdEVycm9yKCJ0aW1lb3V0IG9mICIgKyB4aHIudGltZW91dCArICJtcyBleGNlZWRlZCIsIFJlc3RFcnJvci5SRVFVRVNUX1NFTkRfRVJST1IsIHVuZGVmaW5lZCwgcmVxdWVzdCkpOyB9KTsKICAgIH0KCiAgICAvLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICAgIChmdW5jdGlvbiAoSHR0cFBpcGVsaW5lTG9nTGV2ZWwpIHsKICAgICAgICAvKioKICAgICAgICAgKiBBIGxvZyBsZXZlbCB0aGF0IGluZGljYXRlcyB0aGF0IG5vIGxvZ3Mgd2lsbCBiZSBsb2dnZWQuCiAgICAgICAgICovCiAgICAgICAgSHR0cFBpcGVsaW5lTG9nTGV2ZWxbSHR0cFBpcGVsaW5lTG9nTGV2ZWxbIk9GRiJdID0gMF0gPSAiT0ZGIjsKICAgICAgICAvKioKICAgICAgICAgKiBBbiBlcnJvciBsb2cuCiAgICAgICAgICovCiAgICAgICAgSHR0cFBpcGVsaW5lTG9nTGV2ZWxbSHR0cFBpcGVsaW5lTG9nTGV2ZWxbIkVSUk9SIl0gPSAxXSA9ICJFUlJPUiI7CiAgICAgICAgLyoqCiAgICAgICAgICogQSB3YXJuaW5nIGxvZy4KICAgICAgICAgKi8KICAgICAgICBIdHRwUGlwZWxpbmVMb2dMZXZlbFtIdHRwUGlwZWxpbmVMb2dMZXZlbFsiV0FSTklORyJdID0gMl0gPSAiV0FSTklORyI7CiAgICAgICAgLyoqCiAgICAgICAgICogQW4gaW5mb3JtYXRpb24gbG9nLgogICAgICAgICAqLwogICAgICAgIEh0dHBQaXBlbGluZUxvZ0xldmVsW0h0dHBQaXBlbGluZUxvZ0xldmVsWyJJTkZPIl0gPSAzXSA9ICJJTkZPIjsKICAgIH0pKGV4cG9ydHMuSHR0cFBpcGVsaW5lTG9nTGV2ZWwgfHwgKGV4cG9ydHMuSHR0cFBpcGVsaW5lTG9nTGV2ZWwgPSB7fSkpOwoKICAgIC8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogICAgLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi4KICAgIC8qKgogICAgICogR2V0IHRoZSBwYXRoIHRvIHRoaXMgcGFyYW1ldGVyJ3MgdmFsdWUgYXMgYSBkb3R0ZWQgc3RyaW5nIChhLmIuYykuCiAgICAgKiBAcGFyYW0gcGFyYW1ldGVyIFRoZSBwYXJhbWV0ZXIgdG8gZ2V0IHRoZSBwYXRoIHN0cmluZyBmb3IuCiAgICAgKiBAcmV0dXJucyBUaGUgcGF0aCB0byB0aGlzIHBhcmFtZXRlcidzIHZhbHVlIGFzIGEgZG90dGVkIHN0cmluZy4KICAgICAqLwogICAgZnVuY3Rpb24gZ2V0UGF0aFN0cmluZ0Zyb21QYXJhbWV0ZXIocGFyYW1ldGVyKSB7CiAgICAgICAgcmV0dXJuIGdldFBhdGhTdHJpbmdGcm9tUGFyYW1ldGVyUGF0aChwYXJhbWV0ZXIucGFyYW1ldGVyUGF0aCwgcGFyYW1ldGVyLm1hcHBlcik7CiAgICB9CiAgICBmdW5jdGlvbiBnZXRQYXRoU3RyaW5nRnJvbVBhcmFtZXRlclBhdGgocGFyYW1ldGVyUGF0aCwgbWFwcGVyKSB7CiAgICAgICAgdmFyIHJlc3VsdDsKICAgICAgICBpZiAodHlwZW9mIHBhcmFtZXRlclBhdGggPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgIHJlc3VsdCA9IHBhcmFtZXRlclBhdGg7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKEFycmF5LmlzQXJyYXkocGFyYW1ldGVyUGF0aCkpIHsKICAgICAgICAgICAgcmVzdWx0ID0gcGFyYW1ldGVyUGF0aC5qb2luKCIuIik7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICByZXN1bHQgPSBtYXBwZXIuc2VyaWFsaXplZE5hbWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogICAgLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAgICBmdW5jdGlvbiBpc1N0cmVhbU9wZXJhdGlvbihvcGVyYXRpb25TcGVjKSB7CiAgICAgICAgdmFyIHJlc3VsdCA9IGZhbHNlOwogICAgICAgIGZvciAodmFyIHN0YXR1c0NvZGUgaW4gb3BlcmF0aW9uU3BlYy5yZXNwb25zZXMpIHsKICAgICAgICAgICAgdmFyIG9wZXJhdGlvblJlc3BvbnNlID0gb3BlcmF0aW9uU3BlYy5yZXNwb25zZXNbc3RhdHVzQ29kZV07CiAgICAgICAgICAgIGlmIChvcGVyYXRpb25SZXNwb25zZS5ib2R5TWFwcGVyICYmIG9wZXJhdGlvblJlc3BvbnNlLmJvZHlNYXBwZXIudHlwZS5uYW1lID09PSBNYXBwZXJUeXBlLlN0cmVhbSkgewogICAgICAgICAgICAgICAgcmVzdWx0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogICAgLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAgICAvLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLgogICAgdmFyIHBhcnNlciA9IG5ldyBET01QYXJzZXIoKTsKICAgIGZ1bmN0aW9uIHBhcnNlWE1MKHN0cikgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHZhciBkb20gPSBwYXJzZXIucGFyc2VGcm9tU3RyaW5nKHN0ciwgImFwcGxpY2F0aW9uL3htbCIpOwogICAgICAgICAgICB0aHJvd0lmRXJyb3IoZG9tKTsKICAgICAgICAgICAgdmFyIG9iaiA9IGRvbVRvT2JqZWN0KGRvbS5jaGlsZE5vZGVzWzBdKTsKICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShvYmopOwogICAgICAgIH0KICAgICAgICBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnIpOwogICAgICAgIH0KICAgIH0KICAgIHZhciBlcnJvck5TID0gIiI7CiAgICB0cnkgewogICAgICAgIGVycm9yTlMgPSBwYXJzZXIucGFyc2VGcm9tU3RyaW5nKCJJTlZBTElEIiwgInRleHQveG1sIikuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInBhcnNlcmVycm9yIilbMF0ubmFtZXNwYWNlVVJJOwogICAgfQogICAgY2F0Y2ggKGlnbm9yZWQpIHsKICAgICAgICAvLyBNb3N0IGJyb3dzZXJzIHdpbGwgcmV0dXJuIGEgZG9jdW1lbnQgY29udGFpbmluZyA8cGFyc2VyZXJyb3I+LCBidXQgSUUgd2lsbCB0aHJvdy4KICAgIH0KICAgIGZ1bmN0aW9uIHRocm93SWZFcnJvcihkb20pIHsKICAgICAgICBpZiAoZXJyb3JOUykgewogICAgICAgICAgICB2YXIgcGFyc2VyRXJyb3JzID0gZG9tLmdldEVsZW1lbnRzQnlUYWdOYW1lTlMoZXJyb3JOUywgInBhcnNlcmVycm9yIik7CiAgICAgICAgICAgIGlmIChwYXJzZXJFcnJvcnMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IocGFyc2VyRXJyb3JzLml0ZW0oMCkuaW5uZXJIVE1MKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIGlzRWxlbWVudChub2RlKSB7CiAgICAgICAgcmV0dXJuICEhbm9kZS5hdHRyaWJ1dGVzOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIEVsZW1lbnQtdHlwZWQgdmVyc2lvbiBvZiB0aGUgcHJvdmlkZWQgTm9kZSBpZiB0aGUgcHJvdmlkZWQgbm9kZSBpcyBhbiBlbGVtZW50IHdpdGgKICAgICAqIGF0dHJpYnV0ZXMuIElmIGl0IGlzbid0LCB0aGVuIHVuZGVmaW5lZCBpcyByZXR1cm5lZC4KICAgICAqLwogICAgZnVuY3Rpb24gYXNFbGVtZW50V2l0aEF0dHJpYnV0ZXMobm9kZSkgewogICAgICAgIHJldHVybiBpc0VsZW1lbnQobm9kZSkgJiYgbm9kZS5oYXNBdHRyaWJ1dGVzKCkgPyBub2RlIDogdW5kZWZpbmVkOwogICAgfQogICAgZnVuY3Rpb24gZG9tVG9PYmplY3Qobm9kZSkgewogICAgICAgIHZhciByZXN1bHQgPSB7fTsKICAgICAgICB2YXIgY2hpbGROb2RlQ291bnQgPSBub2RlLmNoaWxkTm9kZXMubGVuZ3RoOwogICAgICAgIHZhciBmaXJzdENoaWxkTm9kZSA9IG5vZGUuY2hpbGROb2Rlc1swXTsKICAgICAgICB2YXIgb25seUNoaWxkVGV4dFZhbHVlID0gKGZpcnN0Q2hpbGROb2RlICYmIGNoaWxkTm9kZUNvdW50ID09PSAxICYmIGZpcnN0Q2hpbGROb2RlLm5vZGVUeXBlID09PSBOb2RlLlRFWFRfTk9ERSAmJiBmaXJzdENoaWxkTm9kZS5ub2RlVmFsdWUpIHx8IHVuZGVmaW5lZDsKICAgICAgICB2YXIgZWxlbWVudFdpdGhBdHRyaWJ1dGVzID0gYXNFbGVtZW50V2l0aEF0dHJpYnV0ZXMobm9kZSk7CiAgICAgICAgaWYgKGVsZW1lbnRXaXRoQXR0cmlidXRlcykgewogICAgICAgICAgICByZXN1bHRbIiQiXSA9IHt9OwogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVsZW1lbnRXaXRoQXR0cmlidXRlcy5hdHRyaWJ1dGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICB2YXIgYXR0ciA9IGVsZW1lbnRXaXRoQXR0cmlidXRlcy5hdHRyaWJ1dGVzW2ldOwogICAgICAgICAgICAgICAgcmVzdWx0WyIkIl1bYXR0ci5ub2RlTmFtZV0gPSBhdHRyLm5vZGVWYWx1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob25seUNoaWxkVGV4dFZhbHVlKSB7CiAgICAgICAgICAgICAgICByZXN1bHRbIl8iXSA9IG9ubHlDaGlsZFRleHRWYWx1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChjaGlsZE5vZGVDb3VudCA9PT0gMCkgewogICAgICAgICAgICByZXN1bHQgPSAiIjsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAob25seUNoaWxkVGV4dFZhbHVlKSB7CiAgICAgICAgICAgIHJlc3VsdCA9IG9ubHlDaGlsZFRleHRWYWx1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKCFvbmx5Q2hpbGRUZXh0VmFsdWUpIHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGlsZE5vZGVDb3VudDsgaSsrKSB7CiAgICAgICAgICAgICAgICB2YXIgY2hpbGQgPSBub2RlLmNoaWxkTm9kZXNbaV07CiAgICAgICAgICAgICAgICAvLyBJZ25vcmUgbGVhZGluZy90cmFpbGluZyB3aGl0ZXNwYWNlIG5vZGVzCiAgICAgICAgICAgICAgICBpZiAoY2hpbGQubm9kZVR5cGUgIT09IE5vZGUuVEVYVF9OT0RFKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGNoaWxkT2JqZWN0ID0gZG9tVG9PYmplY3QoY2hpbGQpOwogICAgICAgICAgICAgICAgICAgIGlmICghcmVzdWx0W2NoaWxkLm5vZGVOYW1lXSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRbY2hpbGQubm9kZU5hbWVdID0gY2hpbGRPYmplY3Q7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKEFycmF5LmlzQXJyYXkocmVzdWx0W2NoaWxkLm5vZGVOYW1lXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0W2NoaWxkLm5vZGVOYW1lXS5wdXNoKGNoaWxkT2JqZWN0KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFtjaGlsZC5ub2RlTmFtZV0gPSBbcmVzdWx0W2NoaWxkLm5vZGVOYW1lXSwgY2hpbGRPYmplY3RdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLW51bGwta2V5d29yZAogICAgdmFyIGRvYyA9IGRvY3VtZW50LmltcGxlbWVudGF0aW9uLmNyZWF0ZURvY3VtZW50KG51bGwsIG51bGwsIG51bGwpOwogICAgdmFyIHNlcmlhbGl6ZXIgPSBuZXcgWE1MU2VyaWFsaXplcigpOwogICAgZnVuY3Rpb24gc3RyaW5naWZ5WE1MKG9iaiwgb3B0cykgewogICAgICAgIHZhciByb290TmFtZSA9IG9wdHMgJiYgb3B0cy5yb290TmFtZSB8fCAicm9vdCI7CiAgICAgICAgdmFyIGRvbSA9IGJ1aWxkTm9kZShvYmosIHJvb3ROYW1lKVswXTsKICAgICAgICByZXR1cm4gJzw/eG1sIHZlcnNpb249IjEuMCIgZW5jb2Rpbmc9IlVURi04IiBzdGFuZGFsb25lPSJ5ZXMiPz4nICsgc2VyaWFsaXplci5zZXJpYWxpemVUb1N0cmluZyhkb20pOwogICAgfQogICAgZnVuY3Rpb24gYnVpbGRBdHRyaWJ1dGVzKGF0dHJzKSB7CiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOwogICAgICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSBPYmplY3Qua2V5cyhhdHRycyk7IF9pIDwgX2EubGVuZ3RoOyBfaSsrKSB7CiAgICAgICAgICAgIHZhciBrZXkgPSBfYVtfaV07CiAgICAgICAgICAgIHZhciBhdHRyID0gZG9jLmNyZWF0ZUF0dHJpYnV0ZShrZXkpOwogICAgICAgICAgICBhdHRyLnZhbHVlID0gYXR0cnNba2V5XS50b1N0cmluZygpOwogICAgICAgICAgICByZXN1bHQucHVzaChhdHRyKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIGZ1bmN0aW9uIGJ1aWxkTm9kZShvYmosIGVsZW1lbnROYW1lKSB7CiAgICAgICAgaWYgKHR5cGVvZiBvYmogPT09ICJzdHJpbmciIHx8IHR5cGVvZiBvYmogPT09ICJudW1iZXIiIHx8IHR5cGVvZiBvYmogPT09ICJib29sZWFuIikgewogICAgICAgICAgICB2YXIgZWxlbSA9IGRvYy5jcmVhdGVFbGVtZW50KGVsZW1lbnROYW1lKTsKICAgICAgICAgICAgZWxlbS50ZXh0Q29udGVudCA9IG9iai50b1N0cmluZygpOwogICAgICAgICAgICByZXR1cm4gW2VsZW1dOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHsKICAgICAgICAgICAgdmFyIHJlc3VsdCA9IFtdOwogICAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIG9ial8xID0gb2JqOyBfaSA8IG9ial8xLmxlbmd0aDsgX2krKykgewogICAgICAgICAgICAgICAgdmFyIGFycmF5RWxlbSA9IG9ial8xW19pXTsKICAgICAgICAgICAgICAgIGZvciAodmFyIF9hID0gMCwgX2IgPSBidWlsZE5vZGUoYXJyYXlFbGVtLCBlbGVtZW50TmFtZSk7IF9hIDwgX2IubGVuZ3RoOyBfYSsrKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGNoaWxkID0gX2JbX2FdOwogICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGNoaWxkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgICAgICBlbHNlIGlmICh0eXBlb2Ygb2JqID09PSAib2JqZWN0IikgewogICAgICAgICAgICB2YXIgZWxlbSA9IGRvYy5jcmVhdGVFbGVtZW50KGVsZW1lbnROYW1lKTsKICAgICAgICAgICAgZm9yICh2YXIgX2MgPSAwLCBfZCA9IE9iamVjdC5rZXlzKG9iaik7IF9jIDwgX2QubGVuZ3RoOyBfYysrKSB7CiAgICAgICAgICAgICAgICB2YXIga2V5ID0gX2RbX2NdOwogICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gIiQiKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgX2UgPSAwLCBfZiA9IGJ1aWxkQXR0cmlidXRlcyhvYmpba2V5XSk7IF9lIDwgX2YubGVuZ3RoOyBfZSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRyID0gX2ZbX2VdOwogICAgICAgICAgICAgICAgICAgICAgICBlbGVtLmF0dHJpYnV0ZXMuc2V0TmFtZWRJdGVtKGF0dHIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIF9nID0gMCwgX2ggPSBidWlsZE5vZGUob2JqW2tleV0sIGtleSk7IF9nIDwgX2gubGVuZ3RoOyBfZysrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjaGlsZCA9IF9oW19nXTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbS5hcHBlbmRDaGlsZChjaGlsZCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBbZWxlbV07CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIklsbGVnYWwgdmFsdWUgcGFzc2VkIHRvIGJ1aWxkT2JqZWN0OiAiICsgb2JqKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAgICB2YXIgQmFzZVJlcXVlc3RQb2xpY3kgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CiAgICAgICAgZnVuY3Rpb24gQmFzZVJlcXVlc3RQb2xpY3koX25leHRQb2xpY3ksIF9vcHRpb25zKSB7CiAgICAgICAgICAgIHRoaXMuX25leHRQb2xpY3kgPSBfbmV4dFBvbGljeTsKICAgICAgICAgICAgdGhpcy5fb3B0aW9ucyA9IF9vcHRpb25zOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBHZXQgd2hldGhlciBvciBub3QgYSBsb2cgd2l0aCB0aGUgcHJvdmlkZWQgbG9nIGxldmVsIHNob3VsZCBiZSBsb2dnZWQuCiAgICAgICAgICogQHBhcmFtIGxvZ0xldmVsIFRoZSBsb2cgbGV2ZWwgb2YgdGhlIGxvZyB0aGF0IHdpbGwgYmUgbG9nZ2VkLgogICAgICAgICAqIEByZXR1cm5zIFdoZXRoZXIgb3Igbm90IGEgbG9nIHdpdGggdGhlIHByb3ZpZGVkIGxvZyBsZXZlbCBzaG91bGQgYmUgbG9nZ2VkLgogICAgICAgICAqLwogICAgICAgIEJhc2VSZXF1ZXN0UG9saWN5LnByb3RvdHlwZS5zaG91bGRMb2cgPSBmdW5jdGlvbiAobG9nTGV2ZWwpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29wdGlvbnMuc2hvdWxkTG9nKGxvZ0xldmVsKTsKICAgICAgICB9OwogICAgICAgIC8qKgogICAgICAgICAqIEF0dGVtcHQgdG8gbG9nIHRoZSBwcm92aWRlZCBtZXNzYWdlIHRvIHRoZSBwcm92aWRlZCBsb2dnZXIuIElmIG5vIGxvZ2dlciB3YXMgcHJvdmlkZWQgb3IgaWYKICAgICAgICAgKiB0aGUgbG9nIGxldmVsIGRvZXMgbm90IG1lYXQgdGhlIGxvZ2dlcidzIHRocmVzaG9sZCwgdGhlbiBub3RoaW5nIHdpbGwgYmUgbG9nZ2VkLgogICAgICAgICAqIEBwYXJhbSBsb2dMZXZlbCBUaGUgbG9nIGxldmVsIG9mIHRoaXMgbG9nLgogICAgICAgICAqIEBwYXJhbSBtZXNzYWdlIFRoZSBtZXNzYWdlIG9mIHRoaXMgbG9nLgogICAgICAgICAqLwogICAgICAgIEJhc2VSZXF1ZXN0UG9saWN5LnByb3RvdHlwZS5sb2cgPSBmdW5jdGlvbiAobG9nTGV2ZWwsIG1lc3NhZ2UpIHsKICAgICAgICAgICAgdGhpcy5fb3B0aW9ucy5sb2cobG9nTGV2ZWwsIG1lc3NhZ2UpOwogICAgICAgIH07CiAgICAgICAgcmV0dXJuIEJhc2VSZXF1ZXN0UG9saWN5OwogICAgfSgpKTsKICAgIC8qKgogICAgICogT3B0aW9uYWwgcHJvcGVydGllcyB0aGF0IGNhbiBiZSB1c2VkIHdoZW4gY3JlYXRpbmcgYSBSZXF1ZXN0UG9saWN5LgogICAgICovCiAgICB2YXIgUmVxdWVzdFBvbGljeU9wdGlvbnMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CiAgICAgICAgZnVuY3Rpb24gUmVxdWVzdFBvbGljeU9wdGlvbnMoX2xvZ2dlcikgewogICAgICAgICAgICB0aGlzLl9sb2dnZXIgPSBfbG9nZ2VyOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBHZXQgd2hldGhlciBvciBub3QgYSBsb2cgd2l0aCB0aGUgcHJvdmlkZWQgbG9nIGxldmVsIHNob3VsZCBiZSBsb2dnZWQuCiAgICAgICAgICogQHBhcmFtIGxvZ0xldmVsIFRoZSBsb2cgbGV2ZWwgb2YgdGhlIGxvZyB0aGF0IHdpbGwgYmUgbG9nZ2VkLgogICAgICAgICAqIEByZXR1cm5zIFdoZXRoZXIgb3Igbm90IGEgbG9nIHdpdGggdGhlIHByb3ZpZGVkIGxvZyBsZXZlbCBzaG91bGQgYmUgbG9nZ2VkLgogICAgICAgICAqLwogICAgICAgIFJlcXVlc3RQb2xpY3lPcHRpb25zLnByb3RvdHlwZS5zaG91bGRMb2cgPSBmdW5jdGlvbiAobG9nTGV2ZWwpIHsKICAgICAgICAgICAgcmV0dXJuICEhdGhpcy5fbG9nZ2VyICYmCiAgICAgICAgICAgICAgICBsb2dMZXZlbCAhPT0gZXhwb3J0cy5IdHRwUGlwZWxpbmVMb2dMZXZlbC5PRkYgJiYKICAgICAgICAgICAgICAgIGxvZ0xldmVsIDw9IHRoaXMuX2xvZ2dlci5taW5pbXVtTG9nTGV2ZWw7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBBdHRlbXB0IHRvIGxvZyB0aGUgcHJvdmlkZWQgbWVzc2FnZSB0byB0aGUgcHJvdmlkZWQgbG9nZ2VyLiBJZiBubyBsb2dnZXIgd2FzIHByb3ZpZGVkIG9yIGlmCiAgICAgICAgICogdGhlIGxvZyBsZXZlbCBkb2VzIG5vdCBtZWF0IHRoZSBsb2dnZXIncyB0aHJlc2hvbGQsIHRoZW4gbm90aGluZyB3aWxsIGJlIGxvZ2dlZC4KICAgICAgICAgKiBAcGFyYW0gbG9nTGV2ZWwgVGhlIGxvZyBsZXZlbCBvZiB0aGlzIGxvZy4KICAgICAgICAgKiBAcGFyYW0gbWVzc2FnZSBUaGUgbWVzc2FnZSBvZiB0aGlzIGxvZy4KICAgICAgICAgKi8KICAgICAgICBSZXF1ZXN0UG9saWN5T3B0aW9ucy5wcm90b3R5cGUubG9nID0gZnVuY3Rpb24gKGxvZ0xldmVsLCBtZXNzYWdlKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9sb2dnZXIgJiYgdGhpcy5zaG91bGRMb2cobG9nTGV2ZWwpKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9sb2dnZXIubG9nKGxvZ0xldmVsLCBtZXNzYWdlKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgcmV0dXJuIFJlcXVlc3RQb2xpY3lPcHRpb25zOwogICAgfSgpKTsKCiAgICAvLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IHNlcmlhbGl6YXRpb24gUmVxdWVzdFBvbGljeUNyZWF0b3IgdGhhdCB3aWxsIHNlcmlhbGl6ZWQgSFRUUCByZXF1ZXN0IGJvZGllcyBhcyB0aGV5CiAgICAgKiBwYXNzIHRocm91Z2ggdGhlIEhUVFAgcGlwZWxpbmUuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGRlc2VyaWFsaXphdGlvblBvbGljeShkZXNlcmlhbGl6YXRpb25Db250ZW50VHlwZXMpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBjcmVhdGU6IGZ1bmN0aW9uIChuZXh0UG9saWN5LCBvcHRpb25zKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IERlc2VyaWFsaXphdGlvblBvbGljeShuZXh0UG9saWN5LCBkZXNlcmlhbGl6YXRpb25Db250ZW50VHlwZXMsIG9wdGlvbnMpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgIH0KICAgIHZhciBkZWZhdWx0SnNvbkNvbnRlbnRUeXBlcyA9IFsiYXBwbGljYXRpb24vanNvbiIsICJ0ZXh0L2pzb24iXTsKICAgIHZhciBkZWZhdWx0WG1sQ29udGVudFR5cGVzID0gWyJhcHBsaWNhdGlvbi94bWwiLCAiYXBwbGljYXRpb24vYXRvbSt4bWwiXTsKICAgIC8qKgogICAgICogQSBSZXF1ZXN0UG9saWN5IHRoYXQgd2lsbCBkZXNlcmlhbGl6ZSBIVFRQIHJlc3BvbnNlIGJvZGllcyBhbmQgaGVhZGVycyBhcyB0aGV5IHBhc3MgdGhyb3VnaCB0aGUKICAgICAqIEhUVFAgcGlwZWxpbmUuCiAgICAgKi8KICAgIHZhciBEZXNlcmlhbGl6YXRpb25Qb2xpY3kgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CiAgICAgICAgX19leHRlbmRzKERlc2VyaWFsaXphdGlvblBvbGljeSwgX3N1cGVyKTsKICAgICAgICBmdW5jdGlvbiBEZXNlcmlhbGl6YXRpb25Qb2xpY3kobmV4dFBvbGljeSwgZGVzZXJpYWxpemF0aW9uQ29udGVudFR5cGVzLCBvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIG5leHRQb2xpY3ksIG9wdGlvbnMpIHx8IHRoaXM7CiAgICAgICAgICAgIF90aGlzLmpzb25Db250ZW50VHlwZXMgPSBkZXNlcmlhbGl6YXRpb25Db250ZW50VHlwZXMgJiYgZGVzZXJpYWxpemF0aW9uQ29udGVudFR5cGVzLmpzb24gfHwgZGVmYXVsdEpzb25Db250ZW50VHlwZXM7CiAgICAgICAgICAgIF90aGlzLnhtbENvbnRlbnRUeXBlcyA9IGRlc2VyaWFsaXphdGlvbkNvbnRlbnRUeXBlcyAmJiBkZXNlcmlhbGl6YXRpb25Db250ZW50VHlwZXMueG1sIHx8IGRlZmF1bHRYbWxDb250ZW50VHlwZXM7CiAgICAgICAgICAgIHJldHVybiBfdGhpczsKICAgICAgICB9CiAgICAgICAgRGVzZXJpYWxpemF0aW9uUG9saWN5LnByb3RvdHlwZS5zZW5kUmVxdWVzdCA9IGZ1bmN0aW9uIChyZXF1ZXN0KSB7CiAgICAgICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHRoaXMuX25leHRQb2xpY3kuc2VuZFJlcXVlc3QocmVxdWVzdCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsgcmV0dXJuIGRlc2VyaWFsaXplUmVzcG9uc2VCb2R5KF90aGlzLmpzb25Db250ZW50VHlwZXMsIF90aGlzLnhtbENvbnRlbnRUeXBlcywgcmVzcG9uc2UpOyB9KV07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gRGVzZXJpYWxpemF0aW9uUG9saWN5OwogICAgfShCYXNlUmVxdWVzdFBvbGljeSkpOwogICAgZnVuY3Rpb24gZ2V0T3BlcmF0aW9uUmVzcG9uc2UocGFyc2VkUmVzcG9uc2UpIHsKICAgICAgICB2YXIgcmVzdWx0OwogICAgICAgIHZhciByZXF1ZXN0ID0gcGFyc2VkUmVzcG9uc2UucmVxdWVzdDsKICAgICAgICB2YXIgb3BlcmF0aW9uU3BlYyA9IHJlcXVlc3Qub3BlcmF0aW9uU3BlYzsKICAgICAgICBpZiAob3BlcmF0aW9uU3BlYykgewogICAgICAgICAgICB2YXIgb3BlcmF0aW9uUmVzcG9uc2VHZXR0ZXIgPSByZXF1ZXN0Lm9wZXJhdGlvblJlc3BvbnNlR2V0dGVyOwogICAgICAgICAgICBpZiAoIW9wZXJhdGlvblJlc3BvbnNlR2V0dGVyKSB7CiAgICAgICAgICAgICAgICByZXN1bHQgPSBvcGVyYXRpb25TcGVjLnJlc3BvbnNlc1twYXJzZWRSZXNwb25zZS5zdGF0dXNdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgcmVzdWx0ID0gb3BlcmF0aW9uUmVzcG9uc2VHZXR0ZXIob3BlcmF0aW9uU3BlYywgcGFyc2VkUmVzcG9uc2UpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICBmdW5jdGlvbiBzaG91bGREZXNlcmlhbGl6ZVJlc3BvbnNlKHBhcnNlZFJlc3BvbnNlKSB7CiAgICAgICAgdmFyIHNob3VsZERlc2VyaWFsaXplID0gcGFyc2VkUmVzcG9uc2UucmVxdWVzdC5zaG91bGREZXNlcmlhbGl6ZTsKICAgICAgICB2YXIgcmVzdWx0OwogICAgICAgIGlmIChzaG91bGREZXNlcmlhbGl6ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHJlc3VsdCA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKHR5cGVvZiBzaG91bGREZXNlcmlhbGl6ZSA9PT0gImJvb2xlYW4iKSB7CiAgICAgICAgICAgIHJlc3VsdCA9IHNob3VsZERlc2VyaWFsaXplOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgcmVzdWx0ID0gc2hvdWxkRGVzZXJpYWxpemUocGFyc2VkUmVzcG9uc2UpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgZnVuY3Rpb24gZGVzZXJpYWxpemVSZXNwb25zZUJvZHkoanNvbkNvbnRlbnRUeXBlcywgeG1sQ29udGVudFR5cGVzLCByZXNwb25zZSkgewogICAgICAgIHJldHVybiBwYXJzZShqc29uQ29udGVudFR5cGVzLCB4bWxDb250ZW50VHlwZXMsIHJlc3BvbnNlKS50aGVuKGZ1bmN0aW9uIChwYXJzZWRSZXNwb25zZSkgewogICAgICAgICAgICB2YXIgc2hvdWxkRGVzZXJpYWxpemUgPSBzaG91bGREZXNlcmlhbGl6ZVJlc3BvbnNlKHBhcnNlZFJlc3BvbnNlKTsKICAgICAgICAgICAgaWYgKHNob3VsZERlc2VyaWFsaXplKSB7CiAgICAgICAgICAgICAgICB2YXIgb3BlcmF0aW9uU3BlYyA9IHBhcnNlZFJlc3BvbnNlLnJlcXVlc3Qub3BlcmF0aW9uU3BlYzsKICAgICAgICAgICAgICAgIGlmIChvcGVyYXRpb25TcGVjICYmIG9wZXJhdGlvblNwZWMucmVzcG9uc2VzKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHN0YXR1c0NvZGUgPSBwYXJzZWRSZXNwb25zZS5zdGF0dXM7CiAgICAgICAgICAgICAgICAgICAgdmFyIGV4cGVjdGVkU3RhdHVzQ29kZXMgPSBPYmplY3Qua2V5cyhvcGVyYXRpb25TcGVjLnJlc3BvbnNlcyk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGhhc05vRXhwZWN0ZWRTdGF0dXNDb2RlcyA9IChleHBlY3RlZFN0YXR1c0NvZGVzLmxlbmd0aCA9PT0gMCB8fCAoZXhwZWN0ZWRTdGF0dXNDb2Rlcy5sZW5ndGggPT09IDEgJiYgZXhwZWN0ZWRTdGF0dXNDb2Rlc1swXSA9PT0gImRlZmF1bHQiKSk7CiAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlU3BlYyA9IGdldE9wZXJhdGlvblJlc3BvbnNlKHBhcnNlZFJlc3BvbnNlKTsKICAgICAgICAgICAgICAgICAgICB2YXIgaXNFeHBlY3RlZFN0YXR1c0NvZGUgPSBoYXNOb0V4cGVjdGVkU3RhdHVzQ29kZXMgPyAoMjAwIDw9IHN0YXR1c0NvZGUgJiYgc3RhdHVzQ29kZSA8IDMwMCkgOiAhIXJlc3BvbnNlU3BlYzsKICAgICAgICAgICAgICAgICAgICBpZiAoIWlzRXhwZWN0ZWRTdGF0dXNDb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkZWZhdWx0UmVzcG9uc2VTcGVjID0gb3BlcmF0aW9uU3BlYy5yZXNwb25zZXMuZGVmYXVsdDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRlZmF1bHRSZXNwb25zZVNwZWMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbml0aWFsRXJyb3JNZXNzYWdlID0gaXNTdHJlYW1PcGVyYXRpb24ob3BlcmF0aW9uU3BlYykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/ICJVbmV4cGVjdGVkIHN0YXR1cyBjb2RlOiAiICsgc3RhdHVzQ29kZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogcGFyc2VkUmVzcG9uc2UuYm9keUFzVGV4dDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlcnJvciA9IG5ldyBSZXN0RXJyb3IoaW5pdGlhbEVycm9yTWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvci5zdGF0dXNDb2RlID0gc3RhdHVzQ29kZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yLnJlcXVlc3QgPSBzdHJpcFJlcXVlc3QocGFyc2VkUmVzcG9uc2UucmVxdWVzdCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvci5yZXNwb25zZSA9IHN0cmlwUmVzcG9uc2UocGFyc2VkUmVzcG9uc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhcnNlZEVycm9yUmVzcG9uc2UgPSBwYXJzZWRSZXNwb25zZS5wYXJzZWRCb2R5OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VkRXJyb3JSZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGVmYXVsdFJlc3BvbnNlQm9keU1hcHBlciA9IGRlZmF1bHRSZXNwb25zZVNwZWMuYm9keU1hcHBlcjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRlZmF1bHRSZXNwb25zZUJvZHlNYXBwZXIgJiYgZGVmYXVsdFJlc3BvbnNlQm9keU1hcHBlci5zZXJpYWxpemVkTmFtZSA9PT0gIkNsb3VkRXJyb3IiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VkRXJyb3JSZXNwb25zZS5lcnJvcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlZEVycm9yUmVzcG9uc2UgPSBwYXJzZWRFcnJvclJlc3BvbnNlLmVycm9yOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlZEVycm9yUmVzcG9uc2UuY29kZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yLmNvZGUgPSBwYXJzZWRFcnJvclJlc3BvbnNlLmNvZGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VkRXJyb3JSZXNwb25zZS5tZXNzYWdlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IubWVzc2FnZSA9IHBhcnNlZEVycm9yUmVzcG9uc2UubWVzc2FnZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbnRlcm5hbEVycm9yID0gcGFyc2VkRXJyb3JSZXNwb25zZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZWRFcnJvclJlc3BvbnNlLmVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJuYWxFcnJvciA9IHBhcnNlZEVycm9yUmVzcG9uc2UuZXJyb3I7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvci5jb2RlID0gaW50ZXJuYWxFcnJvci5jb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGludGVybmFsRXJyb3IubWVzc2FnZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yLm1lc3NhZ2UgPSBpbnRlcm5hbEVycm9yLm1lc3NhZ2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRlZmF1bHRSZXNwb25zZUJvZHlNYXBwZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZVRvRGVzZXJpYWxpemUgPSBwYXJzZWRFcnJvclJlc3BvbnNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wZXJhdGlvblNwZWMuaXNYTUwgJiYgZGVmYXVsdFJlc3BvbnNlQm9keU1hcHBlci50eXBlLm5hbWUgPT09IE1hcHBlclR5cGUuU2VxdWVuY2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZVRvRGVzZXJpYWxpemUgPSB0eXBlb2YgcGFyc2VkRXJyb3JSZXNwb25zZSA9PT0gIm9iamVjdCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBwYXJzZWRFcnJvclJlc3BvbnNlW2RlZmF1bHRSZXNwb25zZUJvZHlNYXBwZXIueG1sRWxlbWVudE5hbWVdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogW107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvci5ib2R5ID0gb3BlcmF0aW9uU3BlYy5zZXJpYWxpemVyLmRlc2VyaWFsaXplKGRlZmF1bHRSZXNwb25zZUJvZHlNYXBwZXIsIHZhbHVlVG9EZXNlcmlhbGl6ZSwgImVycm9yLmJvZHkiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIChkZWZhdWx0RXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvci5tZXNzYWdlID0gIkVycm9yIFwiIiArIGRlZmF1bHRFcnJvci5tZXNzYWdlICsgIlwiIG9jY3VycmVkIGluIGRlc2VyaWFsaXppbmcgdGhlIHJlc3BvbnNlQm9keSAtIFwiIiArIHBhcnNlZFJlc3BvbnNlLmJvZHlBc1RleHQgKyAiXCIgZm9yIHRoZSBkZWZhdWx0IHJlc3BvbnNlLiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlc3BvbnNlU3BlYykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2VTcGVjLmJvZHlNYXBwZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZVRvRGVzZXJpYWxpemUgPSBwYXJzZWRSZXNwb25zZS5wYXJzZWRCb2R5OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wZXJhdGlvblNwZWMuaXNYTUwgJiYgcmVzcG9uc2VTcGVjLmJvZHlNYXBwZXIudHlwZS5uYW1lID09PSBNYXBwZXJUeXBlLlNlcXVlbmNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVUb0Rlc2VyaWFsaXplID0gdHlwZW9mIHZhbHVlVG9EZXNlcmlhbGl6ZSA9PT0gIm9iamVjdCIgPyB2YWx1ZVRvRGVzZXJpYWxpemVbcmVzcG9uc2VTcGVjLmJvZHlNYXBwZXIueG1sRWxlbWVudE5hbWVdIDogW107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlZFJlc3BvbnNlLnBhcnNlZEJvZHkgPSBvcGVyYXRpb25TcGVjLnNlcmlhbGl6ZXIuZGVzZXJpYWxpemUocmVzcG9uc2VTcGVjLmJvZHlNYXBwZXIsIHZhbHVlVG9EZXNlcmlhbGl6ZSwgIm9wZXJhdGlvblJlcy5wYXJzZWRCb2R5Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdEVycm9yID0gbmV3IFJlc3RFcnJvcigiRXJyb3IgIiArIGVycm9yICsgIiBvY2N1cnJlZCBpbiBkZXNlcmlhbGl6aW5nIHRoZSByZXNwb25zZUJvZHkgLSAiICsgcGFyc2VkUmVzcG9uc2UuYm9keUFzVGV4dCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdEVycm9yLnJlcXVlc3QgPSBzdHJpcFJlcXVlc3QocGFyc2VkUmVzcG9uc2UucmVxdWVzdCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdEVycm9yLnJlc3BvbnNlID0gc3RyaXBSZXNwb25zZShwYXJzZWRSZXNwb25zZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KHJlc3RFcnJvcik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAob3BlcmF0aW9uU3BlYy5odHRwTWV0aG9kID09PSAiSEVBRCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGhlYWQgbWV0aG9kcyBuZXZlciBoYXZlIGEgYm9keSwgYnV0IHdlIHJldHVybiBhIGJvb2xlYW4gdG8gaW5kaWNhdGUgcHJlc2VuY2UvYWJzZW5jZSBvZiB0aGUgcmVzb3VyY2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlZFJlc3BvbnNlLnBhcnNlZEJvZHkgPSByZXNwb25zZS5zdGF0dXMgPj0gMjAwICYmIHJlc3BvbnNlLnN0YXR1cyA8IDMwMDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2VTcGVjLmhlYWRlcnNNYXBwZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlZFJlc3BvbnNlLnBhcnNlZEhlYWRlcnMgPSBvcGVyYXRpb25TcGVjLnNlcmlhbGl6ZXIuZGVzZXJpYWxpemUocmVzcG9uc2VTcGVjLmhlYWRlcnNNYXBwZXIsIHBhcnNlZFJlc3BvbnNlLmhlYWRlcnMucmF3SGVhZGVycygpLCAib3BlcmF0aW9uUmVzLnBhcnNlZEhlYWRlcnMiKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHBhcnNlZFJlc3BvbnNlKTsKICAgICAgICB9KTsKICAgIH0KICAgIGZ1bmN0aW9uIHBhcnNlKGpzb25Db250ZW50VHlwZXMsIHhtbENvbnRlbnRUeXBlcywgb3BlcmF0aW9uUmVzcG9uc2UpIHsKICAgICAgICB2YXIgZXJyb3JIYW5kbGVyID0gZnVuY3Rpb24gKGVycikgewogICAgICAgICAgICB2YXIgbXNnID0gIkVycm9yIFwiIiArIGVyciArICJcIiBvY2N1cnJlZCB3aGlsZSBwYXJzaW5nIHRoZSByZXNwb25zZSBib2R5IC0gIiArIG9wZXJhdGlvblJlc3BvbnNlLmJvZHlBc1RleHQgKyAiLiI7CiAgICAgICAgICAgIHZhciBlcnJDb2RlID0gZXJyLmNvZGUgfHwgUmVzdEVycm9yLlBBUlNFX0VSUk9SOwogICAgICAgICAgICB2YXIgZSA9IG5ldyBSZXN0RXJyb3IobXNnLCBlcnJDb2RlLCBvcGVyYXRpb25SZXNwb25zZS5zdGF0dXMsIG9wZXJhdGlvblJlc3BvbnNlLnJlcXVlc3QsIG9wZXJhdGlvblJlc3BvbnNlLCBvcGVyYXRpb25SZXNwb25zZS5ib2R5QXNUZXh0KTsKICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGUpOwogICAgICAgIH07CiAgICAgICAgaWYgKCFvcGVyYXRpb25SZXNwb25zZS5yZXF1ZXN0LnN0cmVhbVJlc3BvbnNlQm9keSAmJiBvcGVyYXRpb25SZXNwb25zZS5ib2R5QXNUZXh0KSB7CiAgICAgICAgICAgIHZhciB0ZXh0XzEgPSBvcGVyYXRpb25SZXNwb25zZS5ib2R5QXNUZXh0OwogICAgICAgICAgICB2YXIgY29udGVudFR5cGUgPSBvcGVyYXRpb25SZXNwb25zZS5oZWFkZXJzLmdldCgiQ29udGVudC1UeXBlIikgfHwgIiI7CiAgICAgICAgICAgIHZhciBjb250ZW50Q29tcG9uZW50cyA9ICFjb250ZW50VHlwZSA/IFtdIDogY29udGVudFR5cGUuc3BsaXQoIjsiKS5tYXAoZnVuY3Rpb24gKGNvbXBvbmVudCkgeyByZXR1cm4gY29tcG9uZW50LnRvTG93ZXJDYXNlKCk7IH0pOwogICAgICAgICAgICBpZiAoY29udGVudENvbXBvbmVudHMubGVuZ3RoID09PSAwIHx8IGNvbnRlbnRDb21wb25lbnRzLnNvbWUoZnVuY3Rpb24gKGNvbXBvbmVudCkgeyByZXR1cm4ganNvbkNvbnRlbnRUeXBlcy5pbmRleE9mKGNvbXBvbmVudCkgIT09IC0xOyB9KSkgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgICAgICAgICAgICAgb3BlcmF0aW9uUmVzcG9uc2UucGFyc2VkQm9keSA9IEpTT04ucGFyc2UodGV4dF8xKTsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG9wZXJhdGlvblJlc3BvbnNlKTsKICAgICAgICAgICAgICAgIH0pLmNhdGNoKGVycm9ySGFuZGxlcik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAoY29udGVudENvbXBvbmVudHMuc29tZShmdW5jdGlvbiAoY29tcG9uZW50KSB7IHJldHVybiB4bWxDb250ZW50VHlwZXMuaW5kZXhPZihjb21wb25lbnQpICE9PSAtMTsgfSkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZVhNTCh0ZXh0XzEpCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGJvZHkpIHsKICAgICAgICAgICAgICAgICAgICBvcGVyYXRpb25SZXNwb25zZS5wYXJzZWRCb2R5ID0gYm9keTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3BlcmF0aW9uUmVzcG9uc2U7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvckhhbmRsZXIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUob3BlcmF0aW9uUmVzcG9uc2UpOwogICAgfQoKICAgIC8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogICAgZnVuY3Rpb24gZXhwb25lbnRpYWxSZXRyeVBvbGljeShyZXRyeUNvdW50LCByZXRyeUludGVydmFsLCBtaW5SZXRyeUludGVydmFsLCBtYXhSZXRyeUludGVydmFsKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgY3JlYXRlOiBmdW5jdGlvbiAobmV4dFBvbGljeSwgb3B0aW9ucykgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBFeHBvbmVudGlhbFJldHJ5UG9saWN5KG5leHRQb2xpY3ksIG9wdGlvbnMsIHJldHJ5Q291bnQsIHJldHJ5SW50ZXJ2YWwsIG1pblJldHJ5SW50ZXJ2YWwsIG1heFJldHJ5SW50ZXJ2YWwpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgIH0KICAgIHZhciBERUZBVUxUX0NMSUVOVF9SRVRSWV9JTlRFUlZBTCA9IDEwMDAgKiAzMDsKICAgIHZhciBERUZBVUxUX0NMSUVOVF9SRVRSWV9DT1VOVCA9IDM7CiAgICB2YXIgREVGQVVMVF9DTElFTlRfTUFYX1JFVFJZX0lOVEVSVkFMID0gMTAwMCAqIDkwOwogICAgdmFyIERFRkFVTFRfQ0xJRU5UX01JTl9SRVRSWV9JTlRFUlZBTCA9IDEwMDAgKiAzOwogICAgLyoqCiAgICAgKiBAY2xhc3MKICAgICAqIEluc3RhbnRpYXRlcyBhIG5ldyAiRXhwb25lbnRpYWxSZXRyeVBvbGljeUZpbHRlciIgaW5zdGFuY2UuCiAgICAgKi8KICAgIHZhciBFeHBvbmVudGlhbFJldHJ5UG9saWN5ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewogICAgICAgIF9fZXh0ZW5kcyhFeHBvbmVudGlhbFJldHJ5UG9saWN5LCBfc3VwZXIpOwogICAgICAgIC8qKgogICAgICAgICAqIEBjb25zdHJ1Y3RvcgogICAgICAgICAqIEBwYXJhbSB7UmVxdWVzdFBvbGljeX0gbmV4dFBvbGljeSBUaGUgbmV4dCBSZXF1ZXN0UG9saWN5IGluIHRoZSBwaXBlbGluZSBjaGFpbi4KICAgICAgICAgKiBAcGFyYW0ge1JlcXVlc3RQb2xpY3lPcHRpb25zfSBvcHRpb25zIFRoZSBvcHRpb25zIGZvciB0aGlzIFJlcXVlc3RQb2xpY3kuCiAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IFtyZXRyeUNvdW50XSAgICAgICAgVGhlIGNsaWVudCByZXRyeSBjb3VudC4KICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gW3JldHJ5SW50ZXJ2YWxdICAgICBUaGUgY2xpZW50IHJldHJ5IGludGVydmFsLCBpbiBtaWxsaXNlY29uZHMuCiAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IFttaW5SZXRyeUludGVydmFsXSAgVGhlIG1pbmltdW0gcmV0cnkgaW50ZXJ2YWwsIGluIG1pbGxpc2Vjb25kcy4KICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gW21heFJldHJ5SW50ZXJ2YWxdICBUaGUgbWF4aW11bSByZXRyeSBpbnRlcnZhbCwgaW4gbWlsbGlzZWNvbmRzLgogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIEV4cG9uZW50aWFsUmV0cnlQb2xpY3kobmV4dFBvbGljeSwgb3B0aW9ucywgcmV0cnlDb3VudCwgcmV0cnlJbnRlcnZhbCwgbWluUmV0cnlJbnRlcnZhbCwgbWF4UmV0cnlJbnRlcnZhbCkgewogICAgICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBuZXh0UG9saWN5LCBvcHRpb25zKSB8fCB0aGlzOwogICAgICAgICAgICBmdW5jdGlvbiBpc051bWJlcihuKSB7IHJldHVybiB0eXBlb2YgbiA9PT0gIm51bWJlciI7IH0KICAgICAgICAgICAgX3RoaXMucmV0cnlDb3VudCA9IGlzTnVtYmVyKHJldHJ5Q291bnQpID8gcmV0cnlDb3VudCA6IERFRkFVTFRfQ0xJRU5UX1JFVFJZX0NPVU5UOwogICAgICAgICAgICBfdGhpcy5yZXRyeUludGVydmFsID0gaXNOdW1iZXIocmV0cnlJbnRlcnZhbCkgPyByZXRyeUludGVydmFsIDogREVGQVVMVF9DTElFTlRfUkVUUllfSU5URVJWQUw7CiAgICAgICAgICAgIF90aGlzLm1pblJldHJ5SW50ZXJ2YWwgPSBpc051bWJlcihtaW5SZXRyeUludGVydmFsKSA/IG1pblJldHJ5SW50ZXJ2YWwgOiBERUZBVUxUX0NMSUVOVF9NSU5fUkVUUllfSU5URVJWQUw7CiAgICAgICAgICAgIF90aGlzLm1heFJldHJ5SW50ZXJ2YWwgPSBpc051bWJlcihtYXhSZXRyeUludGVydmFsKSA/IG1heFJldHJ5SW50ZXJ2YWwgOiBERUZBVUxUX0NMSUVOVF9NQVhfUkVUUllfSU5URVJWQUw7CiAgICAgICAgICAgIHJldHVybiBfdGhpczsKICAgICAgICB9CiAgICAgICAgRXhwb25lbnRpYWxSZXRyeVBvbGljeS5wcm90b3R5cGUuc2VuZFJlcXVlc3QgPSBmdW5jdGlvbiAocmVxdWVzdCkgewogICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fbmV4dFBvbGljeS5zZW5kUmVxdWVzdChyZXF1ZXN0LmNsb25lKCkpCiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsgcmV0dXJuIHJldHJ5KF90aGlzLCByZXF1ZXN0LCByZXNwb25zZSk7IH0pCiAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7IHJldHVybiByZXRyeShfdGhpcywgcmVxdWVzdCwgZXJyb3IucmVzcG9uc2UsIHVuZGVmaW5lZCwgZXJyb3IpOyB9KTsKICAgICAgICB9OwogICAgICAgIHJldHVybiBFeHBvbmVudGlhbFJldHJ5UG9saWN5OwogICAgfShCYXNlUmVxdWVzdFBvbGljeSkpOwogICAgLyoqCiAgICAgKiBEZXRlcm1pbmVzIGlmIHRoZSBvcGVyYXRpb24gc2hvdWxkIGJlIHJldHJpZWQgYW5kIGhvdyBsb25nIHRvIHdhaXQgdW50aWwgdGhlIG5leHQgcmV0cnkuCiAgICAgKgogICAgICogQHBhcmFtIHtFeHBvbmVudGlhbFJldHJ5UG9saWN5fSBwb2xpY3kgVGhlIEV4cG9uZW50aWFsUmV0cnlQb2xpY3kgdGhhdCB0aGlzIGZ1bmN0aW9uIGlzIGJlaW5nIGNhbGxlZCBhZ2FpbnN0LgogICAgICogQHBhcmFtIHtudW1iZXJ9IHN0YXR1c0NvZGUgVGhlIEhUVFAgc3RhdHVzIGNvZGUuCiAgICAgKiBAcGFyYW0ge1JldHJ5RGF0YX0gcmV0cnlEYXRhICBUaGUgcmV0cnkgZGF0YS4KICAgICAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgaWYgdGhlIG9wZXJhdGlvbiBxdWFsaWZpZXMgZm9yIGEgcmV0cnk7IGZhbHNlIG90aGVyd2lzZS4KICAgICAqLwogICAgZnVuY3Rpb24gc2hvdWxkUmV0cnkocG9saWN5LCBzdGF0dXNDb2RlLCByZXRyeURhdGEpIHsKICAgICAgICBpZiAoc3RhdHVzQ29kZSA9PSB1bmRlZmluZWQgfHwgKHN0YXR1c0NvZGUgPCA1MDAgJiYgc3RhdHVzQ29kZSAhPT0gNDA4KSB8fCBzdGF0dXNDb2RlID09PSA1MDEgfHwgc3RhdHVzQ29kZSA9PT0gNTA1KSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgdmFyIGN1cnJlbnRDb3VudDsKICAgICAgICBpZiAoIXJldHJ5RGF0YSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoInJldHJ5RGF0YSBmb3IgdGhlIEV4cG9uZW50aWFsUmV0cnlQb2xpY3lGaWx0ZXIgY2Fubm90IGJlIG51bGwuIik7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBjdXJyZW50Q291bnQgPSAocmV0cnlEYXRhICYmIHJldHJ5RGF0YS5yZXRyeUNvdW50KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIChjdXJyZW50Q291bnQgPCBwb2xpY3kucmV0cnlDb3VudCk7CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZXMgdGhlIHJldHJ5IGRhdGEgZm9yIHRoZSBuZXh0IGF0dGVtcHQuCiAgICAgKgogICAgICogQHBhcmFtIHtFeHBvbmVudGlhbFJldHJ5UG9saWN5fSBwb2xpY3kgVGhlIEV4cG9uZW50aWFsUmV0cnlQb2xpY3kgdGhhdCB0aGlzIGZ1bmN0aW9uIGlzIGJlaW5nIGNhbGxlZCBhZ2FpbnN0LgogICAgICogQHBhcmFtIHtSZXRyeURhdGF9IHJldHJ5RGF0YSAgVGhlIHJldHJ5IGRhdGEuCiAgICAgKiBAcGFyYW0ge1JldHJ5RXJyb3J9IFtlcnJdIFRoZSBvcGVyYXRpb24icyBlcnJvciwgaWYgYW55LgogICAgICovCiAgICBmdW5jdGlvbiB1cGRhdGVSZXRyeURhdGEocG9saWN5LCByZXRyeURhdGEsIGVycikgewogICAgICAgIGlmICghcmV0cnlEYXRhKSB7CiAgICAgICAgICAgIHJldHJ5RGF0YSA9IHsKICAgICAgICAgICAgICAgIHJldHJ5Q291bnQ6IDAsCiAgICAgICAgICAgICAgICByZXRyeUludGVydmFsOiAwCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgICAgaWYgKHJldHJ5RGF0YS5lcnJvcikgewogICAgICAgICAgICAgICAgZXJyLmlubmVyRXJyb3IgPSByZXRyeURhdGEuZXJyb3I7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0cnlEYXRhLmVycm9yID0gZXJyOwogICAgICAgIH0KICAgICAgICAvLyBBZGp1c3QgcmV0cnkgY291bnQKICAgICAgICByZXRyeURhdGEucmV0cnlDb3VudCsrOwogICAgICAgIC8vIEFkanVzdCByZXRyeSBpbnRlcnZhbAogICAgICAgIHZhciBpbmNyZW1lbnREZWx0YSA9IE1hdGgucG93KDIsIHJldHJ5RGF0YS5yZXRyeUNvdW50KSAtIDE7CiAgICAgICAgdmFyIGJvdW5kZWRSYW5kRGVsdGEgPSBwb2xpY3kucmV0cnlJbnRlcnZhbCAqIDAuOCArCiAgICAgICAgICAgIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChwb2xpY3kucmV0cnlJbnRlcnZhbCAqIDEuMiAtIHBvbGljeS5yZXRyeUludGVydmFsICogMC44KSk7CiAgICAgICAgaW5jcmVtZW50RGVsdGEgKj0gYm91bmRlZFJhbmREZWx0YTsKICAgICAgICByZXRyeURhdGEucmV0cnlJbnRlcnZhbCA9IE1hdGgubWluKHBvbGljeS5taW5SZXRyeUludGVydmFsICsgaW5jcmVtZW50RGVsdGEsIHBvbGljeS5tYXhSZXRyeUludGVydmFsKTsKICAgICAgICByZXR1cm4gcmV0cnlEYXRhOwogICAgfQogICAgZnVuY3Rpb24gcmV0cnkocG9saWN5LCByZXF1ZXN0LCByZXNwb25zZSwgcmV0cnlEYXRhLCByZXF1ZXN0RXJyb3IpIHsKICAgICAgICByZXRyeURhdGEgPSB1cGRhdGVSZXRyeURhdGEocG9saWN5LCByZXRyeURhdGEsIHJlcXVlc3RFcnJvcik7CiAgICAgICAgdmFyIGlzQWJvcnRlZCA9IHJlcXVlc3QuYWJvcnRTaWduYWwgJiYgcmVxdWVzdC5hYm9ydFNpZ25hbC5hYm9ydGVkOwogICAgICAgIGlmICghaXNBYm9ydGVkICYmIHNob3VsZFJldHJ5KHBvbGljeSwgcmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3RhdHVzLCByZXRyeURhdGEpKSB7CiAgICAgICAgICAgIHJldHVybiBkZWxheShyZXRyeURhdGEucmV0cnlJbnRlcnZhbCkKICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHsgcmV0dXJuIHBvbGljeS5fbmV4dFBvbGljeS5zZW5kUmVxdWVzdChyZXF1ZXN0LmNsb25lKCkpOyB9KQogICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlcykgeyByZXR1cm4gcmV0cnkocG9saWN5LCByZXF1ZXN0LCByZXMsIHJldHJ5RGF0YSwgdW5kZWZpbmVkKTsgfSkKICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyKSB7IHJldHVybiByZXRyeShwb2xpY3ksIHJlcXVlc3QsIHJlc3BvbnNlLCByZXRyeURhdGEsIGVycik7IH0pOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChpc0Fib3J0ZWQgfHwgcmVxdWVzdEVycm9yIHx8ICFyZXNwb25zZSkgewogICAgICAgICAgICAvLyBJZiB0aGUgb3BlcmF0aW9uIGZhaWxlZCBpbiB0aGUgZW5kLCByZXR1cm4gYWxsIGVycm9ycyBpbnN0ZWFkIG9mIGp1c3QgdGhlIGxhc3Qgb25lCiAgICAgICAgICAgIHZhciBlcnIgPSByZXRyeURhdGEuZXJyb3IgfHwKICAgICAgICAgICAgICAgIG5ldyBSZXN0RXJyb3IoIkZhaWxlZCB0byBzZW5kIHRoZSByZXF1ZXN0LiIsIFJlc3RFcnJvci5SRVFVRVNUX1NFTkRfRVJST1IsIHJlc3BvbnNlICYmIHJlc3BvbnNlLnN0YXR1cywgcmVzcG9uc2UgJiYgcmVzcG9uc2UucmVxdWVzdCwgcmVzcG9uc2UpOwogICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUocmVzcG9uc2UpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICAgIGZ1bmN0aW9uIGdlbmVyYXRlQ2xpZW50UmVxdWVzdElkUG9saWN5KHJlcXVlc3RJZEhlYWRlck5hbWUpIHsKICAgICAgICBpZiAocmVxdWVzdElkSGVhZGVyTmFtZSA9PT0gdm9pZCAwKSB7IHJlcXVlc3RJZEhlYWRlck5hbWUgPSAieC1tcy1jbGllbnQtcmVxdWVzdC1pZCI7IH0KICAgICAgICByZXR1cm4gewogICAgICAgICAgICBjcmVhdGU6IGZ1bmN0aW9uIChuZXh0UG9saWN5LCBvcHRpb25zKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEdlbmVyYXRlQ2xpZW50UmVxdWVzdElkUG9saWN5KG5leHRQb2xpY3ksIG9wdGlvbnMsIHJlcXVlc3RJZEhlYWRlck5hbWUpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgIH0KICAgIHZhciBHZW5lcmF0ZUNsaWVudFJlcXVlc3RJZFBvbGljeSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKICAgICAgICBfX2V4dGVuZHMoR2VuZXJhdGVDbGllbnRSZXF1ZXN0SWRQb2xpY3ksIF9zdXBlcik7CiAgICAgICAgZnVuY3Rpb24gR2VuZXJhdGVDbGllbnRSZXF1ZXN0SWRQb2xpY3kobmV4dFBvbGljeSwgb3B0aW9ucywgX3JlcXVlc3RJZEhlYWRlck5hbWUpIHsKICAgICAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgbmV4dFBvbGljeSwgb3B0aW9ucykgfHwgdGhpczsKICAgICAgICAgICAgX3RoaXMuX3JlcXVlc3RJZEhlYWRlck5hbWUgPSBfcmVxdWVzdElkSGVhZGVyTmFtZTsKICAgICAgICAgICAgcmV0dXJuIF90aGlzOwogICAgICAgIH0KICAgICAgICBHZW5lcmF0ZUNsaWVudFJlcXVlc3RJZFBvbGljeS5wcm90b3R5cGUuc2VuZFJlcXVlc3QgPSBmdW5jdGlvbiAocmVxdWVzdCkgewogICAgICAgICAgICBpZiAoIXJlcXVlc3QuaGVhZGVycy5jb250YWlucyh0aGlzLl9yZXF1ZXN0SWRIZWFkZXJOYW1lKSkgewogICAgICAgICAgICAgICAgcmVxdWVzdC5oZWFkZXJzLnNldCh0aGlzLl9yZXF1ZXN0SWRIZWFkZXJOYW1lLCBnZW5lcmF0ZVV1aWQoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX25leHRQb2xpY3kuc2VuZFJlcXVlc3QocmVxdWVzdCk7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gR2VuZXJhdGVDbGllbnRSZXF1ZXN0SWRQb2xpY3k7CiAgICB9KEJhc2VSZXF1ZXN0UG9saWN5KSk7CgogICAgLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAgICAvLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLgogICAgZnVuY3Rpb24gZ2V0RGVmYXVsdFVzZXJBZ2VudEtleSgpIHsKICAgICAgICByZXR1cm4gIngtbXMtY29tbWFuZC1uYW1lIjsKICAgIH0KICAgIGZ1bmN0aW9uIGdldFBsYXRmb3JtU3BlY2lmaWNEYXRhKCkgewogICAgICAgIHZhciBuYXZpZ2F0b3IgPSB3aW5kb3cubmF2aWdhdG9yOwogICAgICAgIHZhciBvc0luZm8gPSB7CiAgICAgICAgICAgIGtleTogIk9TIiwKICAgICAgICAgICAgdmFsdWU6IChuYXZpZ2F0b3Iub3NjcHUgfHwgbmF2aWdhdG9yLnBsYXRmb3JtKS5yZXBsYWNlKCIgIiwgIiIpCiAgICAgICAgfTsKICAgICAgICByZXR1cm4gW29zSW5mb107CiAgICB9CgogICAgLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAgICBmdW5jdGlvbiBnZXRSdW50aW1lSW5mbygpIHsKICAgICAgICB2YXIgbXNSZXN0UnVudGltZSA9IHsKICAgICAgICAgICAga2V5OiAibXMtcmVzdC1qcyIsCiAgICAgICAgICAgIHZhbHVlOiBDb25zdGFudHMubXNSZXN0VmVyc2lvbgogICAgICAgIH07CiAgICAgICAgcmV0dXJuIFttc1Jlc3RSdW50aW1lXTsKICAgIH0KICAgIGZ1bmN0aW9uIGdldFVzZXJBZ2VudFN0cmluZyh0ZWxlbWV0cnlJbmZvLCBrZXlTZXBhcmF0b3IsIHZhbHVlU2VwYXJhdG9yKSB7CiAgICAgICAgaWYgKGtleVNlcGFyYXRvciA9PT0gdm9pZCAwKSB7IGtleVNlcGFyYXRvciA9ICIgIjsgfQogICAgICAgIGlmICh2YWx1ZVNlcGFyYXRvciA9PT0gdm9pZCAwKSB7IHZhbHVlU2VwYXJhdG9yID0gIi8iOyB9CiAgICAgICAgcmV0dXJuIHRlbGVtZXRyeUluZm8ubWFwKGZ1bmN0aW9uIChpbmZvKSB7CiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGluZm8udmFsdWUgPyAiIiArIHZhbHVlU2VwYXJhdG9yICsgaW5mby52YWx1ZSA6ICIiOwogICAgICAgICAgICByZXR1cm4gIiIgKyBpbmZvLmtleSArIHZhbHVlOwogICAgICAgIH0pLmpvaW4oa2V5U2VwYXJhdG9yKTsKICAgIH0KICAgIHZhciBnZXREZWZhdWx0VXNlckFnZW50SGVhZGVyTmFtZSA9IGdldERlZmF1bHRVc2VyQWdlbnRLZXk7CiAgICBmdW5jdGlvbiBnZXREZWZhdWx0VXNlckFnZW50VmFsdWUoKSB7CiAgICAgICAgdmFyIHJ1bnRpbWVJbmZvID0gZ2V0UnVudGltZUluZm8oKTsKICAgICAgICB2YXIgcGxhdGZvcm1TcGVjaWZpY0RhdGEgPSBnZXRQbGF0Zm9ybVNwZWNpZmljRGF0YSgpOwogICAgICAgIHZhciB1c2VyQWdlbnQgPSBnZXRVc2VyQWdlbnRTdHJpbmcocnVudGltZUluZm8uY29uY2F0KHBsYXRmb3JtU3BlY2lmaWNEYXRhKSk7CiAgICAgICAgcmV0dXJuIHVzZXJBZ2VudDsKICAgIH0KICAgIGZ1bmN0aW9uIHVzZXJBZ2VudFBvbGljeSh1c2VyQWdlbnREYXRhKSB7CiAgICAgICAgdmFyIGtleSA9ICghdXNlckFnZW50RGF0YSB8fCB1c2VyQWdlbnREYXRhLmtleSA9PSB1bmRlZmluZWQpID8gZ2V0RGVmYXVsdFVzZXJBZ2VudEtleSgpIDogdXNlckFnZW50RGF0YS5rZXk7CiAgICAgICAgdmFyIHZhbHVlID0gKCF1c2VyQWdlbnREYXRhIHx8IHVzZXJBZ2VudERhdGEudmFsdWUgPT0gdW5kZWZpbmVkKSA/IGdldERlZmF1bHRVc2VyQWdlbnRWYWx1ZSgpIDogdXNlckFnZW50RGF0YS52YWx1ZTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBjcmVhdGU6IGZ1bmN0aW9uIChuZXh0UG9saWN5LCBvcHRpb25zKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFVzZXJBZ2VudFBvbGljeShuZXh0UG9saWN5LCBvcHRpb25zLCBrZXksIHZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9CiAgICB2YXIgVXNlckFnZW50UG9saWN5ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewogICAgICAgIF9fZXh0ZW5kcyhVc2VyQWdlbnRQb2xpY3ksIF9zdXBlcik7CiAgICAgICAgZnVuY3Rpb24gVXNlckFnZW50UG9saWN5KF9uZXh0UG9saWN5LCBfb3B0aW9ucywgaGVhZGVyS2V5LCBoZWFkZXJWYWx1ZSkgewogICAgICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBfbmV4dFBvbGljeSwgX29wdGlvbnMpIHx8IHRoaXM7CiAgICAgICAgICAgIF90aGlzLl9uZXh0UG9saWN5ID0gX25leHRQb2xpY3k7CiAgICAgICAgICAgIF90aGlzLl9vcHRpb25zID0gX29wdGlvbnM7CiAgICAgICAgICAgIF90aGlzLmhlYWRlcktleSA9IGhlYWRlcktleTsKICAgICAgICAgICAgX3RoaXMuaGVhZGVyVmFsdWUgPSBoZWFkZXJWYWx1ZTsKICAgICAgICAgICAgcmV0dXJuIF90aGlzOwogICAgICAgIH0KICAgICAgICBVc2VyQWdlbnRQb2xpY3kucHJvdG90eXBlLnNlbmRSZXF1ZXN0ID0gZnVuY3Rpb24gKHJlcXVlc3QpIHsKICAgICAgICAgICAgdGhpcy5hZGRVc2VyQWdlbnRIZWFkZXIocmVxdWVzdCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9uZXh0UG9saWN5LnNlbmRSZXF1ZXN0KHJlcXVlc3QpOwogICAgICAgIH07CiAgICAgICAgVXNlckFnZW50UG9saWN5LnByb3RvdHlwZS5hZGRVc2VyQWdlbnRIZWFkZXIgPSBmdW5jdGlvbiAocmVxdWVzdCkgewogICAgICAgICAgICBpZiAoIXJlcXVlc3QuaGVhZGVycykgewogICAgICAgICAgICAgICAgcmVxdWVzdC5oZWFkZXJzID0gbmV3IEh0dHBIZWFkZXJzKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFyZXF1ZXN0LmhlYWRlcnMuZ2V0KHRoaXMuaGVhZGVyS2V5KSAmJiB0aGlzLmhlYWRlclZhbHVlKSB7CiAgICAgICAgICAgICAgICByZXF1ZXN0LmhlYWRlcnMuc2V0KHRoaXMuaGVhZGVyS2V5LCB0aGlzLmhlYWRlclZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgcmV0dXJuIFVzZXJBZ2VudFBvbGljeTsKICAgIH0oQmFzZVJlcXVlc3RQb2xpY3kpKTsKCiAgICAvLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICAgIC8qKgogICAgICogQSBjbGFzcyB0aGF0IGhhbmRsZXMgdGhlIHF1ZXJ5IHBvcnRpb24gb2YgYSBVUkxCdWlsZGVyLgogICAgICovCiAgICB2YXIgVVJMUXVlcnkgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CiAgICAgICAgZnVuY3Rpb24gVVJMUXVlcnkoKSB7CiAgICAgICAgICAgIHRoaXMuX3Jhd1F1ZXJ5ID0ge307CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEdldCB3aGV0aGVyIG9yIG5vdCB0aGVyZSBhbnkgcXVlcnkgcGFyYW1ldGVycyBpbiB0aGlzIFVSTFF1ZXJ5LgogICAgICAgICAqLwogICAgICAgIFVSTFF1ZXJ5LnByb3RvdHlwZS5hbnkgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBPYmplY3Qua2V5cyh0aGlzLl9yYXdRdWVyeSkubGVuZ3RoID4gMDsKICAgICAgICB9OwogICAgICAgIC8qKgogICAgICAgICAqIFNldCBhIHF1ZXJ5IHBhcmFtZXRlciB3aXRoIHRoZSBwcm92aWRlZCBuYW1lIGFuZCB2YWx1ZS4gSWYgdGhlIHBhcmFtZXRlclZhbHVlIGlzIHVuZGVmaW5lZCBvcgogICAgICAgICAqIGVtcHR5LCB0aGVuIHRoaXMgd2lsbCBhdHRlbXB0IHRvIHJlbW92ZSBhbiBleGlzdGluZyBxdWVyeSBwYXJhbWV0ZXIgd2l0aCB0aGUgcHJvdmlkZWQKICAgICAgICAgKiBwYXJhbWV0ZXJOYW1lLgogICAgICAgICAqLwogICAgICAgIFVSTFF1ZXJ5LnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbiAocGFyYW1ldGVyTmFtZSwgcGFyYW1ldGVyVmFsdWUpIHsKICAgICAgICAgICAgaWYgKHBhcmFtZXRlck5hbWUpIHsKICAgICAgICAgICAgICAgIGlmIChwYXJhbWV0ZXJWYWx1ZSAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbmV3VmFsdWUgPSBBcnJheS5pc0FycmF5KHBhcmFtZXRlclZhbHVlKSA/IHBhcmFtZXRlclZhbHVlIDogcGFyYW1ldGVyVmFsdWUudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9yYXdRdWVyeVtwYXJhbWV0ZXJOYW1lXSA9IG5ld1ZhbHVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuX3Jhd1F1ZXJ5W3BhcmFtZXRlck5hbWVdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBHZXQgdGhlIHZhbHVlIG9mIHRoZSBxdWVyeSBwYXJhbWV0ZXIgd2l0aCB0aGUgcHJvdmlkZWQgbmFtZS4gSWYgbm8gcGFyYW1ldGVyIGV4aXN0cyB3aXRoIHRoZQogICAgICAgICAqIHByb3ZpZGVkIHBhcmFtZXRlciBuYW1lLCB0aGVuIHVuZGVmaW5lZCB3aWxsIGJlIHJldHVybmVkLgogICAgICAgICAqLwogICAgICAgIFVSTFF1ZXJ5LnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiAocGFyYW1ldGVyTmFtZSkgewogICAgICAgICAgICByZXR1cm4gcGFyYW1ldGVyTmFtZSA/IHRoaXMuX3Jhd1F1ZXJ5W3BhcmFtZXRlck5hbWVdIDogdW5kZWZpbmVkOwogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogR2V0IHRoZSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhpcyBxdWVyeS4gVGhlIHJldHVybiB2YWx1ZSB3aWxsIG5vdCBzdGFydCB3aXRoIGEgIj8iLgogICAgICAgICAqLwogICAgICAgIFVSTFF1ZXJ5LnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHJlc3VsdCA9ICIiOwogICAgICAgICAgICBmb3IgKHZhciBwYXJhbWV0ZXJOYW1lIGluIHRoaXMuX3Jhd1F1ZXJ5KSB7CiAgICAgICAgICAgICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICImIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciBwYXJhbWV0ZXJWYWx1ZSA9IHRoaXMuX3Jhd1F1ZXJ5W3BhcmFtZXRlck5hbWVdOwogICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkocGFyYW1ldGVyVmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmFtZXRlclN0cmluZ3MgPSBbXTsKICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIHBhcmFtZXRlclZhbHVlXzEgPSBwYXJhbWV0ZXJWYWx1ZTsgX2kgPCBwYXJhbWV0ZXJWYWx1ZV8xLmxlbmd0aDsgX2krKykgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGFyYW1ldGVyVmFsdWVFbGVtZW50ID0gcGFyYW1ldGVyVmFsdWVfMVtfaV07CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtZXRlclN0cmluZ3MucHVzaChwYXJhbWV0ZXJOYW1lICsgIj0iICsgcGFyYW1ldGVyVmFsdWVFbGVtZW50KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHBhcmFtZXRlclN0cmluZ3Muam9pbigiJiIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHBhcmFtZXRlck5hbWUgKyAiPSIgKyBwYXJhbWV0ZXJWYWx1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogUGFyc2UgYSBVUkxRdWVyeSBmcm9tIHRoZSBwcm92aWRlZCB0ZXh0LgogICAgICAgICAqLwogICAgICAgIFVSTFF1ZXJ5LnBhcnNlID0gZnVuY3Rpb24gKHRleHQpIHsKICAgICAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBVUkxRdWVyeSgpOwogICAgICAgICAgICBpZiAodGV4dCkgewogICAgICAgICAgICAgICAgaWYgKHRleHQuc3RhcnRzV2l0aCgiPyIpKSB7CiAgICAgICAgICAgICAgICAgICAgdGV4dCA9IHRleHQuc3Vic3RyaW5nKDEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRTdGF0ZSA9ICJQYXJhbWV0ZXJOYW1lIjsKICAgICAgICAgICAgICAgIHZhciBwYXJhbWV0ZXJOYW1lID0gIiI7CiAgICAgICAgICAgICAgICB2YXIgcGFyYW1ldGVyVmFsdWUgPSAiIjsKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGV4dC5sZW5ndGg7ICsraSkgewogICAgICAgICAgICAgICAgICAgIHZhciBjdXJyZW50Q2hhcmFjdGVyID0gdGV4dFtpXTsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGN1cnJlbnRTdGF0ZSkgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJQYXJhbWV0ZXJOYW1lIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoY3VycmVudENoYXJhY3RlcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIj0iOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RhdGUgPSAiUGFyYW1ldGVyVmFsdWUiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICImIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1ldGVyTmFtZSA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbWV0ZXJWYWx1ZSA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbWV0ZXJOYW1lICs9IGN1cnJlbnRDaGFyYWN0ZXI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIlBhcmFtZXRlclZhbHVlIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoY3VycmVudENoYXJhY3RlcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIj0iOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbWV0ZXJOYW1lID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtZXRlclZhbHVlID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTdGF0ZSA9ICJJbnZhbGlkIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiJiI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5zZXQocGFyYW1ldGVyTmFtZSwgcGFyYW1ldGVyVmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbWV0ZXJOYW1lID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtZXRlclZhbHVlID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTdGF0ZSA9ICJQYXJhbWV0ZXJOYW1lIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1ldGVyVmFsdWUgKz0gY3VycmVudENoYXJhY3RlcjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiSW52YWxpZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudENoYXJhY3RlciA9PT0gIiYiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFN0YXRlID0gIlBhcmFtZXRlck5hbWUiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVucmVjb2duaXplZCBVUkxRdWVyeSBwYXJzZSBzdGF0ZTogIiArIGN1cnJlbnRTdGF0ZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRTdGF0ZSA9PT0gIlBhcmFtZXRlclZhbHVlIikgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdC5zZXQocGFyYW1ldGVyTmFtZSwgcGFyYW1ldGVyVmFsdWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gVVJMUXVlcnk7CiAgICB9KCkpOwogICAgLyoqCiAgICAgKiBBIGNsYXNzIHRoYXQgaGFuZGxlcyBjcmVhdGluZywgbW9kaWZ5aW5nLCBhbmQgcGFyc2luZyBVUkxzLgogICAgICovCiAgICB2YXIgVVJMQnVpbGRlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBVUkxCdWlsZGVyKCkgewogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXQgdGhlIHNjaGVtZS9wcm90b2NvbCBmb3IgdGhpcyBVUkwuIElmIHRoZSBwcm92aWRlZCBzY2hlbWUgY29udGFpbnMgb3RoZXIgcGFydHMgb2YgYSBVUkwKICAgICAgICAgKiAoc3VjaCBhcyBhIGhvc3QsIHBvcnQsIHBhdGgsIG9yIHF1ZXJ5KSwgdGhvc2UgcGFydHMgd2lsbCBiZSBhZGRlZCB0byB0aGlzIFVSTCBhcyB3ZWxsLgogICAgICAgICAqLwogICAgICAgIFVSTEJ1aWxkZXIucHJvdG90eXBlLnNldFNjaGVtZSA9IGZ1bmN0aW9uIChzY2hlbWUpIHsKICAgICAgICAgICAgaWYgKCFzY2hlbWUpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3NjaGVtZSA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuc2V0KHNjaGVtZSwgIlNDSEVNRSIpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBHZXQgdGhlIHNjaGVtZSB0aGF0IGhhcyBiZWVuIHNldCBpbiB0aGlzIFVSTC4KICAgICAgICAgKi8KICAgICAgICBVUkxCdWlsZGVyLnByb3RvdHlwZS5nZXRTY2hlbWUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zY2hlbWU7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBTZXQgdGhlIGhvc3QgZm9yIHRoaXMgVVJMLiBJZiB0aGUgcHJvdmlkZWQgaG9zdCBjb250YWlucyBvdGhlciBwYXJ0cyBvZiBhIFVSTCAoc3VjaCBhcyBhCiAgICAgICAgICogcG9ydCwgcGF0aCwgb3IgcXVlcnkpLCB0aG9zZSBwYXJ0cyB3aWxsIGJlIGFkZGVkIHRvIHRoaXMgVVJMIGFzIHdlbGwuCiAgICAgICAgICovCiAgICAgICAgVVJMQnVpbGRlci5wcm90b3R5cGUuc2V0SG9zdCA9IGZ1bmN0aW9uIChob3N0KSB7CiAgICAgICAgICAgIGlmICghaG9zdCkgewogICAgICAgICAgICAgICAgdGhpcy5faG9zdCA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuc2V0KGhvc3QsICJTQ0hFTUVfT1JfSE9TVCIpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBHZXQgdGhlIGhvc3QgdGhhdCBoYXMgYmVlbiBzZXQgaW4gdGhpcyBVUkwuCiAgICAgICAgICovCiAgICAgICAgVVJMQnVpbGRlci5wcm90b3R5cGUuZ2V0SG9zdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2hvc3Q7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBTZXQgdGhlIHBvcnQgZm9yIHRoaXMgVVJMLiBJZiB0aGUgcHJvdmlkZWQgcG9ydCBjb250YWlucyBvdGhlciBwYXJ0cyBvZiBhIFVSTCAoc3VjaCBhcyBhCiAgICAgICAgICogcGF0aCBvciBxdWVyeSksIHRob3NlIHBhcnRzIHdpbGwgYmUgYWRkZWQgdG8gdGhpcyBVUkwgYXMgd2VsbC4KICAgICAgICAgKi8KICAgICAgICBVUkxCdWlsZGVyLnByb3RvdHlwZS5zZXRQb3J0ID0gZnVuY3Rpb24gKHBvcnQpIHsKICAgICAgICAgICAgaWYgKHBvcnQgPT0gdW5kZWZpbmVkIHx8IHBvcnQgPT09ICIiKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9wb3J0ID0gdW5kZWZpbmVkOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5zZXQocG9ydC50b1N0cmluZygpLCAiUE9SVCIpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBHZXQgdGhlIHBvcnQgdGhhdCBoYXMgYmVlbiBzZXQgaW4gdGhpcyBVUkwuCiAgICAgICAgICovCiAgICAgICAgVVJMQnVpbGRlci5wcm90b3R5cGUuZ2V0UG9ydCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3BvcnQ7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBTZXQgdGhlIHBhdGggZm9yIHRoaXMgVVJMLiBJZiB0aGUgcHJvdmlkZWQgcGF0aCBjb250YWlucyBhIHF1ZXJ5LCB0aGVuIGl0IHdpbGwgYmUgYWRkZWQgdG8KICAgICAgICAgKiB0aGlzIFVSTCBhcyB3ZWxsLgogICAgICAgICAqLwogICAgICAgIFVSTEJ1aWxkZXIucHJvdG90eXBlLnNldFBhdGggPSBmdW5jdGlvbiAocGF0aCkgewogICAgICAgICAgICBpZiAoIXBhdGgpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3BhdGggPSB1bmRlZmluZWQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAocGF0aC5pbmRleE9mKCI6Ly8iKSAhPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNldChwYXRoLCAiU0NIRU1FIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNldChwYXRoLCAiUEFUSCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBBcHBlbmQgdGhlIHByb3ZpZGVkIHBhdGggdG8gdGhpcyBVUkwncyBleGlzdGluZyBwYXRoLiBJZiB0aGUgcHJvdmlkZWQgcGF0aCBjb250YWlucyBhIHF1ZXJ5LAogICAgICAgICAqIHRoZW4gaXQgd2lsbCBiZSBhZGRlZCB0byB0aGlzIFVSTCBhcyB3ZWxsLgogICAgICAgICAqLwogICAgICAgIFVSTEJ1aWxkZXIucHJvdG90eXBlLmFwcGVuZFBhdGggPSBmdW5jdGlvbiAocGF0aCkgewogICAgICAgICAgICBpZiAocGF0aCkgewogICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRQYXRoID0gdGhpcy5nZXRQYXRoKCk7CiAgICAgICAgICAgICAgICBpZiAoY3VycmVudFBhdGgpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIWN1cnJlbnRQYXRoLmVuZHNXaXRoKCIvIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFBhdGggKz0gIi8iOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAocGF0aC5zdGFydHNXaXRoKCIvIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGF0aCA9IHBhdGguc3Vic3RyaW5nKDEpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBwYXRoID0gY3VycmVudFBhdGggKyBwYXRoOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5zZXQocGF0aCwgIlBBVEgiKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogR2V0IHRoZSBwYXRoIHRoYXQgaGFzIGJlZW4gc2V0IGluIHRoaXMgVVJMLgogICAgICAgICAqLwogICAgICAgIFVSTEJ1aWxkZXIucHJvdG90eXBlLmdldFBhdGggPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wYXRoOwogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogU2V0IHRoZSBxdWVyeSBpbiB0aGlzIFVSTC4KICAgICAgICAgKi8KICAgICAgICBVUkxCdWlsZGVyLnByb3RvdHlwZS5zZXRRdWVyeSA9IGZ1bmN0aW9uIChxdWVyeSkgewogICAgICAgICAgICBpZiAoIXF1ZXJ5KSB7CiAgICAgICAgICAgICAgICB0aGlzLl9xdWVyeSA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuX3F1ZXJ5ID0gVVJMUXVlcnkucGFyc2UocXVlcnkpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBTZXQgYSBxdWVyeSBwYXJhbWV0ZXIgd2l0aCB0aGUgcHJvdmlkZWQgbmFtZSBhbmQgdmFsdWUgaW4gdGhpcyBVUkwncyBxdWVyeS4gSWYgdGhlIHByb3ZpZGVkCiAgICAgICAgICogcXVlcnkgcGFyYW1ldGVyIHZhbHVlIGlzIHVuZGVmaW5lZCBvciBlbXB0eSwgdGhlbiB0aGUgcXVlcnkgcGFyYW1ldGVyIHdpbGwgYmUgcmVtb3ZlZCBpZiBpdAogICAgICAgICAqIGV4aXN0ZWQuCiAgICAgICAgICovCiAgICAgICAgVVJMQnVpbGRlci5wcm90b3R5cGUuc2V0UXVlcnlQYXJhbWV0ZXIgPSBmdW5jdGlvbiAocXVlcnlQYXJhbWV0ZXJOYW1lLCBxdWVyeVBhcmFtZXRlclZhbHVlKSB7CiAgICAgICAgICAgIGlmIChxdWVyeVBhcmFtZXRlck5hbWUpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5fcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9xdWVyeSA9IG5ldyBVUkxRdWVyeSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5fcXVlcnkuc2V0KHF1ZXJ5UGFyYW1ldGVyTmFtZSwgcXVlcnlQYXJhbWV0ZXJWYWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIC8qKgogICAgICAgICAqIEdldCB0aGUgdmFsdWUgb2YgdGhlIHF1ZXJ5IHBhcmFtZXRlciB3aXRoIHRoZSBwcm92aWRlZCBxdWVyeSBwYXJhbWV0ZXIgbmFtZS4gSWYgbm8gcXVlcnkKICAgICAgICAgKiBwYXJhbWV0ZXIgZXhpc3RzIHdpdGggdGhlIHByb3ZpZGVkIG5hbWUsIHRoZW4gdW5kZWZpbmVkIHdpbGwgYmUgcmV0dXJuZWQuCiAgICAgICAgICovCiAgICAgICAgVVJMQnVpbGRlci5wcm90b3R5cGUuZ2V0UXVlcnlQYXJhbWV0ZXJWYWx1ZSA9IGZ1bmN0aW9uIChxdWVyeVBhcmFtZXRlck5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3F1ZXJ5ID8gdGhpcy5fcXVlcnkuZ2V0KHF1ZXJ5UGFyYW1ldGVyTmFtZSkgOiB1bmRlZmluZWQ7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBHZXQgdGhlIHF1ZXJ5IGluIHRoaXMgVVJMLgogICAgICAgICAqLwogICAgICAgIFVSTEJ1aWxkZXIucHJvdG90eXBlLmdldFF1ZXJ5ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcXVlcnkgPyB0aGlzLl9xdWVyeS50b1N0cmluZygpIDogdW5kZWZpbmVkOwogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogU2V0IHRoZSBwYXJ0cyBvZiB0aGlzIFVSTCBieSBwYXJzaW5nIHRoZSBwcm92aWRlZCB0ZXh0IHVzaW5nIHRoZSBwcm92aWRlZCBzdGFydFN0YXRlLgogICAgICAgICAqLwogICAgICAgIFVSTEJ1aWxkZXIucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uICh0ZXh0LCBzdGFydFN0YXRlKSB7CiAgICAgICAgICAgIHZhciB0b2tlbml6ZXIgPSBuZXcgVVJMVG9rZW5pemVyKHRleHQsIHN0YXJ0U3RhdGUpOwogICAgICAgICAgICB3aGlsZSAodG9rZW5pemVyLm5leHQoKSkgewogICAgICAgICAgICAgICAgdmFyIHRva2VuID0gdG9rZW5pemVyLmN1cnJlbnQoKTsKICAgICAgICAgICAgICAgIGlmICh0b2tlbikgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodG9rZW4udHlwZSkgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJTQ0hFTUUiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2NoZW1lID0gdG9rZW4udGV4dCB8fCB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiSE9TVCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9ob3N0ID0gdG9rZW4udGV4dCB8fCB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiUE9SVCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9wb3J0ID0gdG9rZW4udGV4dCB8fCB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiUEFUSCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG9rZW5QYXRoID0gdG9rZW4udGV4dCB8fCB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX3BhdGggfHwgdGhpcy5fcGF0aCA9PT0gIi8iIHx8IHRva2VuUGF0aCAhPT0gIi8iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcGF0aCA9IHRva2VuUGF0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJRVUVSWSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9xdWVyeSA9IFVSTFF1ZXJ5LnBhcnNlKHRva2VuLnRleHQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVucmVjb2duaXplZCBVUkxUb2tlblR5cGU6ICIgKyB0b2tlbi50eXBlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIFVSTEJ1aWxkZXIucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgcmVzdWx0ID0gIiI7CiAgICAgICAgICAgIGlmICh0aGlzLl9zY2hlbWUpIHsKICAgICAgICAgICAgICAgIHJlc3VsdCArPSB0aGlzLl9zY2hlbWUgKyAiOi8vIjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5faG9zdCkgewogICAgICAgICAgICAgICAgcmVzdWx0ICs9IHRoaXMuX2hvc3Q7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMuX3BvcnQpIHsKICAgICAgICAgICAgICAgIHJlc3VsdCArPSAiOiIgKyB0aGlzLl9wb3J0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLl9wYXRoKSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX3BhdGguc3RhcnRzV2l0aCgiLyIpKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICIvIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlc3VsdCArPSB0aGlzLl9wYXRoOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLl9xdWVyeSAmJiB0aGlzLl9xdWVyeS5hbnkoKSkgewogICAgICAgICAgICAgICAgcmVzdWx0ICs9ICI/IiArIHRoaXMuX3F1ZXJ5LnRvU3RyaW5nKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9OwogICAgICAgIC8qKgogICAgICAgICAqIElmIHRoZSBwcm92aWRlZCBzZWFyY2hWYWx1ZSBpcyBmb3VuZCBpbiB0aGlzIFVSTEJ1aWxkZXIsIHRoZW4gcmVwbGFjZSBpdCB3aXRoIHRoZSBwcm92aWRlZAogICAgICAgICAqIHJlcGxhY2VWYWx1ZS4KICAgICAgICAgKi8KICAgICAgICBVUkxCdWlsZGVyLnByb3RvdHlwZS5yZXBsYWNlQWxsID0gZnVuY3Rpb24gKHNlYXJjaFZhbHVlLCByZXBsYWNlVmFsdWUpIHsKICAgICAgICAgICAgaWYgKHNlYXJjaFZhbHVlKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNldFNjaGVtZShyZXBsYWNlQWxsKHRoaXMuZ2V0U2NoZW1lKCksIHNlYXJjaFZhbHVlLCByZXBsYWNlVmFsdWUpKTsKICAgICAgICAgICAgICAgIHRoaXMuc2V0SG9zdChyZXBsYWNlQWxsKHRoaXMuZ2V0SG9zdCgpLCBzZWFyY2hWYWx1ZSwgcmVwbGFjZVZhbHVlKSk7CiAgICAgICAgICAgICAgICB0aGlzLnNldFBvcnQocmVwbGFjZUFsbCh0aGlzLmdldFBvcnQoKSwgc2VhcmNoVmFsdWUsIHJlcGxhY2VWYWx1ZSkpOwogICAgICAgICAgICAgICAgdGhpcy5zZXRQYXRoKHJlcGxhY2VBbGwodGhpcy5nZXRQYXRoKCksIHNlYXJjaFZhbHVlLCByZXBsYWNlVmFsdWUpKTsKICAgICAgICAgICAgICAgIHRoaXMuc2V0UXVlcnkocmVwbGFjZUFsbCh0aGlzLmdldFF1ZXJ5KCksIHNlYXJjaFZhbHVlLCByZXBsYWNlVmFsdWUpKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgVVJMQnVpbGRlci5wYXJzZSA9IGZ1bmN0aW9uICh0ZXh0KSB7CiAgICAgICAgICAgIHZhciByZXN1bHQgPSBuZXcgVVJMQnVpbGRlcigpOwogICAgICAgICAgICByZXN1bHQuc2V0KHRleHQsICJTQ0hFTUVfT1JfSE9TVCIpOwogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH07CiAgICAgICAgcmV0dXJuIFVSTEJ1aWxkZXI7CiAgICB9KCkpOwogICAgdmFyIFVSTFRva2VuID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIFVSTFRva2VuKHRleHQsIHR5cGUpIHsKICAgICAgICAgICAgdGhpcy50ZXh0ID0gdGV4dDsKICAgICAgICAgICAgdGhpcy50eXBlID0gdHlwZTsKICAgICAgICB9CiAgICAgICAgVVJMVG9rZW4uc2NoZW1lID0gZnVuY3Rpb24gKHRleHQpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBVUkxUb2tlbih0ZXh0LCAiU0NIRU1FIik7CiAgICAgICAgfTsKICAgICAgICBVUkxUb2tlbi5ob3N0ID0gZnVuY3Rpb24gKHRleHQpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBVUkxUb2tlbih0ZXh0LCAiSE9TVCIpOwogICAgICAgIH07CiAgICAgICAgVVJMVG9rZW4ucG9ydCA9IGZ1bmN0aW9uICh0ZXh0KSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgVVJMVG9rZW4odGV4dCwgIlBPUlQiKTsKICAgICAgICB9OwogICAgICAgIFVSTFRva2VuLnBhdGggPSBmdW5jdGlvbiAodGV4dCkgewogICAgICAgICAgICByZXR1cm4gbmV3IFVSTFRva2VuKHRleHQsICJQQVRIIik7CiAgICAgICAgfTsKICAgICAgICBVUkxUb2tlbi5xdWVyeSA9IGZ1bmN0aW9uICh0ZXh0KSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgVVJMVG9rZW4odGV4dCwgIlFVRVJZIik7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gVVJMVG9rZW47CiAgICB9KCkpOwogICAgLyoqCiAgICAgKiBHZXQgd2hldGhlciBvciBub3QgdGhlIHByb3ZpZGVkIGNoYXJhY3RlciAoc2luZ2xlIGNoYXJhY3RlciBzdHJpbmcpIGlzIGFuIGFscGhhbnVtZXJpYyAobGV0dGVyIG9yCiAgICAgKiBkaWdpdCkgY2hhcmFjdGVyLgogICAgICovCiAgICBmdW5jdGlvbiBpc0FscGhhTnVtZXJpY0NoYXJhY3RlcihjaGFyYWN0ZXIpIHsKICAgICAgICB2YXIgY2hhcmFjdGVyQ29kZSA9IGNoYXJhY3Rlci5jaGFyQ29kZUF0KDApOwogICAgICAgIHJldHVybiAoNDggLyogJzAnICovIDw9IGNoYXJhY3RlckNvZGUgJiYgY2hhcmFjdGVyQ29kZSA8PSA1NyAvKiAnOScgKi8pIHx8CiAgICAgICAgICAgICg2NSAvKiAnQScgKi8gPD0gY2hhcmFjdGVyQ29kZSAmJiBjaGFyYWN0ZXJDb2RlIDw9IDkwIC8qICdaJyAqLykgfHwKICAgICAgICAgICAgKDk3IC8qICdhJyAqLyA8PSBjaGFyYWN0ZXJDb2RlICYmIGNoYXJhY3RlckNvZGUgPD0gMTIyIC8qICd6JyAqLyk7CiAgICB9CiAgICAvKioKICAgICAqIEEgY2xhc3MgdGhhdCB0b2tlbml6ZXMgVVJMIHN0cmluZ3MuCiAgICAgKi8KICAgIHZhciBVUkxUb2tlbml6ZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CiAgICAgICAgZnVuY3Rpb24gVVJMVG9rZW5pemVyKF90ZXh0LCBzdGF0ZSkgewogICAgICAgICAgICB0aGlzLl90ZXh0ID0gX3RleHQ7CiAgICAgICAgICAgIHRoaXMuX3RleHRMZW5ndGggPSBfdGV4dCA/IF90ZXh0Lmxlbmd0aCA6IDA7CiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRTdGF0ZSA9IHN0YXRlICE9IHVuZGVmaW5lZCA/IHN0YXRlIDogIlNDSEVNRV9PUl9IT1NUIjsKICAgICAgICAgICAgdGhpcy5fY3VycmVudEluZGV4ID0gMDsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogR2V0IHRoZSBjdXJyZW50IFVSTFRva2VuIHRoaXMgVVJMVG9rZW5pemVyIGlzIHBvaW50aW5nIGF0LCBvciB1bmRlZmluZWQgaWYgdGhlIFVSTFRva2VuaXplcgogICAgICAgICAqIGhhc24ndCBzdGFydGVkIG9yIGhhcyBmaW5pc2hlZCB0b2tlbml6aW5nLgogICAgICAgICAqLwogICAgICAgIFVSTFRva2VuaXplci5wcm90b3R5cGUuY3VycmVudCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2N1cnJlbnRUb2tlbjsKICAgICAgICB9OwogICAgICAgIC8qKgogICAgICAgICAqIEFkdmFuY2UgdG8gdGhlIG5leHQgVVJMVG9rZW4gYW5kIHJldHVybiB3aGV0aGVyIG9yIG5vdCBhIFVSTFRva2VuIHdhcyBmb3VuZC4KICAgICAgICAgKi8KICAgICAgICBVUkxUb2tlbml6ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmICghaGFzQ3VycmVudENoYXJhY3Rlcih0aGlzKSkgewogICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudFRva2VuID0gdW5kZWZpbmVkOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgc3dpdGNoICh0aGlzLl9jdXJyZW50U3RhdGUpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlICJTQ0hFTUUiOgogICAgICAgICAgICAgICAgICAgICAgICBuZXh0U2NoZW1lKHRoaXMpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICJTQ0hFTUVfT1JfSE9TVCI6CiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRTY2hlbWVPckhvc3QodGhpcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgIkhPU1QiOgogICAgICAgICAgICAgICAgICAgICAgICBuZXh0SG9zdCh0aGlzKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiUE9SVCI6CiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRQb3J0KHRoaXMpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICJQQVRIIjoKICAgICAgICAgICAgICAgICAgICAgICAgbmV4dFBhdGgodGhpcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgIlFVRVJZIjoKICAgICAgICAgICAgICAgICAgICAgICAgbmV4dFF1ZXJ5KHRoaXMpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVucmVjb2duaXplZCBVUkxUb2tlbml6ZXJTdGF0ZTogIiArIHRoaXMuX2N1cnJlbnRTdGF0ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICEhdGhpcy5fY3VycmVudFRva2VuOwogICAgICAgIH07CiAgICAgICAgcmV0dXJuIFVSTFRva2VuaXplcjsKICAgIH0oKSk7CiAgICAvKioKICAgICAqIFJlYWQgdGhlIHJlbWFpbmluZyBjaGFyYWN0ZXJzIGZyb20gdGhpcyBUb2tlbml6ZXIncyBjaGFyYWN0ZXIgc3RyZWFtLgogICAgICovCiAgICBmdW5jdGlvbiByZWFkUmVtYWluaW5nKHRva2VuaXplcikgewogICAgICAgIHZhciByZXN1bHQgPSAiIjsKICAgICAgICBpZiAodG9rZW5pemVyLl9jdXJyZW50SW5kZXggPCB0b2tlbml6ZXIuX3RleHRMZW5ndGgpIHsKICAgICAgICAgICAgcmVzdWx0ID0gdG9rZW5pemVyLl90ZXh0LnN1YnN0cmluZyh0b2tlbml6ZXIuX2N1cnJlbnRJbmRleCk7CiAgICAgICAgICAgIHRva2VuaXplci5fY3VycmVudEluZGV4ID0gdG9rZW5pemVyLl90ZXh0TGVuZ3RoOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBXaGV0aGVyIG9yIG5vdCB0aGlzIFVSTFRva2VuaXplciBoYXMgYSBjdXJyZW50IGNoYXJhY3Rlci4KICAgICAqLwogICAgZnVuY3Rpb24gaGFzQ3VycmVudENoYXJhY3Rlcih0b2tlbml6ZXIpIHsKICAgICAgICByZXR1cm4gdG9rZW5pemVyLl9jdXJyZW50SW5kZXggPCB0b2tlbml6ZXIuX3RleHRMZW5ndGg7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgY2hhcmFjdGVyIGluIHRoZSB0ZXh0IHN0cmluZyBhdCB0aGUgY3VycmVudCBpbmRleC4KICAgICAqLwogICAgZnVuY3Rpb24gZ2V0Q3VycmVudENoYXJhY3Rlcih0b2tlbml6ZXIpIHsKICAgICAgICByZXR1cm4gdG9rZW5pemVyLl90ZXh0W3Rva2VuaXplci5fY3VycmVudEluZGV4XTsKICAgIH0KICAgIC8qKgogICAgICogQWR2YW5jZSB0byB0aGUgY2hhcmFjdGVyIGluIHRleHQgdGhhdCBpcyAic3RlcCIgY2hhcmFjdGVycyBhaGVhZC4gSWYgbm8gc3RlcCB2YWx1ZSBpcyBwcm92aWRlZCwKICAgICAqIHRoZW4gc3RlcCB3aWxsIGRlZmF1bHQgdG8gMS4KICAgICAqLwogICAgZnVuY3Rpb24gbmV4dENoYXJhY3Rlcih0b2tlbml6ZXIsIHN0ZXApIHsKICAgICAgICBpZiAoaGFzQ3VycmVudENoYXJhY3Rlcih0b2tlbml6ZXIpKSB7CiAgICAgICAgICAgIGlmICghc3RlcCkgewogICAgICAgICAgICAgICAgc3RlcCA9IDE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdG9rZW5pemVyLl9jdXJyZW50SW5kZXggKz0gc3RlcDsKICAgICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFN0YXJ0aW5nIHdpdGggdGhlIGN1cnJlbnQgY2hhcmFjdGVyLCBwZWVrICJjaGFyYWN0ZXJzVG9QZWVrIiBudW1iZXIgb2YgY2hhcmFjdGVycyBhaGVhZCBpbiB0aGlzCiAgICAgKiBUb2tlbml6ZXIncyBzdHJlYW0gb2YgY2hhcmFjdGVycy4KICAgICAqLwogICAgZnVuY3Rpb24gcGVla0NoYXJhY3RlcnModG9rZW5pemVyLCBjaGFyYWN0ZXJzVG9QZWVrKSB7CiAgICAgICAgdmFyIGVuZEluZGV4ID0gdG9rZW5pemVyLl9jdXJyZW50SW5kZXggKyBjaGFyYWN0ZXJzVG9QZWVrOwogICAgICAgIGlmICh0b2tlbml6ZXIuX3RleHRMZW5ndGggPCBlbmRJbmRleCkgewogICAgICAgICAgICBlbmRJbmRleCA9IHRva2VuaXplci5fdGV4dExlbmd0aDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRva2VuaXplci5fdGV4dC5zdWJzdHJpbmcodG9rZW5pemVyLl9jdXJyZW50SW5kZXgsIGVuZEluZGV4KTsKICAgIH0KICAgIC8qKgogICAgICogUmVhZCBjaGFyYWN0ZXJzIGZyb20gdGhpcyBUb2tlbml6ZXIgdW50aWwgdGhlIGVuZCBvZiB0aGUgc3RyZWFtIG9yIHVudGlsIHRoZSBwcm92aWRlZCBjb25kaXRpb24KICAgICAqIGlzIGZhbHNlIHdoZW4gcHJvdmlkZWQgdGhlIGN1cnJlbnQgY2hhcmFjdGVyLgogICAgICovCiAgICBmdW5jdGlvbiByZWFkV2hpbGUodG9rZW5pemVyLCBjb25kaXRpb24pIHsKICAgICAgICB2YXIgcmVzdWx0ID0gIiI7CiAgICAgICAgd2hpbGUgKGhhc0N1cnJlbnRDaGFyYWN0ZXIodG9rZW5pemVyKSkgewogICAgICAgICAgICB2YXIgY3VycmVudENoYXJhY3RlciA9IGdldEN1cnJlbnRDaGFyYWN0ZXIodG9rZW5pemVyKTsKICAgICAgICAgICAgaWYgKCFjb25kaXRpb24oY3VycmVudENoYXJhY3RlcikpIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgcmVzdWx0ICs9IGN1cnJlbnRDaGFyYWN0ZXI7CiAgICAgICAgICAgICAgICBuZXh0Q2hhcmFjdGVyKHRva2VuaXplcik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogUmVhZCBjaGFyYWN0ZXJzIGZyb20gdGhpcyBUb2tlbml6ZXIgdW50aWwgYSBub24tYWxwaGFudW1lcmljIGNoYXJhY3RlciBvciB0aGUgZW5kIG9mIHRoZQogICAgICogY2hhcmFjdGVyIHN0cmVhbSBpcyByZWFjaGVkLgogICAgICovCiAgICBmdW5jdGlvbiByZWFkV2hpbGVMZXR0ZXJPckRpZ2l0KHRva2VuaXplcikgewogICAgICAgIHJldHVybiByZWFkV2hpbGUodG9rZW5pemVyLCBmdW5jdGlvbiAoY2hhcmFjdGVyKSB7IHJldHVybiBpc0FscGhhTnVtZXJpY0NoYXJhY3RlcihjaGFyYWN0ZXIpOyB9KTsKICAgIH0KICAgIC8qKgogICAgICogUmVhZCBjaGFyYWN0ZXJzIGZyb20gdGhpcyBUb2tlbml6ZXIgdW50aWwgb25lIG9mIHRoZSBwcm92aWRlZCB0ZXJtaW5hdGluZyBjaGFyYWN0ZXJzIGlzIHJlYWQgb3IKICAgICAqIHRoZSBlbmQgb2YgdGhlIGNoYXJhY3RlciBzdHJlYW0gaXMgcmVhY2hlZC4KICAgICAqLwogICAgZnVuY3Rpb24gcmVhZFVudGlsQ2hhcmFjdGVyKHRva2VuaXplcikgewogICAgICAgIHZhciB0ZXJtaW5hdGluZ0NoYXJhY3RlcnMgPSBbXTsKICAgICAgICBmb3IgKHZhciBfaSA9IDE7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykgewogICAgICAgICAgICB0ZXJtaW5hdGluZ0NoYXJhY3RlcnNbX2kgLSAxXSA9IGFyZ3VtZW50c1tfaV07CiAgICAgICAgfQogICAgICAgIHJldHVybiByZWFkV2hpbGUodG9rZW5pemVyLCBmdW5jdGlvbiAoY2hhcmFjdGVyKSB7IHJldHVybiB0ZXJtaW5hdGluZ0NoYXJhY3RlcnMuaW5kZXhPZihjaGFyYWN0ZXIpID09PSAtMTsgfSk7CiAgICB9CiAgICBmdW5jdGlvbiBuZXh0U2NoZW1lKHRva2VuaXplcikgewogICAgICAgIHZhciBzY2hlbWUgPSByZWFkV2hpbGVMZXR0ZXJPckRpZ2l0KHRva2VuaXplcik7CiAgICAgICAgdG9rZW5pemVyLl9jdXJyZW50VG9rZW4gPSBVUkxUb2tlbi5zY2hlbWUoc2NoZW1lKTsKICAgICAgICBpZiAoIWhhc0N1cnJlbnRDaGFyYWN0ZXIodG9rZW5pemVyKSkgewogICAgICAgICAgICB0b2tlbml6ZXIuX2N1cnJlbnRTdGF0ZSA9ICJET05FIjsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHRva2VuaXplci5fY3VycmVudFN0YXRlID0gIkhPU1QiOwogICAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIG5leHRTY2hlbWVPckhvc3QodG9rZW5pemVyKSB7CiAgICAgICAgdmFyIHNjaGVtZU9ySG9zdCA9IHJlYWRVbnRpbENoYXJhY3Rlcih0b2tlbml6ZXIsICI6IiwgIi8iLCAiPyIpOwogICAgICAgIGlmICghaGFzQ3VycmVudENoYXJhY3Rlcih0b2tlbml6ZXIpKSB7CiAgICAgICAgICAgIHRva2VuaXplci5fY3VycmVudFRva2VuID0gVVJMVG9rZW4uaG9zdChzY2hlbWVPckhvc3QpOwogICAgICAgICAgICB0b2tlbml6ZXIuX2N1cnJlbnRTdGF0ZSA9ICJET05FIjsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoZ2V0Q3VycmVudENoYXJhY3Rlcih0b2tlbml6ZXIpID09PSAiOiIpIHsKICAgICAgICAgICAgaWYgKHBlZWtDaGFyYWN0ZXJzKHRva2VuaXplciwgMykgPT09ICI6Ly8iKSB7CiAgICAgICAgICAgICAgICB0b2tlbml6ZXIuX2N1cnJlbnRUb2tlbiA9IFVSTFRva2VuLnNjaGVtZShzY2hlbWVPckhvc3QpOwogICAgICAgICAgICAgICAgdG9rZW5pemVyLl9jdXJyZW50U3RhdGUgPSAiSE9TVCI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB0b2tlbml6ZXIuX2N1cnJlbnRUb2tlbiA9IFVSTFRva2VuLmhvc3Qoc2NoZW1lT3JIb3N0KTsKICAgICAgICAgICAgICAgIHRva2VuaXplci5fY3VycmVudFN0YXRlID0gIlBPUlQiOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICB0b2tlbml6ZXIuX2N1cnJlbnRUb2tlbiA9IFVSTFRva2VuLmhvc3Qoc2NoZW1lT3JIb3N0KTsKICAgICAgICAgICAgaWYgKGdldEN1cnJlbnRDaGFyYWN0ZXIodG9rZW5pemVyKSA9PT0gIi8iKSB7CiAgICAgICAgICAgICAgICB0b2tlbml6ZXIuX2N1cnJlbnRTdGF0ZSA9ICJQQVRIIjsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHRva2VuaXplci5fY3VycmVudFN0YXRlID0gIlFVRVJZIjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIG5leHRIb3N0KHRva2VuaXplcikgewogICAgICAgIGlmIChwZWVrQ2hhcmFjdGVycyh0b2tlbml6ZXIsIDMpID09PSAiOi8vIikgewogICAgICAgICAgICBuZXh0Q2hhcmFjdGVyKHRva2VuaXplciwgMyk7CiAgICAgICAgfQogICAgICAgIHZhciBob3N0ID0gcmVhZFVudGlsQ2hhcmFjdGVyKHRva2VuaXplciwgIjoiLCAiLyIsICI/Iik7CiAgICAgICAgdG9rZW5pemVyLl9jdXJyZW50VG9rZW4gPSBVUkxUb2tlbi5ob3N0KGhvc3QpOwogICAgICAgIGlmICghaGFzQ3VycmVudENoYXJhY3Rlcih0b2tlbml6ZXIpKSB7CiAgICAgICAgICAgIHRva2VuaXplci5fY3VycmVudFN0YXRlID0gIkRPTkUiOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChnZXRDdXJyZW50Q2hhcmFjdGVyKHRva2VuaXplcikgPT09ICI6IikgewogICAgICAgICAgICB0b2tlbml6ZXIuX2N1cnJlbnRTdGF0ZSA9ICJQT1JUIjsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoZ2V0Q3VycmVudENoYXJhY3Rlcih0b2tlbml6ZXIpID09PSAiLyIpIHsKICAgICAgICAgICAgdG9rZW5pemVyLl9jdXJyZW50U3RhdGUgPSAiUEFUSCI7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICB0b2tlbml6ZXIuX2N1cnJlbnRTdGF0ZSA9ICJRVUVSWSI7CiAgICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gbmV4dFBvcnQodG9rZW5pemVyKSB7CiAgICAgICAgaWYgKGdldEN1cnJlbnRDaGFyYWN0ZXIodG9rZW5pemVyKSA9PT0gIjoiKSB7CiAgICAgICAgICAgIG5leHRDaGFyYWN0ZXIodG9rZW5pemVyKTsKICAgICAgICB9CiAgICAgICAgdmFyIHBvcnQgPSByZWFkVW50aWxDaGFyYWN0ZXIodG9rZW5pemVyLCAiLyIsICI/Iik7CiAgICAgICAgdG9rZW5pemVyLl9jdXJyZW50VG9rZW4gPSBVUkxUb2tlbi5wb3J0KHBvcnQpOwogICAgICAgIGlmICghaGFzQ3VycmVudENoYXJhY3Rlcih0b2tlbml6ZXIpKSB7CiAgICAgICAgICAgIHRva2VuaXplci5fY3VycmVudFN0YXRlID0gIkRPTkUiOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChnZXRDdXJyZW50Q2hhcmFjdGVyKHRva2VuaXplcikgPT09ICIvIikgewogICAgICAgICAgICB0b2tlbml6ZXIuX2N1cnJlbnRTdGF0ZSA9ICJQQVRIIjsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHRva2VuaXplci5fY3VycmVudFN0YXRlID0gIlFVRVJZIjsKICAgICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBuZXh0UGF0aCh0b2tlbml6ZXIpIHsKICAgICAgICB2YXIgcGF0aCA9IHJlYWRVbnRpbENoYXJhY3Rlcih0b2tlbml6ZXIsICI/Iik7CiAgICAgICAgdG9rZW5pemVyLl9jdXJyZW50VG9rZW4gPSBVUkxUb2tlbi5wYXRoKHBhdGgpOwogICAgICAgIGlmICghaGFzQ3VycmVudENoYXJhY3Rlcih0b2tlbml6ZXIpKSB7CiAgICAgICAgICAgIHRva2VuaXplci5fY3VycmVudFN0YXRlID0gIkRPTkUiOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgdG9rZW5pemVyLl9jdXJyZW50U3RhdGUgPSAiUVVFUlkiOwogICAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIG5leHRRdWVyeSh0b2tlbml6ZXIpIHsKICAgICAgICBpZiAoZ2V0Q3VycmVudENoYXJhY3Rlcih0b2tlbml6ZXIpID09PSAiPyIpIHsKICAgICAgICAgICAgbmV4dENoYXJhY3Rlcih0b2tlbml6ZXIpOwogICAgICAgIH0KICAgICAgICB2YXIgcXVlcnkgPSByZWFkUmVtYWluaW5nKHRva2VuaXplcik7CiAgICAgICAgdG9rZW5pemVyLl9jdXJyZW50VG9rZW4gPSBVUkxUb2tlbi5xdWVyeShxdWVyeSk7CiAgICAgICAgdG9rZW5pemVyLl9jdXJyZW50U3RhdGUgPSAiRE9ORSI7CiAgICB9CgogICAgLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAgICBmdW5jdGlvbiByZWRpcmVjdFBvbGljeShtYXhpbXVtUmV0cmllcykgewogICAgICAgIGlmIChtYXhpbXVtUmV0cmllcyA9PT0gdm9pZCAwKSB7IG1heGltdW1SZXRyaWVzID0gMjA7IH0KICAgICAgICByZXR1cm4gewogICAgICAgICAgICBjcmVhdGU6IGZ1bmN0aW9uIChuZXh0UG9saWN5LCBvcHRpb25zKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlZGlyZWN0UG9saWN5KG5leHRQb2xpY3ksIG9wdGlvbnMsIG1heGltdW1SZXRyaWVzKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9CiAgICB2YXIgUmVkaXJlY3RQb2xpY3kgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CiAgICAgICAgX19leHRlbmRzKFJlZGlyZWN0UG9saWN5LCBfc3VwZXIpOwogICAgICAgIGZ1bmN0aW9uIFJlZGlyZWN0UG9saWN5KG5leHRQb2xpY3ksIG9wdGlvbnMsIG1heFJldHJpZXMpIHsKICAgICAgICAgICAgaWYgKG1heFJldHJpZXMgPT09IHZvaWQgMCkgeyBtYXhSZXRyaWVzID0gMjA7IH0KICAgICAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgbmV4dFBvbGljeSwgb3B0aW9ucykgfHwgdGhpczsKICAgICAgICAgICAgX3RoaXMubWF4UmV0cmllcyA9IG1heFJldHJpZXM7CiAgICAgICAgICAgIHJldHVybiBfdGhpczsKICAgICAgICB9CiAgICAgICAgUmVkaXJlY3RQb2xpY3kucHJvdG90eXBlLnNlbmRSZXF1ZXN0ID0gZnVuY3Rpb24gKHJlcXVlc3QpIHsKICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX25leHRQb2xpY3kuc2VuZFJlcXVlc3QocmVxdWVzdCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsgcmV0dXJuIGhhbmRsZVJlZGlyZWN0KF90aGlzLCByZXNwb25zZSwgMCk7IH0pOwogICAgICAgIH07CiAgICAgICAgcmV0dXJuIFJlZGlyZWN0UG9saWN5OwogICAgfShCYXNlUmVxdWVzdFBvbGljeSkpOwogICAgZnVuY3Rpb24gaGFuZGxlUmVkaXJlY3QocG9saWN5LCByZXNwb25zZSwgY3VycmVudFJldHJpZXMpIHsKICAgICAgICB2YXIgcmVxdWVzdCA9IHJlc3BvbnNlLnJlcXVlc3QsIHN0YXR1cyA9IHJlc3BvbnNlLnN0YXR1czsKICAgICAgICB2YXIgbG9jYXRpb25IZWFkZXIgPSByZXNwb25zZS5oZWFkZXJzLmdldCgibG9jYXRpb24iKTsKICAgICAgICBpZiAobG9jYXRpb25IZWFkZXIgJiYKICAgICAgICAgICAgKHN0YXR1cyA9PT0gMzAwIHx8IHN0YXR1cyA9PT0gMzA3IHx8IChzdGF0dXMgPT09IDMwMyAmJiByZXF1ZXN0Lm1ldGhvZCA9PT0gIlBPU1QiKSkgJiYKICAgICAgICAgICAgKCFwb2xpY3kubWF4UmV0cmllcyB8fCBjdXJyZW50UmV0cmllcyA8IHBvbGljeS5tYXhSZXRyaWVzKSkgewogICAgICAgICAgICB2YXIgYnVpbGRlciA9IFVSTEJ1aWxkZXIucGFyc2UocmVxdWVzdC51cmwpOwogICAgICAgICAgICBidWlsZGVyLnNldFBhdGgobG9jYXRpb25IZWFkZXIpOwogICAgICAgICAgICByZXF1ZXN0LnVybCA9IGJ1aWxkZXIudG9TdHJpbmcoKTsKICAgICAgICAgICAgLy8gUE9TVCByZXF1ZXN0IHdpdGggU3RhdHVzIGNvZGUgMzAzIHNob3VsZCBiZSBjb252ZXJ0ZWQgaW50byBhCiAgICAgICAgICAgIC8vIHJlZGlyZWN0ZWQgR0VUIHJlcXVlc3QgaWYgdGhlIHJlZGlyZWN0IHVybCBpcyBwcmVzZW50IGluIHRoZSBsb2NhdGlvbiBoZWFkZXIKICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gMzAzKSB7CiAgICAgICAgICAgICAgICByZXF1ZXN0Lm1ldGhvZCA9ICJHRVQiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBwb2xpY3kuX25leHRQb2xpY3kuc2VuZFJlcXVlc3QocmVxdWVzdCkKICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXMpIHsgcmV0dXJuIGhhbmRsZVJlZGlyZWN0KHBvbGljeSwgcmVzLCBjdXJyZW50UmV0cmllcyArIDEpOyB9KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShyZXNwb25zZSk7CiAgICB9CgogICAgZnVuY3Rpb24gcnBSZWdpc3RyYXRpb25Qb2xpY3kocmV0cnlUaW1lb3V0KSB7CiAgICAgICAgaWYgKHJldHJ5VGltZW91dCA9PT0gdm9pZCAwKSB7IHJldHJ5VGltZW91dCA9IDMwOyB9CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgY3JlYXRlOiBmdW5jdGlvbiAobmV4dFBvbGljeSwgb3B0aW9ucykgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSUFJlZ2lzdHJhdGlvblBvbGljeShuZXh0UG9saWN5LCBvcHRpb25zLCByZXRyeVRpbWVvdXQpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgIH0KICAgIHZhciBSUFJlZ2lzdHJhdGlvblBvbGljeSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKICAgICAgICBfX2V4dGVuZHMoUlBSZWdpc3RyYXRpb25Qb2xpY3ksIF9zdXBlcik7CiAgICAgICAgZnVuY3Rpb24gUlBSZWdpc3RyYXRpb25Qb2xpY3kobmV4dFBvbGljeSwgb3B0aW9ucywgX3JldHJ5VGltZW91dCkgewogICAgICAgICAgICBpZiAoX3JldHJ5VGltZW91dCA9PT0gdm9pZCAwKSB7IF9yZXRyeVRpbWVvdXQgPSAzMDsgfQogICAgICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBuZXh0UG9saWN5LCBvcHRpb25zKSB8fCB0aGlzOwogICAgICAgICAgICBfdGhpcy5fcmV0cnlUaW1lb3V0ID0gX3JldHJ5VGltZW91dDsKICAgICAgICAgICAgcmV0dXJuIF90aGlzOwogICAgICAgIH0KICAgICAgICBSUFJlZ2lzdHJhdGlvblBvbGljeS5wcm90b3R5cGUuc2VuZFJlcXVlc3QgPSBmdW5jdGlvbiAocmVxdWVzdCkgewogICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fbmV4dFBvbGljeS5zZW5kUmVxdWVzdChyZXF1ZXN0LmNsb25lKCkpCiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsgcmV0dXJuIHJlZ2lzdGVySWZOZWVkZWQoX3RoaXMsIHJlcXVlc3QsIHJlc3BvbnNlKTsgfSk7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gUlBSZWdpc3RyYXRpb25Qb2xpY3k7CiAgICB9KEJhc2VSZXF1ZXN0UG9saWN5KSk7CiAgICBmdW5jdGlvbiByZWdpc3RlcklmTmVlZGVkKHBvbGljeSwgcmVxdWVzdCwgcmVzcG9uc2UpIHsKICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgdmFyIHJwTmFtZSA9IGNoZWNrUlBOb3RSZWdpc3RlcmVkRXJyb3IocmVzcG9uc2UuYm9keUFzVGV4dCk7CiAgICAgICAgICAgIGlmIChycE5hbWUpIHsKICAgICAgICAgICAgICAgIHZhciB1cmxQcmVmaXggPSBleHRyYWN0U3Vic2NyaXB0aW9uVXJsKHJlcXVlc3QudXJsKTsKICAgICAgICAgICAgICAgIHJldHVybiByZWdpc3RlclJQKHBvbGljeSwgdXJsUHJlZml4LCBycE5hbWUsIHJlcXVlc3QpCiAgICAgICAgICAgICAgICAgICAgLy8gQXV0b3JlZ2lzdHJhdGlvbiBvZiAke3Byb3ZpZGVyfSBmYWlsZWQgZm9yIHNvbWUgcmVhc29uLiBXZSB3aWxsIG5vdCByZXR1cm4gdGhpcyBlcnJvcgogICAgICAgICAgICAgICAgICAgIC8vIGluc3RlYWQgd2lsbCByZXR1cm4gdGhlIGluaXRpYWwgcmVzcG9uc2Ugd2l0aCA0MDkgc3RhdHVzIGNvZGUgYmFjayB0byB0aGUgdXNlci4KICAgICAgICAgICAgICAgICAgICAvLyBkbyBub3RoaW5nIGhlcmUgYXMgd2UgYXJlIHJldHVybmluZyB0aGUgb3JpZ2luYWwgcmVzcG9uc2UgYXQgdGhlIGVuZCBvZiB0aGlzIG1ldGhvZC4KICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKCkgeyByZXR1cm4gZmFsc2U7IH0pCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlZ2lzdHJhdGlvblN0YXR1cykgewogICAgICAgICAgICAgICAgICAgIGlmIChyZWdpc3RyYXRpb25TdGF0dXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmV0cnkgdGhlIG9yaWdpbmFsIHJlcXVlc3QuIFdlIGhhdmUgdG8gY2hhbmdlIHRoZSB4LW1zLWNsaWVudC1yZXF1ZXN0LWlkCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG90aGVyd2lzZSBBenVyZSBlbmRwb2ludCB3aWxsIHJldHVybiB0aGUgaW5pdGlhbCA0MDkgKGNhY2hlZCkgcmVzcG9uc2UuCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuaGVhZGVycy5zZXQoIngtbXMtY2xpZW50LXJlcXVlc3QtaWQiLCBnZW5lcmF0ZVV1aWQoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwb2xpY3kuX25leHRQb2xpY3kuc2VuZFJlcXVlc3QocmVxdWVzdC5jbG9uZSgpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShyZXNwb25zZSk7CiAgICB9CiAgICAvKioKICAgICAqIFJldXNlcyB0aGUgaGVhZGVycyBvZiB0aGUgb3JpZ2luYWwgcmVxdWVzdCBhbmQgdXJsIChpZiBzcGVjaWZpZWQpLgogICAgICogQHBhcmFtIHtXZWJSZXNvdXJjZX0gb3JpZ2luYWxSZXF1ZXN0IFRoZSBvcmlnaW5hbCByZXF1ZXN0CiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IHJldXNlVXJsVG9vIFNob3VsZCB0aGUgdXJsIGZyb20gdGhlIG9yaWdpbmFsIHJlcXVlc3QgYmUgcmV1c2VkIGFzIHdlbGwuIERlZmF1bHQgZmFsc2UuCiAgICAgKiBAcmV0dXJucyB7b2JqZWN0fSBBIG5ldyByZXF1ZXN0IG9iamVjdCB3aXRoIGRlc2lyZWQgaGVhZGVycy4KICAgICAqLwogICAgZnVuY3Rpb24gZ2V0UmVxdWVzdEVzc2VudGlhbHMob3JpZ2luYWxSZXF1ZXN0LCByZXVzZVVybFRvbykgewogICAgICAgIGlmIChyZXVzZVVybFRvbyA9PT0gdm9pZCAwKSB7IHJldXNlVXJsVG9vID0gZmFsc2U7IH0KICAgICAgICB2YXIgcmVxT3B0aW9ucyA9IG9yaWdpbmFsUmVxdWVzdC5jbG9uZSgpOwogICAgICAgIGlmIChyZXVzZVVybFRvbykgewogICAgICAgICAgICByZXFPcHRpb25zLnVybCA9IG9yaWdpbmFsUmVxdWVzdC51cmw7CiAgICAgICAgfQogICAgICAgIC8vIFdlIGhhdmUgdG8gY2hhbmdlIHRoZSB4LW1zLWNsaWVudC1yZXF1ZXN0LWlkIG90aGVyd2lzZSBBenVyZSBlbmRwb2ludAogICAgICAgIC8vIHdpbGwgcmV0dXJuIHRoZSBpbml0aWFsIDQwOSAoY2FjaGVkKSByZXNwb25zZS4KICAgICAgICByZXFPcHRpb25zLmhlYWRlcnMuc2V0KCJ4LW1zLWNsaWVudC1yZXF1ZXN0LWlkIiwgZ2VuZXJhdGVVdWlkKCkpOwogICAgICAgIC8vIFNldCBjb250ZW50LXR5cGUgdG8gYXBwbGljYXRpb24vanNvbgogICAgICAgIHJlcU9wdGlvbnMuaGVhZGVycy5zZXQoIkNvbnRlbnQtVHlwZSIsICJhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04Iik7CiAgICAgICAgcmV0dXJuIHJlcU9wdGlvbnM7CiAgICB9CiAgICAvKioKICAgICAqIFZhbGlkYXRlcyB0aGUgZXJyb3IgY29kZSBhbmQgbWVzc2FnZSBhc3NvY2lhdGVkIHdpdGggNDA5IHJlc3BvbnNlIHN0YXR1cyBjb2RlLiBJZiBpdCBtYXRjaGVzIHRvIHRoYXQgb2YKICAgICAqIFJQIG5vdCByZWdpc3RlcmVkIHRoZW4gaXQgcmV0dXJucyB0aGUgbmFtZSBvZiB0aGUgUlAgZWxzZSByZXR1cm5zIHVuZGVmaW5lZC4KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBib2R5IFRoZSByZXNwb25zZSBib2R5IHJlY2VpdmVkIGFmdGVyIG1ha2luZyB0aGUgb3JpZ2luYWwgcmVxdWVzdC4KICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBuYW1lIG9mIHRoZSBSUCBpZiBjb25kaXRpb24gaXMgc2F0aXNmaWVkIGVsc2UgdW5kZWZpbmVkLgogICAgICovCiAgICBmdW5jdGlvbiBjaGVja1JQTm90UmVnaXN0ZXJlZEVycm9yKGJvZHkpIHsKICAgICAgICB2YXIgcmVzdWx0LCByZXNwb25zZUJvZHk7CiAgICAgICAgaWYgKGJvZHkpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJlc3BvbnNlQm9keSA9IEpTT04ucGFyc2UoYm9keSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgLy8gZG8gbm90aGluZzsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocmVzcG9uc2VCb2R5ICYmIHJlc3BvbnNlQm9keS5lcnJvciAmJiByZXNwb25zZUJvZHkuZXJyb3IubWVzc2FnZSAmJgogICAgICAgICAgICAgICAgcmVzcG9uc2VCb2R5LmVycm9yLmNvZGUgJiYgcmVzcG9uc2VCb2R5LmVycm9yLmNvZGUgPT09ICJNaXNzaW5nU3Vic2NyaXB0aW9uUmVnaXN0cmF0aW9uIikgewogICAgICAgICAgICAgICAgdmFyIG1hdGNoUmVzID0gcmVzcG9uc2VCb2R5LmVycm9yLm1lc3NhZ2UubWF0Y2goLy4qJyguKiknL2kpOwogICAgICAgICAgICAgICAgaWYgKG1hdGNoUmVzKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gbWF0Y2hSZXMucG9wKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogRXh0cmFjdHMgdGhlIGZpcnN0IHBhcnQgb2YgdGhlIFVSTCwganVzdCBhZnRlciBzdWJzY3JpcHRpb246CiAgICAgKiBodHRwczovL21hbmFnZW1lbnQuYXp1cmUuY29tL3N1YnNjcmlwdGlvbnMvMDAwMDAwMDAtMDAwMC0wMDAwLTAwMDAtMDAwMDAwMDAwMDAwLwogICAgICogQHBhcmFtIHtzdHJpbmd9IHVybCBUaGUgb3JpZ2luYWwgcmVxdWVzdCB1cmwKICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IFRoZSB1cmwgcHJlZml4IGFzIGV4cGxhaW5lZCBhYm92ZS4KICAgICAqLwogICAgZnVuY3Rpb24gZXh0cmFjdFN1YnNjcmlwdGlvblVybCh1cmwpIHsKICAgICAgICB2YXIgcmVzdWx0OwogICAgICAgIHZhciBtYXRjaFJlcyA9IHVybC5tYXRjaCgvLipcL3N1YnNjcmlwdGlvbnNcL1thLWYwLTktXStcLy9pZyk7CiAgICAgICAgaWYgKG1hdGNoUmVzICYmIG1hdGNoUmVzWzBdKSB7CiAgICAgICAgICAgIHJlc3VsdCA9IG1hdGNoUmVzWzBdOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmFibGUgdG8gZXh0cmFjdCBzdWJzY3JpcHRpb25JZCBmcm9tIHRoZSBnaXZlbiB1cmwgLSAiICsgdXJsICsgIi4iKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogUmVnaXN0ZXJzIHRoZSBnaXZlbiBwcm92aWRlci4KICAgICAqIEBwYXJhbSB7UlBSZWdpc3RyYXRpb25Qb2xpY3l9IHBvbGljeSBUaGUgUlBSZWdpc3RyYXRpb25Qb2xpY3kgdGhpcyBmdW5jdGlvbiBpcyBiZWluZyBjYWxsZWQgYWdhaW5zdC4KICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cmxQcmVmaXggaHR0cHM6Ly9tYW5hZ2VtZW50LmF6dXJlLmNvbS9zdWJzY3JpcHRpb25zLzAwMDAwMDAwLTAwMDAtMDAwMC0wMDAwLTAwMDAwMDAwMDAwMC8KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBwcm92aWRlciBUaGUgcHJvdmlkZXIgbmFtZSB0byBiZSByZWdpc3RlcmVkLgogICAgICogQHBhcmFtIHtXZWJSZXNvdXJjZX0gb3JpZ2luYWxSZXF1ZXN0IFRoZSBvcmlnaW5hbCByZXF1ZXN0IHNlbnQgYnkgdGhlIHVzZXIgdGhhdCByZXR1cm5lZCBhIDQwOSByZXNwb25zZQogICAgICogd2l0aCBhIG1lc3NhZ2UgdGhhdCB0aGUgcHJvdmlkZXIgaXMgbm90IHJlZ2lzdGVyZWQuCiAgICAgKiBAcGFyYW0ge3JlZ2lzdHJhdGlvbkNhbGxiYWNrfSBjYWxsYmFjayBUaGUgY2FsbGJhY2sgdGhhdCBoYW5kbGVzIHRoZSBSUCByZWdpc3RyYXRpb24KICAgICAqLwogICAgZnVuY3Rpb24gcmVnaXN0ZXJSUChwb2xpY3ksIHVybFByZWZpeCwgcHJvdmlkZXIsIG9yaWdpbmFsUmVxdWVzdCkgewogICAgICAgIHZhciBwb3N0VXJsID0gdXJsUHJlZml4ICsgInByb3ZpZGVycy8iICsgcHJvdmlkZXIgKyAiL3JlZ2lzdGVyP2FwaS12ZXJzaW9uPTIwMTYtMDItMDEiOwogICAgICAgIHZhciBnZXRVcmwgPSB1cmxQcmVmaXggKyAicHJvdmlkZXJzLyIgKyBwcm92aWRlciArICI/YXBpLXZlcnNpb249MjAxNi0wMi0wMSI7CiAgICAgICAgdmFyIHJlcU9wdGlvbnMgPSBnZXRSZXF1ZXN0RXNzZW50aWFscyhvcmlnaW5hbFJlcXVlc3QpOwogICAgICAgIHJlcU9wdGlvbnMubWV0aG9kID0gIlBPU1QiOwogICAgICAgIHJlcU9wdGlvbnMudXJsID0gcG9zdFVybDsKICAgICAgICByZXR1cm4gcG9saWN5Ll9uZXh0UG9saWN5LnNlbmRSZXF1ZXN0KHJlcU9wdGlvbnMpCiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQXV0b3JlZ2lzdHJhdGlvbiBvZiAiICsgcHJvdmlkZXIgKyAiIGZhaWxlZC4gUGxlYXNlIHRyeSByZWdpc3RlcmluZyBtYW51YWxseS4iKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZ2V0UmVnaXN0cmF0aW9uU3RhdHVzKHBvbGljeSwgZ2V0VXJsLCBvcmlnaW5hbFJlcXVlc3QpOwogICAgICAgIH0pOwogICAgfQogICAgLyoqCiAgICAgKiBQb2xscyB0aGUgcmVnaXN0cmF0aW9uIHN0YXR1cyBvZiB0aGUgcHJvdmlkZXIgdGhhdCB3YXMgcmVnaXN0ZXJlZC4gUG9sbGluZyBoYXBwZW5zIGF0IGFuIGludGVydmFsIG9mIDMwIHNlY29uZHMuCiAgICAgKiBQb2xsaW5nIHdpbGwgaGFwcGVuIHRpbGwgdGhlIHJlZ2lzdHJhdGlvblN0YXRlIHByb3BlcnR5IG9mIHRoZSByZXNwb25zZSBib2R5IGlzICJSZWdpc3RlcmVkIi4KICAgICAqIEBwYXJhbSB7UlBSZWdpc3RyYXRpb25Qb2xpY3l9IHBvbGljeSBUaGUgUlBSZWdpc3RyYXRpb25Qb2xpY3kgdGhpcyBmdW5jdGlvbiBpcyBiZWluZyBjYWxsZWQgYWdhaW5zdC4KICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgVGhlIHJlcXVlc3QgdXJsIGZvciBwb2xsaW5nCiAgICAgKiBAcGFyYW0ge1dlYlJlc291cmNlfSBvcmlnaW5hbFJlcXVlc3QgVGhlIG9yaWdpbmFsIHJlcXVlc3Qgc2VudCBieSB0aGUgdXNlciB0aGF0IHJldHVybmVkIGEgNDA5IHJlc3BvbnNlCiAgICAgKiB3aXRoIGEgbWVzc2FnZSB0aGF0IHRoZSBwcm92aWRlciBpcyBub3QgcmVnaXN0ZXJlZC4KICAgICAqIEByZXR1cm5zIHtQcm9taXNlPGJvb2xlYW4+fSBUcnVlIGlmIFJQIFJlZ2lzdHJhdGlvbiBpcyBzdWNjZXNzZnVsLgogICAgICovCiAgICBmdW5jdGlvbiBnZXRSZWdpc3RyYXRpb25TdGF0dXMocG9saWN5LCB1cmwsIG9yaWdpbmFsUmVxdWVzdCkgewogICAgICAgIHZhciByZXFPcHRpb25zID0gZ2V0UmVxdWVzdEVzc2VudGlhbHMob3JpZ2luYWxSZXF1ZXN0KTsKICAgICAgICByZXFPcHRpb25zLnVybCA9IHVybDsKICAgICAgICByZXFPcHRpb25zLm1ldGhvZCA9ICJHRVQiOwogICAgICAgIHJldHVybiBwb2xpY3kuX25leHRQb2xpY3kuc2VuZFJlcXVlc3QocmVxT3B0aW9ucykudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgIHZhciBvYmogPSByZXMucGFyc2VkQm9keTsKICAgICAgICAgICAgaWYgKHJlcy5wYXJzZWRCb2R5ICYmIG9iai5yZWdpc3RyYXRpb25TdGF0ZSAmJiBvYmoucmVnaXN0cmF0aW9uU3RhdGUgPT09ICJSZWdpc3RlcmVkIikgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZGVsYXkocG9saWN5Ll9yZXRyeVRpbWVvdXQgKiAxMDAwKS50aGVuKGZ1bmN0aW9uICgpIHsgcmV0dXJuIGdldFJlZ2lzdHJhdGlvblN0YXR1cyhwb2xpY3ksIHVybCwgb3JpZ2luYWxSZXF1ZXN0KTsgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KCiAgICAvLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICAgIGZ1bmN0aW9uIHNpZ25pbmdQb2xpY3koYXV0aGVudGljYXRpb25Qcm92aWRlcikgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGNyZWF0ZTogZnVuY3Rpb24gKG5leHRQb2xpY3ksIG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU2lnbmluZ1BvbGljeShuZXh0UG9saWN5LCBvcHRpb25zLCBhdXRoZW50aWNhdGlvblByb3ZpZGVyKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9CiAgICB2YXIgU2lnbmluZ1BvbGljeSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKICAgICAgICBfX2V4dGVuZHMoU2lnbmluZ1BvbGljeSwgX3N1cGVyKTsKICAgICAgICBmdW5jdGlvbiBTaWduaW5nUG9saWN5KG5leHRQb2xpY3ksIG9wdGlvbnMsIGF1dGhlbnRpY2F0aW9uUHJvdmlkZXIpIHsKICAgICAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgbmV4dFBvbGljeSwgb3B0aW9ucykgfHwgdGhpczsKICAgICAgICAgICAgX3RoaXMuYXV0aGVudGljYXRpb25Qcm92aWRlciA9IGF1dGhlbnRpY2F0aW9uUHJvdmlkZXI7CiAgICAgICAgICAgIHJldHVybiBfdGhpczsKICAgICAgICB9CiAgICAgICAgU2lnbmluZ1BvbGljeS5wcm90b3R5cGUuc2lnblJlcXVlc3QgPSBmdW5jdGlvbiAocmVxdWVzdCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5hdXRoZW50aWNhdGlvblByb3ZpZGVyLnNpZ25SZXF1ZXN0KHJlcXVlc3QpOwogICAgICAgIH07CiAgICAgICAgU2lnbmluZ1BvbGljeS5wcm90b3R5cGUuc2VuZFJlcXVlc3QgPSBmdW5jdGlvbiAocmVxdWVzdCkgewogICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICAgICAgICByZXR1cm4gdGhpcy5zaWduUmVxdWVzdChyZXF1ZXN0KS50aGVuKGZ1bmN0aW9uIChuZXh0UmVxdWVzdCkgeyByZXR1cm4gX3RoaXMuX25leHRQb2xpY3kuc2VuZFJlcXVlc3QobmV4dFJlcXVlc3QpOyB9KTsKICAgICAgICB9OwogICAgICAgIHJldHVybiBTaWduaW5nUG9saWN5OwogICAgfShCYXNlUmVxdWVzdFBvbGljeSkpOwoKICAgIC8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogICAgZnVuY3Rpb24gc3lzdGVtRXJyb3JSZXRyeVBvbGljeShyZXRyeUNvdW50LCByZXRyeUludGVydmFsLCBtaW5SZXRyeUludGVydmFsLCBtYXhSZXRyeUludGVydmFsKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgY3JlYXRlOiBmdW5jdGlvbiAobmV4dFBvbGljeSwgb3B0aW9ucykgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTeXN0ZW1FcnJvclJldHJ5UG9saWN5KG5leHRQb2xpY3ksIG9wdGlvbnMsIHJldHJ5Q291bnQsIHJldHJ5SW50ZXJ2YWwsIG1pblJldHJ5SW50ZXJ2YWwsIG1heFJldHJ5SW50ZXJ2YWwpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgIH0KICAgIC8qKgogICAgICogQGNsYXNzCiAgICAgKiBJbnN0YW50aWF0ZXMgYSBuZXcgIkV4cG9uZW50aWFsUmV0cnlQb2xpY3lGaWx0ZXIiIGluc3RhbmNlLgogICAgICoKICAgICAqIEBjb25zdHJ1Y3RvcgogICAgICogQHBhcmFtIHtudW1iZXJ9IHJldHJ5Q291bnQgICAgICAgIFRoZSBjbGllbnQgcmV0cnkgY291bnQuCiAgICAgKiBAcGFyYW0ge251bWJlcn0gcmV0cnlJbnRlcnZhbCAgICAgVGhlIGNsaWVudCByZXRyeSBpbnRlcnZhbCwgaW4gbWlsbGlzZWNvbmRzLgogICAgICogQHBhcmFtIHtudW1iZXJ9IG1pblJldHJ5SW50ZXJ2YWwgIFRoZSBtaW5pbXVtIHJldHJ5IGludGVydmFsLCBpbiBtaWxsaXNlY29uZHMuCiAgICAgKiBAcGFyYW0ge251bWJlcn0gbWF4UmV0cnlJbnRlcnZhbCAgVGhlIG1heGltdW0gcmV0cnkgaW50ZXJ2YWwsIGluIG1pbGxpc2Vjb25kcy4KICAgICAqLwogICAgdmFyIFN5c3RlbUVycm9yUmV0cnlQb2xpY3kgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CiAgICAgICAgX19leHRlbmRzKFN5c3RlbUVycm9yUmV0cnlQb2xpY3ksIF9zdXBlcik7CiAgICAgICAgZnVuY3Rpb24gU3lzdGVtRXJyb3JSZXRyeVBvbGljeShuZXh0UG9saWN5LCBvcHRpb25zLCByZXRyeUNvdW50LCByZXRyeUludGVydmFsLCBtaW5SZXRyeUludGVydmFsLCBtYXhSZXRyeUludGVydmFsKSB7CiAgICAgICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIG5leHRQb2xpY3ksIG9wdGlvbnMpIHx8IHRoaXM7CiAgICAgICAgICAgIF90aGlzLkRFRkFVTFRfQ0xJRU5UX1JFVFJZX0lOVEVSVkFMID0gMTAwMCAqIDMwOwogICAgICAgICAgICBfdGhpcy5ERUZBVUxUX0NMSUVOVF9SRVRSWV9DT1VOVCA9IDM7CiAgICAgICAgICAgIF90aGlzLkRFRkFVTFRfQ0xJRU5UX01BWF9SRVRSWV9JTlRFUlZBTCA9IDEwMDAgKiA5MDsKICAgICAgICAgICAgX3RoaXMuREVGQVVMVF9DTElFTlRfTUlOX1JFVFJZX0lOVEVSVkFMID0gMTAwMCAqIDM7CiAgICAgICAgICAgIF90aGlzLnJldHJ5Q291bnQgPSB0eXBlb2YgcmV0cnlDb3VudCA9PT0gIm51bWJlciIgPyByZXRyeUNvdW50IDogX3RoaXMuREVGQVVMVF9DTElFTlRfUkVUUllfQ09VTlQ7CiAgICAgICAgICAgIF90aGlzLnJldHJ5SW50ZXJ2YWwgPSB0eXBlb2YgcmV0cnlJbnRlcnZhbCA9PT0gIm51bWJlciIgPyByZXRyeUludGVydmFsIDogX3RoaXMuREVGQVVMVF9DTElFTlRfUkVUUllfSU5URVJWQUw7CiAgICAgICAgICAgIF90aGlzLm1pblJldHJ5SW50ZXJ2YWwgPSB0eXBlb2YgbWluUmV0cnlJbnRlcnZhbCA9PT0gIm51bWJlciIgPyBtaW5SZXRyeUludGVydmFsIDogX3RoaXMuREVGQVVMVF9DTElFTlRfTUlOX1JFVFJZX0lOVEVSVkFMOwogICAgICAgICAgICBfdGhpcy5tYXhSZXRyeUludGVydmFsID0gdHlwZW9mIG1heFJldHJ5SW50ZXJ2YWwgPT09ICJudW1iZXIiID8gbWF4UmV0cnlJbnRlcnZhbCA6IF90aGlzLkRFRkFVTFRfQ0xJRU5UX01BWF9SRVRSWV9JTlRFUlZBTDsKICAgICAgICAgICAgcmV0dXJuIF90aGlzOwogICAgICAgIH0KICAgICAgICBTeXN0ZW1FcnJvclJldHJ5UG9saWN5LnByb3RvdHlwZS5zZW5kUmVxdWVzdCA9IGZ1bmN0aW9uIChyZXF1ZXN0KSB7CiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9uZXh0UG9saWN5LnNlbmRSZXF1ZXN0KHJlcXVlc3QuY2xvbmUoKSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsgcmV0dXJuIHJldHJ5JDEoX3RoaXMsIHJlcXVlc3QsIHJlc3BvbnNlKTsgfSk7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gU3lzdGVtRXJyb3JSZXRyeVBvbGljeTsKICAgIH0oQmFzZVJlcXVlc3RQb2xpY3kpKTsKICAgIC8qKgogICAgICogRGV0ZXJtaW5lcyBpZiB0aGUgb3BlcmF0aW9uIHNob3VsZCBiZSByZXRyaWVkIGFuZCBob3cgbG9uZyB0byB3YWl0IHVudGlsIHRoZSBuZXh0IHJldHJ5LgogICAgICoKICAgICAqIEBwYXJhbSB7bnVtYmVyfSBzdGF0dXNDb2RlIFRoZSBIVFRQIHN0YXR1cyBjb2RlLgogICAgICogQHBhcmFtIHtSZXRyeURhdGF9IHJldHJ5RGF0YSAgVGhlIHJldHJ5IGRhdGEuCiAgICAgKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIHRoZSBvcGVyYXRpb24gcXVhbGlmaWVzIGZvciBhIHJldHJ5OyBmYWxzZSBvdGhlcndpc2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNob3VsZFJldHJ5JDEocG9saWN5LCByZXRyeURhdGEpIHsKICAgICAgICB2YXIgY3VycmVudENvdW50OwogICAgICAgIGlmICghcmV0cnlEYXRhKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigicmV0cnlEYXRhIGZvciB0aGUgU3lzdGVtRXJyb3JSZXRyeVBvbGljeUZpbHRlciBjYW5ub3QgYmUgbnVsbC4iKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGN1cnJlbnRDb3VudCA9IChyZXRyeURhdGEgJiYgcmV0cnlEYXRhLnJldHJ5Q291bnQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gKGN1cnJlbnRDb3VudCA8IHBvbGljeS5yZXRyeUNvdW50KTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyB0aGUgcmV0cnkgZGF0YSBmb3IgdGhlIG5leHQgYXR0ZW1wdC4KICAgICAqCiAgICAgKiBAcGFyYW0ge1JldHJ5RGF0YX0gcmV0cnlEYXRhICBUaGUgcmV0cnkgZGF0YS4KICAgICAqIEBwYXJhbSB7b2JqZWN0fSBlcnIgICAgICAgIFRoZSBvcGVyYXRpb24icyBlcnJvciwgaWYgYW55LgogICAgICovCiAgICBmdW5jdGlvbiB1cGRhdGVSZXRyeURhdGEkMShwb2xpY3ksIHJldHJ5RGF0YSwgZXJyKSB7CiAgICAgICAgaWYgKCFyZXRyeURhdGEpIHsKICAgICAgICAgICAgcmV0cnlEYXRhID0gewogICAgICAgICAgICAgICAgcmV0cnlDb3VudDogMCwKICAgICAgICAgICAgICAgIHJldHJ5SW50ZXJ2YWw6IDAKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgaWYgKGVycikgewogICAgICAgICAgICBpZiAocmV0cnlEYXRhLmVycm9yKSB7CiAgICAgICAgICAgICAgICBlcnIuaW5uZXJFcnJvciA9IHJldHJ5RGF0YS5lcnJvcjsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXRyeURhdGEuZXJyb3IgPSBlcnI7CiAgICAgICAgfQogICAgICAgIC8vIEFkanVzdCByZXRyeSBjb3VudAogICAgICAgIHJldHJ5RGF0YS5yZXRyeUNvdW50Kys7CiAgICAgICAgLy8gQWRqdXN0IHJldHJ5IGludGVydmFsCiAgICAgICAgdmFyIGluY3JlbWVudERlbHRhID0gTWF0aC5wb3coMiwgcmV0cnlEYXRhLnJldHJ5Q291bnQpIC0gMTsKICAgICAgICB2YXIgYm91bmRlZFJhbmREZWx0YSA9IHBvbGljeS5yZXRyeUludGVydmFsICogMC44ICsKICAgICAgICAgICAgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKHBvbGljeS5yZXRyeUludGVydmFsICogMS4yIC0gcG9saWN5LnJldHJ5SW50ZXJ2YWwgKiAwLjgpKTsKICAgICAgICBpbmNyZW1lbnREZWx0YSAqPSBib3VuZGVkUmFuZERlbHRhOwogICAgICAgIHJldHJ5RGF0YS5yZXRyeUludGVydmFsID0gTWF0aC5taW4ocG9saWN5Lm1pblJldHJ5SW50ZXJ2YWwgKyBpbmNyZW1lbnREZWx0YSwgcG9saWN5Lm1heFJldHJ5SW50ZXJ2YWwpOwogICAgICAgIHJldHVybiByZXRyeURhdGE7CiAgICB9CiAgICBmdW5jdGlvbiByZXRyeSQxKHBvbGljeSwgcmVxdWVzdCwgb3BlcmF0aW9uUmVzcG9uc2UsIHJldHJ5RGF0YSwgZXJyKSB7CiAgICAgICAgcmV0cnlEYXRhID0gdXBkYXRlUmV0cnlEYXRhJDEocG9saWN5LCByZXRyeURhdGEsIGVycik7CiAgICAgICAgaWYgKGVyciAmJiBlcnIuY29kZSAmJiBzaG91bGRSZXRyeSQxKHBvbGljeSwgcmV0cnlEYXRhKSAmJgogICAgICAgICAgICAoZXJyLmNvZGUgPT09ICJFVElNRURPVVQiIHx8IGVyci5jb2RlID09PSAiRVNPQ0tFVFRJTUVET1VUIiB8fCBlcnIuY29kZSA9PT0gIkVDT05OUkVGVVNFRCIgfHwKICAgICAgICAgICAgICAgIGVyci5jb2RlID09PSAiRUNPTk5SRVNFVCIgfHwgZXJyLmNvZGUgPT09ICJFTk9FTlQiKSkgewogICAgICAgICAgICAvLyBJZiBwcmV2aW91cyBvcGVyYXRpb24gZW5kZWQgd2l0aCBhbiBlcnJvciBhbmQgdGhlIHBvbGljeSBhbGxvd3MgYSByZXRyeSwgZG8gdGhhdAogICAgICAgICAgICByZXR1cm4gZGVsYXkocmV0cnlEYXRhLnJldHJ5SW50ZXJ2YWwpCiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7IHJldHVybiBwb2xpY3kuX25leHRQb2xpY3kuc2VuZFJlcXVlc3QocmVxdWVzdC5jbG9uZSgpKTsgfSkKICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXMpIHsgcmV0dXJuIHJldHJ5JDEocG9saWN5LCByZXF1ZXN0LCByZXMsIHJldHJ5RGF0YSwgZXJyKTsgfSkKICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyKSB7IHJldHVybiByZXRyeSQxKHBvbGljeSwgcmVxdWVzdCwgb3BlcmF0aW9uUmVzcG9uc2UsIHJldHJ5RGF0YSwgZXJyKTsgfSk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBpZiAoZXJyICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgLy8gSWYgdGhlIG9wZXJhdGlvbiBmYWlsZWQgaW4gdGhlIGVuZCwgcmV0dXJuIGFsbCBlcnJvcnMgaW5zdGVhZCBvZiBqdXN0IHRoZSBsYXN0IG9uZQogICAgICAgICAgICAgICAgZXJyID0gcmV0cnlEYXRhLmVycm9yOwogICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShvcGVyYXRpb25SZXNwb25zZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogICAgLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi4KICAgIC8qKgogICAgICogVGhlIGZvcm1hdCB0aGF0IHdpbGwgYmUgdXNlZCB0byBqb2luIGFuIGFycmF5IG9mIHZhbHVlcyB0b2dldGhlciBmb3IgYSBxdWVyeSBwYXJhbWV0ZXIgdmFsdWUuCiAgICAgKi8KICAgIHZhciBRdWVyeUNvbGxlY3Rpb25Gb3JtYXQ7CiAgICAoZnVuY3Rpb24gKFF1ZXJ5Q29sbGVjdGlvbkZvcm1hdCkgewogICAgICAgIFF1ZXJ5Q29sbGVjdGlvbkZvcm1hdFsiQ3N2Il0gPSAiLCI7CiAgICAgICAgUXVlcnlDb2xsZWN0aW9uRm9ybWF0WyJTc3YiXSA9ICIgIjsKICAgICAgICBRdWVyeUNvbGxlY3Rpb25Gb3JtYXRbIlRzdiJdID0gIlx0IjsKICAgICAgICBRdWVyeUNvbGxlY3Rpb25Gb3JtYXRbIlBpcGVzIl0gPSAifCI7CiAgICAgICAgUXVlcnlDb2xsZWN0aW9uRm9ybWF0WyJNdWx0aSJdID0gIk11bHRpIjsKICAgIH0pKFF1ZXJ5Q29sbGVjdGlvbkZvcm1hdCB8fCAoUXVlcnlDb2xsZWN0aW9uRm9ybWF0ID0ge30pKTsKCiAgICAvLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICAgIGZ1bmN0aW9uIGxvYWRFbnZpcm9ubWVudFByb3h5VmFsdWUoKSB7CiAgICAgICAgaWYgKCFwcm9jZXNzKSB7CiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgfQogICAgICAgIGlmIChwcm9jZXNzLmVudltDb25zdGFudHMuSFRUUFNfUFJPWFldKSB7CiAgICAgICAgICAgIHJldHVybiBwcm9jZXNzLmVudltDb25zdGFudHMuSFRUUFNfUFJPWFldOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChwcm9jZXNzLmVudltDb25zdGFudHMuSFRUUFNfUFJPWFkudG9Mb3dlckNhc2UoKV0pIHsKICAgICAgICAgICAgcmV0dXJuIHByb2Nlc3MuZW52W0NvbnN0YW50cy5IVFRQU19QUk9YWS50b0xvd2VyQ2FzZSgpXTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAocHJvY2Vzcy5lbnZbQ29uc3RhbnRzLkhUVFBfUFJPWFldKSB7CiAgICAgICAgICAgIHJldHVybiBwcm9jZXNzLmVudltDb25zdGFudHMuSFRUUF9QUk9YWV07CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKHByb2Nlc3MuZW52W0NvbnN0YW50cy5IVFRQX1BST1hZLnRvTG93ZXJDYXNlKCldKSB7CiAgICAgICAgICAgIHJldHVybiBwcm9jZXNzLmVudltDb25zdGFudHMuSFRUUF9QUk9YWS50b0xvd2VyQ2FzZSgpXTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgIH0KICAgIGZ1bmN0aW9uIGdldERlZmF1bHRQcm94eVNldHRpbmdzKHByb3h5VXJsKSB7CiAgICAgICAgaWYgKCFwcm94eVVybCkgewogICAgICAgICAgICBwcm94eVVybCA9IGxvYWRFbnZpcm9ubWVudFByb3h5VmFsdWUoKTsKICAgICAgICAgICAgaWYgKCFwcm94eVVybCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB2YXIgcGFyc2VkVXJsID0gVVJMQnVpbGRlci5wYXJzZShwcm94eVVybCk7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgaG9zdDogcGFyc2VkVXJsLmdldFNjaGVtZSgpICsgIjovLyIgKyBwYXJzZWRVcmwuZ2V0SG9zdCgpLAogICAgICAgICAgICBwb3J0OiBOdW1iZXIucGFyc2VJbnQocGFyc2VkVXJsLmdldFBvcnQoKSB8fCAiODAiKQogICAgICAgIH07CiAgICB9CiAgICBmdW5jdGlvbiBwcm94eVBvbGljeShwcm94eVNldHRpbmdzKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgY3JlYXRlOiBmdW5jdGlvbiAobmV4dFBvbGljeSwgb3B0aW9ucykgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm94eVBvbGljeShuZXh0UG9saWN5LCBvcHRpb25zLCBwcm94eVNldHRpbmdzKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9CiAgICB2YXIgUHJveHlQb2xpY3kgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CiAgICAgICAgX19leHRlbmRzKFByb3h5UG9saWN5LCBfc3VwZXIpOwogICAgICAgIGZ1bmN0aW9uIFByb3h5UG9saWN5KG5leHRQb2xpY3ksIG9wdGlvbnMsIHByb3h5U2V0dGluZ3MpIHsKICAgICAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgbmV4dFBvbGljeSwgb3B0aW9ucykgfHwgdGhpczsKICAgICAgICAgICAgX3RoaXMucHJveHlTZXR0aW5ncyA9IHByb3h5U2V0dGluZ3M7CiAgICAgICAgICAgIHJldHVybiBfdGhpczsKICAgICAgICB9CiAgICAgICAgUHJveHlQb2xpY3kucHJvdG90eXBlLnNlbmRSZXF1ZXN0ID0gZnVuY3Rpb24gKHJlcXVlc3QpIHsKICAgICAgICAgICAgaWYgKCFyZXF1ZXN0LnByb3h5U2V0dGluZ3MpIHsKICAgICAgICAgICAgICAgIHJlcXVlc3QucHJveHlTZXR0aW5ncyA9IHRoaXMucHJveHlTZXR0aW5nczsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpcy5fbmV4dFBvbGljeS5zZW5kUmVxdWVzdChyZXF1ZXN0KTsKICAgICAgICB9OwogICAgICAgIHJldHVybiBQcm94eVBvbGljeTsKICAgIH0oQmFzZVJlcXVlc3RQb2xpY3kpKTsKCiAgICAvLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICAgIHZhciBTdGF0dXNDb2RlcyA9IENvbnN0YW50cy5IdHRwQ29uc3RhbnRzLlN0YXR1c0NvZGVzOwogICAgZnVuY3Rpb24gdGhyb3R0bGluZ1JldHJ5UG9saWN5KCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGNyZWF0ZTogZnVuY3Rpb24gKG5leHRQb2xpY3ksIG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgVGhyb3R0bGluZ1JldHJ5UG9saWN5KG5leHRQb2xpY3ksIG9wdGlvbnMpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgIH0KICAgIC8qKgogICAgICogVG8gbGVhcm4gbW9yZSwgcGxlYXNlIHJlZmVyIHRvCiAgICAgKiBodHRwczovL2RvY3MubWljcm9zb2Z0LmNvbS9lbi11cy9henVyZS9henVyZS1yZXNvdXJjZS1tYW5hZ2VyL3Jlc291cmNlLW1hbmFnZXItcmVxdWVzdC1saW1pdHMsCiAgICAgKiBodHRwczovL2RvY3MubWljcm9zb2Z0LmNvbS9lbi11cy9henVyZS9henVyZS1zdWJzY3JpcHRpb24tc2VydmljZS1saW1pdHMgYW5kCiAgICAgKiBodHRwczovL2RvY3MubWljcm9zb2Z0LmNvbS9lbi11cy9henVyZS92aXJ0dWFsLW1hY2hpbmVzL3Ryb3VibGVzaG9vdGluZy90cm91Ymxlc2hvb3RpbmctdGhyb3R0bGluZy1lcnJvcnMKICAgICAqLwogICAgdmFyIFRocm90dGxpbmdSZXRyeVBvbGljeSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKICAgICAgICBfX2V4dGVuZHMoVGhyb3R0bGluZ1JldHJ5UG9saWN5LCBfc3VwZXIpOwogICAgICAgIGZ1bmN0aW9uIFRocm90dGxpbmdSZXRyeVBvbGljeShuZXh0UG9saWN5LCBvcHRpb25zLCBfaGFuZGxlUmVzcG9uc2UpIHsKICAgICAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgbmV4dFBvbGljeSwgb3B0aW9ucykgfHwgdGhpczsKICAgICAgICAgICAgX3RoaXMuX2hhbmRsZVJlc3BvbnNlID0gX2hhbmRsZVJlc3BvbnNlIHx8IF90aGlzLl9kZWZhdWx0UmVzcG9uc2VIYW5kbGVyOwogICAgICAgICAgICByZXR1cm4gX3RoaXM7CiAgICAgICAgfQogICAgICAgIFRocm90dGxpbmdSZXRyeVBvbGljeS5wcm90b3R5cGUuc2VuZFJlcXVlc3QgPSBmdW5jdGlvbiAoaHR0cFJlcXVlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgdGhpcy5fbmV4dFBvbGljeS5zZW5kUmVxdWVzdChodHRwUmVxdWVzdC5jbG9uZSgpKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gU3RhdHVzQ29kZXMuVG9vTWFueVJlcXVlc3RzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLl9oYW5kbGVSZXNwb25zZShodHRwUmVxdWVzdCwgcmVzcG9uc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KV07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICBUaHJvdHRsaW5nUmV0cnlQb2xpY3kucHJvdG90eXBlLl9kZWZhdWx0UmVzcG9uc2VIYW5kbGVyID0gZnVuY3Rpb24gKGh0dHBSZXF1ZXN0LCBodHRwUmVzcG9uc2UpIHsKICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIHJldHJ5QWZ0ZXJIZWFkZXIsIGRlbGF5SW5NczsKICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0cnlBZnRlckhlYWRlciA9IGh0dHBSZXNwb25zZS5oZWFkZXJzLmdldChDb25zdGFudHMuSGVhZGVyQ29uc3RhbnRzLlJFVFJZX0FGVEVSKTsKICAgICAgICAgICAgICAgICAgICBpZiAocmV0cnlBZnRlckhlYWRlcikgewogICAgICAgICAgICAgICAgICAgICAgICBkZWxheUluTXMgPSBUaHJvdHRsaW5nUmV0cnlQb2xpY3kucGFyc2VSZXRyeUFmdGVySGVhZGVyKHJldHJ5QWZ0ZXJIZWFkZXIpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGVsYXlJbk1zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgZGVsYXkoZGVsYXlJbk1zKS50aGVuKGZ1bmN0aW9uIChfKSB7IHJldHVybiBfdGhpcy5fbmV4dFBvbGljeS5zZW5kUmVxdWVzdChodHRwUmVxdWVzdCk7IH0pXTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgaHR0cFJlc3BvbnNlXTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICAgIFRocm90dGxpbmdSZXRyeVBvbGljeS5wYXJzZVJldHJ5QWZ0ZXJIZWFkZXIgPSBmdW5jdGlvbiAoaGVhZGVyVmFsdWUpIHsKICAgICAgICAgICAgdmFyIHJldHJ5QWZ0ZXJJblNlY29uZHMgPSBOdW1iZXIoaGVhZGVyVmFsdWUpOwogICAgICAgICAgICBpZiAoTnVtYmVyLmlzTmFOKHJldHJ5QWZ0ZXJJblNlY29uZHMpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gVGhyb3R0bGluZ1JldHJ5UG9saWN5LnBhcnNlRGF0ZVJldHJ5QWZ0ZXJIZWFkZXIoaGVhZGVyVmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIHJldHJ5QWZ0ZXJJblNlY29uZHMgKiAxMDAwOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBUaHJvdHRsaW5nUmV0cnlQb2xpY3kucGFyc2VEYXRlUmV0cnlBZnRlckhlYWRlciA9IGZ1bmN0aW9uIChoZWFkZXJWYWx1ZSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdmFyIG5vdyA9IERhdGUubm93KCk7CiAgICAgICAgICAgICAgICB2YXIgZGF0ZSA9IERhdGUucGFyc2UoaGVhZGVyVmFsdWUpOwogICAgICAgICAgICAgICAgdmFyIGRpZmYgPSBkYXRlIC0gbm93OwogICAgICAgICAgICAgICAgcmV0dXJuIE51bWJlci5pc05hTihkaWZmKSA/IHVuZGVmaW5lZCA6IGRpZmY7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gVGhyb3R0bGluZ1JldHJ5UG9saWN5OwogICAgfShCYXNlUmVxdWVzdFBvbGljeSkpOwoKICAgIC8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogICAgLyoqCiAgICAgKiBAY2xhc3MKICAgICAqIEluaXRpYWxpemVzIGEgbmV3IGluc3RhbmNlIG9mIHRoZSBTZXJ2aWNlQ2xpZW50LgogICAgICovCiAgICB2YXIgU2VydmljZUNsaWVudCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKICAgICAgICAvKioKICAgICAgICAgKiBUaGUgU2VydmljZUNsaWVudCBjb25zdHJ1Y3RvcgogICAgICAgICAqIEBjb25zdHJ1Y3RvcgogICAgICAgICAqIEBwYXJhbSB7U2VydmljZUNsaWVudENyZWRlbnRpYWxzfSBbY3JlZGVudGlhbHNdIFRoZSBjcmVkZW50aWFscyBvYmplY3QgdXNlZCBmb3IgYXV0aGVudGljYXRpb24uCiAgICAgICAgICogQHBhcmFtIHtTZXJ2aWNlQ2xpZW50T3B0aW9uc30gW29wdGlvbnNdIFRoZSBzZXJ2aWNlIGNsaWVudCBvcHRpb25zIHRoYXQgZ292ZXJuIHRoZSBiZWhhdmlvciBvZiB0aGUgY2xpZW50LgogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIFNlcnZpY2VDbGllbnQoY3JlZGVudGlhbHMsIG9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKCFvcHRpb25zKSB7CiAgICAgICAgICAgICAgICBvcHRpb25zID0ge307CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGNyZWRlbnRpYWxzICYmICFjcmVkZW50aWFscy5zaWduUmVxdWVzdCkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJjcmVkZW50aWFscyBhcmd1bWVudCBuZWVkcyB0byBpbXBsZW1lbnQgc2lnblJlcXVlc3QgbWV0aG9kIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fd2l0aENyZWRlbnRpYWxzID0gb3B0aW9ucy53aXRoQ3JlZGVudGlhbHMgfHwgZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX2h0dHBDbGllbnQgPSBvcHRpb25zLmh0dHBDbGllbnQgfHwgbmV3IFhockh0dHBDbGllbnQoKTsKICAgICAgICAgICAgdGhpcy5fcmVxdWVzdFBvbGljeU9wdGlvbnMgPSBuZXcgUmVxdWVzdFBvbGljeU9wdGlvbnMob3B0aW9ucy5odHRwUGlwZWxpbmVMb2dnZXIpOwogICAgICAgICAgICB2YXIgcmVxdWVzdFBvbGljeUZhY3RvcmllczsKICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkob3B0aW9ucy5yZXF1ZXN0UG9saWN5RmFjdG9yaWVzKSkgewogICAgICAgICAgICAgICAgcmVxdWVzdFBvbGljeUZhY3RvcmllcyA9IG9wdGlvbnMucmVxdWVzdFBvbGljeUZhY3RvcmllczsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHJlcXVlc3RQb2xpY3lGYWN0b3JpZXMgPSBjcmVhdGVEZWZhdWx0UmVxdWVzdFBvbGljeUZhY3RvcmllcyhjcmVkZW50aWFscywgb3B0aW9ucyk7CiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5yZXF1ZXN0UG9saWN5RmFjdG9yaWVzKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIG5ld1JlcXVlc3RQb2xpY3lGYWN0b3JpZXMgPSBvcHRpb25zLnJlcXVlc3RQb2xpY3lGYWN0b3JpZXMocmVxdWVzdFBvbGljeUZhY3Rvcmllcyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1JlcXVlc3RQb2xpY3lGYWN0b3JpZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdFBvbGljeUZhY3RvcmllcyA9IG5ld1JlcXVlc3RQb2xpY3lGYWN0b3JpZXM7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX3JlcXVlc3RQb2xpY3lGYWN0b3JpZXMgPSByZXF1ZXN0UG9saWN5RmFjdG9yaWVzOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZW5kIHRoZSBwcm92aWRlZCBodHRwUmVxdWVzdC4KICAgICAgICAgKi8KICAgICAgICBTZXJ2aWNlQ2xpZW50LnByb3RvdHlwZS5zZW5kUmVxdWVzdCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgIGlmIChvcHRpb25zID09PSBudWxsIHx8IG9wdGlvbnMgPT09IHVuZGVmaW5lZCB8fCB0eXBlb2Ygb3B0aW9ucyAhPT0gIm9iamVjdCIpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigib3B0aW9ucyBjYW5ub3QgYmUgbnVsbCBvciB1bmRlZmluZWQgYW5kIGl0IG11c3QgYmUgb2YgdHlwZSBvYmplY3QuIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGh0dHBSZXF1ZXN0OwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMgaW5zdGFuY2VvZiBXZWJSZXNvdXJjZSkgewogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMudmFsaWRhdGVSZXF1ZXN0UHJvcGVydGllcygpOwogICAgICAgICAgICAgICAgICAgIGh0dHBSZXF1ZXN0ID0gb3B0aW9uczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIGh0dHBSZXF1ZXN0ID0gbmV3IFdlYlJlc291cmNlKCk7CiAgICAgICAgICAgICAgICAgICAgaHR0cFJlcXVlc3QgPSBodHRwUmVxdWVzdC5wcmVwYXJlKG9wdGlvbnMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgaHR0cFBpcGVsaW5lID0gdGhpcy5faHR0cENsaWVudDsKICAgICAgICAgICAgaWYgKHRoaXMuX3JlcXVlc3RQb2xpY3lGYWN0b3JpZXMgJiYgdGhpcy5fcmVxdWVzdFBvbGljeUZhY3Rvcmllcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gdGhpcy5fcmVxdWVzdFBvbGljeUZhY3Rvcmllcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkgewogICAgICAgICAgICAgICAgICAgIGh0dHBQaXBlbGluZSA9IHRoaXMuX3JlcXVlc3RQb2xpY3lGYWN0b3JpZXNbaV0uY3JlYXRlKGh0dHBQaXBlbGluZSwgdGhpcy5fcmVxdWVzdFBvbGljeU9wdGlvbnMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBodHRwUGlwZWxpbmUuc2VuZFJlcXVlc3QoaHR0cFJlcXVlc3QpOwogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogU2VuZCBhbiBIVFRQIHJlcXVlc3QgdGhhdCBpcyBwb3B1bGF0ZWQgdXNpbmcgdGhlIHByb3ZpZGVkIE9wZXJhdGlvblNwZWMuCiAgICAgICAgICogQHBhcmFtIHtPcGVyYXRpb25Bcmd1bWVudHN9IG9wZXJhdGlvbkFyZ3VtZW50cyBUaGUgYXJndW1lbnRzIHRoYXQgdGhlIEhUVFAgcmVxdWVzdCdzIHRlbXBsYXRlZCB2YWx1ZXMgd2lsbCBiZSBwb3B1bGF0ZWQgZnJvbS4KICAgICAgICAgKiBAcGFyYW0ge09wZXJhdGlvblNwZWN9IG9wZXJhdGlvblNwZWMgVGhlIE9wZXJhdGlvblNwZWMgdG8gdXNlIHRvIHBvcHVsYXRlIHRoZSBodHRwUmVxdWVzdC4KICAgICAgICAgKiBAcGFyYW0ge1NlcnZpY2VDYWxsYmFja30gY2FsbGJhY2sgVGhlIGNhbGxiYWNrIHRvIGNhbGwgd2hlbiB0aGUgcmVzcG9uc2UgaXMgcmVjZWl2ZWQuCiAgICAgICAgICovCiAgICAgICAgU2VydmljZUNsaWVudC5wcm90b3R5cGUuc2VuZE9wZXJhdGlvblJlcXVlc3QgPSBmdW5jdGlvbiAob3BlcmF0aW9uQXJndW1lbnRzLCBvcGVyYXRpb25TcGVjLCBjYWxsYmFjaykgewogICAgICAgICAgICBpZiAodHlwZW9mIG9wZXJhdGlvbkFyZ3VtZW50cy5vcHRpb25zID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgICAgICBjYWxsYmFjayA9IG9wZXJhdGlvbkFyZ3VtZW50cy5vcHRpb25zOwogICAgICAgICAgICAgICAgb3BlcmF0aW9uQXJndW1lbnRzLm9wdGlvbnMgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGh0dHBSZXF1ZXN0ID0gbmV3IFdlYlJlc291cmNlKCk7CiAgICAgICAgICAgIHZhciByZXN1bHQ7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB2YXIgYmFzZVVyaSA9IG9wZXJhdGlvblNwZWMuYmFzZVVybCB8fCB0aGlzLmJhc2VVcmk7CiAgICAgICAgICAgICAgICBpZiAoIWJhc2VVcmkpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIklmIG9wZXJhdGlvblNwZWMuYmFzZVVybCBpcyBub3Qgc3BlY2lmaWVkLCB0aGVuIHRoZSBTZXJ2aWNlQ2xpZW50IG11c3QgaGF2ZSBhIGJhc2VVcmkgc3RyaW5nIHByb3BlcnR5IHRoYXQgY29udGFpbnMgdGhlIGJhc2UgVVJMIHRvIHVzZS4iKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGh0dHBSZXF1ZXN0Lm1ldGhvZCA9IG9wZXJhdGlvblNwZWMuaHR0cE1ldGhvZDsKICAgICAgICAgICAgICAgIGh0dHBSZXF1ZXN0Lm9wZXJhdGlvblNwZWMgPSBvcGVyYXRpb25TcGVjOwogICAgICAgICAgICAgICAgdmFyIHJlcXVlc3RVcmwgPSBVUkxCdWlsZGVyLnBhcnNlKGJhc2VVcmkpOwogICAgICAgICAgICAgICAgaWYgKG9wZXJhdGlvblNwZWMucGF0aCkgewogICAgICAgICAgICAgICAgICAgIHJlcXVlc3RVcmwuYXBwZW5kUGF0aChvcGVyYXRpb25TcGVjLnBhdGgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKG9wZXJhdGlvblNwZWMudXJsUGFyYW1ldGVycyAmJiBvcGVyYXRpb25TcGVjLnVybFBhcmFtZXRlcnMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSBvcGVyYXRpb25TcGVjLnVybFBhcmFtZXRlcnM7IF9pIDwgX2EubGVuZ3RoOyBfaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1cmxQYXJhbWV0ZXIgPSBfYVtfaV07CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1cmxQYXJhbWV0ZXJWYWx1ZSA9IGdldE9wZXJhdGlvbkFyZ3VtZW50VmFsdWVGcm9tUGFyYW1ldGVyKHRoaXMsIG9wZXJhdGlvbkFyZ3VtZW50cywgdXJsUGFyYW1ldGVyLCBvcGVyYXRpb25TcGVjLnNlcmlhbGl6ZXIpOwogICAgICAgICAgICAgICAgICAgICAgICB1cmxQYXJhbWV0ZXJWYWx1ZSA9IG9wZXJhdGlvblNwZWMuc2VyaWFsaXplci5zZXJpYWxpemUodXJsUGFyYW1ldGVyLm1hcHBlciwgdXJsUGFyYW1ldGVyVmFsdWUsIGdldFBhdGhTdHJpbmdGcm9tUGFyYW1ldGVyKHVybFBhcmFtZXRlcikpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXVybFBhcmFtZXRlci5za2lwRW5jb2RpbmcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybFBhcmFtZXRlclZhbHVlID0gZW5jb2RlVVJJQ29tcG9uZW50KHVybFBhcmFtZXRlclZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0VXJsLnJlcGxhY2VBbGwoInsiICsgKHVybFBhcmFtZXRlci5tYXBwZXIuc2VyaWFsaXplZE5hbWUgfHwgZ2V0UGF0aFN0cmluZ0Zyb21QYXJhbWV0ZXIodXJsUGFyYW1ldGVyKSkgKyAifSIsIHVybFBhcmFtZXRlclZhbHVlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAob3BlcmF0aW9uU3BlYy5xdWVyeVBhcmFtZXRlcnMgJiYgb3BlcmF0aW9uU3BlYy5xdWVyeVBhcmFtZXRlcnMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIF9iID0gMCwgX2MgPSBvcGVyYXRpb25TcGVjLnF1ZXJ5UGFyYW1ldGVyczsgX2IgPCBfYy5sZW5ndGg7IF9iKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHF1ZXJ5UGFyYW1ldGVyID0gX2NbX2JdOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcXVlcnlQYXJhbWV0ZXJWYWx1ZSA9IGdldE9wZXJhdGlvbkFyZ3VtZW50VmFsdWVGcm9tUGFyYW1ldGVyKHRoaXMsIG9wZXJhdGlvbkFyZ3VtZW50cywgcXVlcnlQYXJhbWV0ZXIsIG9wZXJhdGlvblNwZWMuc2VyaWFsaXplcik7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChxdWVyeVBhcmFtZXRlclZhbHVlICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnlQYXJhbWV0ZXJWYWx1ZSA9IG9wZXJhdGlvblNwZWMuc2VyaWFsaXplci5zZXJpYWxpemUocXVlcnlQYXJhbWV0ZXIubWFwcGVyLCBxdWVyeVBhcmFtZXRlclZhbHVlLCBnZXRQYXRoU3RyaW5nRnJvbVBhcmFtZXRlcihxdWVyeVBhcmFtZXRlcikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHF1ZXJ5UGFyYW1ldGVyLmNvbGxlY3Rpb25Gb3JtYXQgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHF1ZXJ5UGFyYW1ldGVyLmNvbGxlY3Rpb25Gb3JtYXQgPT09IFF1ZXJ5Q29sbGVjdGlvbkZvcm1hdC5NdWx0aSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocXVlcnlQYXJhbWV0ZXJWYWx1ZS5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVyVmFsdWUgPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGluZGV4IGluIHF1ZXJ5UGFyYW1ldGVyVmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IHF1ZXJ5UGFyYW1ldGVyVmFsdWVbaW5kZXhdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVyVmFsdWVbaW5kZXhdID0gaXRlbSA9PSB1bmRlZmluZWQgPyAiIiA6IGl0ZW0udG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnlQYXJhbWV0ZXJWYWx1ZSA9IHF1ZXJ5UGFyYW1ldGVyVmFsdWUuam9pbihxdWVyeVBhcmFtZXRlci5jb2xsZWN0aW9uRm9ybWF0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXF1ZXJ5UGFyYW1ldGVyLnNraXBFbmNvZGluZykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHF1ZXJ5UGFyYW1ldGVyVmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGluZGV4IGluIHF1ZXJ5UGFyYW1ldGVyVmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVyVmFsdWVbaW5kZXhdID0gZW5jb2RlVVJJQ29tcG9uZW50KHF1ZXJ5UGFyYW1ldGVyVmFsdWVbaW5kZXhdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnlQYXJhbWV0ZXJWYWx1ZSA9IGVuY29kZVVSSUNvbXBvbmVudChxdWVyeVBhcmFtZXRlclZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0VXJsLnNldFF1ZXJ5UGFyYW1ldGVyKHF1ZXJ5UGFyYW1ldGVyLm1hcHBlci5zZXJpYWxpemVkTmFtZSB8fCBnZXRQYXRoU3RyaW5nRnJvbVBhcmFtZXRlcihxdWVyeVBhcmFtZXRlciksIHF1ZXJ5UGFyYW1ldGVyVmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaHR0cFJlcXVlc3QudXJsID0gcmVxdWVzdFVybC50b1N0cmluZygpOwogICAgICAgICAgICAgICAgdmFyIGNvbnRlbnRUeXBlID0gb3BlcmF0aW9uU3BlYy5jb250ZW50VHlwZSB8fCB0aGlzLnJlcXVlc3RDb250ZW50VHlwZTsKICAgICAgICAgICAgICAgIGlmIChjb250ZW50VHlwZSkgewogICAgICAgICAgICAgICAgICAgIGh0dHBSZXF1ZXN0LmhlYWRlcnMuc2V0KCJDb250ZW50LVR5cGUiLCBjb250ZW50VHlwZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAob3BlcmF0aW9uU3BlYy5oZWFkZXJQYXJhbWV0ZXJzKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgX2QgPSAwLCBfZSA9IG9wZXJhdGlvblNwZWMuaGVhZGVyUGFyYW1ldGVyczsgX2QgPCBfZS5sZW5ndGg7IF9kKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGhlYWRlclBhcmFtZXRlciA9IF9lW19kXTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGhlYWRlclZhbHVlID0gZ2V0T3BlcmF0aW9uQXJndW1lbnRWYWx1ZUZyb21QYXJhbWV0ZXIodGhpcywgb3BlcmF0aW9uQXJndW1lbnRzLCBoZWFkZXJQYXJhbWV0ZXIsIG9wZXJhdGlvblNwZWMuc2VyaWFsaXplcik7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoZWFkZXJWYWx1ZSAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlclZhbHVlID0gb3BlcmF0aW9uU3BlYy5zZXJpYWxpemVyLnNlcmlhbGl6ZShoZWFkZXJQYXJhbWV0ZXIubWFwcGVyLCBoZWFkZXJWYWx1ZSwgZ2V0UGF0aFN0cmluZ0Zyb21QYXJhbWV0ZXIoaGVhZGVyUGFyYW1ldGVyKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaGVhZGVyQ29sbGVjdGlvblByZWZpeCA9IGhlYWRlclBhcmFtZXRlci5tYXBwZXIuaGVhZGVyQ29sbGVjdGlvblByZWZpeDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoZWFkZXJDb2xsZWN0aW9uUHJlZml4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgX2YgPSAwLCBfZyA9IE9iamVjdC5rZXlzKGhlYWRlclZhbHVlKTsgX2YgPCBfZy5sZW5ndGg7IF9mKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGtleSA9IF9nW19mXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaHR0cFJlcXVlc3QuaGVhZGVycy5zZXQoaGVhZGVyQ29sbGVjdGlvblByZWZpeCArIGtleSwgaGVhZGVyVmFsdWVba2V5XSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaHR0cFJlcXVlc3QuaGVhZGVycy5zZXQoaGVhZGVyUGFyYW1ldGVyLm1hcHBlci5zZXJpYWxpemVkTmFtZSB8fCBnZXRQYXRoU3RyaW5nRnJvbVBhcmFtZXRlcihoZWFkZXJQYXJhbWV0ZXIpLCBoZWFkZXJWYWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB2YXIgb3B0aW9ucyA9IG9wZXJhdGlvbkFyZ3VtZW50cy5vcHRpb25zOwogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5jdXN0b21IZWFkZXJzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGN1c3RvbUhlYWRlck5hbWUgaW4gb3B0aW9ucy5jdXN0b21IZWFkZXJzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBodHRwUmVxdWVzdC5oZWFkZXJzLnNldChjdXN0b21IZWFkZXJOYW1lLCBvcHRpb25zLmN1c3RvbUhlYWRlcnNbY3VzdG9tSGVhZGVyTmFtZV0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmFib3J0U2lnbmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGh0dHBSZXF1ZXN0LmFib3J0U2lnbmFsID0gb3B0aW9ucy5hYm9ydFNpZ25hbDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMudGltZW91dCkgewogICAgICAgICAgICAgICAgICAgICAgICBodHRwUmVxdWVzdC50aW1lb3V0ID0gb3B0aW9ucy50aW1lb3V0OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5vblVwbG9hZFByb2dyZXNzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGh0dHBSZXF1ZXN0Lm9uVXBsb2FkUHJvZ3Jlc3MgPSBvcHRpb25zLm9uVXBsb2FkUHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLm9uRG93bmxvYWRQcm9ncmVzcykgewogICAgICAgICAgICAgICAgICAgICAgICBodHRwUmVxdWVzdC5vbkRvd25sb2FkUHJvZ3Jlc3MgPSBvcHRpb25zLm9uRG93bmxvYWRQcm9ncmVzczsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBodHRwUmVxdWVzdC53aXRoQ3JlZGVudGlhbHMgPSB0aGlzLl93aXRoQ3JlZGVudGlhbHM7CiAgICAgICAgICAgICAgICBzZXJpYWxpemVSZXF1ZXN0Qm9keSh0aGlzLCBodHRwUmVxdWVzdCwgb3BlcmF0aW9uQXJndW1lbnRzLCBvcGVyYXRpb25TcGVjKTsKICAgICAgICAgICAgICAgIGlmIChodHRwUmVxdWVzdC5zdHJlYW1SZXNwb25zZUJvZHkgPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgaHR0cFJlcXVlc3Quc3RyZWFtUmVzcG9uc2VCb2R5ID0gaXNTdHJlYW1PcGVyYXRpb24ob3BlcmF0aW9uU3BlYyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXN1bHQgPSB0aGlzLnNlbmRSZXF1ZXN0KGh0dHBSZXF1ZXN0KQogICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXMpIHsgcmV0dXJuIGZsYXR0ZW5SZXNwb25zZShyZXMsIG9wZXJhdGlvblNwZWMucmVzcG9uc2VzW3Jlcy5zdGF0dXNdKTsgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICByZXN1bHQgPSBQcm9taXNlLnJlamVjdChlcnJvcik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGNiID0gY2FsbGJhY2s7CiAgICAgICAgICAgIGlmIChjYikgewogICAgICAgICAgICAgICAgcmVzdWx0CiAgICAgICAgICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLW51bGwta2V5d29yZAogICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXMpIHsgcmV0dXJuIGNiKG51bGwsIHJlcy5fcmVzcG9uc2UucGFyc2VkQm9keSwgcmVzLl9yZXNwb25zZS5yZXF1ZXN0LCByZXMuX3Jlc3BvbnNlKTsgfSkKICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycikgeyByZXR1cm4gY2IoZXJyKTsgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9OwogICAgICAgIHJldHVybiBTZXJ2aWNlQ2xpZW50OwogICAgfSgpKTsKICAgIGZ1bmN0aW9uIHNlcmlhbGl6ZVJlcXVlc3RCb2R5KHNlcnZpY2VDbGllbnQsIGh0dHBSZXF1ZXN0LCBvcGVyYXRpb25Bcmd1bWVudHMsIG9wZXJhdGlvblNwZWMpIHsKICAgICAgICBpZiAob3BlcmF0aW9uU3BlYy5yZXF1ZXN0Qm9keSAmJiBvcGVyYXRpb25TcGVjLnJlcXVlc3RCb2R5Lm1hcHBlcikgewogICAgICAgICAgICBodHRwUmVxdWVzdC5ib2R5ID0gZ2V0T3BlcmF0aW9uQXJndW1lbnRWYWx1ZUZyb21QYXJhbWV0ZXIoc2VydmljZUNsaWVudCwgb3BlcmF0aW9uQXJndW1lbnRzLCBvcGVyYXRpb25TcGVjLnJlcXVlc3RCb2R5LCBvcGVyYXRpb25TcGVjLnNlcmlhbGl6ZXIpOwogICAgICAgICAgICB2YXIgYm9keU1hcHBlciA9IG9wZXJhdGlvblNwZWMucmVxdWVzdEJvZHkubWFwcGVyOwogICAgICAgICAgICB2YXIgcmVxdWlyZWQgPSBib2R5TWFwcGVyLnJlcXVpcmVkLCB4bWxOYW1lID0gYm9keU1hcHBlci54bWxOYW1lLCB4bWxFbGVtZW50TmFtZSA9IGJvZHlNYXBwZXIueG1sRWxlbWVudE5hbWUsIHNlcmlhbGl6ZWROYW1lID0gYm9keU1hcHBlci5zZXJpYWxpemVkTmFtZTsKICAgICAgICAgICAgdmFyIHR5cGVOYW1lID0gYm9keU1hcHBlci50eXBlLm5hbWU7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpZiAoaHR0cFJlcXVlc3QuYm9keSAhPSB1bmRlZmluZWQgfHwgcmVxdWlyZWQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdEJvZHlQYXJhbWV0ZXJQYXRoU3RyaW5nID0gZ2V0UGF0aFN0cmluZ0Zyb21QYXJhbWV0ZXIob3BlcmF0aW9uU3BlYy5yZXF1ZXN0Qm9keSk7CiAgICAgICAgICAgICAgICAgICAgaHR0cFJlcXVlc3QuYm9keSA9IG9wZXJhdGlvblNwZWMuc2VyaWFsaXplci5zZXJpYWxpemUoYm9keU1hcHBlciwgaHR0cFJlcXVlc3QuYm9keSwgcmVxdWVzdEJvZHlQYXJhbWV0ZXJQYXRoU3RyaW5nKTsKICAgICAgICAgICAgICAgICAgICB2YXIgaXNTdHJlYW0gPSB0eXBlTmFtZSA9PT0gTWFwcGVyVHlwZS5TdHJlYW07CiAgICAgICAgICAgICAgICAgICAgaWYgKG9wZXJhdGlvblNwZWMuaXNYTUwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVOYW1lID09PSBNYXBwZXJUeXBlLlNlcXVlbmNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBodHRwUmVxdWVzdC5ib2R5ID0gc3RyaW5naWZ5WE1MKHByZXBhcmVYTUxSb290TGlzdChodHRwUmVxdWVzdC5ib2R5LCB4bWxFbGVtZW50TmFtZSB8fCB4bWxOYW1lIHx8IHNlcmlhbGl6ZWROYW1lKSwgeyByb290TmFtZTogeG1sTmFtZSB8fCBzZXJpYWxpemVkTmFtZSB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICghaXNTdHJlYW0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGh0dHBSZXF1ZXN0LmJvZHkgPSBzdHJpbmdpZnlYTUwoaHR0cFJlcXVlc3QuYm9keSwgeyByb290TmFtZTogeG1sTmFtZSB8fCBzZXJpYWxpemVkTmFtZSB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICghaXNTdHJlYW0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgaHR0cFJlcXVlc3QuYm9keSA9IEpTT04uc3RyaW5naWZ5KGh0dHBSZXF1ZXN0LmJvZHkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiRXJyb3IgXCIiICsgZXJyb3IubWVzc2FnZSArICJcIiBvY2N1cnJlZCBpbiBzZXJpYWxpemluZyB0aGUgcGF5bG9hZCAtICIgKyBKU09OLnN0cmluZ2lmeShzZXJpYWxpemVkTmFtZSwgdW5kZWZpbmVkLCAiICAiKSArICIuIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAob3BlcmF0aW9uU3BlYy5mb3JtRGF0YVBhcmFtZXRlcnMgJiYgb3BlcmF0aW9uU3BlYy5mb3JtRGF0YVBhcmFtZXRlcnMubGVuZ3RoID4gMCkgewogICAgICAgICAgICBodHRwUmVxdWVzdC5mb3JtRGF0YSA9IHt9OwogICAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gb3BlcmF0aW9uU3BlYy5mb3JtRGF0YVBhcmFtZXRlcnM7IF9pIDwgX2EubGVuZ3RoOyBfaSsrKSB7CiAgICAgICAgICAgICAgICB2YXIgZm9ybURhdGFQYXJhbWV0ZXIgPSBfYVtfaV07CiAgICAgICAgICAgICAgICB2YXIgZm9ybURhdGFQYXJhbWV0ZXJWYWx1ZSA9IGdldE9wZXJhdGlvbkFyZ3VtZW50VmFsdWVGcm9tUGFyYW1ldGVyKHNlcnZpY2VDbGllbnQsIG9wZXJhdGlvbkFyZ3VtZW50cywgZm9ybURhdGFQYXJhbWV0ZXIsIG9wZXJhdGlvblNwZWMuc2VyaWFsaXplcik7CiAgICAgICAgICAgICAgICBpZiAoZm9ybURhdGFQYXJhbWV0ZXJWYWx1ZSAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZm9ybURhdGFQYXJhbWV0ZXJQcm9wZXJ0eU5hbWUgPSBmb3JtRGF0YVBhcmFtZXRlci5tYXBwZXIuc2VyaWFsaXplZE5hbWUgfHwgZ2V0UGF0aFN0cmluZ0Zyb21QYXJhbWV0ZXIoZm9ybURhdGFQYXJhbWV0ZXIpOwogICAgICAgICAgICAgICAgICAgIGh0dHBSZXF1ZXN0LmZvcm1EYXRhW2Zvcm1EYXRhUGFyYW1ldGVyUHJvcGVydHlOYW1lXSA9IG9wZXJhdGlvblNwZWMuc2VyaWFsaXplci5zZXJpYWxpemUoZm9ybURhdGFQYXJhbWV0ZXIubWFwcGVyLCBmb3JtRGF0YVBhcmFtZXRlclZhbHVlLCBnZXRQYXRoU3RyaW5nRnJvbVBhcmFtZXRlcihmb3JtRGF0YVBhcmFtZXRlcikpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gaXNSZXF1ZXN0UG9saWN5RmFjdG9yeShpbnN0YW5jZSkgewogICAgICAgIHJldHVybiB0eXBlb2YgaW5zdGFuY2UuY3JlYXRlID09PSAiZnVuY3Rpb24iOwogICAgfQogICAgZnVuY3Rpb24gZ2V0VmFsdWVPckZ1bmN0aW9uUmVzdWx0KHZhbHVlLCBkZWZhdWx0VmFsdWVDcmVhdG9yKSB7CiAgICAgICAgdmFyIHJlc3VsdDsKICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAic3RyaW5nIikgewogICAgICAgICAgICByZXN1bHQgPSB2YWx1ZTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHJlc3VsdCA9IGRlZmF1bHRWYWx1ZUNyZWF0b3IoKTsKICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgICAgcmVzdWx0ID0gdmFsdWUocmVzdWx0KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgZnVuY3Rpb24gY3JlYXRlRGVmYXVsdFJlcXVlc3RQb2xpY3lGYWN0b3JpZXMoY3JlZGVudGlhbHMsIG9wdGlvbnMpIHsKICAgICAgICB2YXIgZmFjdG9yaWVzID0gW107CiAgICAgICAgaWYgKG9wdGlvbnMuZ2VuZXJhdGVDbGllbnRSZXF1ZXN0SWRIZWFkZXIpIHsKICAgICAgICAgICAgZmFjdG9yaWVzLnB1c2goZ2VuZXJhdGVDbGllbnRSZXF1ZXN0SWRQb2xpY3kob3B0aW9ucy5jbGllbnRSZXF1ZXN0SWRIZWFkZXJOYW1lKSk7CiAgICAgICAgfQogICAgICAgIGlmIChjcmVkZW50aWFscykgewogICAgICAgICAgICBpZiAoaXNSZXF1ZXN0UG9saWN5RmFjdG9yeShjcmVkZW50aWFscykpIHsKICAgICAgICAgICAgICAgIGZhY3Rvcmllcy5wdXNoKGNyZWRlbnRpYWxzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGZhY3Rvcmllcy5wdXNoKHNpZ25pbmdQb2xpY3koY3JlZGVudGlhbHMpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB2YXIgdXNlckFnZW50SGVhZGVyTmFtZSA9IGdldFZhbHVlT3JGdW5jdGlvblJlc3VsdChvcHRpb25zLnVzZXJBZ2VudEhlYWRlck5hbWUsIGdldERlZmF1bHRVc2VyQWdlbnRIZWFkZXJOYW1lKTsKICAgICAgICB2YXIgdXNlckFnZW50SGVhZGVyVmFsdWUgPSBnZXRWYWx1ZU9yRnVuY3Rpb25SZXN1bHQob3B0aW9ucy51c2VyQWdlbnQsIGdldERlZmF1bHRVc2VyQWdlbnRWYWx1ZSk7CiAgICAgICAgaWYgKHVzZXJBZ2VudEhlYWRlck5hbWUgJiYgdXNlckFnZW50SGVhZGVyVmFsdWUpIHsKICAgICAgICAgICAgZmFjdG9yaWVzLnB1c2godXNlckFnZW50UG9saWN5KHsga2V5OiB1c2VyQWdlbnRIZWFkZXJOYW1lLCB2YWx1ZTogdXNlckFnZW50SGVhZGVyVmFsdWUgfSkpOwogICAgICAgIH0KICAgICAgICBmYWN0b3JpZXMucHVzaChyZWRpcmVjdFBvbGljeSgpKTsKICAgICAgICBmYWN0b3JpZXMucHVzaChycFJlZ2lzdHJhdGlvblBvbGljeShvcHRpb25zLnJwUmVnaXN0cmF0aW9uUmV0cnlUaW1lb3V0KSk7CiAgICAgICAgaWYgKCFvcHRpb25zLm5vUmV0cnlQb2xpY3kpIHsKICAgICAgICAgICAgZmFjdG9yaWVzLnB1c2goZXhwb25lbnRpYWxSZXRyeVBvbGljeSgpKTsKICAgICAgICAgICAgZmFjdG9yaWVzLnB1c2goc3lzdGVtRXJyb3JSZXRyeVBvbGljeSgpKTsKICAgICAgICAgICAgZmFjdG9yaWVzLnB1c2godGhyb3R0bGluZ1JldHJ5UG9saWN5KCkpOwogICAgICAgIH0KICAgICAgICBmYWN0b3JpZXMucHVzaChkZXNlcmlhbGl6YXRpb25Qb2xpY3kob3B0aW9ucy5kZXNlcmlhbGl6YXRpb25Db250ZW50VHlwZXMpKTsKICAgICAgICB2YXIgcHJveHlTZXR0aW5ncyA9IG9wdGlvbnMucHJveHlTZXR0aW5ncyB8fCBnZXREZWZhdWx0UHJveHlTZXR0aW5ncygpOwogICAgICAgIGlmIChwcm94eVNldHRpbmdzKSB7CiAgICAgICAgICAgIGZhY3Rvcmllcy5wdXNoKHByb3h5UG9saWN5KHByb3h5U2V0dGluZ3MpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhY3RvcmllczsKICAgIH0KICAgIGZ1bmN0aW9uIGdldE9wZXJhdGlvbkFyZ3VtZW50VmFsdWVGcm9tUGFyYW1ldGVyKHNlcnZpY2VDbGllbnQsIG9wZXJhdGlvbkFyZ3VtZW50cywgcGFyYW1ldGVyLCBzZXJpYWxpemVyKSB7CiAgICAgICAgcmV0dXJuIGdldE9wZXJhdGlvbkFyZ3VtZW50VmFsdWVGcm9tUGFyYW1ldGVyUGF0aChzZXJ2aWNlQ2xpZW50LCBvcGVyYXRpb25Bcmd1bWVudHMsIHBhcmFtZXRlci5wYXJhbWV0ZXJQYXRoLCBwYXJhbWV0ZXIubWFwcGVyLCBzZXJpYWxpemVyKTsKICAgIH0KICAgIGZ1bmN0aW9uIGdldE9wZXJhdGlvbkFyZ3VtZW50VmFsdWVGcm9tUGFyYW1ldGVyUGF0aChzZXJ2aWNlQ2xpZW50LCBvcGVyYXRpb25Bcmd1bWVudHMsIHBhcmFtZXRlclBhdGgsIHBhcmFtZXRlck1hcHBlciwgc2VyaWFsaXplcikgewogICAgICAgIHZhciB2YWx1ZTsKICAgICAgICBpZiAodHlwZW9mIHBhcmFtZXRlclBhdGggPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgIHBhcmFtZXRlclBhdGggPSBbcGFyYW1ldGVyUGF0aF07CiAgICAgICAgfQogICAgICAgIGlmIChBcnJheS5pc0FycmF5KHBhcmFtZXRlclBhdGgpKSB7CiAgICAgICAgICAgIGlmIChwYXJhbWV0ZXJQYXRoLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIGlmIChwYXJhbWV0ZXJNYXBwZXIuaXNDb25zdGFudCkgewogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyYW1ldGVyTWFwcGVyLmRlZmF1bHRWYWx1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHZhciBwcm9wZXJ0eVNlYXJjaFJlc3VsdCA9IGdldFByb3BlcnR5RnJvbVBhcmFtZXRlclBhdGgob3BlcmF0aW9uQXJndW1lbnRzLCBwYXJhbWV0ZXJQYXRoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIXByb3BlcnR5U2VhcmNoUmVzdWx0LnByb3BlcnR5Rm91bmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlTZWFyY2hSZXN1bHQgPSBnZXRQcm9wZXJ0eUZyb21QYXJhbWV0ZXJQYXRoKHNlcnZpY2VDbGllbnQsIHBhcmFtZXRlclBhdGgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB2YXIgdXNlRGVmYXVsdFZhbHVlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFwcm9wZXJ0eVNlYXJjaFJlc3VsdC5wcm9wZXJ0eUZvdW5kKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVzZURlZmF1bHRWYWx1ZSA9IHBhcmFtZXRlck1hcHBlci5yZXF1aXJlZCB8fCAocGFyYW1ldGVyUGF0aFswXSA9PT0gIm9wdGlvbnMiICYmIHBhcmFtZXRlclBhdGgubGVuZ3RoID09PSAyKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB1c2VEZWZhdWx0VmFsdWUgPyBwYXJhbWV0ZXJNYXBwZXIuZGVmYXVsdFZhbHVlIDogcHJvcGVydHlTZWFyY2hSZXN1bHQucHJvcGVydHlWYWx1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIFNlcmlhbGl6ZSBqdXN0IGZvciB2YWxpZGF0aW9uIHB1cnBvc2VzLgogICAgICAgICAgICAgICAgdmFyIHBhcmFtZXRlclBhdGhTdHJpbmcgPSBnZXRQYXRoU3RyaW5nRnJvbVBhcmFtZXRlclBhdGgocGFyYW1ldGVyUGF0aCwgcGFyYW1ldGVyTWFwcGVyKTsKICAgICAgICAgICAgICAgIHNlcmlhbGl6ZXIuc2VyaWFsaXplKHBhcmFtZXRlck1hcHBlciwgdmFsdWUsIHBhcmFtZXRlclBhdGhTdHJpbmcpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBpZiAocGFyYW1ldGVyTWFwcGVyLnJlcXVpcmVkKSB7CiAgICAgICAgICAgICAgICB2YWx1ZSA9IHt9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAodmFyIHByb3BlcnR5TmFtZSBpbiBwYXJhbWV0ZXJQYXRoKSB7CiAgICAgICAgICAgICAgICB2YXIgcHJvcGVydHlNYXBwZXIgPSBwYXJhbWV0ZXJNYXBwZXIudHlwZS5tb2RlbFByb3BlcnRpZXNbcHJvcGVydHlOYW1lXTsKICAgICAgICAgICAgICAgIHZhciBwcm9wZXJ0eVBhdGggPSBwYXJhbWV0ZXJQYXRoW3Byb3BlcnR5TmFtZV07CiAgICAgICAgICAgICAgICB2YXIgcHJvcGVydHlWYWx1ZSA9IGdldE9wZXJhdGlvbkFyZ3VtZW50VmFsdWVGcm9tUGFyYW1ldGVyUGF0aChzZXJ2aWNlQ2xpZW50LCBvcGVyYXRpb25Bcmd1bWVudHMsIHByb3BlcnR5UGF0aCwgcHJvcGVydHlNYXBwZXIsIHNlcmlhbGl6ZXIpOwogICAgICAgICAgICAgICAgLy8gU2VyaWFsaXplIGp1c3QgZm9yIHZhbGlkYXRpb24gcHVycG9zZXMuCiAgICAgICAgICAgICAgICB2YXIgcHJvcGVydHlQYXRoU3RyaW5nID0gZ2V0UGF0aFN0cmluZ0Zyb21QYXJhbWV0ZXJQYXRoKHByb3BlcnR5UGF0aCwgcHJvcGVydHlNYXBwZXIpOwogICAgICAgICAgICAgICAgc2VyaWFsaXplci5zZXJpYWxpemUocHJvcGVydHlNYXBwZXIsIHByb3BlcnR5VmFsdWUsIHByb3BlcnR5UGF0aFN0cmluZyk7CiAgICAgICAgICAgICAgICBpZiAocHJvcGVydHlWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCF2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHt9OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB2YWx1ZVtwcm9wZXJ0eU5hbWVdID0gcHJvcGVydHlWYWx1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdmFsdWU7CiAgICB9CiAgICBmdW5jdGlvbiBnZXRQcm9wZXJ0eUZyb21QYXJhbWV0ZXJQYXRoKHBhcmVudCwgcGFyYW1ldGVyUGF0aCkgewogICAgICAgIHZhciByZXN1bHQgPSB7IHByb3BlcnR5Rm91bmQ6IGZhbHNlIH07CiAgICAgICAgdmFyIGkgPSAwOwogICAgICAgIGZvciAoOyBpIDwgcGFyYW1ldGVyUGF0aC5sZW5ndGg7ICsraSkgewogICAgICAgICAgICB2YXIgcGFyYW1ldGVyUGF0aFBhcnQgPSBwYXJhbWV0ZXJQYXRoW2ldOwogICAgICAgICAgICAvLyBNYWtlIHN1cmUgdG8gY2hlY2sgaW5oZXJpdGVkIHByb3BlcnRpZXMgdG9vLCBzbyBkb24ndCB1c2UgaGFzT3duUHJvcGVydHkoKS4KICAgICAgICAgICAgaWYgKHBhcmVudCAhPSB1bmRlZmluZWQgJiYgcGFyYW1ldGVyUGF0aFBhcnQgaW4gcGFyZW50KSB7CiAgICAgICAgICAgICAgICBwYXJlbnQgPSBwYXJlbnRbcGFyYW1ldGVyUGF0aFBhcnRdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGkgPT09IHBhcmFtZXRlclBhdGgubGVuZ3RoKSB7CiAgICAgICAgICAgIHJlc3VsdC5wcm9wZXJ0eVZhbHVlID0gcGFyZW50OwogICAgICAgICAgICByZXN1bHQucHJvcGVydHlGb3VuZCA9IHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICBmdW5jdGlvbiBmbGF0dGVuUmVzcG9uc2UoX3Jlc3BvbnNlLCByZXNwb25zZVNwZWMpIHsKICAgICAgICB2YXIgcGFyc2VkSGVhZGVycyA9IF9yZXNwb25zZS5wYXJzZWRIZWFkZXJzOwogICAgICAgIHZhciBib2R5TWFwcGVyID0gcmVzcG9uc2VTcGVjICYmIHJlc3BvbnNlU3BlYy5ib2R5TWFwcGVyOwogICAgICAgIHZhciBhZGRPcGVyYXRpb25SZXNwb25zZSA9IGZ1bmN0aW9uIChvYmopIHsKICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosICJfcmVzcG9uc2UiLCB7CiAgICAgICAgICAgICAgICB2YWx1ZTogX3Jlc3BvbnNlCiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgaWYgKGJvZHlNYXBwZXIpIHsKICAgICAgICAgICAgdmFyIHR5cGVOYW1lID0gYm9keU1hcHBlci50eXBlLm5hbWU7CiAgICAgICAgICAgIGlmICh0eXBlTmFtZSA9PT0gIlN0cmVhbSIpIHsKICAgICAgICAgICAgICAgIHJldHVybiBhZGRPcGVyYXRpb25SZXNwb25zZShfX2Fzc2lnbih7fSwgcGFyc2VkSGVhZGVycywgeyBibG9iQm9keTogX3Jlc3BvbnNlLmJsb2JCb2R5LCByZWFkYWJsZVN0cmVhbUJvZHk6IF9yZXNwb25zZS5yZWFkYWJsZVN0cmVhbUJvZHkgfSkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBtb2RlbFByb3BlcnRpZXNfMSA9IHR5cGVOYW1lID09PSAiQ29tcG9zaXRlIiAmJiBib2R5TWFwcGVyLnR5cGUubW9kZWxQcm9wZXJ0aWVzIHx8IHt9OwogICAgICAgICAgICB2YXIgaXNQYWdlYWJsZVJlc3BvbnNlID0gT2JqZWN0LmtleXMobW9kZWxQcm9wZXJ0aWVzXzEpLnNvbWUoZnVuY3Rpb24gKGspIHsgcmV0dXJuIG1vZGVsUHJvcGVydGllc18xW2tdLnNlcmlhbGl6ZWROYW1lID09PSAiIjsgfSk7CiAgICAgICAgICAgIGlmICh0eXBlTmFtZSA9PT0gIlNlcXVlbmNlIiB8fCBpc1BhZ2VhYmxlUmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgIHZhciBhcnJheVJlc3BvbnNlID0gKF9yZXNwb25zZS5wYXJzZWRCb2R5IHx8IFtdKS5zbGljZSgpOwogICAgICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IE9iamVjdC5rZXlzKG1vZGVsUHJvcGVydGllc18xKTsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHsKICAgICAgICAgICAgICAgICAgICB2YXIga2V5ID0gX2FbX2ldOwogICAgICAgICAgICAgICAgICAgIGlmIChtb2RlbFByb3BlcnRpZXNfMVtrZXldLnNlcmlhbGl6ZWROYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFycmF5UmVzcG9uc2Vba2V5XSA9IF9yZXNwb25zZS5wYXJzZWRCb2R5W2tleV07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHBhcnNlZEhlYWRlcnMpIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBfYiA9IDAsIF9jID0gT2JqZWN0LmtleXMocGFyc2VkSGVhZGVycyk7IF9iIDwgX2MubGVuZ3RoOyBfYisrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBrZXkgPSBfY1tfYl07CiAgICAgICAgICAgICAgICAgICAgICAgIGFycmF5UmVzcG9uc2Vba2V5XSA9IHBhcnNlZEhlYWRlcnNba2V5XTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBhZGRPcGVyYXRpb25SZXNwb25zZShhcnJheVJlc3BvbnNlKTsKICAgICAgICAgICAgICAgIHJldHVybiBhcnJheVJlc3BvbnNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0eXBlTmFtZSA9PT0gIkNvbXBvc2l0ZSIgfHwgdHlwZU5hbWUgPT09ICJEaWN0aW9uYXJ5IikgewogICAgICAgICAgICAgICAgcmV0dXJuIGFkZE9wZXJhdGlvblJlc3BvbnNlKF9fYXNzaWduKHt9LCBwYXJzZWRIZWFkZXJzLCBfcmVzcG9uc2UucGFyc2VkQm9keSkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChib2R5TWFwcGVyIHx8IF9yZXNwb25zZS5yZXF1ZXN0Lm1ldGhvZCA9PT0gIkhFQUQiIHx8IGlzUHJpbWl0aXZlVHlwZShfcmVzcG9uc2UucGFyc2VkQm9keSkpIHsKICAgICAgICAgICAgLy8gcHJpbWl0aXZlIGJvZHkgdHlwZXMgYW5kIEhFQUQgYm9vbGVhbnMKICAgICAgICAgICAgcmV0dXJuIGFkZE9wZXJhdGlvblJlc3BvbnNlKF9fYXNzaWduKHt9LCBwYXJzZWRIZWFkZXJzLCB7IGJvZHk6IF9yZXNwb25zZS5wYXJzZWRCb2R5IH0pKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFkZE9wZXJhdGlvblJlc3BvbnNlKF9fYXNzaWduKHt9LCBwYXJzZWRIZWFkZXJzLCBfcmVzcG9uc2UucGFyc2VkQm9keSkpOwogICAgfQoKICAgIC8qCiAgICAgKiBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICAgICAqIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS4gU2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24uCiAgICAgKgogICAgICogQ29kZSBnZW5lcmF0ZWQgYnkgTWljcm9zb2Z0IChSKSBBdXRvUmVzdCBDb2RlIEdlbmVyYXRvci4KICAgICAqIENoYW5nZXMgbWF5IGNhdXNlIGluY29ycmVjdCBiZWhhdmlvciBhbmQgd2lsbCBiZSBsb3N0IGlmIHRoZSBjb2RlIGlzIHJlZ2VuZXJhdGVkLgogICAgICovCgogICAgdmFyIGluZGV4ID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewoKICAgIH0pOwoKICAgIC8qKgogICAgICogQW4gYWJvcnRlciBpbnN0YW5jZSBpbXBsZW1lbnRzIEFib3J0U2lnbmFsIGludGVyZmFjZSwgY2FuIGFib3J0IEhUVFAgcmVxdWVzdHMuCiAgICAgKgogICAgICogLSBDYWxsIEFib3J0ZXIubm9uZSB0byBjcmVhdGUgYSBuZXcgQWJvcnRlciBpbnN0YW5jZSB3aXRob3V0IHRpbWVvdXQuCiAgICAgKiAtIENhbGwgQWJvcnRlci50aW1lb3V0KCkgdG8gY3JlYXRlIGEgbmV3IEFib3J0ZXIgaW5zdGFuY2Ugd2l0aCB0aW1lb3V0LgogICAgICoKICAgICAqIEZvciBhbiBleGlzdGluZyBpbnN0YW5jZSBhYm9ydGVyOgogICAgICogLSBDYWxsIGFib3J0ZXIud2l0aFRpbWVvdXQoKSB0byBjcmVhdGUgYW5kIHJldHVybiBhIGNoaWxkIEFib3J0ZXIgaW5zdGFuY2Ugd2l0aCB0aW1lb3V0LgogICAgICogLSBDYWxsIGFib3J0ZXIud2l0aFZhbHVlKGtleSwgdmFsdWUpIHRvIGNyZWF0ZSBhbmQgcmV0dXJuIGEgY2hpbGQgQWJvcnRlciBpbnN0YW5jZSB3aXRoIGtleS92YWx1ZSBwYWlyLgogICAgICogLSBDYWxsIGFib3J0ZXIuYWJvcnQoKSB0byBhYm9ydCBjdXJyZW50IGluc3RhbmNlIGFuZCBhbGwgY2hpbGRyZW4gaW5zdGFuY2VzLgogICAgICogLSBDYWxsIGFib3J0ZXIuZ2V0VmFsdWUoa2V5KSB0byBzZWFyY2ggYW5kIGdldCB2YWx1ZSB3aXRoIGNvcnJlc3BvbmRpbmcga2V5IGZyb20gY3VycmVudCBhYm9ydGVyIHRvIGFsbCBwYXJlbnRzLgogICAgICoKICAgICAqIEBleGFtcGxlCiAgICAgKiAvLyBBYm9ydCB3aXRob3V0IHRpbWVvdXQKICAgICAqIGF3YWl0IGJsb2NrQmxvYlVSTC51cGxvYWQoQWJvcnRlci5ub25lLCBidWYsIGJ1Zi5sZW5ndGgpOwogICAgICoKICAgICAqIEBleGFtcGxlCiAgICAgKiAvLyBBYm9ydCBjb250YWluZXIgY3JlYXRlIGluIDEwMDBtcwogICAgICogYXdhaXQgYmxvY2tCbG9iVVJMLnVwbG9hZChBYm9ydGVyLnRpbWVvdXQoMTAwMCksIGJ1ZiwgYnVmLmxlbmd0aCk7CiAgICAgKgogICAgICogQGV4YW1wbGUKICAgICAqIC8vIFNoYXJlIGFib3J0ZXIgY3Jvc3MgbXVsdGlwbGUgb3BlcmF0aW9ucyBpbiAzMHMKICAgICAqIC8vIFVwbG9hZCB0aGUgc2FtZSBkYXRhIHRvIDIgZGlmZmVyZW50IGRhdGEgY2VudGVycyBhdCB0aGUgc2FtZSB0aW1lLCBhYm9ydCBhbm90aGVyIHdoZW4gYW55IG9mIHRoZW0gaXMgZmluaXNoZWQKICAgICAqIGNvbnN0IGFib3J0ZXIgPSBBYm9ydGVyLnRpbWVvdXQoMzAgKiAxMDAwKTsKICAgICAqIGJsb2NrQmxvYlVSTDEudXBsb2FkKGFib3J0ZXIsIGJ1ZiwgYnVmLmxlbmd0aCkudGhlbihhYm9ydGVyLmFib3J0KTsKICAgICAqIGJsb2NrQmxvYlVSTDIudXBsb2FkKGFib3J0ZXIsIGJ1ZiwgYnVmLmxlbmd0aCkudGhlbihhYm9ydGVyLmFib3J0KTsKICAgICAqCiAgICAgKiBAZXhhbXBsZQogICAgICogLy8gQ2FzY2FkZWQgYWJvcnRpbmcKICAgICAqIC8vIEFsbCBvcGVyYXRpb25zIGNhbid0IHRha2UgbW9yZSB0aGFuIDMwIHNlY29uZHMKICAgICAqIGNvbnN0IGFib3J0ZXIgPSBBYm9ydGVyLnRpbWVvdXQoMzAgKiAxMDAwKTsKICAgICAqCiAgICAgKiAvLyBGb2xsb3dpbmcgMiBvcGVyYXRpb25zIGNhbid0IHRha2UgbW9yZSB0aGFuIDI1IHNlY29uZHMKICAgICAqIGF3YWl0IGJsb2NrQmxvYlVSTC51cGxvYWQoYWJvcnRlci53aXRoVGltZW91dCgyNSAqIDEwMDApLCBidWYsIGJ1Zi5sZW5ndGgpOwogICAgICogYXdhaXQgYmxvY2tCbG9iVVJMLnVwbG9hZChhYm9ydGVyLndpdGhUaW1lb3V0KDI1ICogMTAwMCksIGJ1ZiwgYnVmLmxlbmd0aCk7CiAgICAgKgogICAgICogQGV4cG9ydAogICAgICogQGNsYXNzIEFib3J0ZXIKICAgICAqIEBpbXBsZW1lbnRzIHtBYm9ydFNpZ25hbExpa2V9CiAgICAgKi8KICAgIHZhciBBYm9ydGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewogICAgICAgIC8vIHByaXZhdGUgZGlzcG9zZWQ6IGJvb2xlYW4gPSBmYWxzZTsKICAgICAgICAvKioKICAgICAgICAgKiBQcml2YXRlIGNvbnN0cnVjdG9yIGZvciBpbnRlcm5hbCB1c2FnZSwgY3JlYXRlcyBhbiBpbnN0YW5jZSBvZiBBYm9ydGVyLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtBYm9ydGVyfSBbcGFyZW50XSBPcHRpb25hbC4gUGFyZW50IGFib3J0ZXIuCiAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IFt0aW1lb3V0PTBdIE9wdGlvbmFsLiBUaW1lb3V0IGJlZm9yZSBhYm9ydCBpbiBtaWxsaXNlY29uZCwgMCBtZWFucyBubyB0aW1lb3V0LgogICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBba2V5XSBPcHRpb25hbC4gSW1tdXRhYmxlIGtleSBpbiBzdHJpbmcuCiAgICAgICAgICogQHBhcmFtIHsoc3RyaW5nIHwgbnVtYmVyIHwgYm9vbGVhbiB8IG51bGwpfSBbdmFsdWVdIE9wdGlvbmFsLiBJbW11dGFibGUgdmFsdWUuCiAgICAgICAgICogQG1lbWJlcm9mIEFib3J0ZXIKICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBBYm9ydGVyKHBhcmVudCwgdGltZW91dCwga2V5LCB2YWx1ZSkgewogICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICAgICAgICBpZiAodGltZW91dCA9PT0gdm9pZCAwKSB7IHRpbWVvdXQgPSAwOyB9CiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBvbmFib3J0IGV2ZW50IGxpc3RlbmVyLgogICAgICAgICAgICAgKgogICAgICAgICAgICAgKiBAbWVtYmVyb2YgQWJvcnRlcgogICAgICAgICAgICAgKi8KICAgICAgICAgICAgdGhpcy5vbmFib3J0ID0gbnVsbDsKICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOnZhcmlhYmxlLW5hbWUKICAgICAgICAgICAgdGhpcy5fYWJvcnRlZCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmNoaWxkcmVuID0gW107IC8vIFdoZW4gY2hpbGQgb2JqZWN0IGNhbGxzIGRpc3Bvc2UoKSwgcmVtb3ZlIGNoaWxkIGZyb20gaGVyZQogICAgICAgICAgICB0aGlzLmFib3J0RXZlbnRMaXN0ZW5lcnMgPSBbXTsKICAgICAgICAgICAgdGhpcy5wYXJlbnQgPSBwYXJlbnQ7CiAgICAgICAgICAgIHRoaXMua2V5ID0ga2V5OwogICAgICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CiAgICAgICAgICAgIGlmICh0aW1lb3V0ID4gMCkgewogICAgICAgICAgICAgICAgdGhpcy50aW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIF90aGlzLmFib3J0LmNhbGwoX3RoaXMpOwogICAgICAgICAgICAgICAgfSwgdGltZW91dCk7CiAgICAgICAgICAgICAgICAvLyBXaGVuIGNhbGxlZCwgdGhlIGFjdGl2ZSBUaW1lb3V0IG9iamVjdCB3aWxsIG5vdCByZXF1aXJlIHRoZSBOb2RlLmpzIGV2ZW50IGxvb3AKICAgICAgICAgICAgICAgIC8vIHRvIHJlbWFpbiBhY3RpdmUuIElmIHRoZXJlIGlzIG5vIG90aGVyIGFjdGl2aXR5IGtlZXBpbmcgdGhlIGV2ZW50IGxvb3AgcnVubmluZywKICAgICAgICAgICAgICAgIC8vIHRoZSBwcm9jZXNzIG1heSBleGl0IGJlZm9yZSB0aGUgVGltZW91dCBvYmplY3QncyBjYWxsYmFjayBpcyBpbnZva2VkLgogICAgICAgICAgICAgICAgaWYgKHRoaXMudGltZXIgJiYgaXNOb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50aW1lci51bnJlZigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShBYm9ydGVyLnByb3RvdHlwZSwgImFib3J0ZWQiLCB7CiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBTdGF0dXMgb2Ygd2hldGhlciBhYm9ydGVkIG9yIG5vdC4KICAgICAgICAgICAgICoKICAgICAgICAgICAgICogQHJlYWRvbmx5CiAgICAgICAgICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICAgICAgICAgKiBAbWVtYmVyb2YgQWJvcnRlcgogICAgICAgICAgICAgKi8KICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYWJvcnRlZDsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgICAgfSk7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEFib3J0ZXIsICJub25lIiwgewogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogQ3JlYXRlcyBhIG5ldyBBYm9ydGVyIGluc3RhbmNlIHdpdGhvdXQgdGltZW91dC4KICAgICAgICAgICAgICoKICAgICAgICAgICAgICogQHJlYWRvbmx5CiAgICAgICAgICAgICAqIEBzdGF0aWMKICAgICAgICAgICAgICogQHR5cGUge0Fib3J0ZXJ9CiAgICAgICAgICAgICAqIEBtZW1iZXJvZiBBYm9ydGVyCiAgICAgICAgICAgICAqLwogICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQWJvcnRlcih1bmRlZmluZWQsIDApOwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICB9KTsKICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGVzIGEgbmV3IEFib3J0ZXIgaW5zdGFuY2Ugd2l0aCB0aW1lb3V0IGluIG1pbGxpc2Vjb25kcy4KICAgICAgICAgKiBTZXQgcGFyYW1ldGVyIHRpbWVvdXQgdG8gMCB3aWxsIG5vdCBjcmVhdGUgYSB0aW1lci4KICAgICAgICAgKgogICAgICAgICAqIEBzdGF0aWMKICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0ge3RpbWVvdXR9IGluIG1pbGxpc2Vjb25kcwogICAgICAgICAqIEByZXR1cm5zIHtBYm9ydGVyfQogICAgICAgICAqIEBtZW1iZXJvZiBBYm9ydGVyCiAgICAgICAgICovCiAgICAgICAgQWJvcnRlci50aW1lb3V0ID0gZnVuY3Rpb24gKHRpbWVvdXQpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBBYm9ydGVyKHVuZGVmaW5lZCwgdGltZW91dCk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGUgYW5kIHJldHVybiBhIG5ldyBBYm9ydGVyIGluc3RhbmNlLCB3aGljaCB3aWxsIGJlIGFwcGVuZGVkIGFzIGEgY2hpbGQgbm9kZSBvZiBjdXJyZW50IEFib3J0ZXIuCiAgICAgICAgICogQ3VycmVudCBBYm9ydGVyIGluc3RhbmNlIGJlY29tZXMgZmF0aGVyIG5vZGUgb2YgdGhlIG5ldyBpbnN0YW5jZS4gV2hlbiBjdXJyZW50IG9yIGZhdGhlciBBYm9ydGVyIG5vZGUKICAgICAgICAgKiB0cmlnZ2VycyB0aW1lb3V0IGV2ZW50LCBhbGwgY2hpbGRyZW4gbm9kZXMgYWJvcnQgZXZlbnQgd2lsbCBiZSB0cmlnZ2VyZWQgdG9vLgogICAgICAgICAqCiAgICAgICAgICogV2hlbiB0aW1lb3V0IHBhcmFtZXRlciAoaW4gbWlsbGlzZWNvbmQpIGlzIGxhcmdlciB0aGFuIDAsIHRoZSBhYm9ydCBldmVudCB3aWxsIGJlIHRyaWdnZXJlZCB3aGVuIHRpbWVvdXQuCiAgICAgICAgICogT3RoZXJ3aXNlLCBjYWxsIGFib3J0KCkgbWV0aG9kIHRvIG1hbnVhbGx5IGFib3J0LgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IHt0aW1lb3V0fSBUaW1lb3V0IGluIG1pbGxpc2Vjb25kLgogICAgICAgICAqIEByZXR1cm5zIHtBYm9ydGVyfSBUaGUgbmV3IEFib3J0ZXIgaW5zdGFuY2UgY3JlYXRlZC4KICAgICAgICAgKiBAbWVtYmVyb2YgQWJvcnRlcgogICAgICAgICAqLwogICAgICAgIEFib3J0ZXIucHJvdG90eXBlLndpdGhUaW1lb3V0ID0gZnVuY3Rpb24gKHRpbWVvdXQpIHsKICAgICAgICAgICAgdmFyIGNoaWxkQ2FuY2VsQ29udGV4dCA9IG5ldyBBYm9ydGVyKHRoaXMsIHRpbWVvdXQpOwogICAgICAgICAgICB0aGlzLmNoaWxkcmVuLnB1c2goY2hpbGRDYW5jZWxDb250ZXh0KTsKICAgICAgICAgICAgcmV0dXJuIGNoaWxkQ2FuY2VsQ29udGV4dDsKICAgICAgICB9OwogICAgICAgIC8qKgogICAgICAgICAqIENyZWF0ZSBhbmQgcmV0dXJuIGEgbmV3IEFib3J0ZXIgaW5zdGFuY2UsIHdoaWNoIHdpbGwgYmUgYXBwZW5kZWQgYXMgYSBjaGlsZCBub2RlIG9mIGN1cnJlbnQgQWJvcnRlci4KICAgICAgICAgKiBDdXJyZW50IEFib3J0ZXIgaW5zdGFuY2UgYmVjb21lcyBmYXRoZXIgbm9kZSBvZiB0aGUgbmV3IGluc3RhbmNlLiBXaGVuIGN1cnJlbnQgb3IgZmF0aGVyIEFib3J0ZXIgbm9kZQogICAgICAgICAqIHRyaWdnZXJzIHRpbWVvdXQgZXZlbnQsIGFsbCBjaGlsZHJlbiBub2RlcyBhYm9ydCBldmVudCB3aWxsIGJlIHRyaWdnZXJlZCB0b28uCiAgICAgICAgICoKICAgICAgICAgKiBJbW11dGFibGUga2V5IHZhbHVlIHBhaXIgd2lsbCBiZSBzZXQgaW50byB0aGUgbmV3IGNyZWF0ZWQgQWJvcnRlciBpbnN0YW5jZS4KICAgICAgICAgKiBDYWxsIGdldFZhbHVlKCkgdG8gZmluZCBvdXQgbGF0ZXN0IHZhbHVlIHdpdGggY29ycmVzcG9uZGluZyBrZXkgaW4gdGhlIGNoYWluIG9mCiAgICAgICAgICogW2N1cnJlbnQgbm9kZV0gLT4gW3BhcmVudCBub2RlXSBhbmQgW2dyYW5kIHBhcmVudCBub2RlXS4uLi4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkKICAgICAgICAgKiBAcGFyYW0geyhzdHJpbmcgfCBudW1iZXIgfCBib29sZWFuIHwgbnVsbCl9IFt2YWx1ZV0KICAgICAgICAgKiBAcmV0dXJucyB7QWJvcnRlcn0KICAgICAgICAgKiBAbWVtYmVyb2YgQWJvcnRlcgogICAgICAgICAqLwogICAgICAgIEFib3J0ZXIucHJvdG90eXBlLndpdGhWYWx1ZSA9IGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CiAgICAgICAgICAgIHZhciBjaGlsZENhbmNlbENvbnRleHQgPSBuZXcgQWJvcnRlcih0aGlzLCAwLCBrZXksIHZhbHVlKTsKICAgICAgICAgICAgdGhpcy5jaGlsZHJlbi5wdXNoKGNoaWxkQ2FuY2VsQ29udGV4dCk7CiAgICAgICAgICAgIHJldHVybiBjaGlsZENhbmNlbENvbnRleHQ7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBGaW5kIG91dCBsYXRlc3QgdmFsdWUgd2l0aCBjb3JyZXNwb25kaW5nIGtleSBpbiB0aGUgY2hhaW4gb2YKICAgICAgICAgKiBbY3VycmVudCBub2RlXSAtPiBbcGFyZW50IG5vZGVdIC0+IFtncmFuZCBwYXJlbnQgbm9kZV0gLT4gLi4uIC0+IFtyb290IG5vZGVdLgogICAgICAgICAqCiAgICAgICAgICogSWYga2V5IGlzIG5vdCBmb3VuZCwgdW5kZWZpbmVkIHdpbGwgYmUgcmV0dXJuZWQuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5CiAgICAgICAgICogQHJldHVybnMgeyhzdHJpbmcgfCBudW1iZXIgfCBib29sZWFuIHwgbnVsbCB8IHVuZGVmaW5lZCl9CiAgICAgICAgICogQG1lbWJlcm9mIEFib3J0ZXIKICAgICAgICAgKi8KICAgICAgICBBYm9ydGVyLnByb3RvdHlwZS5nZXRWYWx1ZSA9IGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAgICAgZm9yICh2YXIgcGFyZW50XzEgPSB0aGlzOyBwYXJlbnRfMTsgcGFyZW50XzEgPSBwYXJlbnRfMS5wYXJlbnQpIHsKICAgICAgICAgICAgICAgIGlmIChwYXJlbnRfMS5rZXkgPT09IGtleSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJlbnRfMS52YWx1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogVHJpZ2dlciBhYm9ydCBldmVudCBpbW1lZGlhdGVseSwgdGhlIG9uYWJvcnQgYW5kIGFsbCBhYm9ydCBldmVudCBsaXN0ZW5lcnMgd2lsbCBiZSB0cmlnZ2VyZWQuCiAgICAgICAgICogV2lsbCB0cnkgdG8gdHJpZ2dlciBhYm9ydCBldmVudCBmb3IgYWxsIGNoaWxkcmVuIEFib3J0ZXIgbm9kZXMuCiAgICAgICAgICoKICAgICAgICAgKiAtIElmIHRoZXJlIGlzIGEgdGltZW91dCwgdGhlIHRpbWVyIHdpbGwgYmUgY2FuY2VsbGVkLgogICAgICAgICAqIC0gSWYgYWJvcnRlZCBpcyB0cnVlLCBub3RoaW5nIHdpbGwgaGFwcGVuLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybnMKICAgICAgICAgKiBAbWVtYmVyb2YgQWJvcnRlcgogICAgICAgICAqLwogICAgICAgIEFib3J0ZXIucHJvdG90eXBlLmFib3J0ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICAgICAgICBpZiAodGhpcy5hYm9ydGVkKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5jYW5jZWxUaW1lcigpOwogICAgICAgICAgICBpZiAodGhpcy5vbmFib3J0KSB7CiAgICAgICAgICAgICAgICB0aGlzLm9uYWJvcnQuY2FsbCh0aGlzLCB7IHR5cGU6ICJhYm9ydCIgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5hYm9ydEV2ZW50TGlzdGVuZXJzLmZvckVhY2goZnVuY3Rpb24gKGxpc3RlbmVyKSB7CiAgICAgICAgICAgICAgICBsaXN0ZW5lci5jYWxsKF90aGlzLCB7IHR5cGU6ICJhYm9ydCIgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGNoaWxkKSB7IHJldHVybiBjaGlsZC5jYW5jZWxCeVBhcmVudCgpOyB9KTsKICAgICAgICAgICAgdGhpcy5fYWJvcnRlZCA9IHRydWU7CiAgICAgICAgfTsKICAgICAgICAvLyBwdWJsaWMgZGlzcG9zZSgpIHsKICAgICAgICAvLyAgIGlmICh0aGlzLmRpc3Bvc2VkIHx8IHRoaXMuYWJvcnRlZCkgewogICAgICAgIC8vICAgICByZXR1cm47CiAgICAgICAgLy8gICB9CiAgICAgICAgLy8gICB0aGlzLmNhbmNlbFRpbWVyKCk7CiAgICAgICAgLy8gICAvLyAocGFyZW50KUEgPC0gQiA8LSBDKGNoaWxkKSwgaWYgQiBkaXNwb3Nlcywgd2hlbiBBIGFib3J0LCBDIHdpbGwgbm90IGFib3J0CiAgICAgICAgLy8gICBpZiAodGhpcy5wYXJlbnQpIHsKICAgICAgICAvLyAgICAgY29uc3QgaW5kZXggPSB0aGlzLnBhcmVudC5jaGlsZHJlbi5pbmRleE9mKHRoaXMpOwogICAgICAgIC8vICAgICBpZiAoaW5kZXggPiAtMSkgewogICAgICAgIC8vICAgICAgIHRoaXMucGFyZW50LmNoaWxkcmVuLnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgLy8gICAgIH0KICAgICAgICAvLyAgIH0KICAgICAgICAvLyAgIHRoaXMuZGlzcG9zZWQgPSB0cnVlOwogICAgICAgIC8vIH0KICAgICAgICAvKioKICAgICAgICAgKiBBZGRlZCBuZXcgImFib3J0IiBldmVudCBsaXN0ZW5lciwgb25seSBzdXBwb3J0ICJhYm9ydCIgZXZlbnQuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0geyJhYm9ydCJ9IF90eXBlIE9ubHkgc3VwcG9ydCAiYWJvcnQiIGV2ZW50CiAgICAgICAgICogQHBhcmFtIHsodGhpczogQWJvcnRTaWduYWxMaWtlLCBldjogYW55KSA9PiBhbnl9IGxpc3RlbmVyCiAgICAgICAgICogQG1lbWJlcm9mIEFib3J0ZXIKICAgICAgICAgKi8KICAgICAgICBBYm9ydGVyLnByb3RvdHlwZS5hZGRFdmVudExpc3RlbmVyID0gZnVuY3Rpb24gKAogICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTp2YXJpYWJsZS1uYW1lCiAgICAgICAgX3R5cGUsIGxpc3RlbmVyKSB7CiAgICAgICAgICAgIHRoaXMuYWJvcnRFdmVudExpc3RlbmVycy5wdXNoKGxpc3RlbmVyKTsKICAgICAgICB9OwogICAgICAgIC8qKgogICAgICAgICAqIFJlbW92ZSAiYWJvcnQiIGV2ZW50IGxpc3RlbmVyLCBvbmx5IHN1cHBvcnQgImFib3J0IiBldmVudC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7ImFib3J0In0gX3R5cGUgT25seSBzdXBwb3J0ICJhYm9ydCIgZXZlbnQKICAgICAgICAgKiBAcGFyYW0geyh0aGlzOiBBYm9ydFNpZ25hbExpa2UsIGV2OiBhbnkpID0+IGFueX0gbGlzdGVuZXIKICAgICAgICAgKiBAbWVtYmVyb2YgQWJvcnRlcgogICAgICAgICAqLwogICAgICAgIEFib3J0ZXIucHJvdG90eXBlLnJlbW92ZUV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbiAoCiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOnZhcmlhYmxlLW5hbWUKICAgICAgICBfdHlwZSwgbGlzdGVuZXIpIHsKICAgICAgICAgICAgdmFyIGluZGV4ID0gdGhpcy5hYm9ydEV2ZW50TGlzdGVuZXJzLmluZGV4T2YobGlzdGVuZXIpOwogICAgICAgICAgICBpZiAoaW5kZXggPiAtMSkgewogICAgICAgICAgICAgICAgdGhpcy5hYm9ydEV2ZW50TGlzdGVuZXJzLnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIEFib3J0ZXIucHJvdG90eXBlLmRpc3BhdGNoRXZlbnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiTWV0aG9kIG5vdCBpbXBsZW1lbnRlZC4iKTsKICAgICAgICB9OwogICAgICAgIEFib3J0ZXIucHJvdG90eXBlLmNhbmNlbEJ5UGFyZW50ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAvLyBpZiAoIXRoaXMuZGlzcG9zZWQpIHsKICAgICAgICAgICAgdGhpcy5hYm9ydCgpOwogICAgICAgICAgICAvLyB9CiAgICAgICAgfTsKICAgICAgICBBYm9ydGVyLnByb3RvdHlwZS5jYW5jZWxUaW1lciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKHRoaXMudGltZXIpIHsKICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnRpbWVyKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgcmV0dXJuIEFib3J0ZXI7CiAgICB9KCkpOwoKICAgIC8vIFRoaXMgZmlsZSBpcyB1c2VkIGFzIGEgc2hpbSBvZiAiQmxvYkRvd25sb2FkUmVzcG9uc2UiIGZvciBzb21lIGJyb3dzZXIgYnVuZGxlcnMKICAgIC8vIHdoZW4gdHJ5aW5nIHRvIGJ1bmRsZSAiQmxvYkRvd25sb2FkUmVzcG9uc2UiCiAgICAvLyAiQmxvYkRvd25sb2FkUmVzcG9uc2UiIGNsYXNzIGlzIG9ubHkgYXZhaWxhYmxlIGluIE5vZGUuanMgcnVudGltZQogICAgdmFyIEJsb2JEb3dubG9hZFJlc3BvbnNlID0gMTsKCiAgICAvKgogICAgICogQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAgICAgKiBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLgogICAgICoKICAgICAqIENvZGUgZ2VuZXJhdGVkIGJ5IE1pY3Jvc29mdCAoUikgQXV0b1Jlc3QgQ29kZSBHZW5lcmF0b3IuCiAgICAgKiBDaGFuZ2VzIG1heSBjYXVzZSBpbmNvcnJlY3QgYmVoYXZpb3IgYW5kIHdpbGwgYmUgbG9zdCBpZiB0aGUgY29kZSBpcyByZWdlbmVyYXRlZC4KICAgICAqLwogICAgdmFyIEtleUluZm8gPSB7CiAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJLZXlJbmZvIiwKICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgIG5hbWU6ICJDb21wb3NpdGUiLAogICAgICAgICAgICBjbGFzc05hbWU6ICJLZXlJbmZvIiwKICAgICAgICAgICAgbW9kZWxQcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJTdGFydCIsCiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJTdGFydCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBleHBpcnk6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiRXhwaXJ5IiwKICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIkV4cGlyeSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgVXNlckRlbGVnYXRpb25LZXkgPSB7CiAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJVc2VyRGVsZWdhdGlvbktleSIsCiAgICAgICAgdHlwZTogewogICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiVXNlckRlbGVnYXRpb25LZXkiLAogICAgICAgICAgICBtb2RlbFByb3BlcnRpZXM6IHsKICAgICAgICAgICAgICAgIHNpZ25lZE9pZDogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJTaWduZWRPaWQiLAogICAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiU2lnbmVkT2lkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHNpZ25lZFRpZDogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJTaWduZWRUaWQiLAogICAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiU2lnbmVkVGlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHNpZ25lZFN0YXJ0OiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIlNpZ25lZFN0YXJ0IiwKICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIlNpZ25lZFN0YXJ0IiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHNpZ25lZEV4cGlyeTogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJTaWduZWRFeHBpcnkiLAogICAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiU2lnbmVkRXhwaXJ5IiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHNpZ25lZFNlcnZpY2U6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiU2lnbmVkU2VydmljZSIsCiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJTaWduZWRTZXJ2aWNlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHNpZ25lZFZlcnNpb246IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiU2lnbmVkVmVyc2lvbiIsCiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJTaWduZWRWZXJzaW9uIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHZhbHVlOiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIlZhbHVlIiwKICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIlZhbHVlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBTdG9yYWdlRXJyb3IgPSB7CiAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJTdG9yYWdlRXJyb3IiLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgIGNsYXNzTmFtZTogIlN0b3JhZ2VFcnJvciIsCiAgICAgICAgICAgIG1vZGVsUHJvcGVydGllczogewogICAgICAgICAgICAgICAgbWVzc2FnZTogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJNZXNzYWdlIiwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIk1lc3NhZ2UiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIERhdGFMYWtlU3RvcmFnZUVycm9yRXJyb3IgPSB7CiAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJEYXRhTGFrZVN0b3JhZ2VFcnJvcl9lcnJvciIsCiAgICAgICAgdHlwZTogewogICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiRGF0YUxha2VTdG9yYWdlRXJyb3JFcnJvciIsCiAgICAgICAgICAgIG1vZGVsUHJvcGVydGllczogewogICAgICAgICAgICAgICAgY29kZTogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJDb2RlIiwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIkNvZGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbWVzc2FnZTogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJNZXNzYWdlIiwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIk1lc3NhZ2UiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIERhdGFMYWtlU3RvcmFnZUVycm9yID0gewogICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiRGF0YUxha2VTdG9yYWdlRXJyb3IiLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgIGNsYXNzTmFtZTogIkRhdGFMYWtlU3RvcmFnZUVycm9yIiwKICAgICAgICAgICAgbW9kZWxQcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICBlcnJvcjogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiRGF0YUxha2VTdG9yYWdlRXJyb3JFcnJvciIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIEFjY2Vzc1BvbGljeSA9IHsKICAgICAgICBzZXJpYWxpemVkTmFtZTogIkFjY2Vzc1BvbGljeSIsCiAgICAgICAgdHlwZTogewogICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiQWNjZXNzUG9saWN5IiwKICAgICAgICAgICAgbW9kZWxQcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJTdGFydCIsCiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJTdGFydCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBleHBpcnk6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiRXhwaXJ5IiwKICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIkV4cGlyeSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBwZXJtaXNzaW9uOiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIlBlcm1pc3Npb24iLAogICAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiUGVybWlzc2lvbiIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgQmxvYlByb3BlcnRpZXMgPSB7CiAgICAgICAgeG1sTmFtZTogIlByb3BlcnRpZXMiLAogICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiQmxvYlByb3BlcnRpZXMiLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgIGNsYXNzTmFtZTogIkJsb2JQcm9wZXJ0aWVzIiwKICAgICAgICAgICAgbW9kZWxQcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICBjcmVhdGlvblRpbWU6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiQ3JlYXRpb24tVGltZSIsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJDcmVhdGlvbi1UaW1lIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJEYXRlVGltZVJmYzExMjMiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGxhc3RNb2RpZmllZDogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJMYXN0LU1vZGlmaWVkIiwKICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIkxhc3QtTW9kaWZpZWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXRhZzogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJFdGFnIiwKICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIkV0YWciLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY29udGVudExlbmd0aDogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJDb250ZW50LUxlbmd0aCIsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJDb250ZW50LUxlbmd0aCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiTnVtYmVyIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJDb250ZW50LVR5cGUiLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiQ29udGVudC1UeXBlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNvbnRlbnRFbmNvZGluZzogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJDb250ZW50LUVuY29kaW5nIiwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIkNvbnRlbnQtRW5jb2RpbmciLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY29udGVudExhbmd1YWdlOiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIkNvbnRlbnQtTGFuZ3VhZ2UiLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiQ29udGVudC1MYW5ndWFnZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjb250ZW50TUQ1OiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIkNvbnRlbnQtTUQ1IiwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIkNvbnRlbnQtTUQ1IiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJCeXRlQXJyYXkiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNvbnRlbnREaXNwb3NpdGlvbjogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJDb250ZW50LURpc3Bvc2l0aW9uIiwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIkNvbnRlbnQtRGlzcG9zaXRpb24iLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2FjaGVDb250cm9sOiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIkNhY2hlLUNvbnRyb2wiLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiQ2FjaGUtQ29udHJvbCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBibG9iU2VxdWVuY2VOdW1iZXI6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAieC1tcy1ibG9iLXNlcXVlbmNlLW51bWJlciIsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWJsb2Itc2VxdWVuY2UtbnVtYmVyIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJOdW1iZXIiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGJsb2JUeXBlOiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIkJsb2JUeXBlIiwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIkJsb2JUeXBlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJFbnVtIiwKICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dlZFZhbHVlczogWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIkJsb2NrQmxvYiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiUGFnZUJsb2IiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIkFwcGVuZEJsb2IiCiAgICAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbGVhc2VTdGF0dXM6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiTGVhc2VTdGF0dXMiLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiTGVhc2VTdGF0dXMiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkVudW0iLAogICAgICAgICAgICAgICAgICAgICAgICBhbGxvd2VkVmFsdWVzOiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAibG9ja2VkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ1bmxvY2tlZCIKICAgICAgICAgICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsZWFzZVN0YXRlOiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIkxlYXNlU3RhdGUiLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiTGVhc2VTdGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRW51bSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGFsbG93ZWRWYWx1ZXM6IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJhdmFpbGFibGUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImxlYXNlZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZXhwaXJlZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYnJlYWtpbmciLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImJyb2tlbiIKICAgICAgICAgICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsZWFzZUR1cmF0aW9uOiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIkxlYXNlRHVyYXRpb24iLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiTGVhc2VEdXJhdGlvbiIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRW51bSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGFsbG93ZWRWYWx1ZXM6IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJpbmZpbml0ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZml4ZWQiCiAgICAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY29weUlkOiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIkNvcHlJZCIsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJDb3B5SWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY29weVN0YXR1czogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJDb3B5U3RhdHVzIiwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIkNvcHlTdGF0dXMiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkVudW0iLAogICAgICAgICAgICAgICAgICAgICAgICBhbGxvd2VkVmFsdWVzOiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAicGVuZGluZyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAic3VjY2VzcyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYWJvcnRlZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZmFpbGVkIgogICAgICAgICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNvcHlTb3VyY2U6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiQ29weVNvdXJjZSIsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJDb3B5U291cmNlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNvcHlQcm9ncmVzczogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJDb3B5UHJvZ3Jlc3MiLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiQ29weVByb2dyZXNzIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNvcHlDb21wbGV0aW9uVGltZTogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJDb3B5Q29tcGxldGlvblRpbWUiLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiQ29weUNvbXBsZXRpb25UaW1lIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJEYXRlVGltZVJmYzExMjMiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNvcHlTdGF0dXNEZXNjcmlwdGlvbjogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJDb3B5U3RhdHVzRGVzY3JpcHRpb24iLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiQ29weVN0YXR1c0Rlc2NyaXB0aW9uIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHNlcnZlckVuY3J5cHRlZDogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJTZXJ2ZXJFbmNyeXB0ZWQiLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiU2VydmVyRW5jcnlwdGVkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJCb29sZWFuIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBpbmNyZW1lbnRhbENvcHk6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiSW5jcmVtZW50YWxDb3B5IiwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIkluY3JlbWVudGFsQ29weSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQm9vbGVhbiIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZGVzdGluYXRpb25TbmFwc2hvdDogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJEZXN0aW5hdGlvblNuYXBzaG90IiwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIkRlc3RpbmF0aW9uU25hcHNob3QiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZGVsZXRlZFRpbWU6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiRGVsZXRlZFRpbWUiLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiRGVsZXRlZFRpbWUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVtYWluaW5nUmV0ZW50aW9uRGF5czogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJSZW1haW5pbmdSZXRlbnRpb25EYXlzIiwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIlJlbWFpbmluZ1JldGVudGlvbkRheXMiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIk51bWJlciIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgYWNjZXNzVGllcjogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJBY2Nlc3NUaWVyIiwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIkFjY2Vzc1RpZXIiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgYWNjZXNzVGllckluZmVycmVkOiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIkFjY2Vzc1RpZXJJbmZlcnJlZCIsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJBY2Nlc3NUaWVySW5mZXJyZWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkJvb2xlYW4iCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGFyY2hpdmVTdGF0dXM6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiQXJjaGl2ZVN0YXR1cyIsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJBcmNoaXZlU3RhdHVzIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGN1c3RvbWVyUHJvdmlkZWRLZXlTaGEyNTY6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiQ3VzdG9tZXJQcm92aWRlZEtleVNoYTI1NiIsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJDdXN0b21lclByb3ZpZGVkS2V5U2hhMjU2IiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGFjY2Vzc1RpZXJDaGFuZ2VUaW1lOiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIkFjY2Vzc1RpZXJDaGFuZ2VUaW1lIiwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIkFjY2Vzc1RpZXJDaGFuZ2VUaW1lIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJEYXRlVGltZVJmYzExMjMiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBCbG9iTWV0YWRhdGEgPSB7CiAgICAgICAgeG1sTmFtZTogIk1ldGFkYXRhIiwKICAgICAgICBzZXJpYWxpemVkTmFtZTogIkJsb2JNZXRhZGF0YSIsCiAgICAgICAgdHlwZTogewogICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiQmxvYk1ldGFkYXRhIiwKICAgICAgICAgICAgbW9kZWxQcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICBlbmNyeXB0ZWQ6IHsKICAgICAgICAgICAgICAgICAgICB4bWxJc0F0dHJpYnV0ZTogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiRW5jcnlwdGVkIiwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIkVuY3J5cHRlZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgYWRkaXRpb25hbFByb3BlcnRpZXM6IHsKICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBCbG9iSXRlbSA9IHsKICAgICAgICB4bWxOYW1lOiAiQmxvYiIsCiAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJCbG9iSXRlbSIsCiAgICAgICAgdHlwZTogewogICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiQmxvYkl0ZW0iLAogICAgICAgICAgICBtb2RlbFByb3BlcnRpZXM6IHsKICAgICAgICAgICAgICAgIG5hbWU6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiTmFtZSIsCiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGRlbGV0ZWQ6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiRGVsZXRlZCIsCiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJEZWxldGVkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJCb29sZWFuIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzbmFwc2hvdDogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJTbmFwc2hvdCIsCiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJTbmFwc2hvdCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIlByb3BlcnRpZXMiLAogICAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiUHJvcGVydGllcyIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiQmxvYlByb3BlcnRpZXMiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIG1ldGFkYXRhOiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIk1ldGFkYXRhIiwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIk1ldGFkYXRhIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJDb21wb3NpdGUiLAogICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJCbG9iTWV0YWRhdGEiLAogICAgICAgICAgICAgICAgICAgICAgICBhZGRpdGlvbmFsUHJvcGVydGllczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIEJsb2JGbGF0TGlzdFNlZ21lbnQgPSB7CiAgICAgICAgeG1sTmFtZTogIkJsb2JzIiwKICAgICAgICBzZXJpYWxpemVkTmFtZTogIkJsb2JGbGF0TGlzdFNlZ21lbnQiLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgIGNsYXNzTmFtZTogIkJsb2JGbGF0TGlzdFNlZ21lbnQiLAogICAgICAgICAgICBtb2RlbFByb3BlcnRpZXM6IHsKICAgICAgICAgICAgICAgIGJsb2JJdGVtczogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJCbG9iSXRlbXMiLAogICAgICAgICAgICAgICAgICAgIHhtbEVsZW1lbnROYW1lOiAiQmxvYiIsCiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJCbG9iSXRlbXMiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlNlcXVlbmNlIiwKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJDb21wb3NpdGUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogIkJsb2JJdGVtIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBMaXN0QmxvYnNGbGF0U2VnbWVudFJlc3BvbnNlID0gewogICAgICAgIHhtbE5hbWU6ICJFbnVtZXJhdGlvblJlc3VsdHMiLAogICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiTGlzdEJsb2JzRmxhdFNlZ21lbnRSZXNwb25zZSIsCiAgICAgICAgdHlwZTogewogICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiTGlzdEJsb2JzRmxhdFNlZ21lbnRSZXNwb25zZSIsCiAgICAgICAgICAgIG1vZGVsUHJvcGVydGllczogewogICAgICAgICAgICAgICAgc2VydmljZUVuZHBvaW50OiB7CiAgICAgICAgICAgICAgICAgICAgeG1sSXNBdHRyaWJ1dGU6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIlNlcnZpY2VFbmRwb2ludCIsCiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJTZXJ2aWNlRW5kcG9pbnQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY29udGFpbmVyTmFtZTogewogICAgICAgICAgICAgICAgICAgIHhtbElzQXR0cmlidXRlOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJDb250YWluZXJOYW1lIiwKICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIkNvbnRhaW5lck5hbWUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcHJlZml4OiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIlByZWZpeCIsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJQcmVmaXgiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbWFya2VyOiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIk1hcmtlciIsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJNYXJrZXIiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbWF4UmVzdWx0czogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJNYXhSZXN1bHRzIiwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIk1heFJlc3VsdHMiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIk51bWJlciIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZGVsaW1pdGVyOiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIkRlbGltaXRlciIsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJEZWxpbWl0ZXIiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgc2VnbWVudDogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJCbG9icyIsCiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJTZWdtZW50IiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJDb21wb3NpdGUiLAogICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJCbG9iRmxhdExpc3RTZWdtZW50IgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBuZXh0TWFya2VyOiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIk5leHRNYXJrZXIiLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiTmV4dE1hcmtlciIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgQmxvYlByZWZpeCA9IHsKICAgICAgICBzZXJpYWxpemVkTmFtZTogIkJsb2JQcmVmaXgiLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgIGNsYXNzTmFtZTogIkJsb2JQcmVmaXgiLAogICAgICAgICAgICBtb2RlbFByb3BlcnRpZXM6IHsKICAgICAgICAgICAgICAgIG5hbWU6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiTmFtZSIsCiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBCbG9iSGllcmFyY2h5TGlzdFNlZ21lbnQgPSB7CiAgICAgICAgeG1sTmFtZTogIkJsb2JzIiwKICAgICAgICBzZXJpYWxpemVkTmFtZTogIkJsb2JIaWVyYXJjaHlMaXN0U2VnbWVudCIsCiAgICAgICAgdHlwZTogewogICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiQmxvYkhpZXJhcmNoeUxpc3RTZWdtZW50IiwKICAgICAgICAgICAgbW9kZWxQcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICBibG9iUHJlZml4ZXM6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiQmxvYlByZWZpeGVzIiwKICAgICAgICAgICAgICAgICAgICB4bWxFbGVtZW50TmFtZTogIkJsb2JQcmVmaXgiLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiQmxvYlByZWZpeGVzIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTZXF1ZW5jZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJCbG9iUHJlZml4IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGJsb2JJdGVtczogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJCbG9iSXRlbXMiLAogICAgICAgICAgICAgICAgICAgIHhtbEVsZW1lbnROYW1lOiAiQmxvYiIsCiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJCbG9iSXRlbXMiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlNlcXVlbmNlIiwKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJDb21wb3NpdGUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogIkJsb2JJdGVtIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBMaXN0QmxvYnNIaWVyYXJjaHlTZWdtZW50UmVzcG9uc2UgPSB7CiAgICAgICAgeG1sTmFtZTogIkVudW1lcmF0aW9uUmVzdWx0cyIsCiAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJMaXN0QmxvYnNIaWVyYXJjaHlTZWdtZW50UmVzcG9uc2UiLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgIGNsYXNzTmFtZTogIkxpc3RCbG9ic0hpZXJhcmNoeVNlZ21lbnRSZXNwb25zZSIsCiAgICAgICAgICAgIG1vZGVsUHJvcGVydGllczogewogICAgICAgICAgICAgICAgc2VydmljZUVuZHBvaW50OiB7CiAgICAgICAgICAgICAgICAgICAgeG1sSXNBdHRyaWJ1dGU6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIlNlcnZpY2VFbmRwb2ludCIsCiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJTZXJ2aWNlRW5kcG9pbnQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY29udGFpbmVyTmFtZTogewogICAgICAgICAgICAgICAgICAgIHhtbElzQXR0cmlidXRlOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJDb250YWluZXJOYW1lIiwKICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIkNvbnRhaW5lck5hbWUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcHJlZml4OiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIlByZWZpeCIsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJQcmVmaXgiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbWFya2VyOiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIk1hcmtlciIsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJNYXJrZXIiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbWF4UmVzdWx0czogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJNYXhSZXN1bHRzIiwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIk1heFJlc3VsdHMiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIk51bWJlciIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZGVsaW1pdGVyOiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIkRlbGltaXRlciIsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJEZWxpbWl0ZXIiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgc2VnbWVudDogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJCbG9icyIsCiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJTZWdtZW50IiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJDb21wb3NpdGUiLAogICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJCbG9iSGllcmFyY2h5TGlzdFNlZ21lbnQiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIG5leHRNYXJrZXI6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiTmV4dE1hcmtlciIsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJOZXh0TWFya2VyIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBCbG9jayA9IHsKICAgICAgICBzZXJpYWxpemVkTmFtZTogIkJsb2NrIiwKICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgIG5hbWU6ICJDb21wb3NpdGUiLAogICAgICAgICAgICBjbGFzc05hbWU6ICJCbG9jayIsCiAgICAgICAgICAgIG1vZGVsUHJvcGVydGllczogewogICAgICAgICAgICAgICAgbmFtZTogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIk5hbWUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgc2l6ZTogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJTaXplIiwKICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIlNpemUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIk51bWJlciIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIEJsb2NrTGlzdCA9IHsKICAgICAgICBzZXJpYWxpemVkTmFtZTogIkJsb2NrTGlzdCIsCiAgICAgICAgdHlwZTogewogICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiQmxvY2tMaXN0IiwKICAgICAgICAgICAgbW9kZWxQcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICBjb21taXR0ZWRCbG9ja3M6IHsKICAgICAgICAgICAgICAgICAgICB4bWxJc1dyYXBwZWQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIkNvbW1pdHRlZEJsb2NrcyIsCiAgICAgICAgICAgICAgICAgICAgeG1sRWxlbWVudE5hbWU6ICJCbG9jayIsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJDb21taXR0ZWRCbG9ja3MiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlNlcXVlbmNlIiwKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJDb21wb3NpdGUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogIkJsb2NrIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHVuY29tbWl0dGVkQmxvY2tzOiB7CiAgICAgICAgICAgICAgICAgICAgeG1sSXNXcmFwcGVkOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJVbmNvbW1pdHRlZEJsb2NrcyIsCiAgICAgICAgICAgICAgICAgICAgeG1sRWxlbWVudE5hbWU6ICJCbG9jayIsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJVbmNvbW1pdHRlZEJsb2NrcyIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU2VxdWVuY2UiLAogICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiQmxvY2siCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIEJsb2NrTG9va3VwTGlzdCA9IHsKICAgICAgICB4bWxOYW1lOiAiQmxvY2tMaXN0IiwKICAgICAgICBzZXJpYWxpemVkTmFtZTogIkJsb2NrTG9va3VwTGlzdCIsCiAgICAgICAgdHlwZTogewogICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiQmxvY2tMb29rdXBMaXN0IiwKICAgICAgICAgICAgbW9kZWxQcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICBjb21taXR0ZWQ6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiQ29tbWl0dGVkIiwKICAgICAgICAgICAgICAgICAgICB4bWxFbGVtZW50TmFtZTogIkNvbW1pdHRlZCIsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJDb21taXR0ZWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlNlcXVlbmNlIiwKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdW5jb21taXR0ZWQ6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiVW5jb21taXR0ZWQiLAogICAgICAgICAgICAgICAgICAgIHhtbEVsZW1lbnROYW1lOiAiVW5jb21taXR0ZWQiLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiVW5jb21taXR0ZWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlNlcXVlbmNlIiwKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbGF0ZXN0OiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIkxhdGVzdCIsCiAgICAgICAgICAgICAgICAgICAgeG1sRWxlbWVudE5hbWU6ICJMYXRlc3QiLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiTGF0ZXN0IiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTZXF1ZW5jZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBDb250YWluZXJQcm9wZXJ0aWVzID0gewogICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiQ29udGFpbmVyUHJvcGVydGllcyIsCiAgICAgICAgdHlwZTogewogICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiQ29udGFpbmVyUHJvcGVydGllcyIsCiAgICAgICAgICAgIG1vZGVsUHJvcGVydGllczogewogICAgICAgICAgICAgICAgbGFzdE1vZGlmaWVkOiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIkxhc3QtTW9kaWZpZWQiLAogICAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiTGFzdC1Nb2RpZmllZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGF0ZVRpbWVSZmMxMTIzIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBldGFnOiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIkV0YWciLAogICAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiRXRhZyIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsZWFzZVN0YXR1czogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJMZWFzZVN0YXR1cyIsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJMZWFzZVN0YXR1cyIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRW51bSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGFsbG93ZWRWYWx1ZXM6IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJsb2NrZWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInVubG9ja2VkIgogICAgICAgICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGxlYXNlU3RhdGU6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiTGVhc2VTdGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJMZWFzZVN0YXRlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJFbnVtIiwKICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dlZFZhbHVlczogWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgImF2YWlsYWJsZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAibGVhc2VkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJleHBpcmVkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJicmVha2luZyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYnJva2VuIgogICAgICAgICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGxlYXNlRHVyYXRpb246IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiTGVhc2VEdXJhdGlvbiIsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJMZWFzZUR1cmF0aW9uIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJFbnVtIiwKICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dlZFZhbHVlczogWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgImluZmluaXRlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJmaXhlZCIKICAgICAgICAgICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBwdWJsaWNBY2Nlc3M6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiUHVibGljQWNjZXNzIiwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIlB1YmxpY0FjY2VzcyIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBoYXNJbW11dGFiaWxpdHlQb2xpY3k6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiSGFzSW1tdXRhYmlsaXR5UG9saWN5IiwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIkhhc0ltbXV0YWJpbGl0eVBvbGljeSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQm9vbGVhbiIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgaGFzTGVnYWxIb2xkOiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIkhhc0xlZ2FsSG9sZCIsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJIYXNMZWdhbEhvbGQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkJvb2xlYW4iCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBDb250YWluZXJJdGVtID0gewogICAgICAgIHhtbE5hbWU6ICJDb250YWluZXIiLAogICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiQ29udGFpbmVySXRlbSIsCiAgICAgICAgdHlwZTogewogICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiQ29udGFpbmVySXRlbSIsCiAgICAgICAgICAgIG1vZGVsUHJvcGVydGllczogewogICAgICAgICAgICAgICAgbmFtZTogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIk5hbWUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcHJvcGVydGllczogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJQcm9wZXJ0aWVzIiwKICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIlByb3BlcnRpZXMiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogIkNvbnRhaW5lclByb3BlcnRpZXMiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIG1ldGFkYXRhOiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIk1ldGFkYXRhIiwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIk1ldGFkYXRhIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJEaWN0aW9uYXJ5IiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBMaXN0Q29udGFpbmVyc1NlZ21lbnRSZXNwb25zZSA9IHsKICAgICAgICB4bWxOYW1lOiAiRW51bWVyYXRpb25SZXN1bHRzIiwKICAgICAgICBzZXJpYWxpemVkTmFtZTogIkxpc3RDb250YWluZXJzU2VnbWVudFJlc3BvbnNlIiwKICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgIG5hbWU6ICJDb21wb3NpdGUiLAogICAgICAgICAgICBjbGFzc05hbWU6ICJMaXN0Q29udGFpbmVyc1NlZ21lbnRSZXNwb25zZSIsCiAgICAgICAgICAgIG1vZGVsUHJvcGVydGllczogewogICAgICAgICAgICAgICAgc2VydmljZUVuZHBvaW50OiB7CiAgICAgICAgICAgICAgICAgICAgeG1sSXNBdHRyaWJ1dGU6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIlNlcnZpY2VFbmRwb2ludCIsCiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJTZXJ2aWNlRW5kcG9pbnQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcHJlZml4OiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIlByZWZpeCIsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJQcmVmaXgiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbWFya2VyOiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIk1hcmtlciIsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJNYXJrZXIiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbWF4UmVzdWx0czogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJNYXhSZXN1bHRzIiwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIk1heFJlc3VsdHMiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIk51bWJlciIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY29udGFpbmVySXRlbXM6IHsKICAgICAgICAgICAgICAgICAgICB4bWxJc1dyYXBwZWQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIkNvbnRhaW5lcnMiLAogICAgICAgICAgICAgICAgICAgIHhtbEVsZW1lbnROYW1lOiAiQ29udGFpbmVyIiwKICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIkNvbnRhaW5lckl0ZW1zIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTZXF1ZW5jZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJDb250YWluZXJJdGVtIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIG5leHRNYXJrZXI6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiTmV4dE1hcmtlciIsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJOZXh0TWFya2VyIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBDb3JzUnVsZSA9IHsKICAgICAgICBzZXJpYWxpemVkTmFtZTogIkNvcnNSdWxlIiwKICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgIG5hbWU6ICJDb21wb3NpdGUiLAogICAgICAgICAgICBjbGFzc05hbWU6ICJDb3JzUnVsZSIsCiAgICAgICAgICAgIG1vZGVsUHJvcGVydGllczogewogICAgICAgICAgICAgICAgYWxsb3dlZE9yaWdpbnM6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiQWxsb3dlZE9yaWdpbnMiLAogICAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiQWxsb3dlZE9yaWdpbnMiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgYWxsb3dlZE1ldGhvZHM6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiQWxsb3dlZE1ldGhvZHMiLAogICAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiQWxsb3dlZE1ldGhvZHMiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgYWxsb3dlZEhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiQWxsb3dlZEhlYWRlcnMiLAogICAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiQWxsb3dlZEhlYWRlcnMiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXhwb3NlZEhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiRXhwb3NlZEhlYWRlcnMiLAogICAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiRXhwb3NlZEhlYWRlcnMiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbWF4QWdlSW5TZWNvbmRzOiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIk1heEFnZUluU2Vjb25kcyIsCiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJNYXhBZ2VJblNlY29uZHMiLAogICAgICAgICAgICAgICAgICAgIGNvbnN0cmFpbnRzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIEluY2x1c2l2ZU1pbmltdW06IDAKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIk51bWJlciIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIEdlb1JlcGxpY2F0aW9uID0gewogICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiR2VvUmVwbGljYXRpb24iLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgIGNsYXNzTmFtZTogIkdlb1JlcGxpY2F0aW9uIiwKICAgICAgICAgICAgbW9kZWxQcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICBzdGF0dXM6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiU3RhdHVzIiwKICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIlN0YXR1cyIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsYXN0U3luY1RpbWU6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiTGFzdFN5bmNUaW1lIiwKICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIkxhc3RTeW5jVGltZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGF0ZVRpbWVSZmMxMTIzIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgUmV0ZW50aW9uUG9saWN5ID0gewogICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiUmV0ZW50aW9uUG9saWN5IiwKICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgIG5hbWU6ICJDb21wb3NpdGUiLAogICAgICAgICAgICBjbGFzc05hbWU6ICJSZXRlbnRpb25Qb2xpY3kiLAogICAgICAgICAgICBtb2RlbFByb3BlcnRpZXM6IHsKICAgICAgICAgICAgICAgIGVuYWJsZWQ6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiRW5hYmxlZCIsCiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJFbmFibGVkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJCb29sZWFuIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBkYXlzOiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIkRheXMiLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiRGF5cyIsCiAgICAgICAgICAgICAgICAgICAgY29uc3RyYWludHM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgSW5jbHVzaXZlTWluaW11bTogMQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiTnVtYmVyIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgTG9nZ2luZyA9IHsKICAgICAgICBzZXJpYWxpemVkTmFtZTogIkxvZ2dpbmciLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgIGNsYXNzTmFtZTogIkxvZ2dpbmciLAogICAgICAgICAgICBtb2RlbFByb3BlcnRpZXM6IHsKICAgICAgICAgICAgICAgIHZlcnNpb246IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiVmVyc2lvbiIsCiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJWZXJzaW9uIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGRlbGV0ZVByb3BlcnR5OiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIkRlbGV0ZSIsCiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJEZWxldGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkJvb2xlYW4iCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlYWQ6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiUmVhZCIsCiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJSZWFkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJCb29sZWFuIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB3cml0ZTogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJXcml0ZSIsCiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJXcml0ZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQm9vbGVhbiIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmV0ZW50aW9uUG9saWN5OiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIlJldGVudGlvblBvbGljeSIsCiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJSZXRlbnRpb25Qb2xpY3kiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogIlJldGVudGlvblBvbGljeSIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIE1ldHJpY3MgPSB7CiAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJNZXRyaWNzIiwKICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgIG5hbWU6ICJDb21wb3NpdGUiLAogICAgICAgICAgICBjbGFzc05hbWU6ICJNZXRyaWNzIiwKICAgICAgICAgICAgbW9kZWxQcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICB2ZXJzaW9uOiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIlZlcnNpb24iLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiVmVyc2lvbiIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlbmFibGVkOiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIkVuYWJsZWQiLAogICAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiRW5hYmxlZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQm9vbGVhbiIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgaW5jbHVkZUFQSXM6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiSW5jbHVkZUFQSXMiLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiSW5jbHVkZUFQSXMiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkJvb2xlYW4iCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJldGVudGlvblBvbGljeTogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJSZXRlbnRpb25Qb2xpY3kiLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiUmV0ZW50aW9uUG9saWN5IiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJDb21wb3NpdGUiLAogICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJSZXRlbnRpb25Qb2xpY3kiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBQYWdlUmFuZ2UgPSB7CiAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJQYWdlUmFuZ2UiLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgIGNsYXNzTmFtZTogIlBhZ2VSYW5nZSIsCiAgICAgICAgICAgIG1vZGVsUHJvcGVydGllczogewogICAgICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiU3RhcnQiLAogICAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiU3RhcnQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIk51bWJlciIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIkVuZCIsCiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJFbmQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIk51bWJlciIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIENsZWFyUmFuZ2UgPSB7CiAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJDbGVhclJhbmdlIiwKICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgIG5hbWU6ICJDb21wb3NpdGUiLAogICAgICAgICAgICBjbGFzc05hbWU6ICJDbGVhclJhbmdlIiwKICAgICAgICAgICAgbW9kZWxQcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJTdGFydCIsCiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJTdGFydCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiTnVtYmVyIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiRW5kIiwKICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIkVuZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiTnVtYmVyIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgUGFnZUxpc3QgPSB7CiAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJQYWdlTGlzdCIsCiAgICAgICAgdHlwZTogewogICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiUGFnZUxpc3QiLAogICAgICAgICAgICBtb2RlbFByb3BlcnRpZXM6IHsKICAgICAgICAgICAgICAgIHBhZ2VSYW5nZTogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJQYWdlUmFuZ2UiLAogICAgICAgICAgICAgICAgICAgIHhtbEVsZW1lbnROYW1lOiAiUGFnZVJhbmdlIiwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIlBhZ2VSYW5nZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU2VxdWVuY2UiLAogICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiUGFnZVJhbmdlIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNsZWFyUmFuZ2U6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiQ2xlYXJSYW5nZSIsCiAgICAgICAgICAgICAgICAgICAgeG1sRWxlbWVudE5hbWU6ICJDbGVhclJhbmdlIiwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIkNsZWFyUmFuZ2UiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlNlcXVlbmNlIiwKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJDb21wb3NpdGUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogIkNsZWFyUmFuZ2UiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIFNpZ25lZElkZW50aWZpZXIgPSB7CiAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJTaWduZWRJZGVudGlmaWVyIiwKICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgIG5hbWU6ICJDb21wb3NpdGUiLAogICAgICAgICAgICBjbGFzc05hbWU6ICJTaWduZWRJZGVudGlmaWVyIiwKICAgICAgICAgICAgbW9kZWxQcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICBpZDogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJJZCIsCiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJJZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBhY2Nlc3NQb2xpY3k6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiQWNjZXNzUG9saWN5IiwKICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIkFjY2Vzc1BvbGljeSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiQWNjZXNzUG9saWN5IgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgU3RhdGljV2Vic2l0ZSA9IHsKICAgICAgICBzZXJpYWxpemVkTmFtZTogIlN0YXRpY1dlYnNpdGUiLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgIGNsYXNzTmFtZTogIlN0YXRpY1dlYnNpdGUiLAogICAgICAgICAgICBtb2RlbFByb3BlcnRpZXM6IHsKICAgICAgICAgICAgICAgIGVuYWJsZWQ6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiRW5hYmxlZCIsCiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJFbmFibGVkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJCb29sZWFuIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBpbmRleERvY3VtZW50OiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIkluZGV4RG9jdW1lbnQiLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiSW5kZXhEb2N1bWVudCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlcnJvckRvY3VtZW50NDA0UGF0aDogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJFcnJvckRvY3VtZW50NDA0UGF0aCIsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJFcnJvckRvY3VtZW50NDA0UGF0aCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgU3RvcmFnZVNlcnZpY2VQcm9wZXJ0aWVzID0gewogICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiU3RvcmFnZVNlcnZpY2VQcm9wZXJ0aWVzIiwKICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgIG5hbWU6ICJDb21wb3NpdGUiLAogICAgICAgICAgICBjbGFzc05hbWU6ICJTdG9yYWdlU2VydmljZVByb3BlcnRpZXMiLAogICAgICAgICAgICBtb2RlbFByb3BlcnRpZXM6IHsKICAgICAgICAgICAgICAgIGxvZ2dpbmc6IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiTG9nZ2luZyIsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJMb2dnaW5nIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJDb21wb3NpdGUiLAogICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJMb2dnaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBob3VyTWV0cmljczogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJIb3VyTWV0cmljcyIsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJIb3VyTWV0cmljcyIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiTWV0cmljcyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbWludXRlTWV0cmljczogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJNaW51dGVNZXRyaWNzIiwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIk1pbnV0ZU1ldHJpY3MiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogIk1ldHJpY3MiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNvcnM6IHsKICAgICAgICAgICAgICAgICAgICB4bWxJc1dyYXBwZWQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIkNvcnMiLAogICAgICAgICAgICAgICAgICAgIHhtbEVsZW1lbnROYW1lOiAiQ29yc1J1bGUiLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiQ29ycyIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU2VxdWVuY2UiLAogICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiQ29yc1J1bGUiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZGVmYXVsdFNlcnZpY2VWZXJzaW9uOiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIkRlZmF1bHRTZXJ2aWNlVmVyc2lvbiIsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJEZWZhdWx0U2VydmljZVZlcnNpb24iLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZGVsZXRlUmV0ZW50aW9uUG9saWN5OiB7CiAgICAgICAgICAgICAgICAgICAgeG1sTmFtZTogIkRlbGV0ZVJldGVudGlvblBvbGljeSIsCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJEZWxldGVSZXRlbnRpb25Qb2xpY3kiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogIlJldGVudGlvblBvbGljeSIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgc3RhdGljV2Vic2l0ZTogewogICAgICAgICAgICAgICAgICAgIHhtbE5hbWU6ICJTdGF0aWNXZWJzaXRlIiwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIlN0YXRpY1dlYnNpdGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogIlN0YXRpY1dlYnNpdGUiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBTdG9yYWdlU2VydmljZVN0YXRzID0gewogICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiU3RvcmFnZVNlcnZpY2VTdGF0cyIsCiAgICAgICAgdHlwZTogewogICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiU3RvcmFnZVNlcnZpY2VTdGF0cyIsCiAgICAgICAgICAgIG1vZGVsUHJvcGVydGllczogewogICAgICAgICAgICAgICAgZ2VvUmVwbGljYXRpb246IHsKICAgICAgICAgICAgICAgICAgICB4bWxOYW1lOiAiR2VvUmVwbGljYXRpb24iLAogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiR2VvUmVwbGljYXRpb24iLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogIkdlb1JlcGxpY2F0aW9uIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgU2VydmljZVNldFByb3BlcnRpZXNIZWFkZXJzID0gewogICAgICAgIHNlcmlhbGl6ZWROYW1lOiAic2VydmljZS1zZXRwcm9wZXJ0aWVzLWhlYWRlcnMiLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgIGNsYXNzTmFtZTogIlNlcnZpY2VTZXRQcm9wZXJ0aWVzSGVhZGVycyIsCiAgICAgICAgICAgIG1vZGVsUHJvcGVydGllczogewogICAgICAgICAgICAgICAgY2xpZW50UmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNsaWVudC1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHZlcnNpb246IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtdmVyc2lvbiIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlcnJvckNvZGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtZXJyb3ItY29kZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgU2VydmljZUdldFByb3BlcnRpZXNIZWFkZXJzID0gewogICAgICAgIHNlcmlhbGl6ZWROYW1lOiAic2VydmljZS1nZXRwcm9wZXJ0aWVzLWhlYWRlcnMiLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgIGNsYXNzTmFtZTogIlNlcnZpY2VHZXRQcm9wZXJ0aWVzSGVhZGVycyIsCiAgICAgICAgICAgIG1vZGVsUHJvcGVydGllczogewogICAgICAgICAgICAgICAgY2xpZW50UmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNsaWVudC1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHZlcnNpb246IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtdmVyc2lvbiIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlcnJvckNvZGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtZXJyb3ItY29kZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgU2VydmljZUdldFN0YXRpc3RpY3NIZWFkZXJzID0gewogICAgICAgIHNlcmlhbGl6ZWROYW1lOiAic2VydmljZS1nZXRzdGF0aXN0aWNzLWhlYWRlcnMiLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgIGNsYXNzTmFtZTogIlNlcnZpY2VHZXRTdGF0aXN0aWNzSGVhZGVycyIsCiAgICAgICAgICAgIG1vZGVsUHJvcGVydGllczogewogICAgICAgICAgICAgICAgY2xpZW50UmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNsaWVudC1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHZlcnNpb246IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtdmVyc2lvbiIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBkYXRlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJkYXRlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJEYXRlVGltZVJmYzExMjMiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVycm9yQ29kZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1lcnJvci1jb2RlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBTZXJ2aWNlTGlzdENvbnRhaW5lcnNTZWdtZW50SGVhZGVycyA9IHsKICAgICAgICBzZXJpYWxpemVkTmFtZTogInNlcnZpY2UtbGlzdGNvbnRhaW5lcnNzZWdtZW50LWhlYWRlcnMiLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgIGNsYXNzTmFtZTogIlNlcnZpY2VMaXN0Q29udGFpbmVyc1NlZ21lbnRIZWFkZXJzIiwKICAgICAgICAgICAgbW9kZWxQcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICBjbGllbnRSZXF1ZXN0SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtY2xpZW50LXJlcXVlc3QtaWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXJlcXVlc3QtaWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdmVyc2lvbjogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy12ZXJzaW9uIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVycm9yQ29kZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1lcnJvci1jb2RlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBTZXJ2aWNlR2V0VXNlckRlbGVnYXRpb25LZXlIZWFkZXJzID0gewogICAgICAgIHNlcmlhbGl6ZWROYW1lOiAic2VydmljZS1nZXR1c2VyZGVsZWdhdGlvbmtleS1oZWFkZXJzIiwKICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgIG5hbWU6ICJDb21wb3NpdGUiLAogICAgICAgICAgICBjbGFzc05hbWU6ICJTZXJ2aWNlR2V0VXNlckRlbGVnYXRpb25LZXlIZWFkZXJzIiwKICAgICAgICAgICAgbW9kZWxQcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICBjbGllbnRSZXF1ZXN0SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtY2xpZW50LXJlcXVlc3QtaWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXJlcXVlc3QtaWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdmVyc2lvbjogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy12ZXJzaW9uIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGRhdGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImRhdGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXJyb3JDb2RlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWVycm9yLWNvZGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIFNlcnZpY2VHZXRBY2NvdW50SW5mb0hlYWRlcnMgPSB7CiAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJzZXJ2aWNlLWdldGFjY291bnRpbmZvLWhlYWRlcnMiLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgIGNsYXNzTmFtZTogIlNlcnZpY2VHZXRBY2NvdW50SW5mb0hlYWRlcnMiLAogICAgICAgICAgICBtb2RlbFByb3BlcnRpZXM6IHsKICAgICAgICAgICAgICAgIGNsaWVudFJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1jbGllbnQtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZXF1ZXN0SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB2ZXJzaW9uOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXZlcnNpb24iLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZGF0ZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGF0ZVRpbWVSZmMxMTIzIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBza3VOYW1lOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXNrdS1uYW1lIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJFbnVtIiwKICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dlZFZhbHVlczogWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIlN0YW5kYXJkX0xSUyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiU3RhbmRhcmRfR1JTIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJTdGFuZGFyZF9SQUdSUyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiU3RhbmRhcmRfWlJTIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJQcmVtaXVtX0xSUyIKICAgICAgICAgICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBhY2NvdW50S2luZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1hY2NvdW50LWtpbmQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkVudW0iLAogICAgICAgICAgICAgICAgICAgICAgICBhbGxvd2VkVmFsdWVzOiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiU3RvcmFnZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiQmxvYlN0b3JhZ2UiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIlN0b3JhZ2VWMiIKICAgICAgICAgICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlcnJvckNvZGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtZXJyb3ItY29kZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgU2VydmljZVN1Ym1pdEJhdGNoSGVhZGVycyA9IHsKICAgICAgICBzZXJpYWxpemVkTmFtZTogInNlcnZpY2Utc3VibWl0YmF0Y2gtaGVhZGVycyIsCiAgICAgICAgdHlwZTogewogICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiU2VydmljZVN1Ym1pdEJhdGNoSGVhZGVycyIsCiAgICAgICAgICAgIG1vZGVsUHJvcGVydGllczogewogICAgICAgICAgICAgICAgY2xpZW50UmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNsaWVudC1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJjb250ZW50LXR5cGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXJlcXVlc3QtaWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdmVyc2lvbjogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy12ZXJzaW9uIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVycm9yQ29kZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1lcnJvci1jb2RlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBDb250YWluZXJDcmVhdGVIZWFkZXJzID0gewogICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiY29udGFpbmVyLWNyZWF0ZS1oZWFkZXJzIiwKICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgIG5hbWU6ICJDb21wb3NpdGUiLAogICAgICAgICAgICBjbGFzc05hbWU6ICJDb250YWluZXJDcmVhdGVIZWFkZXJzIiwKICAgICAgICAgICAgbW9kZWxQcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICBlVGFnOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJldGFnIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGxhc3RNb2RpZmllZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAibGFzdC1tb2RpZmllZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGF0ZVRpbWVSZmMxMTIzIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjbGllbnRSZXF1ZXN0SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtY2xpZW50LXJlcXVlc3QtaWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXJlcXVlc3QtaWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdmVyc2lvbjogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy12ZXJzaW9uIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGRhdGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImRhdGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXJyb3JDb2RlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWVycm9yLWNvZGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIENvbnRhaW5lckdldFByb3BlcnRpZXNIZWFkZXJzID0gewogICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiY29udGFpbmVyLWdldHByb3BlcnRpZXMtaGVhZGVycyIsCiAgICAgICAgdHlwZTogewogICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiQ29udGFpbmVyR2V0UHJvcGVydGllc0hlYWRlcnMiLAogICAgICAgICAgICBtb2RlbFByb3BlcnRpZXM6IHsKICAgICAgICAgICAgICAgIG1ldGFkYXRhOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLW1ldGEiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRpY3Rpb25hcnkiLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGhlYWRlckNvbGxlY3Rpb25QcmVmaXg6ICJ4LW1zLW1ldGEtIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVUYWc6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImV0YWciLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbGFzdE1vZGlmaWVkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJsYXN0LW1vZGlmaWVkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJEYXRlVGltZVJmYzExMjMiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGxlYXNlRHVyYXRpb246IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtbGVhc2UtZHVyYXRpb24iLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkVudW0iLAogICAgICAgICAgICAgICAgICAgICAgICBhbGxvd2VkVmFsdWVzOiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaW5maW5pdGUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImZpeGVkIgogICAgICAgICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGxlYXNlU3RhdGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtbGVhc2Utc3RhdGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkVudW0iLAogICAgICAgICAgICAgICAgICAgICAgICBhbGxvd2VkVmFsdWVzOiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYXZhaWxhYmxlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJsZWFzZWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImV4cGlyZWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImJyZWFraW5nIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJicm9rZW4iCiAgICAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbGVhc2VTdGF0dXM6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtbGVhc2Utc3RhdHVzIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJFbnVtIiwKICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dlZFZhbHVlczogWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgImxvY2tlZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidW5sb2NrZWQiCiAgICAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2xpZW50UmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNsaWVudC1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHZlcnNpb246IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtdmVyc2lvbiIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBkYXRlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJkYXRlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJEYXRlVGltZVJmYzExMjMiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGJsb2JQdWJsaWNBY2Nlc3M6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtYmxvYi1wdWJsaWMtYWNjZXNzIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGhhc0ltbXV0YWJpbGl0eVBvbGljeTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1oYXMtaW1tdXRhYmlsaXR5LXBvbGljeSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQm9vbGVhbiIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgaGFzTGVnYWxIb2xkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWhhcy1sZWdhbC1ob2xkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJCb29sZWFuIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlcnJvckNvZGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtZXJyb3ItY29kZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgQ29udGFpbmVyRGVsZXRlSGVhZGVycyA9IHsKICAgICAgICBzZXJpYWxpemVkTmFtZTogImNvbnRhaW5lci1kZWxldGUtaGVhZGVycyIsCiAgICAgICAgdHlwZTogewogICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiQ29udGFpbmVyRGVsZXRlSGVhZGVycyIsCiAgICAgICAgICAgIG1vZGVsUHJvcGVydGllczogewogICAgICAgICAgICAgICAgY2xpZW50UmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNsaWVudC1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHZlcnNpb246IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtdmVyc2lvbiIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBkYXRlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJkYXRlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJEYXRlVGltZVJmYzExMjMiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVycm9yQ29kZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1lcnJvci1jb2RlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBDb250YWluZXJTZXRNZXRhZGF0YUhlYWRlcnMgPSB7CiAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJjb250YWluZXItc2V0bWV0YWRhdGEtaGVhZGVycyIsCiAgICAgICAgdHlwZTogewogICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiQ29udGFpbmVyU2V0TWV0YWRhdGFIZWFkZXJzIiwKICAgICAgICAgICAgbW9kZWxQcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICBlVGFnOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJldGFnIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGxhc3RNb2RpZmllZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAibGFzdC1tb2RpZmllZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGF0ZVRpbWVSZmMxMTIzIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjbGllbnRSZXF1ZXN0SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtY2xpZW50LXJlcXVlc3QtaWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXJlcXVlc3QtaWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdmVyc2lvbjogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy12ZXJzaW9uIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGRhdGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImRhdGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXJyb3JDb2RlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWVycm9yLWNvZGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIENvbnRhaW5lckdldEFjY2Vzc1BvbGljeUhlYWRlcnMgPSB7CiAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJjb250YWluZXItZ2V0YWNjZXNzcG9saWN5LWhlYWRlcnMiLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgIGNsYXNzTmFtZTogIkNvbnRhaW5lckdldEFjY2Vzc1BvbGljeUhlYWRlcnMiLAogICAgICAgICAgICBtb2RlbFByb3BlcnRpZXM6IHsKICAgICAgICAgICAgICAgIGJsb2JQdWJsaWNBY2Nlc3M6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtYmxvYi1wdWJsaWMtYWNjZXNzIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVUYWc6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImV0YWciLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbGFzdE1vZGlmaWVkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJsYXN0LW1vZGlmaWVkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJEYXRlVGltZVJmYzExMjMiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNsaWVudFJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1jbGllbnQtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZXF1ZXN0SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB2ZXJzaW9uOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXZlcnNpb24iLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZGF0ZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGF0ZVRpbWVSZmMxMTIzIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlcnJvckNvZGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtZXJyb3ItY29kZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgQ29udGFpbmVyU2V0QWNjZXNzUG9saWN5SGVhZGVycyA9IHsKICAgICAgICBzZXJpYWxpemVkTmFtZTogImNvbnRhaW5lci1zZXRhY2Nlc3Nwb2xpY3ktaGVhZGVycyIsCiAgICAgICAgdHlwZTogewogICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiQ29udGFpbmVyU2V0QWNjZXNzUG9saWN5SGVhZGVycyIsCiAgICAgICAgICAgIG1vZGVsUHJvcGVydGllczogewogICAgICAgICAgICAgICAgZVRhZzogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZXRhZyIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImxhc3QtbW9kaWZpZWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2xpZW50UmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNsaWVudC1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHZlcnNpb246IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtdmVyc2lvbiIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBkYXRlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJkYXRlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJEYXRlVGltZVJmYzExMjMiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVycm9yQ29kZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1lcnJvci1jb2RlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBDb250YWluZXJBY3F1aXJlTGVhc2VIZWFkZXJzID0gewogICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiY29udGFpbmVyLWFjcXVpcmVsZWFzZS1oZWFkZXJzIiwKICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgIG5hbWU6ICJDb21wb3NpdGUiLAogICAgICAgICAgICBjbGFzc05hbWU6ICJDb250YWluZXJBY3F1aXJlTGVhc2VIZWFkZXJzIiwKICAgICAgICAgICAgbW9kZWxQcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICBlVGFnOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJldGFnIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGxhc3RNb2RpZmllZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAibGFzdC1tb2RpZmllZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGF0ZVRpbWVSZmMxMTIzIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsZWFzZUlkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWxlYXNlLWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNsaWVudFJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1jbGllbnQtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZXF1ZXN0SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB2ZXJzaW9uOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXZlcnNpb24iLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZGF0ZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGF0ZVRpbWVSZmMxMTIzIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlcnJvckNvZGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtZXJyb3ItY29kZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgQ29udGFpbmVyUmVsZWFzZUxlYXNlSGVhZGVycyA9IHsKICAgICAgICBzZXJpYWxpemVkTmFtZTogImNvbnRhaW5lci1yZWxlYXNlbGVhc2UtaGVhZGVycyIsCiAgICAgICAgdHlwZTogewogICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiQ29udGFpbmVyUmVsZWFzZUxlYXNlSGVhZGVycyIsCiAgICAgICAgICAgIG1vZGVsUHJvcGVydGllczogewogICAgICAgICAgICAgICAgZVRhZzogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZXRhZyIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImxhc3QtbW9kaWZpZWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2xpZW50UmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNsaWVudC1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHZlcnNpb246IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtdmVyc2lvbiIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBkYXRlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJkYXRlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJEYXRlVGltZVJmYzExMjMiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVycm9yQ29kZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1lcnJvci1jb2RlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBDb250YWluZXJSZW5ld0xlYXNlSGVhZGVycyA9IHsKICAgICAgICBzZXJpYWxpemVkTmFtZTogImNvbnRhaW5lci1yZW5ld2xlYXNlLWhlYWRlcnMiLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgIGNsYXNzTmFtZTogIkNvbnRhaW5lclJlbmV3TGVhc2VIZWFkZXJzIiwKICAgICAgICAgICAgbW9kZWxQcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICBlVGFnOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJldGFnIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGxhc3RNb2RpZmllZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAibGFzdC1tb2RpZmllZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGF0ZVRpbWVSZmMxMTIzIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsZWFzZUlkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWxlYXNlLWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNsaWVudFJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1jbGllbnQtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZXF1ZXN0SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB2ZXJzaW9uOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXZlcnNpb24iLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZGF0ZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGF0ZVRpbWVSZmMxMTIzIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlcnJvckNvZGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtZXJyb3ItY29kZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgQ29udGFpbmVyQnJlYWtMZWFzZUhlYWRlcnMgPSB7CiAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJjb250YWluZXItYnJlYWtsZWFzZS1oZWFkZXJzIiwKICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgIG5hbWU6ICJDb21wb3NpdGUiLAogICAgICAgICAgICBjbGFzc05hbWU6ICJDb250YWluZXJCcmVha0xlYXNlSGVhZGVycyIsCiAgICAgICAgICAgIG1vZGVsUHJvcGVydGllczogewogICAgICAgICAgICAgICAgZVRhZzogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZXRhZyIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImxhc3QtbW9kaWZpZWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbGVhc2VUaW1lOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWxlYXNlLXRpbWUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIk51bWJlciIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2xpZW50UmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNsaWVudC1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHZlcnNpb246IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtdmVyc2lvbiIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBkYXRlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJkYXRlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJEYXRlVGltZVJmYzExMjMiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVycm9yQ29kZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1lcnJvci1jb2RlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBDb250YWluZXJDaGFuZ2VMZWFzZUhlYWRlcnMgPSB7CiAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJjb250YWluZXItY2hhbmdlbGVhc2UtaGVhZGVycyIsCiAgICAgICAgdHlwZTogewogICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiQ29udGFpbmVyQ2hhbmdlTGVhc2VIZWFkZXJzIiwKICAgICAgICAgICAgbW9kZWxQcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICBlVGFnOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJldGFnIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGxhc3RNb2RpZmllZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAibGFzdC1tb2RpZmllZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGF0ZVRpbWVSZmMxMTIzIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsZWFzZUlkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWxlYXNlLWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNsaWVudFJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1jbGllbnQtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZXF1ZXN0SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB2ZXJzaW9uOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXZlcnNpb24iLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZGF0ZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGF0ZVRpbWVSZmMxMTIzIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlcnJvckNvZGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtZXJyb3ItY29kZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgQ29udGFpbmVyTGlzdEJsb2JGbGF0U2VnbWVudEhlYWRlcnMgPSB7CiAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJjb250YWluZXItbGlzdGJsb2JmbGF0c2VnbWVudC1oZWFkZXJzIiwKICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgIG5hbWU6ICJDb21wb3NpdGUiLAogICAgICAgICAgICBjbGFzc05hbWU6ICJDb250YWluZXJMaXN0QmxvYkZsYXRTZWdtZW50SGVhZGVycyIsCiAgICAgICAgICAgIG1vZGVsUHJvcGVydGllczogewogICAgICAgICAgICAgICAgY29udGVudFR5cGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImNvbnRlbnQtdHlwZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjbGllbnRSZXF1ZXN0SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtY2xpZW50LXJlcXVlc3QtaWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXJlcXVlc3QtaWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdmVyc2lvbjogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy12ZXJzaW9uIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGRhdGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImRhdGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXJyb3JDb2RlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWVycm9yLWNvZGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIENvbnRhaW5lckxpc3RCbG9iSGllcmFyY2h5U2VnbWVudEhlYWRlcnMgPSB7CiAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJjb250YWluZXItbGlzdGJsb2JoaWVyYXJjaHlzZWdtZW50LWhlYWRlcnMiLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgIGNsYXNzTmFtZTogIkNvbnRhaW5lckxpc3RCbG9iSGllcmFyY2h5U2VnbWVudEhlYWRlcnMiLAogICAgICAgICAgICBtb2RlbFByb3BlcnRpZXM6IHsKICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJjb250ZW50LXR5cGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2xpZW50UmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNsaWVudC1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHZlcnNpb246IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtdmVyc2lvbiIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBkYXRlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJkYXRlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJEYXRlVGltZVJmYzExMjMiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVycm9yQ29kZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1lcnJvci1jb2RlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBDb250YWluZXJHZXRBY2NvdW50SW5mb0hlYWRlcnMgPSB7CiAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJjb250YWluZXItZ2V0YWNjb3VudGluZm8taGVhZGVycyIsCiAgICAgICAgdHlwZTogewogICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiQ29udGFpbmVyR2V0QWNjb3VudEluZm9IZWFkZXJzIiwKICAgICAgICAgICAgbW9kZWxQcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICBjbGllbnRSZXF1ZXN0SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtY2xpZW50LXJlcXVlc3QtaWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXJlcXVlc3QtaWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdmVyc2lvbjogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy12ZXJzaW9uIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGRhdGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImRhdGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgc2t1TmFtZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1za3UtbmFtZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRW51bSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGFsbG93ZWRWYWx1ZXM6IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJTdGFuZGFyZF9MUlMiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIlN0YW5kYXJkX0dSUyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiU3RhbmRhcmRfUkFHUlMiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIlN0YW5kYXJkX1pSUyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiUHJlbWl1bV9MUlMiCiAgICAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgYWNjb3VudEtpbmQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtYWNjb3VudC1raW5kIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJFbnVtIiwKICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dlZFZhbHVlczogWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIlN0b3JhZ2UiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIkJsb2JTdG9yYWdlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJTdG9yYWdlVjIiCiAgICAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXJyb3JDb2RlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWVycm9yLWNvZGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIEJsb2JEb3dubG9hZEhlYWRlcnMgPSB7CiAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJibG9iLWRvd25sb2FkLWhlYWRlcnMiLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgIGNsYXNzTmFtZTogIkJsb2JEb3dubG9hZEhlYWRlcnMiLAogICAgICAgICAgICBtb2RlbFByb3BlcnRpZXM6IHsKICAgICAgICAgICAgICAgIGxhc3RNb2RpZmllZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAibGFzdC1tb2RpZmllZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGF0ZVRpbWVSZmMxMTIzIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBtZXRhZGF0YTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1tZXRhIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJEaWN0aW9uYXJ5IiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBoZWFkZXJDb2xsZWN0aW9uUHJlZml4OiAieC1tcy1tZXRhLSIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjb250ZW50TGVuZ3RoOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJjb250ZW50LWxlbmd0aCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiTnVtYmVyIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiY29udGVudC10eXBlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNvbnRlbnRSYW5nZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiY29udGVudC1yYW5nZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlVGFnOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJldGFnIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNvbnRlbnRNRDU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImNvbnRlbnQtbWQ1IiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJCeXRlQXJyYXkiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNvbnRlbnRFbmNvZGluZzogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiY29udGVudC1lbmNvZGluZyIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjYWNoZUNvbnRyb2w6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImNhY2hlLWNvbnRyb2wiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY29udGVudERpc3Bvc2l0aW9uOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJjb250ZW50LWRpc3Bvc2l0aW9uIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNvbnRlbnRMYW5ndWFnZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiY29udGVudC1sYW5ndWFnZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBibG9iU2VxdWVuY2VOdW1iZXI6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtYmxvYi1zZXF1ZW5jZS1udW1iZXIiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIk51bWJlciIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgYmxvYlR5cGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtYmxvYi10eXBlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJFbnVtIiwKICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dlZFZhbHVlczogWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIkJsb2NrQmxvYiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiUGFnZUJsb2IiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIkFwcGVuZEJsb2IiCiAgICAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY29weUNvbXBsZXRpb25UaW1lOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNvcHktY29tcGxldGlvbi10aW1lIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJEYXRlVGltZVJmYzExMjMiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNvcHlTdGF0dXNEZXNjcmlwdGlvbjogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1jb3B5LXN0YXR1cy1kZXNjcmlwdGlvbiIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjb3B5SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtY29weS1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjb3B5UHJvZ3Jlc3M6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtY29weS1wcm9ncmVzcyIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjb3B5U291cmNlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNvcHktc291cmNlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNvcHlTdGF0dXM6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtY29weS1zdGF0dXMiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkVudW0iLAogICAgICAgICAgICAgICAgICAgICAgICBhbGxvd2VkVmFsdWVzOiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAicGVuZGluZyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAic3VjY2VzcyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYWJvcnRlZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZmFpbGVkIgogICAgICAgICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGxlYXNlRHVyYXRpb246IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtbGVhc2UtZHVyYXRpb24iLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkVudW0iLAogICAgICAgICAgICAgICAgICAgICAgICBhbGxvd2VkVmFsdWVzOiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaW5maW5pdGUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImZpeGVkIgogICAgICAgICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGxlYXNlU3RhdGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtbGVhc2Utc3RhdGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkVudW0iLAogICAgICAgICAgICAgICAgICAgICAgICBhbGxvd2VkVmFsdWVzOiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYXZhaWxhYmxlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJsZWFzZWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImV4cGlyZWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImJyZWFraW5nIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJicm9rZW4iCiAgICAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbGVhc2VTdGF0dXM6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtbGVhc2Utc3RhdHVzIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJFbnVtIiwKICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dlZFZhbHVlczogWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgImxvY2tlZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidW5sb2NrZWQiCiAgICAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2xpZW50UmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNsaWVudC1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHZlcnNpb246IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtdmVyc2lvbiIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBhY2NlcHRSYW5nZXM6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImFjY2VwdC1yYW5nZXMiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZGF0ZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGF0ZVRpbWVSZmMxMTIzIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBibG9iQ29tbWl0dGVkQmxvY2tDb3VudDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1ibG9iLWNvbW1pdHRlZC1ibG9jay1jb3VudCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiTnVtYmVyIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBpc1NlcnZlckVuY3J5cHRlZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1zZXJ2ZXItZW5jcnlwdGVkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJCb29sZWFuIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlbmNyeXB0aW9uS2V5U2hhMjU2OiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWVuY3J5cHRpb24ta2V5LXNoYTI1NiIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBibG9iQ29udGVudE1ENTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1ibG9iLWNvbnRlbnQtbWQ1IiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJCeXRlQXJyYXkiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNvbnRlbnRDcmM2NDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1jb250ZW50LWNyYzY0IiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJCeXRlQXJyYXkiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVycm9yQ29kZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1lcnJvci1jb2RlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBCbG9iR2V0UHJvcGVydGllc0hlYWRlcnMgPSB7CiAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJibG9iLWdldHByb3BlcnRpZXMtaGVhZGVycyIsCiAgICAgICAgdHlwZTogewogICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiQmxvYkdldFByb3BlcnRpZXNIZWFkZXJzIiwKICAgICAgICAgICAgbW9kZWxQcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImxhc3QtbW9kaWZpZWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY3JlYXRpb25UaW1lOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNyZWF0aW9uLXRpbWUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbWV0YWRhdGE6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtbWV0YSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGljdGlvbmFyeSIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgaGVhZGVyQ29sbGVjdGlvblByZWZpeDogIngtbXMtbWV0YS0iCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgYmxvYlR5cGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtYmxvYi10eXBlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJFbnVtIiwKICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dlZFZhbHVlczogWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIkJsb2NrQmxvYiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiUGFnZUJsb2IiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIkFwcGVuZEJsb2IiCiAgICAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY29weUNvbXBsZXRpb25UaW1lOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNvcHktY29tcGxldGlvbi10aW1lIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJEYXRlVGltZVJmYzExMjMiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNvcHlTdGF0dXNEZXNjcmlwdGlvbjogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1jb3B5LXN0YXR1cy1kZXNjcmlwdGlvbiIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjb3B5SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtY29weS1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjb3B5UHJvZ3Jlc3M6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtY29weS1wcm9ncmVzcyIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjb3B5U291cmNlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNvcHktc291cmNlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNvcHlTdGF0dXM6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtY29weS1zdGF0dXMiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkVudW0iLAogICAgICAgICAgICAgICAgICAgICAgICBhbGxvd2VkVmFsdWVzOiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAicGVuZGluZyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAic3VjY2VzcyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYWJvcnRlZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZmFpbGVkIgogICAgICAgICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGlzSW5jcmVtZW50YWxDb3B5OiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWluY3JlbWVudGFsLWNvcHkiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkJvb2xlYW4iCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uU25hcHNob3Q6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtY29weS1kZXN0aW5hdGlvbi1zbmFwc2hvdCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsZWFzZUR1cmF0aW9uOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWxlYXNlLWR1cmF0aW9uIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJFbnVtIiwKICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dlZFZhbHVlczogWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgImluZmluaXRlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJmaXhlZCIKICAgICAgICAgICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsZWFzZVN0YXRlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWxlYXNlLXN0YXRlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJFbnVtIiwKICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dlZFZhbHVlczogWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgImF2YWlsYWJsZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAibGVhc2VkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJleHBpcmVkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJicmVha2luZyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYnJva2VuIgogICAgICAgICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGxlYXNlU3RhdHVzOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWxlYXNlLXN0YXR1cyIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRW51bSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGFsbG93ZWRWYWx1ZXM6IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJsb2NrZWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInVubG9ja2VkIgogICAgICAgICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNvbnRlbnRMZW5ndGg6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImNvbnRlbnQtbGVuZ3RoIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJOdW1iZXIiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJjb250ZW50LXR5cGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZVRhZzogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZXRhZyIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjb250ZW50TUQ1OiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJjb250ZW50LW1kNSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQnl0ZUFycmF5IgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjb250ZW50RW5jb2Rpbmc6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImNvbnRlbnQtZW5jb2RpbmciLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY29udGVudERpc3Bvc2l0aW9uOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJjb250ZW50LWRpc3Bvc2l0aW9uIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNvbnRlbnRMYW5ndWFnZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiY29udGVudC1sYW5ndWFnZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjYWNoZUNvbnRyb2w6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImNhY2hlLWNvbnRyb2wiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgYmxvYlNlcXVlbmNlTnVtYmVyOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWJsb2Itc2VxdWVuY2UtbnVtYmVyIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJOdW1iZXIiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNsaWVudFJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1jbGllbnQtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZXF1ZXN0SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB2ZXJzaW9uOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXZlcnNpb24iLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZGF0ZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGF0ZVRpbWVSZmMxMTIzIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBhY2NlcHRSYW5nZXM6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImFjY2VwdC1yYW5nZXMiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgYmxvYkNvbW1pdHRlZEJsb2NrQ291bnQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtYmxvYi1jb21taXR0ZWQtYmxvY2stY291bnQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIk51bWJlciIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgaXNTZXJ2ZXJFbmNyeXB0ZWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtc2VydmVyLWVuY3J5cHRlZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQm9vbGVhbiIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZW5jcnlwdGlvbktleVNoYTI1NjogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1lbmNyeXB0aW9uLWtleS1zaGEyNTYiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgYWNjZXNzVGllcjogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1hY2Nlc3MtdGllciIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBhY2Nlc3NUaWVySW5mZXJyZWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtYWNjZXNzLXRpZXItaW5mZXJyZWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkJvb2xlYW4iCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGFyY2hpdmVTdGF0dXM6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtYXJjaGl2ZS1zdGF0dXMiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgYWNjZXNzVGllckNoYW5nZVRpbWU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtYWNjZXNzLXRpZXItY2hhbmdlLXRpbWUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXJyb3JDb2RlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWVycm9yLWNvZGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIEJsb2JEZWxldGVIZWFkZXJzID0gewogICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiYmxvYi1kZWxldGUtaGVhZGVycyIsCiAgICAgICAgdHlwZTogewogICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiQmxvYkRlbGV0ZUhlYWRlcnMiLAogICAgICAgICAgICBtb2RlbFByb3BlcnRpZXM6IHsKICAgICAgICAgICAgICAgIGNsaWVudFJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1jbGllbnQtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZXF1ZXN0SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB2ZXJzaW9uOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXZlcnNpb24iLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZGF0ZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGF0ZVRpbWVSZmMxMTIzIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlcnJvckNvZGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtZXJyb3ItY29kZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgQmxvYlNldEFjY2Vzc0NvbnRyb2xIZWFkZXJzID0gewogICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiYmxvYi1zZXRhY2Nlc3Njb250cm9sLWhlYWRlcnMiLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgIGNsYXNzTmFtZTogIkJsb2JTZXRBY2Nlc3NDb250cm9sSGVhZGVycyIsCiAgICAgICAgICAgIG1vZGVsUHJvcGVydGllczogewogICAgICAgICAgICAgICAgZGF0ZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGF0ZVRpbWVSZmMxMTIzIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlVGFnOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJldGFnIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGxhc3RNb2RpZmllZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAibGFzdC1tb2RpZmllZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGF0ZVRpbWVSZmMxMTIzIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZXF1ZXN0SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB2ZXJzaW9uOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXZlcnNpb24iLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2xpZW50UmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNsaWVudC1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBCbG9iR2V0QWNjZXNzQ29udHJvbEhlYWRlcnMgPSB7CiAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJibG9iLWdldGFjY2Vzc2NvbnRyb2wtaGVhZGVycyIsCiAgICAgICAgdHlwZTogewogICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiQmxvYkdldEFjY2Vzc0NvbnRyb2xIZWFkZXJzIiwKICAgICAgICAgICAgbW9kZWxQcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICBkYXRlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJkYXRlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJEYXRlVGltZVJmYzExMjMiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVUYWc6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImV0YWciLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbGFzdE1vZGlmaWVkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJsYXN0LW1vZGlmaWVkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJEYXRlVGltZVJmYzExMjMiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHhNc093bmVyOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLW93bmVyIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHhNc0dyb3VwOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWdyb3VwIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHhNc1Blcm1pc3Npb25zOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXBlcm1pc3Npb25zIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHhNc0FjbDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1hY2wiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXJlcXVlc3QtaWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdmVyc2lvbjogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy12ZXJzaW9uIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNsaWVudFJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1jbGllbnQtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgQmxvYlJlbmFtZUhlYWRlcnMgPSB7CiAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJibG9iLXJlbmFtZS1oZWFkZXJzIiwKICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgIG5hbWU6ICJDb21wb3NpdGUiLAogICAgICAgICAgICBjbGFzc05hbWU6ICJCbG9iUmVuYW1lSGVhZGVycyIsCiAgICAgICAgICAgIG1vZGVsUHJvcGVydGllczogewogICAgICAgICAgICAgICAgZVRhZzogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZXRhZyIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImxhc3QtbW9kaWZpZWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2xpZW50UmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNsaWVudC1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHZlcnNpb246IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtdmVyc2lvbiIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjb250ZW50TGVuZ3RoOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJjb250ZW50LWxlbmd0aCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiTnVtYmVyIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBkYXRlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJkYXRlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJEYXRlVGltZVJmYzExMjMiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBQYWdlQmxvYkNyZWF0ZUhlYWRlcnMgPSB7CiAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJwYWdlYmxvYi1jcmVhdGUtaGVhZGVycyIsCiAgICAgICAgdHlwZTogewogICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiUGFnZUJsb2JDcmVhdGVIZWFkZXJzIiwKICAgICAgICAgICAgbW9kZWxQcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICBlVGFnOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJldGFnIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGxhc3RNb2RpZmllZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAibGFzdC1tb2RpZmllZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGF0ZVRpbWVSZmMxMTIzIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjb250ZW50TUQ1OiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJjb250ZW50LW1kNSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQnl0ZUFycmF5IgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjbGllbnRSZXF1ZXN0SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtY2xpZW50LXJlcXVlc3QtaWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXJlcXVlc3QtaWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdmVyc2lvbjogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy12ZXJzaW9uIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGRhdGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImRhdGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgaXNTZXJ2ZXJFbmNyeXB0ZWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtcmVxdWVzdC1zZXJ2ZXItZW5jcnlwdGVkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJCb29sZWFuIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlbmNyeXB0aW9uS2V5U2hhMjU2OiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWVuY3J5cHRpb24ta2V5LXNoYTI1NiIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlcnJvckNvZGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtZXJyb3ItY29kZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgQXBwZW5kQmxvYkNyZWF0ZUhlYWRlcnMgPSB7CiAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJhcHBlbmRibG9iLWNyZWF0ZS1oZWFkZXJzIiwKICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgIG5hbWU6ICJDb21wb3NpdGUiLAogICAgICAgICAgICBjbGFzc05hbWU6ICJBcHBlbmRCbG9iQ3JlYXRlSGVhZGVycyIsCiAgICAgICAgICAgIG1vZGVsUHJvcGVydGllczogewogICAgICAgICAgICAgICAgZVRhZzogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZXRhZyIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImxhc3QtbW9kaWZpZWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY29udGVudE1ENTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiY29udGVudC1tZDUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkJ5dGVBcnJheSIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2xpZW50UmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNsaWVudC1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHZlcnNpb246IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtdmVyc2lvbiIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBkYXRlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJkYXRlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJEYXRlVGltZVJmYzExMjMiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGlzU2VydmVyRW5jcnlwdGVkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXJlcXVlc3Qtc2VydmVyLWVuY3J5cHRlZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQm9vbGVhbiIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZW5jcnlwdGlvbktleVNoYTI1NjogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1lbmNyeXB0aW9uLWtleS1zaGEyNTYiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXJyb3JDb2RlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWVycm9yLWNvZGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIEJsb2NrQmxvYlVwbG9hZEhlYWRlcnMgPSB7CiAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJibG9ja2Jsb2ItdXBsb2FkLWhlYWRlcnMiLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgIGNsYXNzTmFtZTogIkJsb2NrQmxvYlVwbG9hZEhlYWRlcnMiLAogICAgICAgICAgICBtb2RlbFByb3BlcnRpZXM6IHsKICAgICAgICAgICAgICAgIGVUYWc6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImV0YWciLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbGFzdE1vZGlmaWVkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJsYXN0LW1vZGlmaWVkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJEYXRlVGltZVJmYzExMjMiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNvbnRlbnRNRDU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImNvbnRlbnQtbWQ1IiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJCeXRlQXJyYXkiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNsaWVudFJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1jbGllbnQtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZXF1ZXN0SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB2ZXJzaW9uOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXZlcnNpb24iLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZGF0ZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGF0ZVRpbWVSZmMxMTIzIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBpc1NlcnZlckVuY3J5cHRlZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1yZXF1ZXN0LXNlcnZlci1lbmNyeXB0ZWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkJvb2xlYW4iCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVuY3J5cHRpb25LZXlTaGEyNTY6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtZW5jcnlwdGlvbi1rZXktc2hhMjU2IiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVycm9yQ29kZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1lcnJvci1jb2RlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBCbG9iVW5kZWxldGVIZWFkZXJzID0gewogICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiYmxvYi11bmRlbGV0ZS1oZWFkZXJzIiwKICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgIG5hbWU6ICJDb21wb3NpdGUiLAogICAgICAgICAgICBjbGFzc05hbWU6ICJCbG9iVW5kZWxldGVIZWFkZXJzIiwKICAgICAgICAgICAgbW9kZWxQcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICBjbGllbnRSZXF1ZXN0SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtY2xpZW50LXJlcXVlc3QtaWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXJlcXVlc3QtaWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdmVyc2lvbjogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy12ZXJzaW9uIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGRhdGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImRhdGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXJyb3JDb2RlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWVycm9yLWNvZGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIEJsb2JTZXRIVFRQSGVhZGVyc0hlYWRlcnMgPSB7CiAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJibG9iLXNldGh0dHBoZWFkZXJzLWhlYWRlcnMiLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgIGNsYXNzTmFtZTogIkJsb2JTZXRIVFRQSGVhZGVyc0hlYWRlcnMiLAogICAgICAgICAgICBtb2RlbFByb3BlcnRpZXM6IHsKICAgICAgICAgICAgICAgIGVUYWc6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImV0YWciLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbGFzdE1vZGlmaWVkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJsYXN0LW1vZGlmaWVkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJEYXRlVGltZVJmYzExMjMiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGJsb2JTZXF1ZW5jZU51bWJlcjogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1ibG9iLXNlcXVlbmNlLW51bWJlciIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiTnVtYmVyIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjbGllbnRSZXF1ZXN0SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtY2xpZW50LXJlcXVlc3QtaWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXJlcXVlc3QtaWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdmVyc2lvbjogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy12ZXJzaW9uIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGRhdGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImRhdGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXJyb3JDb2RlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWVycm9yLWNvZGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIEJsb2JTZXRNZXRhZGF0YUhlYWRlcnMgPSB7CiAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJibG9iLXNldG1ldGFkYXRhLWhlYWRlcnMiLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgIGNsYXNzTmFtZTogIkJsb2JTZXRNZXRhZGF0YUhlYWRlcnMiLAogICAgICAgICAgICBtb2RlbFByb3BlcnRpZXM6IHsKICAgICAgICAgICAgICAgIGVUYWc6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImV0YWciLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbGFzdE1vZGlmaWVkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJsYXN0LW1vZGlmaWVkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJEYXRlVGltZVJmYzExMjMiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNsaWVudFJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1jbGllbnQtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZXF1ZXN0SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB2ZXJzaW9uOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXZlcnNpb24iLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZGF0ZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGF0ZVRpbWVSZmMxMTIzIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBpc1NlcnZlckVuY3J5cHRlZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1yZXF1ZXN0LXNlcnZlci1lbmNyeXB0ZWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkJvb2xlYW4iCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVuY3J5cHRpb25LZXlTaGEyNTY6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtZW5jcnlwdGlvbi1rZXktc2hhMjU2IiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVycm9yQ29kZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1lcnJvci1jb2RlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBCbG9iQWNxdWlyZUxlYXNlSGVhZGVycyA9IHsKICAgICAgICBzZXJpYWxpemVkTmFtZTogImJsb2ItYWNxdWlyZWxlYXNlLWhlYWRlcnMiLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgIGNsYXNzTmFtZTogIkJsb2JBY3F1aXJlTGVhc2VIZWFkZXJzIiwKICAgICAgICAgICAgbW9kZWxQcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICBlVGFnOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJldGFnIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGxhc3RNb2RpZmllZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAibGFzdC1tb2RpZmllZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGF0ZVRpbWVSZmMxMTIzIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsZWFzZUlkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWxlYXNlLWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNsaWVudFJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1jbGllbnQtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZXF1ZXN0SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB2ZXJzaW9uOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXZlcnNpb24iLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZGF0ZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGF0ZVRpbWVSZmMxMTIzIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlcnJvckNvZGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtZXJyb3ItY29kZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgQmxvYlJlbGVhc2VMZWFzZUhlYWRlcnMgPSB7CiAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJibG9iLXJlbGVhc2VsZWFzZS1oZWFkZXJzIiwKICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgIG5hbWU6ICJDb21wb3NpdGUiLAogICAgICAgICAgICBjbGFzc05hbWU6ICJCbG9iUmVsZWFzZUxlYXNlSGVhZGVycyIsCiAgICAgICAgICAgIG1vZGVsUHJvcGVydGllczogewogICAgICAgICAgICAgICAgZVRhZzogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZXRhZyIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImxhc3QtbW9kaWZpZWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2xpZW50UmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNsaWVudC1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHZlcnNpb246IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtdmVyc2lvbiIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBkYXRlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJkYXRlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJEYXRlVGltZVJmYzExMjMiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVycm9yQ29kZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1lcnJvci1jb2RlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBCbG9iUmVuZXdMZWFzZUhlYWRlcnMgPSB7CiAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJibG9iLXJlbmV3bGVhc2UtaGVhZGVycyIsCiAgICAgICAgdHlwZTogewogICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiQmxvYlJlbmV3TGVhc2VIZWFkZXJzIiwKICAgICAgICAgICAgbW9kZWxQcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICBlVGFnOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJldGFnIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGxhc3RNb2RpZmllZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAibGFzdC1tb2RpZmllZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGF0ZVRpbWVSZmMxMTIzIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsZWFzZUlkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWxlYXNlLWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNsaWVudFJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1jbGllbnQtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZXF1ZXN0SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB2ZXJzaW9uOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXZlcnNpb24iLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZGF0ZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGF0ZVRpbWVSZmMxMTIzIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlcnJvckNvZGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtZXJyb3ItY29kZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgQmxvYkNoYW5nZUxlYXNlSGVhZGVycyA9IHsKICAgICAgICBzZXJpYWxpemVkTmFtZTogImJsb2ItY2hhbmdlbGVhc2UtaGVhZGVycyIsCiAgICAgICAgdHlwZTogewogICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiQmxvYkNoYW5nZUxlYXNlSGVhZGVycyIsCiAgICAgICAgICAgIG1vZGVsUHJvcGVydGllczogewogICAgICAgICAgICAgICAgZVRhZzogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZXRhZyIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImxhc3QtbW9kaWZpZWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2xpZW50UmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNsaWVudC1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGxlYXNlSWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtbGVhc2UtaWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdmVyc2lvbjogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy12ZXJzaW9uIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGRhdGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImRhdGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXJyb3JDb2RlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWVycm9yLWNvZGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIEJsb2JCcmVha0xlYXNlSGVhZGVycyA9IHsKICAgICAgICBzZXJpYWxpemVkTmFtZTogImJsb2ItYnJlYWtsZWFzZS1oZWFkZXJzIiwKICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgIG5hbWU6ICJDb21wb3NpdGUiLAogICAgICAgICAgICBjbGFzc05hbWU6ICJCbG9iQnJlYWtMZWFzZUhlYWRlcnMiLAogICAgICAgICAgICBtb2RlbFByb3BlcnRpZXM6IHsKICAgICAgICAgICAgICAgIGVUYWc6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImV0YWciLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbGFzdE1vZGlmaWVkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJsYXN0LW1vZGlmaWVkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJEYXRlVGltZVJmYzExMjMiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGxlYXNlVGltZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1sZWFzZS10aW1lIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJOdW1iZXIiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNsaWVudFJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1jbGllbnQtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZXF1ZXN0SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB2ZXJzaW9uOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXZlcnNpb24iLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZGF0ZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGF0ZVRpbWVSZmMxMTIzIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlcnJvckNvZGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtZXJyb3ItY29kZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgQmxvYkNyZWF0ZVNuYXBzaG90SGVhZGVycyA9IHsKICAgICAgICBzZXJpYWxpemVkTmFtZTogImJsb2ItY3JlYXRlc25hcHNob3QtaGVhZGVycyIsCiAgICAgICAgdHlwZTogewogICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiQmxvYkNyZWF0ZVNuYXBzaG90SGVhZGVycyIsCiAgICAgICAgICAgIG1vZGVsUHJvcGVydGllczogewogICAgICAgICAgICAgICAgc25hcHNob3Q6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtc25hcHNob3QiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZVRhZzogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZXRhZyIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImxhc3QtbW9kaWZpZWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2xpZW50UmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNsaWVudC1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHZlcnNpb246IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtdmVyc2lvbiIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBkYXRlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJkYXRlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJEYXRlVGltZVJmYzExMjMiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGlzU2VydmVyRW5jcnlwdGVkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXJlcXVlc3Qtc2VydmVyLWVuY3J5cHRlZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQm9vbGVhbiIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZW5jcnlwdGlvbktleVNoYTI1NjogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1lbmNyeXB0aW9uLWtleS1zaGEyNTYiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXJyb3JDb2RlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWVycm9yLWNvZGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIEJsb2JTdGFydENvcHlGcm9tVVJMSGVhZGVycyA9IHsKICAgICAgICBzZXJpYWxpemVkTmFtZTogImJsb2Itc3RhcnRjb3B5ZnJvbXVybC1oZWFkZXJzIiwKICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgIG5hbWU6ICJDb21wb3NpdGUiLAogICAgICAgICAgICBjbGFzc05hbWU6ICJCbG9iU3RhcnRDb3B5RnJvbVVSTEhlYWRlcnMiLAogICAgICAgICAgICBtb2RlbFByb3BlcnRpZXM6IHsKICAgICAgICAgICAgICAgIGVUYWc6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImV0YWciLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbGFzdE1vZGlmaWVkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJsYXN0LW1vZGlmaWVkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJEYXRlVGltZVJmYzExMjMiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNsaWVudFJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1jbGllbnQtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZXF1ZXN0SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB2ZXJzaW9uOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXZlcnNpb24iLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZGF0ZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGF0ZVRpbWVSZmMxMTIzIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjb3B5SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtY29weS1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjb3B5U3RhdHVzOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNvcHktc3RhdHVzIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJFbnVtIiwKICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dlZFZhbHVlczogWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgInBlbmRpbmciLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImFib3J0ZWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImZhaWxlZCIKICAgICAgICAgICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlcnJvckNvZGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtZXJyb3ItY29kZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgQmxvYkNvcHlGcm9tVVJMSGVhZGVycyA9IHsKICAgICAgICBzZXJpYWxpemVkTmFtZTogImJsb2ItY29weWZyb211cmwtaGVhZGVycyIsCiAgICAgICAgdHlwZTogewogICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiQmxvYkNvcHlGcm9tVVJMSGVhZGVycyIsCiAgICAgICAgICAgIG1vZGVsUHJvcGVydGllczogewogICAgICAgICAgICAgICAgZVRhZzogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZXRhZyIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImxhc3QtbW9kaWZpZWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2xpZW50UmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNsaWVudC1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHZlcnNpb246IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtdmVyc2lvbiIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBkYXRlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJkYXRlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJEYXRlVGltZVJmYzExMjMiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNvcHlJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1jb3B5LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNvcHlTdGF0dXM6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtY29weS1zdGF0dXMiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkVudW0iLAogICAgICAgICAgICAgICAgICAgICAgICBhbGxvd2VkVmFsdWVzOiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAic3VjY2VzcyIKICAgICAgICAgICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlcnJvckNvZGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtZXJyb3ItY29kZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgQmxvYkFib3J0Q29weUZyb21VUkxIZWFkZXJzID0gewogICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiYmxvYi1hYm9ydGNvcHlmcm9tdXJsLWhlYWRlcnMiLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgIGNsYXNzTmFtZTogIkJsb2JBYm9ydENvcHlGcm9tVVJMSGVhZGVycyIsCiAgICAgICAgICAgIG1vZGVsUHJvcGVydGllczogewogICAgICAgICAgICAgICAgY2xpZW50UmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNsaWVudC1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHZlcnNpb246IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtdmVyc2lvbiIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBkYXRlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJkYXRlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJEYXRlVGltZVJmYzExMjMiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVycm9yQ29kZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1lcnJvci1jb2RlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBCbG9iU2V0VGllckhlYWRlcnMgPSB7CiAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJibG9iLXNldHRpZXItaGVhZGVycyIsCiAgICAgICAgdHlwZTogewogICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiQmxvYlNldFRpZXJIZWFkZXJzIiwKICAgICAgICAgICAgbW9kZWxQcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICBjbGllbnRSZXF1ZXN0SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtY2xpZW50LXJlcXVlc3QtaWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXJlcXVlc3QtaWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdmVyc2lvbjogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy12ZXJzaW9uIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVycm9yQ29kZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1lcnJvci1jb2RlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBCbG9iR2V0QWNjb3VudEluZm9IZWFkZXJzID0gewogICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiYmxvYi1nZXRhY2NvdW50aW5mby1oZWFkZXJzIiwKICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgIG5hbWU6ICJDb21wb3NpdGUiLAogICAgICAgICAgICBjbGFzc05hbWU6ICJCbG9iR2V0QWNjb3VudEluZm9IZWFkZXJzIiwKICAgICAgICAgICAgbW9kZWxQcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICBjbGllbnRSZXF1ZXN0SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtY2xpZW50LXJlcXVlc3QtaWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXJlcXVlc3QtaWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdmVyc2lvbjogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy12ZXJzaW9uIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGRhdGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImRhdGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgc2t1TmFtZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1za3UtbmFtZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRW51bSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGFsbG93ZWRWYWx1ZXM6IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJTdGFuZGFyZF9MUlMiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIlN0YW5kYXJkX0dSUyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiU3RhbmRhcmRfUkFHUlMiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIlN0YW5kYXJkX1pSUyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiUHJlbWl1bV9MUlMiCiAgICAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgYWNjb3VudEtpbmQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtYWNjb3VudC1raW5kIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJFbnVtIiwKICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dlZFZhbHVlczogWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIlN0b3JhZ2UiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIkJsb2JTdG9yYWdlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJTdG9yYWdlVjIiCiAgICAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXJyb3JDb2RlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWVycm9yLWNvZGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIEJsb2NrQmxvYlN0YWdlQmxvY2tIZWFkZXJzID0gewogICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiYmxvY2tibG9iLXN0YWdlYmxvY2staGVhZGVycyIsCiAgICAgICAgdHlwZTogewogICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiQmxvY2tCbG9iU3RhZ2VCbG9ja0hlYWRlcnMiLAogICAgICAgICAgICBtb2RlbFByb3BlcnRpZXM6IHsKICAgICAgICAgICAgICAgIGNvbnRlbnRNRDU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImNvbnRlbnQtbWQ1IiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJCeXRlQXJyYXkiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNsaWVudFJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1jbGllbnQtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZXF1ZXN0SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB2ZXJzaW9uOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXZlcnNpb24iLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZGF0ZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGF0ZVRpbWVSZmMxMTIzIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB4TXNDb250ZW50Q3JjNjQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtY29udGVudC1jcmM2NCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQnl0ZUFycmF5IgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBpc1NlcnZlckVuY3J5cHRlZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1yZXF1ZXN0LXNlcnZlci1lbmNyeXB0ZWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkJvb2xlYW4iCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVuY3J5cHRpb25LZXlTaGEyNTY6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtZW5jcnlwdGlvbi1rZXktc2hhMjU2IiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVycm9yQ29kZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1lcnJvci1jb2RlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBCbG9ja0Jsb2JTdGFnZUJsb2NrRnJvbVVSTEhlYWRlcnMgPSB7CiAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJibG9ja2Jsb2Itc3RhZ2VibG9ja2Zyb211cmwtaGVhZGVycyIsCiAgICAgICAgdHlwZTogewogICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiQmxvY2tCbG9iU3RhZ2VCbG9ja0Zyb21VUkxIZWFkZXJzIiwKICAgICAgICAgICAgbW9kZWxQcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICBjb250ZW50TUQ1OiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJjb250ZW50LW1kNSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQnl0ZUFycmF5IgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB4TXNDb250ZW50Q3JjNjQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtY29udGVudC1jcmM2NCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQnl0ZUFycmF5IgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjbGllbnRSZXF1ZXN0SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtY2xpZW50LXJlcXVlc3QtaWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXJlcXVlc3QtaWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdmVyc2lvbjogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy12ZXJzaW9uIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGRhdGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImRhdGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgaXNTZXJ2ZXJFbmNyeXB0ZWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtcmVxdWVzdC1zZXJ2ZXItZW5jcnlwdGVkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJCb29sZWFuIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlbmNyeXB0aW9uS2V5U2hhMjU2OiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWVuY3J5cHRpb24ta2V5LXNoYTI1NiIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlcnJvckNvZGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtZXJyb3ItY29kZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgQmxvY2tCbG9iQ29tbWl0QmxvY2tMaXN0SGVhZGVycyA9IHsKICAgICAgICBzZXJpYWxpemVkTmFtZTogImJsb2NrYmxvYi1jb21taXRibG9ja2xpc3QtaGVhZGVycyIsCiAgICAgICAgdHlwZTogewogICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiQmxvY2tCbG9iQ29tbWl0QmxvY2tMaXN0SGVhZGVycyIsCiAgICAgICAgICAgIG1vZGVsUHJvcGVydGllczogewogICAgICAgICAgICAgICAgZVRhZzogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZXRhZyIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImxhc3QtbW9kaWZpZWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY29udGVudE1ENTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiY29udGVudC1tZDUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkJ5dGVBcnJheSIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgeE1zQ29udGVudENyYzY0OiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNvbnRlbnQtY3JjNjQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkJ5dGVBcnJheSIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2xpZW50UmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNsaWVudC1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHZlcnNpb246IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtdmVyc2lvbiIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBkYXRlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJkYXRlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJEYXRlVGltZVJmYzExMjMiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGlzU2VydmVyRW5jcnlwdGVkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXJlcXVlc3Qtc2VydmVyLWVuY3J5cHRlZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQm9vbGVhbiIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZW5jcnlwdGlvbktleVNoYTI1NjogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1lbmNyeXB0aW9uLWtleS1zaGEyNTYiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXJyb3JDb2RlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWVycm9yLWNvZGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIEJsb2NrQmxvYkdldEJsb2NrTGlzdEhlYWRlcnMgPSB7CiAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJibG9ja2Jsb2ItZ2V0YmxvY2tsaXN0LWhlYWRlcnMiLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgIGNsYXNzTmFtZTogIkJsb2NrQmxvYkdldEJsb2NrTGlzdEhlYWRlcnMiLAogICAgICAgICAgICBtb2RlbFByb3BlcnRpZXM6IHsKICAgICAgICAgICAgICAgIGxhc3RNb2RpZmllZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAibGFzdC1tb2RpZmllZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGF0ZVRpbWVSZmMxMTIzIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlVGFnOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJldGFnIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJjb250ZW50LXR5cGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgYmxvYkNvbnRlbnRMZW5ndGg6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtYmxvYi1jb250ZW50LWxlbmd0aCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiTnVtYmVyIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjbGllbnRSZXF1ZXN0SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtY2xpZW50LXJlcXVlc3QtaWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXJlcXVlc3QtaWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdmVyc2lvbjogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy12ZXJzaW9uIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGRhdGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImRhdGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXJyb3JDb2RlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWVycm9yLWNvZGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIFBhZ2VCbG9iVXBsb2FkUGFnZXNIZWFkZXJzID0gewogICAgICAgIHNlcmlhbGl6ZWROYW1lOiAicGFnZWJsb2ItdXBsb2FkcGFnZXMtaGVhZGVycyIsCiAgICAgICAgdHlwZTogewogICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiUGFnZUJsb2JVcGxvYWRQYWdlc0hlYWRlcnMiLAogICAgICAgICAgICBtb2RlbFByb3BlcnRpZXM6IHsKICAgICAgICAgICAgICAgIGVUYWc6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImV0YWciLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbGFzdE1vZGlmaWVkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJsYXN0LW1vZGlmaWVkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJEYXRlVGltZVJmYzExMjMiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNvbnRlbnRNRDU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImNvbnRlbnQtbWQ1IiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJCeXRlQXJyYXkiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHhNc0NvbnRlbnRDcmM2NDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1jb250ZW50LWNyYzY0IiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJCeXRlQXJyYXkiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGJsb2JTZXF1ZW5jZU51bWJlcjogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1ibG9iLXNlcXVlbmNlLW51bWJlciIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiTnVtYmVyIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjbGllbnRSZXF1ZXN0SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtY2xpZW50LXJlcXVlc3QtaWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXJlcXVlc3QtaWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdmVyc2lvbjogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy12ZXJzaW9uIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGRhdGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImRhdGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgaXNTZXJ2ZXJFbmNyeXB0ZWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtcmVxdWVzdC1zZXJ2ZXItZW5jcnlwdGVkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJCb29sZWFuIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlbmNyeXB0aW9uS2V5U2hhMjU2OiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWVuY3J5cHRpb24ta2V5LXNoYTI1NiIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlcnJvckNvZGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtZXJyb3ItY29kZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgUGFnZUJsb2JDbGVhclBhZ2VzSGVhZGVycyA9IHsKICAgICAgICBzZXJpYWxpemVkTmFtZTogInBhZ2VibG9iLWNsZWFycGFnZXMtaGVhZGVycyIsCiAgICAgICAgdHlwZTogewogICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiUGFnZUJsb2JDbGVhclBhZ2VzSGVhZGVycyIsCiAgICAgICAgICAgIG1vZGVsUHJvcGVydGllczogewogICAgICAgICAgICAgICAgZVRhZzogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZXRhZyIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImxhc3QtbW9kaWZpZWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY29udGVudE1ENTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiY29udGVudC1tZDUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkJ5dGVBcnJheSIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgeE1zQ29udGVudENyYzY0OiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNvbnRlbnQtY3JjNjQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkJ5dGVBcnJheSIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgYmxvYlNlcXVlbmNlTnVtYmVyOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWJsb2Itc2VxdWVuY2UtbnVtYmVyIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJOdW1iZXIiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNsaWVudFJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1jbGllbnQtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZXF1ZXN0SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB2ZXJzaW9uOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXZlcnNpb24iLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZGF0ZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGF0ZVRpbWVSZmMxMTIzIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlcnJvckNvZGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtZXJyb3ItY29kZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgUGFnZUJsb2JVcGxvYWRQYWdlc0Zyb21VUkxIZWFkZXJzID0gewogICAgICAgIHNlcmlhbGl6ZWROYW1lOiAicGFnZWJsb2ItdXBsb2FkcGFnZXNmcm9tdXJsLWhlYWRlcnMiLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgIGNsYXNzTmFtZTogIlBhZ2VCbG9iVXBsb2FkUGFnZXNGcm9tVVJMSGVhZGVycyIsCiAgICAgICAgICAgIG1vZGVsUHJvcGVydGllczogewogICAgICAgICAgICAgICAgZVRhZzogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZXRhZyIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImxhc3QtbW9kaWZpZWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY29udGVudE1ENTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiY29udGVudC1tZDUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkJ5dGVBcnJheSIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgeE1zQ29udGVudENyYzY0OiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNvbnRlbnQtY3JjNjQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkJ5dGVBcnJheSIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgYmxvYlNlcXVlbmNlTnVtYmVyOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWJsb2Itc2VxdWVuY2UtbnVtYmVyIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJOdW1iZXIiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHZlcnNpb246IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtdmVyc2lvbiIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBkYXRlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJkYXRlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJEYXRlVGltZVJmYzExMjMiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGlzU2VydmVyRW5jcnlwdGVkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXJlcXVlc3Qtc2VydmVyLWVuY3J5cHRlZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQm9vbGVhbiIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZW5jcnlwdGlvbktleVNoYTI1NjogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1lbmNyeXB0aW9uLWtleS1zaGEyNTYiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXJyb3JDb2RlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWVycm9yLWNvZGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIFBhZ2VCbG9iR2V0UGFnZVJhbmdlc0hlYWRlcnMgPSB7CiAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJwYWdlYmxvYi1nZXRwYWdlcmFuZ2VzLWhlYWRlcnMiLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgIGNsYXNzTmFtZTogIlBhZ2VCbG9iR2V0UGFnZVJhbmdlc0hlYWRlcnMiLAogICAgICAgICAgICBtb2RlbFByb3BlcnRpZXM6IHsKICAgICAgICAgICAgICAgIGxhc3RNb2RpZmllZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAibGFzdC1tb2RpZmllZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGF0ZVRpbWVSZmMxMTIzIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlVGFnOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJldGFnIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGJsb2JDb250ZW50TGVuZ3RoOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWJsb2ItY29udGVudC1sZW5ndGgiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIk51bWJlciIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2xpZW50UmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNsaWVudC1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHZlcnNpb246IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtdmVyc2lvbiIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBkYXRlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJkYXRlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJEYXRlVGltZVJmYzExMjMiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVycm9yQ29kZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1lcnJvci1jb2RlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBQYWdlQmxvYkdldFBhZ2VSYW5nZXNEaWZmSGVhZGVycyA9IHsKICAgICAgICBzZXJpYWxpemVkTmFtZTogInBhZ2VibG9iLWdldHBhZ2VyYW5nZXNkaWZmLWhlYWRlcnMiLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgIGNsYXNzTmFtZTogIlBhZ2VCbG9iR2V0UGFnZVJhbmdlc0RpZmZIZWFkZXJzIiwKICAgICAgICAgICAgbW9kZWxQcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImxhc3QtbW9kaWZpZWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZVRhZzogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZXRhZyIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBibG9iQ29udGVudExlbmd0aDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1ibG9iLWNvbnRlbnQtbGVuZ3RoIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJOdW1iZXIiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNsaWVudFJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1jbGllbnQtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZXF1ZXN0SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB2ZXJzaW9uOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXZlcnNpb24iLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZGF0ZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGF0ZVRpbWVSZmMxMTIzIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlcnJvckNvZGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtZXJyb3ItY29kZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgUGFnZUJsb2JSZXNpemVIZWFkZXJzID0gewogICAgICAgIHNlcmlhbGl6ZWROYW1lOiAicGFnZWJsb2ItcmVzaXplLWhlYWRlcnMiLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgIGNsYXNzTmFtZTogIlBhZ2VCbG9iUmVzaXplSGVhZGVycyIsCiAgICAgICAgICAgIG1vZGVsUHJvcGVydGllczogewogICAgICAgICAgICAgICAgZVRhZzogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZXRhZyIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImxhc3QtbW9kaWZpZWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgYmxvYlNlcXVlbmNlTnVtYmVyOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWJsb2Itc2VxdWVuY2UtbnVtYmVyIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJOdW1iZXIiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNsaWVudFJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1jbGllbnQtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZXF1ZXN0SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB2ZXJzaW9uOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXZlcnNpb24iLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZGF0ZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGF0ZVRpbWVSZmMxMTIzIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlcnJvckNvZGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtZXJyb3ItY29kZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgUGFnZUJsb2JVcGRhdGVTZXF1ZW5jZU51bWJlckhlYWRlcnMgPSB7CiAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJwYWdlYmxvYi11cGRhdGVzZXF1ZW5jZW51bWJlci1oZWFkZXJzIiwKICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgIG5hbWU6ICJDb21wb3NpdGUiLAogICAgICAgICAgICBjbGFzc05hbWU6ICJQYWdlQmxvYlVwZGF0ZVNlcXVlbmNlTnVtYmVySGVhZGVycyIsCiAgICAgICAgICAgIG1vZGVsUHJvcGVydGllczogewogICAgICAgICAgICAgICAgZVRhZzogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZXRhZyIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImxhc3QtbW9kaWZpZWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgYmxvYlNlcXVlbmNlTnVtYmVyOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWJsb2Itc2VxdWVuY2UtbnVtYmVyIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJOdW1iZXIiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNsaWVudFJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1jbGllbnQtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZXF1ZXN0SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtcmVxdWVzdC1pZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB2ZXJzaW9uOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXZlcnNpb24iLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZGF0ZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGF0ZVRpbWVSZmMxMTIzIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlcnJvckNvZGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtZXJyb3ItY29kZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgUGFnZUJsb2JDb3B5SW5jcmVtZW50YWxIZWFkZXJzID0gewogICAgICAgIHNlcmlhbGl6ZWROYW1lOiAicGFnZWJsb2ItY29weWluY3JlbWVudGFsLWhlYWRlcnMiLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgIGNsYXNzTmFtZTogIlBhZ2VCbG9iQ29weUluY3JlbWVudGFsSGVhZGVycyIsCiAgICAgICAgICAgIG1vZGVsUHJvcGVydGllczogewogICAgICAgICAgICAgICAgZVRhZzogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZXRhZyIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImxhc3QtbW9kaWZpZWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2xpZW50UmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNsaWVudC1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlcXVlc3RJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHZlcnNpb246IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtdmVyc2lvbiIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBkYXRlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJkYXRlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJEYXRlVGltZVJmYzExMjMiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNvcHlJZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1jb3B5LWlkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNvcHlTdGF0dXM6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtY29weS1zdGF0dXMiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkVudW0iLAogICAgICAgICAgICAgICAgICAgICAgICBhbGxvd2VkVmFsdWVzOiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAicGVuZGluZyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAic3VjY2VzcyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYWJvcnRlZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZmFpbGVkIgogICAgICAgICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVycm9yQ29kZTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1lcnJvci1jb2RlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBBcHBlbmRCbG9iQXBwZW5kQmxvY2tIZWFkZXJzID0gewogICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiYXBwZW5kYmxvYi1hcHBlbmRibG9jay1oZWFkZXJzIiwKICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgIG5hbWU6ICJDb21wb3NpdGUiLAogICAgICAgICAgICBjbGFzc05hbWU6ICJBcHBlbmRCbG9iQXBwZW5kQmxvY2tIZWFkZXJzIiwKICAgICAgICAgICAgbW9kZWxQcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICBlVGFnOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJldGFnIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGxhc3RNb2RpZmllZDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAibGFzdC1tb2RpZmllZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGF0ZVRpbWVSZmMxMTIzIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjb250ZW50TUQ1OiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJjb250ZW50LW1kNSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQnl0ZUFycmF5IgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB4TXNDb250ZW50Q3JjNjQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtY29udGVudC1jcmM2NCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQnl0ZUFycmF5IgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjbGllbnRSZXF1ZXN0SWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtY2xpZW50LXJlcXVlc3QtaWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXJlcXVlc3QtaWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdmVyc2lvbjogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy12ZXJzaW9uIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGRhdGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImRhdGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgYmxvYkFwcGVuZE9mZnNldDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1ibG9iLWFwcGVuZC1vZmZzZXQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgYmxvYkNvbW1pdHRlZEJsb2NrQ291bnQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtYmxvYi1jb21taXR0ZWQtYmxvY2stY291bnQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIk51bWJlciIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgaXNTZXJ2ZXJFbmNyeXB0ZWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtcmVxdWVzdC1zZXJ2ZXItZW5jcnlwdGVkIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJCb29sZWFuIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlbmNyeXB0aW9uS2V5U2hhMjU2OiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWVuY3J5cHRpb24ta2V5LXNoYTI1NiIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlcnJvckNvZGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtZXJyb3ItY29kZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgQXBwZW5kQmxvYkFwcGVuZEJsb2NrRnJvbVVybEhlYWRlcnMgPSB7CiAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJhcHBlbmRibG9iLWFwcGVuZGJsb2NrZnJvbXVybC1oZWFkZXJzIiwKICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgIG5hbWU6ICJDb21wb3NpdGUiLAogICAgICAgICAgICBjbGFzc05hbWU6ICJBcHBlbmRCbG9iQXBwZW5kQmxvY2tGcm9tVXJsSGVhZGVycyIsCiAgICAgICAgICAgIG1vZGVsUHJvcGVydGllczogewogICAgICAgICAgICAgICAgZVRhZzogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiZXRhZyIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImxhc3QtbW9kaWZpZWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY29udGVudE1ENTogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiY29udGVudC1tZDUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkJ5dGVBcnJheSIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgeE1zQ29udGVudENyYzY0OiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNvbnRlbnQtY3JjNjQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkJ5dGVBcnJheSIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVxdWVzdElkOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXJlcXVlc3QtaWQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdmVyc2lvbjogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy12ZXJzaW9uIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGRhdGU6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImRhdGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgYmxvYkFwcGVuZE9mZnNldDogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1ibG9iLWFwcGVuZC1vZmZzZXQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgYmxvYkNvbW1pdHRlZEJsb2NrQ291bnQ6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtYmxvYi1jb21taXR0ZWQtYmxvY2stY291bnQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIk51bWJlciIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZW5jcnlwdGlvbktleVNoYTI1NjogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1lbmNyeXB0aW9uLWtleS1zaGEyNTYiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXJyb3JDb2RlOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWVycm9yLWNvZGUiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwoKICAgIC8qCiAgICAgKiBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICAgICAqIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS4gU2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24uCiAgICAgKgogICAgICogQ29kZSBnZW5lcmF0ZWQgYnkgTWljcm9zb2Z0IChSKSBBdXRvUmVzdCBDb2RlIEdlbmVyYXRvci4KICAgICAqIENoYW5nZXMgbWF5IGNhdXNlIGluY29ycmVjdCBiZWhhdmlvciBhbmQgd2lsbCBiZSBsb3N0IGlmIHRoZSBjb2RlIGlzIHJlZ2VuZXJhdGVkLgogICAgICovCgogICAgdmFyIE1hcHBlcnMgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICAgICAgQ29udGFpbmVySXRlbTogQ29udGFpbmVySXRlbSwKICAgICAgICBDb250YWluZXJQcm9wZXJ0aWVzOiBDb250YWluZXJQcm9wZXJ0aWVzLAogICAgICAgIENvcnNSdWxlOiBDb3JzUnVsZSwKICAgICAgICBHZW9SZXBsaWNhdGlvbjogR2VvUmVwbGljYXRpb24sCiAgICAgICAgS2V5SW5mbzogS2V5SW5mbywKICAgICAgICBMaXN0Q29udGFpbmVyc1NlZ21lbnRSZXNwb25zZTogTGlzdENvbnRhaW5lcnNTZWdtZW50UmVzcG9uc2UsCiAgICAgICAgTG9nZ2luZzogTG9nZ2luZywKICAgICAgICBNZXRyaWNzOiBNZXRyaWNzLAogICAgICAgIFJldGVudGlvblBvbGljeTogUmV0ZW50aW9uUG9saWN5LAogICAgICAgIFNlcnZpY2VHZXRBY2NvdW50SW5mb0hlYWRlcnM6IFNlcnZpY2VHZXRBY2NvdW50SW5mb0hlYWRlcnMsCiAgICAgICAgU2VydmljZUdldFByb3BlcnRpZXNIZWFkZXJzOiBTZXJ2aWNlR2V0UHJvcGVydGllc0hlYWRlcnMsCiAgICAgICAgU2VydmljZUdldFN0YXRpc3RpY3NIZWFkZXJzOiBTZXJ2aWNlR2V0U3RhdGlzdGljc0hlYWRlcnMsCiAgICAgICAgU2VydmljZUdldFVzZXJEZWxlZ2F0aW9uS2V5SGVhZGVyczogU2VydmljZUdldFVzZXJEZWxlZ2F0aW9uS2V5SGVhZGVycywKICAgICAgICBTZXJ2aWNlTGlzdENvbnRhaW5lcnNTZWdtZW50SGVhZGVyczogU2VydmljZUxpc3RDb250YWluZXJzU2VnbWVudEhlYWRlcnMsCiAgICAgICAgU2VydmljZVNldFByb3BlcnRpZXNIZWFkZXJzOiBTZXJ2aWNlU2V0UHJvcGVydGllc0hlYWRlcnMsCiAgICAgICAgU2VydmljZVN1Ym1pdEJhdGNoSGVhZGVyczogU2VydmljZVN1Ym1pdEJhdGNoSGVhZGVycywKICAgICAgICBTdGF0aWNXZWJzaXRlOiBTdGF0aWNXZWJzaXRlLAogICAgICAgIFN0b3JhZ2VFcnJvcjogU3RvcmFnZUVycm9yLAogICAgICAgIFN0b3JhZ2VTZXJ2aWNlUHJvcGVydGllczogU3RvcmFnZVNlcnZpY2VQcm9wZXJ0aWVzLAogICAgICAgIFN0b3JhZ2VTZXJ2aWNlU3RhdHM6IFN0b3JhZ2VTZXJ2aWNlU3RhdHMsCiAgICAgICAgVXNlckRlbGVnYXRpb25LZXk6IFVzZXJEZWxlZ2F0aW9uS2V5CiAgICB9KTsKCiAgICAvKgogICAgICogQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAgICAgKiBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvcgogICAgICogbGljZW5zZSBpbmZvcm1hdGlvbi4KICAgICAqCiAgICAgKiBDb2RlIGdlbmVyYXRlZCBieSBNaWNyb3NvZnQgKFIpIEF1dG9SZXN0IENvZGUgR2VuZXJhdG9yLgogICAgICogQ2hhbmdlcyBtYXkgY2F1c2UgaW5jb3JyZWN0IGJlaGF2aW9yIGFuZCB3aWxsIGJlIGxvc3QgaWYgdGhlIGNvZGUgaXMKICAgICAqIHJlZ2VuZXJhdGVkLgogICAgICovCiAgICB2YXIgYWNjZXNzID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6IFsKICAgICAgICAgICAgIm9wdGlvbnMiLAogICAgICAgICAgICAiYWNjZXNzIgogICAgICAgIF0sCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1ibG9iLXB1YmxpYy1hY2Nlc3MiLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBhY3Rpb24wID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6ICJhY3Rpb24iLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgaXNDb25zdGFudDogdHJ1ZSwKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWxlYXNlLWFjdGlvbiIsCiAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogJ2FjcXVpcmUnLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBhY3Rpb24xID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6ICJhY3Rpb24iLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgaXNDb25zdGFudDogdHJ1ZSwKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWxlYXNlLWFjdGlvbiIsCiAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogJ3JlbGVhc2UnLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBhY3Rpb24yID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6ICJhY3Rpb24iLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgaXNDb25zdGFudDogdHJ1ZSwKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWxlYXNlLWFjdGlvbiIsCiAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogJ3JlbmV3JywKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgYWN0aW9uMyA9IHsKICAgICAgICBwYXJhbWV0ZXJQYXRoOiAiYWN0aW9uIiwKICAgICAgICBtYXBwZXI6IHsKICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgIGlzQ29uc3RhbnQ6IHRydWUsCiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1sZWFzZS1hY3Rpb24iLAogICAgICAgICAgICBkZWZhdWx0VmFsdWU6ICdicmVhaycsCiAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIGFjdGlvbjQgPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogImFjdGlvbiIsCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICBpc0NvbnN0YW50OiB0cnVlLAogICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtbGVhc2UtYWN0aW9uIiwKICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiAnY2hhbmdlJywKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgYWN0aW9uNSA9IHsKICAgICAgICBwYXJhbWV0ZXJQYXRoOiAiYWN0aW9uIiwKICAgICAgICBtYXBwZXI6IHsKICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgIGlzQ29uc3RhbnQ6IHRydWUsCiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiYWN0aW9uIiwKICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiAnc2V0QWNjZXNzQ29udHJvbCcsCiAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIGFjdGlvbjYgPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogImFjdGlvbiIsCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICBpc0NvbnN0YW50OiB0cnVlLAogICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImFjdGlvbiIsCiAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogJ2dldEFjY2Vzc0NvbnRyb2wnLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBhcHBlbmRQb3NpdGlvbiA9IHsKICAgICAgICBwYXJhbWV0ZXJQYXRoOiBbCiAgICAgICAgICAgICJvcHRpb25zIiwKICAgICAgICAgICAgImFwcGVuZFBvc2l0aW9uQWNjZXNzQ29uZGl0aW9ucyIsCiAgICAgICAgICAgICJhcHBlbmRQb3NpdGlvbiIKICAgICAgICBdLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtYmxvYi1jb25kaXRpb24tYXBwZW5kcG9zIiwKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIk51bWJlciIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgYmxvYkNhY2hlQ29udHJvbCA9IHsKICAgICAgICBwYXJhbWV0ZXJQYXRoOiBbCiAgICAgICAgICAgICJvcHRpb25zIiwKICAgICAgICAgICAgImJsb2JIVFRQSGVhZGVycyIsCiAgICAgICAgICAgICJibG9iQ2FjaGVDb250cm9sIgogICAgICAgIF0sCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1ibG9iLWNhY2hlLWNvbnRyb2wiLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBibG9iQ29udGVudERpc3Bvc2l0aW9uID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6IFsKICAgICAgICAgICAgIm9wdGlvbnMiLAogICAgICAgICAgICAiYmxvYkhUVFBIZWFkZXJzIiwKICAgICAgICAgICAgImJsb2JDb250ZW50RGlzcG9zaXRpb24iCiAgICAgICAgXSwKICAgICAgICBtYXBwZXI6IHsKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWJsb2ItY29udGVudC1kaXNwb3NpdGlvbiIsCiAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIGJsb2JDb250ZW50RW5jb2RpbmcgPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogWwogICAgICAgICAgICAib3B0aW9ucyIsCiAgICAgICAgICAgICJibG9iSFRUUEhlYWRlcnMiLAogICAgICAgICAgICAiYmxvYkNvbnRlbnRFbmNvZGluZyIKICAgICAgICBdLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtYmxvYi1jb250ZW50LWVuY29kaW5nIiwKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgYmxvYkNvbnRlbnRMYW5ndWFnZSA9IHsKICAgICAgICBwYXJhbWV0ZXJQYXRoOiBbCiAgICAgICAgICAgICJvcHRpb25zIiwKICAgICAgICAgICAgImJsb2JIVFRQSGVhZGVycyIsCiAgICAgICAgICAgICJibG9iQ29udGVudExhbmd1YWdlIgogICAgICAgIF0sCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1ibG9iLWNvbnRlbnQtbGFuZ3VhZ2UiLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBibG9iQ29udGVudExlbmd0aCA9IHsKICAgICAgICBwYXJhbWV0ZXJQYXRoOiAiYmxvYkNvbnRlbnRMZW5ndGgiLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWJsb2ItY29udGVudC1sZW5ndGgiLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiTnVtYmVyIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBibG9iQ29udGVudE1ENSA9IHsKICAgICAgICBwYXJhbWV0ZXJQYXRoOiBbCiAgICAgICAgICAgICJvcHRpb25zIiwKICAgICAgICAgICAgImJsb2JIVFRQSGVhZGVycyIsCiAgICAgICAgICAgICJibG9iQ29udGVudE1ENSIKICAgICAgICBdLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtYmxvYi1jb250ZW50LW1kNSIsCiAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJCeXRlQXJyYXkiCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIGJsb2JDb250ZW50VHlwZSA9IHsKICAgICAgICBwYXJhbWV0ZXJQYXRoOiBbCiAgICAgICAgICAgICJvcHRpb25zIiwKICAgICAgICAgICAgImJsb2JIVFRQSGVhZGVycyIsCiAgICAgICAgICAgICJibG9iQ29udGVudFR5cGUiCiAgICAgICAgXSwKICAgICAgICBtYXBwZXI6IHsKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWJsb2ItY29udGVudC10eXBlIiwKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgYmxvYlNlcXVlbmNlTnVtYmVyID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6IFsKICAgICAgICAgICAgIm9wdGlvbnMiLAogICAgICAgICAgICAiYmxvYlNlcXVlbmNlTnVtYmVyIgogICAgICAgIF0sCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1ibG9iLXNlcXVlbmNlLW51bWJlciIsCiAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIk51bWJlciIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgYmxvYlR5cGUwID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6ICJibG9iVHlwZSIsCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICBpc0NvbnN0YW50OiB0cnVlLAogICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtYmxvYi10eXBlIiwKICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiAnUGFnZUJsb2InLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBibG9iVHlwZTEgPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogImJsb2JUeXBlIiwKICAgICAgICBtYXBwZXI6IHsKICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgIGlzQ29uc3RhbnQ6IHRydWUsCiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1ibG9iLXR5cGUiLAogICAgICAgICAgICBkZWZhdWx0VmFsdWU6ICdBcHBlbmRCbG9iJywKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgYmxvYlR5cGUyID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6ICJibG9iVHlwZSIsCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICBpc0NvbnN0YW50OiB0cnVlLAogICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtYmxvYi10eXBlIiwKICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiAnQmxvY2tCbG9iJywKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgYmxvY2tJZCA9IHsKICAgICAgICBwYXJhbWV0ZXJQYXRoOiAiYmxvY2tJZCIsCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImJsb2NraWQiLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBicmVha1BlcmlvZCA9IHsKICAgICAgICBwYXJhbWV0ZXJQYXRoOiBbCiAgICAgICAgICAgICJvcHRpb25zIiwKICAgICAgICAgICAgImJyZWFrUGVyaW9kIgogICAgICAgIF0sCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1sZWFzZS1icmVhay1wZXJpb2QiLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiTnVtYmVyIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBjYWNoZUNvbnRyb2wgPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogWwogICAgICAgICAgICAib3B0aW9ucyIsCiAgICAgICAgICAgICJkaXJlY3RvcnlIdHRwSGVhZGVycyIsCiAgICAgICAgICAgICJjYWNoZUNvbnRyb2wiCiAgICAgICAgXSwKICAgICAgICBtYXBwZXI6IHsKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNhY2hlLWNvbnRyb2wiLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBjb21wMCA9IHsKICAgICAgICBwYXJhbWV0ZXJQYXRoOiAiY29tcCIsCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICBpc0NvbnN0YW50OiB0cnVlLAogICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImNvbXAiLAogICAgICAgICAgICBkZWZhdWx0VmFsdWU6ICdwcm9wZXJ0aWVzJywKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgY29tcDEgPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogImNvbXAiLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgaXNDb25zdGFudDogdHJ1ZSwKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJjb21wIiwKICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiAnc3RhdHMnLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBjb21wMTAgPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogImNvbXAiLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgaXNDb25zdGFudDogdHJ1ZSwKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJjb21wIiwKICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiAnY29weScsCiAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIGNvbXAxMSA9IHsKICAgICAgICBwYXJhbWV0ZXJQYXRoOiAiY29tcCIsCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICBpc0NvbnN0YW50OiB0cnVlLAogICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImNvbXAiLAogICAgICAgICAgICBkZWZhdWx0VmFsdWU6ICd0aWVyJywKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgY29tcDEyID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6ICJjb21wIiwKICAgICAgICBtYXBwZXI6IHsKICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgIGlzQ29uc3RhbnQ6IHRydWUsCiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiY29tcCIsCiAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogJ3BhZ2UnLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBjb21wMTMgPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogImNvbXAiLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgaXNDb25zdGFudDogdHJ1ZSwKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJjb21wIiwKICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiAncGFnZWxpc3QnLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBjb21wMTQgPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogImNvbXAiLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgaXNDb25zdGFudDogdHJ1ZSwKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJjb21wIiwKICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiAnaW5jcmVtZW50YWxjb3B5JywKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgY29tcDE1ID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6ICJjb21wIiwKICAgICAgICBtYXBwZXI6IHsKICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgIGlzQ29uc3RhbnQ6IHRydWUsCiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiY29tcCIsCiAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogJ2FwcGVuZGJsb2NrJywKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgY29tcDE2ID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6ICJjb21wIiwKICAgICAgICBtYXBwZXI6IHsKICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgIGlzQ29uc3RhbnQ6IHRydWUsCiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiY29tcCIsCiAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogJ2Jsb2NrJywKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgY29tcDE3ID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6ICJjb21wIiwKICAgICAgICBtYXBwZXI6IHsKICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgIGlzQ29uc3RhbnQ6IHRydWUsCiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiY29tcCIsCiAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogJ2Jsb2NrbGlzdCcsCiAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIGNvbXAyID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6ICJjb21wIiwKICAgICAgICBtYXBwZXI6IHsKICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgIGlzQ29uc3RhbnQ6IHRydWUsCiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiY29tcCIsCiAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogJ2xpc3QnLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBjb21wMyA9IHsKICAgICAgICBwYXJhbWV0ZXJQYXRoOiAiY29tcCIsCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICBpc0NvbnN0YW50OiB0cnVlLAogICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImNvbXAiLAogICAgICAgICAgICBkZWZhdWx0VmFsdWU6ICd1c2VyZGVsZWdhdGlvbmtleScsCiAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIGNvbXA0ID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6ICJjb21wIiwKICAgICAgICBtYXBwZXI6IHsKICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgIGlzQ29uc3RhbnQ6IHRydWUsCiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiY29tcCIsCiAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogJ2JhdGNoJywKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgY29tcDUgPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogImNvbXAiLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgaXNDb25zdGFudDogdHJ1ZSwKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJjb21wIiwKICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiAnbWV0YWRhdGEnLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBjb21wNiA9IHsKICAgICAgICBwYXJhbWV0ZXJQYXRoOiAiY29tcCIsCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICBpc0NvbnN0YW50OiB0cnVlLAogICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImNvbXAiLAogICAgICAgICAgICBkZWZhdWx0VmFsdWU6ICdhY2wnLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBjb21wNyA9IHsKICAgICAgICBwYXJhbWV0ZXJQYXRoOiAiY29tcCIsCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICBpc0NvbnN0YW50OiB0cnVlLAogICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImNvbXAiLAogICAgICAgICAgICBkZWZhdWx0VmFsdWU6ICdsZWFzZScsCiAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIGNvbXA4ID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6ICJjb21wIiwKICAgICAgICBtYXBwZXI6IHsKICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgIGlzQ29uc3RhbnQ6IHRydWUsCiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiY29tcCIsCiAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogJ3VuZGVsZXRlJywKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgY29tcDkgPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogImNvbXAiLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgaXNDb25zdGFudDogdHJ1ZSwKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJjb21wIiwKICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiAnc25hcHNob3QnLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBjb250ZW50RGlzcG9zaXRpb24gPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogWwogICAgICAgICAgICAib3B0aW9ucyIsCiAgICAgICAgICAgICJkaXJlY3RvcnlIdHRwSGVhZGVycyIsCiAgICAgICAgICAgICJjb250ZW50RGlzcG9zaXRpb24iCiAgICAgICAgXSwKICAgICAgICBtYXBwZXI6IHsKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNvbnRlbnQtZGlzcG9zaXRpb24iLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBjb250ZW50RW5jb2RpbmcgPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogWwogICAgICAgICAgICAib3B0aW9ucyIsCiAgICAgICAgICAgICJkaXJlY3RvcnlIdHRwSGVhZGVycyIsCiAgICAgICAgICAgICJjb250ZW50RW5jb2RpbmciCiAgICAgICAgXSwKICAgICAgICBtYXBwZXI6IHsKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNvbnRlbnQtZW5jb2RpbmciLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBjb250ZW50TGFuZ3VhZ2UgPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogWwogICAgICAgICAgICAib3B0aW9ucyIsCiAgICAgICAgICAgICJkaXJlY3RvcnlIdHRwSGVhZGVycyIsCiAgICAgICAgICAgICJjb250ZW50TGFuZ3VhZ2UiCiAgICAgICAgXSwKICAgICAgICBtYXBwZXI6IHsKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNvbnRlbnQtbGFuZ3VhZ2UiLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBjb250ZW50TGVuZ3RoID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6ICJjb250ZW50TGVuZ3RoIiwKICAgICAgICBtYXBwZXI6IHsKICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiQ29udGVudC1MZW5ndGgiLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiTnVtYmVyIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBjb250ZW50VHlwZSA9IHsKICAgICAgICBwYXJhbWV0ZXJQYXRoOiBbCiAgICAgICAgICAgICJvcHRpb25zIiwKICAgICAgICAgICAgImRpcmVjdG9yeUh0dHBIZWFkZXJzIiwKICAgICAgICAgICAgImNvbnRlbnRUeXBlIgogICAgICAgIF0sCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1jb250ZW50LXR5cGUiLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBjb3B5QWN0aW9uQWJvcnRDb25zdGFudCA9IHsKICAgICAgICBwYXJhbWV0ZXJQYXRoOiAiY29weUFjdGlvbkFib3J0Q29uc3RhbnQiLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgaXNDb25zdGFudDogdHJ1ZSwKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNvcHktYWN0aW9uIiwKICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiAnYWJvcnQnLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBjb3B5SWQgPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogImNvcHlJZCIsCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImNvcHlpZCIsCiAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIGNvcHlTb3VyY2UgPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogImNvcHlTb3VyY2UiLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNvcHktc291cmNlIiwKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgZGVsZXRlU25hcHNob3RzID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6IFsKICAgICAgICAgICAgIm9wdGlvbnMiLAogICAgICAgICAgICAiZGVsZXRlU25hcHNob3RzIgogICAgICAgIF0sCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1kZWxldGUtc25hcHNob3RzIiwKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIkVudW0iLAogICAgICAgICAgICAgICAgYWxsb3dlZFZhbHVlczogWwogICAgICAgICAgICAgICAgICAgICJpbmNsdWRlIiwKICAgICAgICAgICAgICAgICAgICAib25seSIKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgZGVsaW1pdGVyID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6ICJkZWxpbWl0ZXIiLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJkZWxpbWl0ZXIiLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBkaXJlY3RvcnlQcm9wZXJ0aWVzID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6IFsKICAgICAgICAgICAgIm9wdGlvbnMiLAogICAgICAgICAgICAiZGlyZWN0b3J5UHJvcGVydGllcyIKICAgICAgICBdLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtcHJvcGVydGllcyIsCiAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIGR1cmF0aW9uID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6IFsKICAgICAgICAgICAgIm9wdGlvbnMiLAogICAgICAgICAgICAiZHVyYXRpb24iCiAgICAgICAgXSwKICAgICAgICBtYXBwZXI6IHsKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWxlYXNlLWR1cmF0aW9uIiwKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIk51bWJlciIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgZW5jcnlwdGlvbkFsZ29yaXRobSA9IHsKICAgICAgICBwYXJhbWV0ZXJQYXRoOiBbCiAgICAgICAgICAgICJvcHRpb25zIiwKICAgICAgICAgICAgImNwa0luZm8iLAogICAgICAgICAgICAiZW5jcnlwdGlvbkFsZ29yaXRobSIKICAgICAgICBdLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtZW5jcnlwdGlvbi1hbGdvcml0aG0iLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiRW51bSIsCiAgICAgICAgICAgICAgICBhbGxvd2VkVmFsdWVzOiBbCiAgICAgICAgICAgICAgICAgICAgIkFFUzI1NiIKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgZW5jcnlwdGlvbktleSA9IHsKICAgICAgICBwYXJhbWV0ZXJQYXRoOiBbCiAgICAgICAgICAgICJvcHRpb25zIiwKICAgICAgICAgICAgImNwa0luZm8iLAogICAgICAgICAgICAiZW5jcnlwdGlvbktleSIKICAgICAgICBdLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtZW5jcnlwdGlvbi1rZXkiLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBlbmNyeXB0aW9uS2V5U2hhMjU2ID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6IFsKICAgICAgICAgICAgIm9wdGlvbnMiLAogICAgICAgICAgICAiY3BrSW5mbyIsCiAgICAgICAgICAgICJlbmNyeXB0aW9uS2V5U2hhMjU2IgogICAgICAgIF0sCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1lbmNyeXB0aW9uLWtleS1zaGEyNTYiLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBncm91cCA9IHsKICAgICAgICBwYXJhbWV0ZXJQYXRoOiBbCiAgICAgICAgICAgICJvcHRpb25zIiwKICAgICAgICAgICAgImdyb3VwIgogICAgICAgIF0sCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1ncm91cCIsCiAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIGlmTWF0Y2ggPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogWwogICAgICAgICAgICAib3B0aW9ucyIsCiAgICAgICAgICAgICJtb2RpZmllZEFjY2Vzc0NvbmRpdGlvbnMiLAogICAgICAgICAgICAiaWZNYXRjaCIKICAgICAgICBdLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIklmLU1hdGNoIiwKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgaWZNb2RpZmllZFNpbmNlID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6IFsKICAgICAgICAgICAgIm9wdGlvbnMiLAogICAgICAgICAgICAibW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zIiwKICAgICAgICAgICAgImlmTW9kaWZpZWRTaW5jZSIKICAgICAgICBdLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIklmLU1vZGlmaWVkLVNpbmNlIiwKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIkRhdGVUaW1lUmZjMTEyMyIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgaWZOb25lTWF0Y2ggPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogWwogICAgICAgICAgICAib3B0aW9ucyIsCiAgICAgICAgICAgICJtb2RpZmllZEFjY2Vzc0NvbmRpdGlvbnMiLAogICAgICAgICAgICAiaWZOb25lTWF0Y2giCiAgICAgICAgXSwKICAgICAgICBtYXBwZXI6IHsKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJJZi1Ob25lLU1hdGNoIiwKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgaWZTZXF1ZW5jZU51bWJlckVxdWFsVG8gPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogWwogICAgICAgICAgICAib3B0aW9ucyIsCiAgICAgICAgICAgICJzZXF1ZW5jZU51bWJlckFjY2Vzc0NvbmRpdGlvbnMiLAogICAgICAgICAgICAiaWZTZXF1ZW5jZU51bWJlckVxdWFsVG8iCiAgICAgICAgXSwKICAgICAgICBtYXBwZXI6IHsKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWlmLXNlcXVlbmNlLW51bWJlci1lcSIsCiAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJOdW1iZXIiCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIGlmU2VxdWVuY2VOdW1iZXJMZXNzVGhhbiA9IHsKICAgICAgICBwYXJhbWV0ZXJQYXRoOiBbCiAgICAgICAgICAgICJvcHRpb25zIiwKICAgICAgICAgICAgInNlcXVlbmNlTnVtYmVyQWNjZXNzQ29uZGl0aW9ucyIsCiAgICAgICAgICAgICJpZlNlcXVlbmNlTnVtYmVyTGVzc1RoYW4iCiAgICAgICAgXSwKICAgICAgICBtYXBwZXI6IHsKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWlmLXNlcXVlbmNlLW51bWJlci1sdCIsCiAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJOdW1iZXIiCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIGlmU2VxdWVuY2VOdW1iZXJMZXNzVGhhbk9yRXF1YWxUbyA9IHsKICAgICAgICBwYXJhbWV0ZXJQYXRoOiBbCiAgICAgICAgICAgICJvcHRpb25zIiwKICAgICAgICAgICAgInNlcXVlbmNlTnVtYmVyQWNjZXNzQ29uZGl0aW9ucyIsCiAgICAgICAgICAgICJpZlNlcXVlbmNlTnVtYmVyTGVzc1RoYW5PckVxdWFsVG8iCiAgICAgICAgXSwKICAgICAgICBtYXBwZXI6IHsKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWlmLXNlcXVlbmNlLW51bWJlci1sZSIsCiAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJOdW1iZXIiCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIGlmVW5tb2RpZmllZFNpbmNlID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6IFsKICAgICAgICAgICAgIm9wdGlvbnMiLAogICAgICAgICAgICAibW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zIiwKICAgICAgICAgICAgImlmVW5tb2RpZmllZFNpbmNlIgogICAgICAgIF0sCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiSWYtVW5tb2RpZmllZC1TaW5jZSIsCiAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJEYXRlVGltZVJmYzExMjMiCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIGluY2x1ZGUwID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6IFsKICAgICAgICAgICAgIm9wdGlvbnMiLAogICAgICAgICAgICAiaW5jbHVkZSIKICAgICAgICBdLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImluY2x1ZGUiLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiRW51bSIsCiAgICAgICAgICAgICAgICBhbGxvd2VkVmFsdWVzOiBbCiAgICAgICAgICAgICAgICAgICAgIm1ldGFkYXRhIgogICAgICAgICAgICAgICAgXQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBpbmNsdWRlMSA9IHsKICAgICAgICBwYXJhbWV0ZXJQYXRoOiBbCiAgICAgICAgICAgICJvcHRpb25zIiwKICAgICAgICAgICAgImluY2x1ZGUiCiAgICAgICAgXSwKICAgICAgICBtYXBwZXI6IHsKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJpbmNsdWRlIiwKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIlNlcXVlbmNlIiwKICAgICAgICAgICAgICAgIGVsZW1lbnQ6IHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJFbnVtIiwKICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dlZFZhbHVlczogWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgImNvcHkiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImRlbGV0ZWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIm1ldGFkYXRhIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzbmFwc2hvdHMiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInVuY29tbWl0dGVkYmxvYnMiCiAgICAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGNvbGxlY3Rpb25Gb3JtYXQ6IFF1ZXJ5Q29sbGVjdGlvbkZvcm1hdC5Dc3YKICAgIH07CiAgICB2YXIgbGVhc2VJZDAgPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogWwogICAgICAgICAgICAib3B0aW9ucyIsCiAgICAgICAgICAgICJsZWFzZUFjY2Vzc0NvbmRpdGlvbnMiLAogICAgICAgICAgICAibGVhc2VJZCIKICAgICAgICBdLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtbGVhc2UtaWQiLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBsZWFzZUlkMSA9IHsKICAgICAgICBwYXJhbWV0ZXJQYXRoOiAibGVhc2VJZCIsCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtbGVhc2UtaWQiLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBsaXN0VHlwZSA9IHsKICAgICAgICBwYXJhbWV0ZXJQYXRoOiAibGlzdFR5cGUiLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJibG9ja2xpc3R0eXBlIiwKICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiAnY29tbWl0dGVkJywKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIkVudW0iLAogICAgICAgICAgICAgICAgYWxsb3dlZFZhbHVlczogWwogICAgICAgICAgICAgICAgICAgICJjb21taXR0ZWQiLAogICAgICAgICAgICAgICAgICAgICJ1bmNvbW1pdHRlZCIsCiAgICAgICAgICAgICAgICAgICAgImFsbCIKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgbWFya2VyMCA9IHsKICAgICAgICBwYXJhbWV0ZXJQYXRoOiBbCiAgICAgICAgICAgICJvcHRpb25zIiwKICAgICAgICAgICAgIm1hcmtlciIKICAgICAgICBdLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIm1hcmtlciIsCiAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIG1heHJlc3VsdHMgPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogWwogICAgICAgICAgICAib3B0aW9ucyIsCiAgICAgICAgICAgICJtYXhyZXN1bHRzIgogICAgICAgIF0sCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAibWF4cmVzdWx0cyIsCiAgICAgICAgICAgIGNvbnN0cmFpbnRzOiB7CiAgICAgICAgICAgICAgICBJbmNsdXNpdmVNaW5pbXVtOiAxCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJOdW1iZXIiCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIG1heFNpemUgPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogWwogICAgICAgICAgICAib3B0aW9ucyIsCiAgICAgICAgICAgICJhcHBlbmRQb3NpdGlvbkFjY2Vzc0NvbmRpdGlvbnMiLAogICAgICAgICAgICAibWF4U2l6ZSIKICAgICAgICBdLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtYmxvYi1jb25kaXRpb24tbWF4c2l6ZSIsCiAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJOdW1iZXIiCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIG1ldGFkYXRhID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6IFsKICAgICAgICAgICAgIm9wdGlvbnMiLAogICAgICAgICAgICAibWV0YWRhdGEiCiAgICAgICAgXSwKICAgICAgICBtYXBwZXI6IHsKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLW1ldGEiLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiRGljdGlvbmFyeSIsCiAgICAgICAgICAgICAgICB2YWx1ZTogewogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGhlYWRlckNvbGxlY3Rpb25QcmVmaXg6ICJ4LW1zLW1ldGEtIgogICAgICAgIH0KICAgIH07CiAgICB2YXIgbXVsdGlwYXJ0Q29udGVudFR5cGUgPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogIm11bHRpcGFydENvbnRlbnRUeXBlIiwKICAgICAgICBtYXBwZXI6IHsKICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiQ29udGVudC1UeXBlIiwKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgb3duZXIgPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogWwogICAgICAgICAgICAib3B0aW9ucyIsCiAgICAgICAgICAgICJvd25lciIKICAgICAgICBdLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtb3duZXIiLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBwYWdlV3JpdGUwID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6ICJwYWdlV3JpdGUiLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgaXNDb25zdGFudDogdHJ1ZSwKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXBhZ2Utd3JpdGUiLAogICAgICAgICAgICBkZWZhdWx0VmFsdWU6ICd1cGRhdGUnLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBwYWdlV3JpdGUxID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6ICJwYWdlV3JpdGUiLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgaXNDb25zdGFudDogdHJ1ZSwKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXBhZ2Utd3JpdGUiLAogICAgICAgICAgICBkZWZhdWx0VmFsdWU6ICdjbGVhcicsCiAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIHBhdGhSZW5hbWVNb2RlID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6ICJwYXRoUmVuYW1lTW9kZSIsCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAibW9kZSIsCiAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJFbnVtIiwKICAgICAgICAgICAgICAgIGFsbG93ZWRWYWx1ZXM6IFsKICAgICAgICAgICAgICAgICAgICAibGVnYWN5IiwKICAgICAgICAgICAgICAgICAgICAicG9zaXgiCiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIHBvc2l4QWNsID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6IFsKICAgICAgICAgICAgIm9wdGlvbnMiLAogICAgICAgICAgICAicG9zaXhBY2wiCiAgICAgICAgXSwKICAgICAgICBtYXBwZXI6IHsKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWFjbCIsCiAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIHBvc2l4UGVybWlzc2lvbnMgPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogWwogICAgICAgICAgICAib3B0aW9ucyIsCiAgICAgICAgICAgICJwb3NpeFBlcm1pc3Npb25zIgogICAgICAgIF0sCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1wZXJtaXNzaW9ucyIsCiAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIHBvc2l4VW1hc2sgPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogWwogICAgICAgICAgICAib3B0aW9ucyIsCiAgICAgICAgICAgICJwb3NpeFVtYXNrIgogICAgICAgIF0sCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy11bWFzayIsCiAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIHByZWZpeCA9IHsKICAgICAgICBwYXJhbWV0ZXJQYXRoOiBbCiAgICAgICAgICAgICJvcHRpb25zIiwKICAgICAgICAgICAgInByZWZpeCIKICAgICAgICBdLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogInByZWZpeCIsCiAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIHByZXZzbmFwc2hvdCA9IHsKICAgICAgICBwYXJhbWV0ZXJQYXRoOiBbCiAgICAgICAgICAgICJvcHRpb25zIiwKICAgICAgICAgICAgInByZXZzbmFwc2hvdCIKICAgICAgICBdLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogInByZXZzbmFwc2hvdCIsCiAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIHByb3Bvc2VkTGVhc2VJZDAgPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogWwogICAgICAgICAgICAib3B0aW9ucyIsCiAgICAgICAgICAgICJwcm9wb3NlZExlYXNlSWQiCiAgICAgICAgXSwKICAgICAgICBtYXBwZXI6IHsKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXByb3Bvc2VkLWxlYXNlLWlkIiwKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgcHJvcG9zZWRMZWFzZUlkMSA9IHsKICAgICAgICBwYXJhbWV0ZXJQYXRoOiAicHJvcG9zZWRMZWFzZUlkIiwKICAgICAgICBtYXBwZXI6IHsKICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1wcm9wb3NlZC1sZWFzZS1pZCIsCiAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIHJhbmdlMCA9IHsKICAgICAgICBwYXJhbWV0ZXJQYXRoOiBbCiAgICAgICAgICAgICJvcHRpb25zIiwKICAgICAgICAgICAgInJhbmdlIgogICAgICAgIF0sCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1yYW5nZSIsCiAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIHJhbmdlMSA9IHsKICAgICAgICBwYXJhbWV0ZXJQYXRoOiAicmFuZ2UiLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXJhbmdlIiwKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgcmFuZ2VHZXRDb250ZW50Q1JDNjQgPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogWwogICAgICAgICAgICAib3B0aW9ucyIsCiAgICAgICAgICAgICJyYW5nZUdldENvbnRlbnRDUkM2NCIKICAgICAgICBdLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtcmFuZ2UtZ2V0LWNvbnRlbnQtY3JjNjQiLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiQm9vbGVhbiIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgcmFuZ2VHZXRDb250ZW50TUQ1ID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6IFsKICAgICAgICAgICAgIm9wdGlvbnMiLAogICAgICAgICAgICAicmFuZ2VHZXRDb250ZW50TUQ1IgogICAgICAgIF0sCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1yYW5nZS1nZXQtY29udGVudC1tZDUiLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiQm9vbGVhbiIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgcmVoeWRyYXRlUHJpb3JpdHkgPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogWwogICAgICAgICAgICAib3B0aW9ucyIsCiAgICAgICAgICAgICJyZWh5ZHJhdGVQcmlvcml0eSIKICAgICAgICBdLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtcmVoeWRyYXRlLXByaW9yaXR5IiwKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgcmVuYW1lU291cmNlID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6ICJyZW5hbWVTb3VyY2UiLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXJlbmFtZS1zb3VyY2UiLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciByZXF1ZXN0SWQgPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogWwogICAgICAgICAgICAib3B0aW9ucyIsCiAgICAgICAgICAgICJyZXF1ZXN0SWQiCiAgICAgICAgXSwKICAgICAgICBtYXBwZXI6IHsKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNsaWVudC1yZXF1ZXN0LWlkIiwKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgcmVzdHlwZTAgPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogInJlc3R5cGUiLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgaXNDb25zdGFudDogdHJ1ZSwKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJyZXN0eXBlIiwKICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiAnc2VydmljZScsCiAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIHJlc3R5cGUxID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6ICJyZXN0eXBlIiwKICAgICAgICBtYXBwZXI6IHsKICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgIGlzQ29uc3RhbnQ6IHRydWUsCiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAicmVzdHlwZSIsCiAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogJ2FjY291bnQnLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciByZXN0eXBlMiA9IHsKICAgICAgICBwYXJhbWV0ZXJQYXRoOiAicmVzdHlwZSIsCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICBpc0NvbnN0YW50OiB0cnVlLAogICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogInJlc3R5cGUiLAogICAgICAgICAgICBkZWZhdWx0VmFsdWU6ICdjb250YWluZXInLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBzZXF1ZW5jZU51bWJlckFjdGlvbiA9IHsKICAgICAgICBwYXJhbWV0ZXJQYXRoOiAic2VxdWVuY2VOdW1iZXJBY3Rpb24iLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXNlcXVlbmNlLW51bWJlci1hY3Rpb24iLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiRW51bSIsCiAgICAgICAgICAgICAgICBhbGxvd2VkVmFsdWVzOiBbCiAgICAgICAgICAgICAgICAgICAgIm1heCIsCiAgICAgICAgICAgICAgICAgICAgInVwZGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgImluY3JlbWVudCIKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgc25hcHNob3QgPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogWwogICAgICAgICAgICAib3B0aW9ucyIsCiAgICAgICAgICAgICJzbmFwc2hvdCIKICAgICAgICBdLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogInNuYXBzaG90IiwKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgc291cmNlQ29udGVudENyYzY0ID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6IFsKICAgICAgICAgICAgIm9wdGlvbnMiLAogICAgICAgICAgICAic291cmNlQ29udGVudENyYzY0IgogICAgICAgIF0sCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1zb3VyY2UtY29udGVudC1jcmM2NCIsCiAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJCeXRlQXJyYXkiCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIHNvdXJjZUNvbnRlbnRNRDUgPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogWwogICAgICAgICAgICAib3B0aW9ucyIsCiAgICAgICAgICAgICJzb3VyY2VDb250ZW50TUQ1IgogICAgICAgIF0sCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1zb3VyY2UtY29udGVudC1tZDUiLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiQnl0ZUFycmF5IgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBzb3VyY2VJZk1hdGNoID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6IFsKICAgICAgICAgICAgIm9wdGlvbnMiLAogICAgICAgICAgICAic291cmNlTW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zIiwKICAgICAgICAgICAgInNvdXJjZUlmTWF0Y2giCiAgICAgICAgXSwKICAgICAgICBtYXBwZXI6IHsKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXNvdXJjZS1pZi1tYXRjaCIsCiAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIHNvdXJjZUlmTW9kaWZpZWRTaW5jZSA9IHsKICAgICAgICBwYXJhbWV0ZXJQYXRoOiBbCiAgICAgICAgICAgICJvcHRpb25zIiwKICAgICAgICAgICAgInNvdXJjZU1vZGlmaWVkQWNjZXNzQ29uZGl0aW9ucyIsCiAgICAgICAgICAgICJzb3VyY2VJZk1vZGlmaWVkU2luY2UiCiAgICAgICAgXSwKICAgICAgICBtYXBwZXI6IHsKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXNvdXJjZS1pZi1tb2RpZmllZC1zaW5jZSIsCiAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJEYXRlVGltZVJmYzExMjMiCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIHNvdXJjZUlmTm9uZU1hdGNoID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6IFsKICAgICAgICAgICAgIm9wdGlvbnMiLAogICAgICAgICAgICAic291cmNlTW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zIiwKICAgICAgICAgICAgInNvdXJjZUlmTm9uZU1hdGNoIgogICAgICAgIF0sCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1zb3VyY2UtaWYtbm9uZS1tYXRjaCIsCiAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIHNvdXJjZUlmVW5tb2RpZmllZFNpbmNlID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6IFsKICAgICAgICAgICAgIm9wdGlvbnMiLAogICAgICAgICAgICAic291cmNlTW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zIiwKICAgICAgICAgICAgInNvdXJjZUlmVW5tb2RpZmllZFNpbmNlIgogICAgICAgIF0sCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1zb3VyY2UtaWYtdW5tb2RpZmllZC1zaW5jZSIsCiAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJEYXRlVGltZVJmYzExMjMiCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIHNvdXJjZUxlYXNlSWQgPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogWwogICAgICAgICAgICAib3B0aW9ucyIsCiAgICAgICAgICAgICJzb3VyY2VMZWFzZUlkIgogICAgICAgIF0sCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1zb3VyY2UtbGVhc2UtaWQiLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBzb3VyY2VSYW5nZTAgPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogInNvdXJjZVJhbmdlIiwKICAgICAgICBtYXBwZXI6IHsKICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1zb3VyY2UtcmFuZ2UiLAogICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICBuYW1lOiAiU3RyaW5nIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHZhciBzb3VyY2VSYW5nZTEgPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogWwogICAgICAgICAgICAib3B0aW9ucyIsCiAgICAgICAgICAgICJzb3VyY2VSYW5nZSIKICAgICAgICBdLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIngtbXMtc291cmNlLXJhbmdlIiwKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgc291cmNlVXJsID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6ICJzb3VyY2VVcmwiLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLWNvcHktc291cmNlIiwKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgdGllcjAgPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogWwogICAgICAgICAgICAib3B0aW9ucyIsCiAgICAgICAgICAgICJ0aWVyIgogICAgICAgIF0sCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1hY2Nlc3MtdGllciIsCiAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIHRpZXIxID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6ICJ0aWVyIiwKICAgICAgICBtYXBwZXI6IHsKICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1hY2Nlc3MtdGllciIsCiAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJpbmciCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIHRpbWVvdXQgPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogWwogICAgICAgICAgICAib3B0aW9ucyIsCiAgICAgICAgICAgICJ0aW1lb3V0IgogICAgICAgIF0sCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAidGltZW91dCIsCiAgICAgICAgICAgIGNvbnN0cmFpbnRzOiB7CiAgICAgICAgICAgICAgICBJbmNsdXNpdmVNaW5pbXVtOiAwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJOdW1iZXIiCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIHRyYW5zYWN0aW9uYWxDb250ZW50Q3JjNjQgPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogWwogICAgICAgICAgICAib3B0aW9ucyIsCiAgICAgICAgICAgICJ0cmFuc2FjdGlvbmFsQ29udGVudENyYzY0IgogICAgICAgIF0sCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAieC1tcy1jb250ZW50LWNyYzY0IiwKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIkJ5dGVBcnJheSIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgdHJhbnNhY3Rpb25hbENvbnRlbnRNRDUgPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogWwogICAgICAgICAgICAib3B0aW9ucyIsCiAgICAgICAgICAgICJ0cmFuc2FjdGlvbmFsQ29udGVudE1ENSIKICAgICAgICBdLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogIkNvbnRlbnQtTUQ1IiwKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIkJ5dGVBcnJheSIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgdXBuID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6IFsKICAgICAgICAgICAgIm9wdGlvbnMiLAogICAgICAgICAgICAidXBuIgogICAgICAgIF0sCiAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAidXBuIiwKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIkJvb2xlYW4iCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIHVybCA9IHsKICAgICAgICBwYXJhbWV0ZXJQYXRoOiAidXJsIiwKICAgICAgICBtYXBwZXI6IHsKICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAidXJsIiwKICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiAnJywKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgc2tpcEVuY29kaW5nOiB0cnVlCiAgICB9OwogICAgdmFyIHZlcnNpb24gPSB7CiAgICAgICAgcGFyYW1ldGVyUGF0aDogInZlcnNpb24iLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgaXNDb25zdGFudDogdHJ1ZSwKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXZlcnNpb24iLAogICAgICAgICAgICBkZWZhdWx0VmFsdWU6ICcyMDE5LTAyLTAyJywKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICB2YXIgeE1zUmVxdWlyZXNTeW5jID0gewogICAgICAgIHBhcmFtZXRlclBhdGg6ICJ4TXNSZXF1aXJlc1N5bmMiLAogICAgICAgIG1hcHBlcjogewogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgaXNDb25zdGFudDogdHJ1ZSwKICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJ4LW1zLXJlcXVpcmVzLXN5bmMiLAogICAgICAgICAgICBkZWZhdWx0VmFsdWU6ICd0cnVlJywKICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgbmFtZTogIlN0cmluZyIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CgogICAgLyoKICAgICAqIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogICAgICogTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IKICAgICAqIGxpY2Vuc2UgaW5mb3JtYXRpb24uCiAgICAgKgogICAgICogQ29kZSBnZW5lcmF0ZWQgYnkgTWljcm9zb2Z0IChSKSBBdXRvUmVzdCBDb2RlIEdlbmVyYXRvci4KICAgICAqIENoYW5nZXMgbWF5IGNhdXNlIGluY29ycmVjdCBiZWhhdmlvciBhbmQgd2lsbCBiZSBsb3N0IGlmIHRoZSBjb2RlIGlzCiAgICAgKiByZWdlbmVyYXRlZC4KICAgICAqLwogICAgLyoqIENsYXNzIHJlcHJlc2VudGluZyBhIFNlcnZpY2UuICovCiAgICB2YXIgU2VydmljZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGUgYSBTZXJ2aWNlLgogICAgICAgICAqIEBwYXJhbSB7U3RvcmFnZUNsaWVudENvbnRleHR9IGNsaWVudCBSZWZlcmVuY2UgdG8gdGhlIHNlcnZpY2UgY2xpZW50LgogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIFNlcnZpY2UoY2xpZW50KSB7CiAgICAgICAgICAgIHRoaXMuY2xpZW50ID0gY2xpZW50OwogICAgICAgIH0KICAgICAgICBTZXJ2aWNlLnByb3RvdHlwZS5zZXRQcm9wZXJ0aWVzID0gZnVuY3Rpb24gKHN0b3JhZ2VTZXJ2aWNlUHJvcGVydGllcywgb3B0aW9ucywgY2FsbGJhY2spIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2xpZW50LnNlbmRPcGVyYXRpb25SZXF1ZXN0KHsKICAgICAgICAgICAgICAgIHN0b3JhZ2VTZXJ2aWNlUHJvcGVydGllczogc3RvcmFnZVNlcnZpY2VQcm9wZXJ0aWVzLAogICAgICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucwogICAgICAgICAgICB9LCBzZXRQcm9wZXJ0aWVzT3BlcmF0aW9uU3BlYywgY2FsbGJhY2spOwogICAgICAgIH07CiAgICAgICAgU2VydmljZS5wcm90b3R5cGUuZ2V0UHJvcGVydGllcyA9IGZ1bmN0aW9uIChvcHRpb25zLCBjYWxsYmFjaykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jbGllbnQuc2VuZE9wZXJhdGlvblJlcXVlc3QoewogICAgICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucwogICAgICAgICAgICB9LCBnZXRQcm9wZXJ0aWVzT3BlcmF0aW9uU3BlYywgY2FsbGJhY2spOwogICAgICAgIH07CiAgICAgICAgU2VydmljZS5wcm90b3R5cGUuZ2V0U3RhdGlzdGljcyA9IGZ1bmN0aW9uIChvcHRpb25zLCBjYWxsYmFjaykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jbGllbnQuc2VuZE9wZXJhdGlvblJlcXVlc3QoewogICAgICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucwogICAgICAgICAgICB9LCBnZXRTdGF0aXN0aWNzT3BlcmF0aW9uU3BlYywgY2FsbGJhY2spOwogICAgICAgIH07CiAgICAgICAgU2VydmljZS5wcm90b3R5cGUubGlzdENvbnRhaW5lcnNTZWdtZW50ID0gZnVuY3Rpb24gKG9wdGlvbnMsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNsaWVudC5zZW5kT3BlcmF0aW9uUmVxdWVzdCh7CiAgICAgICAgICAgICAgICBvcHRpb25zOiBvcHRpb25zCiAgICAgICAgICAgIH0sIGxpc3RDb250YWluZXJzU2VnbWVudE9wZXJhdGlvblNwZWMsIGNhbGxiYWNrKTsKICAgICAgICB9OwogICAgICAgIFNlcnZpY2UucHJvdG90eXBlLmdldFVzZXJEZWxlZ2F0aW9uS2V5ID0gZnVuY3Rpb24gKGtleUluZm8sIG9wdGlvbnMsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNsaWVudC5zZW5kT3BlcmF0aW9uUmVxdWVzdCh7CiAgICAgICAgICAgICAgICBrZXlJbmZvOiBrZXlJbmZvLAogICAgICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucwogICAgICAgICAgICB9LCBnZXRVc2VyRGVsZWdhdGlvbktleU9wZXJhdGlvblNwZWMsIGNhbGxiYWNrKTsKICAgICAgICB9OwogICAgICAgIFNlcnZpY2UucHJvdG90eXBlLmdldEFjY291bnRJbmZvID0gZnVuY3Rpb24gKG9wdGlvbnMsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNsaWVudC5zZW5kT3BlcmF0aW9uUmVxdWVzdCh7CiAgICAgICAgICAgICAgICBvcHRpb25zOiBvcHRpb25zCiAgICAgICAgICAgIH0sIGdldEFjY291bnRJbmZvT3BlcmF0aW9uU3BlYywgY2FsbGJhY2spOwogICAgICAgIH07CiAgICAgICAgU2VydmljZS5wcm90b3R5cGUuc3VibWl0QmF0Y2ggPSBmdW5jdGlvbiAoYm9keSwgY29udGVudExlbmd0aCwgbXVsdGlwYXJ0Q29udGVudFR5cGUsIG9wdGlvbnMsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNsaWVudC5zZW5kT3BlcmF0aW9uUmVxdWVzdCh7CiAgICAgICAgICAgICAgICBib2R5OiBib2R5LAogICAgICAgICAgICAgICAgY29udGVudExlbmd0aDogY29udGVudExlbmd0aCwKICAgICAgICAgICAgICAgIG11bHRpcGFydENvbnRlbnRUeXBlOiBtdWx0aXBhcnRDb250ZW50VHlwZSwKICAgICAgICAgICAgICAgIG9wdGlvbnM6IG9wdGlvbnMKICAgICAgICAgICAgfSwgc3VibWl0QmF0Y2hPcGVyYXRpb25TcGVjLCBjYWxsYmFjayk7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gU2VydmljZTsKICAgIH0oKSk7CiAgICAvLyBPcGVyYXRpb24gU3BlY2lmaWNhdGlvbnMKICAgIHZhciBzZXJpYWxpemVyJDEgPSBuZXcgU2VyaWFsaXplcihNYXBwZXJzLCB0cnVlKTsKICAgIHZhciBzZXRQcm9wZXJ0aWVzT3BlcmF0aW9uU3BlYyA9IHsKICAgICAgICBodHRwTWV0aG9kOiAiUFVUIiwKICAgICAgICB1cmxQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHVybAogICAgICAgIF0sCiAgICAgICAgcXVlcnlQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHRpbWVvdXQsCiAgICAgICAgICAgIHJlc3R5cGUwLAogICAgICAgICAgICBjb21wMAogICAgICAgIF0sCiAgICAgICAgaGVhZGVyUGFyYW1ldGVyczogWwogICAgICAgICAgICB2ZXJzaW9uLAogICAgICAgICAgICByZXF1ZXN0SWQKICAgICAgICBdLAogICAgICAgIHJlcXVlc3RCb2R5OiB7CiAgICAgICAgICAgIHBhcmFtZXRlclBhdGg6ICJzdG9yYWdlU2VydmljZVByb3BlcnRpZXMiLAogICAgICAgICAgICBtYXBwZXI6IF9fYXNzaWduKHt9LCBTdG9yYWdlU2VydmljZVByb3BlcnRpZXMsIHsgcmVxdWlyZWQ6IHRydWUgfSkKICAgICAgICB9LAogICAgICAgIGNvbnRlbnRUeXBlOiAiYXBwbGljYXRpb24veG1sOyBjaGFyc2V0PXV0Zi04IiwKICAgICAgICByZXNwb25zZXM6IHsKICAgICAgICAgICAgMjAyOiB7CiAgICAgICAgICAgICAgICBoZWFkZXJzTWFwcGVyOiBTZXJ2aWNlU2V0UHJvcGVydGllc0hlYWRlcnMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVmYXVsdDogewogICAgICAgICAgICAgICAgYm9keU1hcHBlcjogU3RvcmFnZUVycm9yCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGlzWE1MOiB0cnVlLAogICAgICAgIHNlcmlhbGl6ZXI6IHNlcmlhbGl6ZXIkMQogICAgfTsKICAgIHZhciBnZXRQcm9wZXJ0aWVzT3BlcmF0aW9uU3BlYyA9IHsKICAgICAgICBodHRwTWV0aG9kOiAiR0VUIiwKICAgICAgICB1cmxQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHVybAogICAgICAgIF0sCiAgICAgICAgcXVlcnlQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHRpbWVvdXQsCiAgICAgICAgICAgIHJlc3R5cGUwLAogICAgICAgICAgICBjb21wMAogICAgICAgIF0sCiAgICAgICAgaGVhZGVyUGFyYW1ldGVyczogWwogICAgICAgICAgICB2ZXJzaW9uLAogICAgICAgICAgICByZXF1ZXN0SWQKICAgICAgICBdLAogICAgICAgIHJlc3BvbnNlczogewogICAgICAgICAgICAyMDA6IHsKICAgICAgICAgICAgICAgIGJvZHlNYXBwZXI6IFN0b3JhZ2VTZXJ2aWNlUHJvcGVydGllcywKICAgICAgICAgICAgICAgIGhlYWRlcnNNYXBwZXI6IFNlcnZpY2VHZXRQcm9wZXJ0aWVzSGVhZGVycwogICAgICAgICAgICB9LAogICAgICAgICAgICBkZWZhdWx0OiB7CiAgICAgICAgICAgICAgICBib2R5TWFwcGVyOiBTdG9yYWdlRXJyb3IKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgaXNYTUw6IHRydWUsCiAgICAgICAgc2VyaWFsaXplcjogc2VyaWFsaXplciQxCiAgICB9OwogICAgdmFyIGdldFN0YXRpc3RpY3NPcGVyYXRpb25TcGVjID0gewogICAgICAgIGh0dHBNZXRob2Q6ICJHRVQiLAogICAgICAgIHVybFBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdXJsCiAgICAgICAgXSwKICAgICAgICBxdWVyeVBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdGltZW91dCwKICAgICAgICAgICAgcmVzdHlwZTAsCiAgICAgICAgICAgIGNvbXAxCiAgICAgICAgXSwKICAgICAgICBoZWFkZXJQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHZlcnNpb24sCiAgICAgICAgICAgIHJlcXVlc3RJZAogICAgICAgIF0sCiAgICAgICAgcmVzcG9uc2VzOiB7CiAgICAgICAgICAgIDIwMDogewogICAgICAgICAgICAgICAgYm9keU1hcHBlcjogU3RvcmFnZVNlcnZpY2VTdGF0cywKICAgICAgICAgICAgICAgIGhlYWRlcnNNYXBwZXI6IFNlcnZpY2VHZXRTdGF0aXN0aWNzSGVhZGVycwogICAgICAgICAgICB9LAogICAgICAgICAgICBkZWZhdWx0OiB7CiAgICAgICAgICAgICAgICBib2R5TWFwcGVyOiBTdG9yYWdlRXJyb3IKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgaXNYTUw6IHRydWUsCiAgICAgICAgc2VyaWFsaXplcjogc2VyaWFsaXplciQxCiAgICB9OwogICAgdmFyIGxpc3RDb250YWluZXJzU2VnbWVudE9wZXJhdGlvblNwZWMgPSB7CiAgICAgICAgaHR0cE1ldGhvZDogIkdFVCIsCiAgICAgICAgdXJsUGFyYW1ldGVyczogWwogICAgICAgICAgICB1cmwKICAgICAgICBdLAogICAgICAgIHF1ZXJ5UGFyYW1ldGVyczogWwogICAgICAgICAgICBwcmVmaXgsCiAgICAgICAgICAgIG1hcmtlcjAsCiAgICAgICAgICAgIG1heHJlc3VsdHMsCiAgICAgICAgICAgIGluY2x1ZGUwLAogICAgICAgICAgICB0aW1lb3V0LAogICAgICAgICAgICBjb21wMgogICAgICAgIF0sCiAgICAgICAgaGVhZGVyUGFyYW1ldGVyczogWwogICAgICAgICAgICB2ZXJzaW9uLAogICAgICAgICAgICByZXF1ZXN0SWQKICAgICAgICBdLAogICAgICAgIHJlc3BvbnNlczogewogICAgICAgICAgICAyMDA6IHsKICAgICAgICAgICAgICAgIGJvZHlNYXBwZXI6IExpc3RDb250YWluZXJzU2VnbWVudFJlc3BvbnNlLAogICAgICAgICAgICAgICAgaGVhZGVyc01hcHBlcjogU2VydmljZUxpc3RDb250YWluZXJzU2VnbWVudEhlYWRlcnMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVmYXVsdDogewogICAgICAgICAgICAgICAgYm9keU1hcHBlcjogU3RvcmFnZUVycm9yCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGlzWE1MOiB0cnVlLAogICAgICAgIHNlcmlhbGl6ZXI6IHNlcmlhbGl6ZXIkMQogICAgfTsKICAgIHZhciBnZXRVc2VyRGVsZWdhdGlvbktleU9wZXJhdGlvblNwZWMgPSB7CiAgICAgICAgaHR0cE1ldGhvZDogIlBPU1QiLAogICAgICAgIHVybFBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdXJsCiAgICAgICAgXSwKICAgICAgICBxdWVyeVBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdGltZW91dCwKICAgICAgICAgICAgcmVzdHlwZTAsCiAgICAgICAgICAgIGNvbXAzCiAgICAgICAgXSwKICAgICAgICBoZWFkZXJQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHZlcnNpb24sCiAgICAgICAgICAgIHJlcXVlc3RJZAogICAgICAgIF0sCiAgICAgICAgcmVxdWVzdEJvZHk6IHsKICAgICAgICAgICAgcGFyYW1ldGVyUGF0aDogImtleUluZm8iLAogICAgICAgICAgICBtYXBwZXI6IF9fYXNzaWduKHt9LCBLZXlJbmZvLCB7IHJlcXVpcmVkOiB0cnVlIH0pCiAgICAgICAgfSwKICAgICAgICBjb250ZW50VHlwZTogImFwcGxpY2F0aW9uL3htbDsgY2hhcnNldD11dGYtOCIsCiAgICAgICAgcmVzcG9uc2VzOiB7CiAgICAgICAgICAgIDIwMDogewogICAgICAgICAgICAgICAgYm9keU1hcHBlcjogVXNlckRlbGVnYXRpb25LZXksCiAgICAgICAgICAgICAgICBoZWFkZXJzTWFwcGVyOiBTZXJ2aWNlR2V0VXNlckRlbGVnYXRpb25LZXlIZWFkZXJzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICAgIGJvZHlNYXBwZXI6IFN0b3JhZ2VFcnJvcgogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBpc1hNTDogdHJ1ZSwKICAgICAgICBzZXJpYWxpemVyOiBzZXJpYWxpemVyJDEKICAgIH07CiAgICB2YXIgZ2V0QWNjb3VudEluZm9PcGVyYXRpb25TcGVjID0gewogICAgICAgIGh0dHBNZXRob2Q6ICJHRVQiLAogICAgICAgIHVybFBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdXJsCiAgICAgICAgXSwKICAgICAgICBxdWVyeVBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgcmVzdHlwZTEsCiAgICAgICAgICAgIGNvbXAwCiAgICAgICAgXSwKICAgICAgICBoZWFkZXJQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHZlcnNpb24KICAgICAgICBdLAogICAgICAgIHJlc3BvbnNlczogewogICAgICAgICAgICAyMDA6IHsKICAgICAgICAgICAgICAgIGhlYWRlcnNNYXBwZXI6IFNlcnZpY2VHZXRBY2NvdW50SW5mb0hlYWRlcnMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVmYXVsdDogewogICAgICAgICAgICAgICAgYm9keU1hcHBlcjogU3RvcmFnZUVycm9yCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGlzWE1MOiB0cnVlLAogICAgICAgIHNlcmlhbGl6ZXI6IHNlcmlhbGl6ZXIkMQogICAgfTsKICAgIHZhciBzdWJtaXRCYXRjaE9wZXJhdGlvblNwZWMgPSB7CiAgICAgICAgaHR0cE1ldGhvZDogIlBPU1QiLAogICAgICAgIHVybFBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdXJsCiAgICAgICAgXSwKICAgICAgICBxdWVyeVBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdGltZW91dCwKICAgICAgICAgICAgY29tcDQKICAgICAgICBdLAogICAgICAgIGhlYWRlclBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgY29udGVudExlbmd0aCwKICAgICAgICAgICAgbXVsdGlwYXJ0Q29udGVudFR5cGUsCiAgICAgICAgICAgIHZlcnNpb24sCiAgICAgICAgICAgIHJlcXVlc3RJZAogICAgICAgIF0sCiAgICAgICAgcmVxdWVzdEJvZHk6IHsKICAgICAgICAgICAgcGFyYW1ldGVyUGF0aDogImJvZHkiLAogICAgICAgICAgICBtYXBwZXI6IHsKICAgICAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJib2R5IiwKICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyZWFtIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBjb250ZW50VHlwZTogImFwcGxpY2F0aW9uL3htbDsgY2hhcnNldD11dGYtOCIsCiAgICAgICAgcmVzcG9uc2VzOiB7CiAgICAgICAgICAgIDIwMjogewogICAgICAgICAgICAgICAgYm9keU1hcHBlcjogewogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAicGFyc2VkUmVzcG9uc2UiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmVhbSIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgaGVhZGVyc01hcHBlcjogU2VydmljZVN1Ym1pdEJhdGNoSGVhZGVycwogICAgICAgICAgICB9LAogICAgICAgICAgICBkZWZhdWx0OiB7CiAgICAgICAgICAgICAgICBib2R5TWFwcGVyOiBTdG9yYWdlRXJyb3IKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgaXNYTUw6IHRydWUsCiAgICAgICAgc2VyaWFsaXplcjogc2VyaWFsaXplciQxCiAgICB9OwoKICAgIC8qCiAgICAgKiBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICAgICAqIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS4gU2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24uCiAgICAgKgogICAgICogQ29kZSBnZW5lcmF0ZWQgYnkgTWljcm9zb2Z0IChSKSBBdXRvUmVzdCBDb2RlIEdlbmVyYXRvci4KICAgICAqIENoYW5nZXMgbWF5IGNhdXNlIGluY29ycmVjdCBiZWhhdmlvciBhbmQgd2lsbCBiZSBsb3N0IGlmIHRoZSBjb2RlIGlzIHJlZ2VuZXJhdGVkLgogICAgICovCgogICAgdmFyIE1hcHBlcnMkMSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgICAgICBBY2Nlc3NQb2xpY3k6IEFjY2Vzc1BvbGljeSwKICAgICAgICBCbG9iRmxhdExpc3RTZWdtZW50OiBCbG9iRmxhdExpc3RTZWdtZW50LAogICAgICAgIEJsb2JIaWVyYXJjaHlMaXN0U2VnbWVudDogQmxvYkhpZXJhcmNoeUxpc3RTZWdtZW50LAogICAgICAgIEJsb2JJdGVtOiBCbG9iSXRlbSwKICAgICAgICBCbG9iTWV0YWRhdGE6IEJsb2JNZXRhZGF0YSwKICAgICAgICBCbG9iUHJlZml4OiBCbG9iUHJlZml4LAogICAgICAgIEJsb2JQcm9wZXJ0aWVzOiBCbG9iUHJvcGVydGllcywKICAgICAgICBDb250YWluZXJBY3F1aXJlTGVhc2VIZWFkZXJzOiBDb250YWluZXJBY3F1aXJlTGVhc2VIZWFkZXJzLAogICAgICAgIENvbnRhaW5lckJyZWFrTGVhc2VIZWFkZXJzOiBDb250YWluZXJCcmVha0xlYXNlSGVhZGVycywKICAgICAgICBDb250YWluZXJDaGFuZ2VMZWFzZUhlYWRlcnM6IENvbnRhaW5lckNoYW5nZUxlYXNlSGVhZGVycywKICAgICAgICBDb250YWluZXJDcmVhdGVIZWFkZXJzOiBDb250YWluZXJDcmVhdGVIZWFkZXJzLAogICAgICAgIENvbnRhaW5lckRlbGV0ZUhlYWRlcnM6IENvbnRhaW5lckRlbGV0ZUhlYWRlcnMsCiAgICAgICAgQ29udGFpbmVyR2V0QWNjZXNzUG9saWN5SGVhZGVyczogQ29udGFpbmVyR2V0QWNjZXNzUG9saWN5SGVhZGVycywKICAgICAgICBDb250YWluZXJHZXRBY2NvdW50SW5mb0hlYWRlcnM6IENvbnRhaW5lckdldEFjY291bnRJbmZvSGVhZGVycywKICAgICAgICBDb250YWluZXJHZXRQcm9wZXJ0aWVzSGVhZGVyczogQ29udGFpbmVyR2V0UHJvcGVydGllc0hlYWRlcnMsCiAgICAgICAgQ29udGFpbmVyTGlzdEJsb2JGbGF0U2VnbWVudEhlYWRlcnM6IENvbnRhaW5lckxpc3RCbG9iRmxhdFNlZ21lbnRIZWFkZXJzLAogICAgICAgIENvbnRhaW5lckxpc3RCbG9iSGllcmFyY2h5U2VnbWVudEhlYWRlcnM6IENvbnRhaW5lckxpc3RCbG9iSGllcmFyY2h5U2VnbWVudEhlYWRlcnMsCiAgICAgICAgQ29udGFpbmVyUmVsZWFzZUxlYXNlSGVhZGVyczogQ29udGFpbmVyUmVsZWFzZUxlYXNlSGVhZGVycywKICAgICAgICBDb250YWluZXJSZW5ld0xlYXNlSGVhZGVyczogQ29udGFpbmVyUmVuZXdMZWFzZUhlYWRlcnMsCiAgICAgICAgQ29udGFpbmVyU2V0QWNjZXNzUG9saWN5SGVhZGVyczogQ29udGFpbmVyU2V0QWNjZXNzUG9saWN5SGVhZGVycywKICAgICAgICBDb250YWluZXJTZXRNZXRhZGF0YUhlYWRlcnM6IENvbnRhaW5lclNldE1ldGFkYXRhSGVhZGVycywKICAgICAgICBMaXN0QmxvYnNGbGF0U2VnbWVudFJlc3BvbnNlOiBMaXN0QmxvYnNGbGF0U2VnbWVudFJlc3BvbnNlLAogICAgICAgIExpc3RCbG9ic0hpZXJhcmNoeVNlZ21lbnRSZXNwb25zZTogTGlzdEJsb2JzSGllcmFyY2h5U2VnbWVudFJlc3BvbnNlLAogICAgICAgIFNpZ25lZElkZW50aWZpZXI6IFNpZ25lZElkZW50aWZpZXIsCiAgICAgICAgU3RvcmFnZUVycm9yOiBTdG9yYWdlRXJyb3IKICAgIH0pOwoKICAgIC8qCiAgICAgKiBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICAgICAqIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS4gU2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yCiAgICAgKiBsaWNlbnNlIGluZm9ybWF0aW9uLgogICAgICoKICAgICAqIENvZGUgZ2VuZXJhdGVkIGJ5IE1pY3Jvc29mdCAoUikgQXV0b1Jlc3QgQ29kZSBHZW5lcmF0b3IuCiAgICAgKiBDaGFuZ2VzIG1heSBjYXVzZSBpbmNvcnJlY3QgYmVoYXZpb3IgYW5kIHdpbGwgYmUgbG9zdCBpZiB0aGUgY29kZSBpcwogICAgICogcmVnZW5lcmF0ZWQuCiAgICAgKi8KICAgIC8qKiBDbGFzcyByZXByZXNlbnRpbmcgYSBDb250YWluZXIuICovCiAgICB2YXIgQ29udGFpbmVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewogICAgICAgIC8qKgogICAgICAgICAqIENyZWF0ZSBhIENvbnRhaW5lci4KICAgICAgICAgKiBAcGFyYW0ge1N0b3JhZ2VDbGllbnRDb250ZXh0fSBjbGllbnQgUmVmZXJlbmNlIHRvIHRoZSBzZXJ2aWNlIGNsaWVudC4KICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBDb250YWluZXIoY2xpZW50KSB7CiAgICAgICAgICAgIHRoaXMuY2xpZW50ID0gY2xpZW50OwogICAgICAgIH0KICAgICAgICBDb250YWluZXIucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uIChvcHRpb25zLCBjYWxsYmFjaykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jbGllbnQuc2VuZE9wZXJhdGlvblJlcXVlc3QoewogICAgICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucwogICAgICAgICAgICB9LCBjcmVhdGVPcGVyYXRpb25TcGVjLCBjYWxsYmFjayk7CiAgICAgICAgfTsKICAgICAgICBDb250YWluZXIucHJvdG90eXBlLmdldFByb3BlcnRpZXMgPSBmdW5jdGlvbiAob3B0aW9ucywgY2FsbGJhY2spIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2xpZW50LnNlbmRPcGVyYXRpb25SZXF1ZXN0KHsKICAgICAgICAgICAgICAgIG9wdGlvbnM6IG9wdGlvbnMKICAgICAgICAgICAgfSwgZ2V0UHJvcGVydGllc09wZXJhdGlvblNwZWMkMSwgY2FsbGJhY2spOwogICAgICAgIH07CiAgICAgICAgQ29udGFpbmVyLnByb3RvdHlwZS5kZWxldGVNZXRob2QgPSBmdW5jdGlvbiAob3B0aW9ucywgY2FsbGJhY2spIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2xpZW50LnNlbmRPcGVyYXRpb25SZXF1ZXN0KHsKICAgICAgICAgICAgICAgIG9wdGlvbnM6IG9wdGlvbnMKICAgICAgICAgICAgfSwgZGVsZXRlTWV0aG9kT3BlcmF0aW9uU3BlYywgY2FsbGJhY2spOwogICAgICAgIH07CiAgICAgICAgQ29udGFpbmVyLnByb3RvdHlwZS5zZXRNZXRhZGF0YSA9IGZ1bmN0aW9uIChvcHRpb25zLCBjYWxsYmFjaykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jbGllbnQuc2VuZE9wZXJhdGlvblJlcXVlc3QoewogICAgICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucwogICAgICAgICAgICB9LCBzZXRNZXRhZGF0YU9wZXJhdGlvblNwZWMsIGNhbGxiYWNrKTsKICAgICAgICB9OwogICAgICAgIENvbnRhaW5lci5wcm90b3R5cGUuZ2V0QWNjZXNzUG9saWN5ID0gZnVuY3Rpb24gKG9wdGlvbnMsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNsaWVudC5zZW5kT3BlcmF0aW9uUmVxdWVzdCh7CiAgICAgICAgICAgICAgICBvcHRpb25zOiBvcHRpb25zCiAgICAgICAgICAgIH0sIGdldEFjY2Vzc1BvbGljeU9wZXJhdGlvblNwZWMsIGNhbGxiYWNrKTsKICAgICAgICB9OwogICAgICAgIENvbnRhaW5lci5wcm90b3R5cGUuc2V0QWNjZXNzUG9saWN5ID0gZnVuY3Rpb24gKG9wdGlvbnMsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNsaWVudC5zZW5kT3BlcmF0aW9uUmVxdWVzdCh7CiAgICAgICAgICAgICAgICBvcHRpb25zOiBvcHRpb25zCiAgICAgICAgICAgIH0sIHNldEFjY2Vzc1BvbGljeU9wZXJhdGlvblNwZWMsIGNhbGxiYWNrKTsKICAgICAgICB9OwogICAgICAgIENvbnRhaW5lci5wcm90b3R5cGUuYWNxdWlyZUxlYXNlID0gZnVuY3Rpb24gKG9wdGlvbnMsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNsaWVudC5zZW5kT3BlcmF0aW9uUmVxdWVzdCh7CiAgICAgICAgICAgICAgICBvcHRpb25zOiBvcHRpb25zCiAgICAgICAgICAgIH0sIGFjcXVpcmVMZWFzZU9wZXJhdGlvblNwZWMsIGNhbGxiYWNrKTsKICAgICAgICB9OwogICAgICAgIENvbnRhaW5lci5wcm90b3R5cGUucmVsZWFzZUxlYXNlID0gZnVuY3Rpb24gKGxlYXNlSWQsIG9wdGlvbnMsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNsaWVudC5zZW5kT3BlcmF0aW9uUmVxdWVzdCh7CiAgICAgICAgICAgICAgICBsZWFzZUlkOiBsZWFzZUlkLAogICAgICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucwogICAgICAgICAgICB9LCByZWxlYXNlTGVhc2VPcGVyYXRpb25TcGVjLCBjYWxsYmFjayk7CiAgICAgICAgfTsKICAgICAgICBDb250YWluZXIucHJvdG90eXBlLnJlbmV3TGVhc2UgPSBmdW5jdGlvbiAobGVhc2VJZCwgb3B0aW9ucywgY2FsbGJhY2spIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2xpZW50LnNlbmRPcGVyYXRpb25SZXF1ZXN0KHsKICAgICAgICAgICAgICAgIGxlYXNlSWQ6IGxlYXNlSWQsCiAgICAgICAgICAgICAgICBvcHRpb25zOiBvcHRpb25zCiAgICAgICAgICAgIH0sIHJlbmV3TGVhc2VPcGVyYXRpb25TcGVjLCBjYWxsYmFjayk7CiAgICAgICAgfTsKICAgICAgICBDb250YWluZXIucHJvdG90eXBlLmJyZWFrTGVhc2UgPSBmdW5jdGlvbiAob3B0aW9ucywgY2FsbGJhY2spIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2xpZW50LnNlbmRPcGVyYXRpb25SZXF1ZXN0KHsKICAgICAgICAgICAgICAgIG9wdGlvbnM6IG9wdGlvbnMKICAgICAgICAgICAgfSwgYnJlYWtMZWFzZU9wZXJhdGlvblNwZWMsIGNhbGxiYWNrKTsKICAgICAgICB9OwogICAgICAgIENvbnRhaW5lci5wcm90b3R5cGUuY2hhbmdlTGVhc2UgPSBmdW5jdGlvbiAobGVhc2VJZCwgcHJvcG9zZWRMZWFzZUlkLCBvcHRpb25zLCBjYWxsYmFjaykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jbGllbnQuc2VuZE9wZXJhdGlvblJlcXVlc3QoewogICAgICAgICAgICAgICAgbGVhc2VJZDogbGVhc2VJZCwKICAgICAgICAgICAgICAgIHByb3Bvc2VkTGVhc2VJZDogcHJvcG9zZWRMZWFzZUlkLAogICAgICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucwogICAgICAgICAgICB9LCBjaGFuZ2VMZWFzZU9wZXJhdGlvblNwZWMsIGNhbGxiYWNrKTsKICAgICAgICB9OwogICAgICAgIENvbnRhaW5lci5wcm90b3R5cGUubGlzdEJsb2JGbGF0U2VnbWVudCA9IGZ1bmN0aW9uIChvcHRpb25zLCBjYWxsYmFjaykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jbGllbnQuc2VuZE9wZXJhdGlvblJlcXVlc3QoewogICAgICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucwogICAgICAgICAgICB9LCBsaXN0QmxvYkZsYXRTZWdtZW50T3BlcmF0aW9uU3BlYywgY2FsbGJhY2spOwogICAgICAgIH07CiAgICAgICAgQ29udGFpbmVyLnByb3RvdHlwZS5saXN0QmxvYkhpZXJhcmNoeVNlZ21lbnQgPSBmdW5jdGlvbiAoZGVsaW1pdGVyLCBvcHRpb25zLCBjYWxsYmFjaykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jbGllbnQuc2VuZE9wZXJhdGlvblJlcXVlc3QoewogICAgICAgICAgICAgICAgZGVsaW1pdGVyOiBkZWxpbWl0ZXIsCiAgICAgICAgICAgICAgICBvcHRpb25zOiBvcHRpb25zCiAgICAgICAgICAgIH0sIGxpc3RCbG9iSGllcmFyY2h5U2VnbWVudE9wZXJhdGlvblNwZWMsIGNhbGxiYWNrKTsKICAgICAgICB9OwogICAgICAgIENvbnRhaW5lci5wcm90b3R5cGUuZ2V0QWNjb3VudEluZm8gPSBmdW5jdGlvbiAob3B0aW9ucywgY2FsbGJhY2spIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2xpZW50LnNlbmRPcGVyYXRpb25SZXF1ZXN0KHsKICAgICAgICAgICAgICAgIG9wdGlvbnM6IG9wdGlvbnMKICAgICAgICAgICAgfSwgZ2V0QWNjb3VudEluZm9PcGVyYXRpb25TcGVjJDEsIGNhbGxiYWNrKTsKICAgICAgICB9OwogICAgICAgIHJldHVybiBDb250YWluZXI7CiAgICB9KCkpOwogICAgLy8gT3BlcmF0aW9uIFNwZWNpZmljYXRpb25zCiAgICB2YXIgc2VyaWFsaXplciQyID0gbmV3IFNlcmlhbGl6ZXIoTWFwcGVycyQxLCB0cnVlKTsKICAgIHZhciBjcmVhdGVPcGVyYXRpb25TcGVjID0gewogICAgICAgIGh0dHBNZXRob2Q6ICJQVVQiLAogICAgICAgIHBhdGg6ICJ7Y29udGFpbmVyTmFtZX0iLAogICAgICAgIHVybFBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdXJsCiAgICAgICAgXSwKICAgICAgICBxdWVyeVBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdGltZW91dCwKICAgICAgICAgICAgcmVzdHlwZTIKICAgICAgICBdLAogICAgICAgIGhlYWRlclBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgbWV0YWRhdGEsCiAgICAgICAgICAgIGFjY2VzcywKICAgICAgICAgICAgdmVyc2lvbiwKICAgICAgICAgICAgcmVxdWVzdElkCiAgICAgICAgXSwKICAgICAgICByZXNwb25zZXM6IHsKICAgICAgICAgICAgMjAxOiB7CiAgICAgICAgICAgICAgICBoZWFkZXJzTWFwcGVyOiBDb250YWluZXJDcmVhdGVIZWFkZXJzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICAgIGJvZHlNYXBwZXI6IFN0b3JhZ2VFcnJvcgogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBpc1hNTDogdHJ1ZSwKICAgICAgICBzZXJpYWxpemVyOiBzZXJpYWxpemVyJDIKICAgIH07CiAgICB2YXIgZ2V0UHJvcGVydGllc09wZXJhdGlvblNwZWMkMSA9IHsKICAgICAgICBodHRwTWV0aG9kOiAiR0VUIiwKICAgICAgICBwYXRoOiAie2NvbnRhaW5lck5hbWV9IiwKICAgICAgICB1cmxQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHVybAogICAgICAgIF0sCiAgICAgICAgcXVlcnlQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHRpbWVvdXQsCiAgICAgICAgICAgIHJlc3R5cGUyCiAgICAgICAgXSwKICAgICAgICBoZWFkZXJQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHZlcnNpb24sCiAgICAgICAgICAgIHJlcXVlc3RJZCwKICAgICAgICAgICAgbGVhc2VJZDAKICAgICAgICBdLAogICAgICAgIHJlc3BvbnNlczogewogICAgICAgICAgICAyMDA6IHsKICAgICAgICAgICAgICAgIGhlYWRlcnNNYXBwZXI6IENvbnRhaW5lckdldFByb3BlcnRpZXNIZWFkZXJzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICAgIGJvZHlNYXBwZXI6IFN0b3JhZ2VFcnJvcgogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBpc1hNTDogdHJ1ZSwKICAgICAgICBzZXJpYWxpemVyOiBzZXJpYWxpemVyJDIKICAgIH07CiAgICB2YXIgZGVsZXRlTWV0aG9kT3BlcmF0aW9uU3BlYyA9IHsKICAgICAgICBodHRwTWV0aG9kOiAiREVMRVRFIiwKICAgICAgICBwYXRoOiAie2NvbnRhaW5lck5hbWV9IiwKICAgICAgICB1cmxQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHVybAogICAgICAgIF0sCiAgICAgICAgcXVlcnlQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHRpbWVvdXQsCiAgICAgICAgICAgIHJlc3R5cGUyCiAgICAgICAgXSwKICAgICAgICBoZWFkZXJQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHZlcnNpb24sCiAgICAgICAgICAgIHJlcXVlc3RJZCwKICAgICAgICAgICAgbGVhc2VJZDAsCiAgICAgICAgICAgIGlmTW9kaWZpZWRTaW5jZSwKICAgICAgICAgICAgaWZVbm1vZGlmaWVkU2luY2UKICAgICAgICBdLAogICAgICAgIHJlc3BvbnNlczogewogICAgICAgICAgICAyMDI6IHsKICAgICAgICAgICAgICAgIGhlYWRlcnNNYXBwZXI6IENvbnRhaW5lckRlbGV0ZUhlYWRlcnMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVmYXVsdDogewogICAgICAgICAgICAgICAgYm9keU1hcHBlcjogU3RvcmFnZUVycm9yCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGlzWE1MOiB0cnVlLAogICAgICAgIHNlcmlhbGl6ZXI6IHNlcmlhbGl6ZXIkMgogICAgfTsKICAgIHZhciBzZXRNZXRhZGF0YU9wZXJhdGlvblNwZWMgPSB7CiAgICAgICAgaHR0cE1ldGhvZDogIlBVVCIsCiAgICAgICAgcGF0aDogIntjb250YWluZXJOYW1lfSIsCiAgICAgICAgdXJsUGFyYW1ldGVyczogWwogICAgICAgICAgICB1cmwKICAgICAgICBdLAogICAgICAgIHF1ZXJ5UGFyYW1ldGVyczogWwogICAgICAgICAgICB0aW1lb3V0LAogICAgICAgICAgICByZXN0eXBlMiwKICAgICAgICAgICAgY29tcDUKICAgICAgICBdLAogICAgICAgIGhlYWRlclBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgbWV0YWRhdGEsCiAgICAgICAgICAgIHZlcnNpb24sCiAgICAgICAgICAgIHJlcXVlc3RJZCwKICAgICAgICAgICAgbGVhc2VJZDAsCiAgICAgICAgICAgIGlmTW9kaWZpZWRTaW5jZQogICAgICAgIF0sCiAgICAgICAgcmVzcG9uc2VzOiB7CiAgICAgICAgICAgIDIwMDogewogICAgICAgICAgICAgICAgaGVhZGVyc01hcHBlcjogQ29udGFpbmVyU2V0TWV0YWRhdGFIZWFkZXJzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICAgIGJvZHlNYXBwZXI6IFN0b3JhZ2VFcnJvcgogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBpc1hNTDogdHJ1ZSwKICAgICAgICBzZXJpYWxpemVyOiBzZXJpYWxpemVyJDIKICAgIH07CiAgICB2YXIgZ2V0QWNjZXNzUG9saWN5T3BlcmF0aW9uU3BlYyA9IHsKICAgICAgICBodHRwTWV0aG9kOiAiR0VUIiwKICAgICAgICBwYXRoOiAie2NvbnRhaW5lck5hbWV9IiwKICAgICAgICB1cmxQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHVybAogICAgICAgIF0sCiAgICAgICAgcXVlcnlQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHRpbWVvdXQsCiAgICAgICAgICAgIHJlc3R5cGUyLAogICAgICAgICAgICBjb21wNgogICAgICAgIF0sCiAgICAgICAgaGVhZGVyUGFyYW1ldGVyczogWwogICAgICAgICAgICB2ZXJzaW9uLAogICAgICAgICAgICByZXF1ZXN0SWQsCiAgICAgICAgICAgIGxlYXNlSWQwCiAgICAgICAgXSwKICAgICAgICByZXNwb25zZXM6IHsKICAgICAgICAgICAgMjAwOiB7CiAgICAgICAgICAgICAgICBib2R5TWFwcGVyOiB7CiAgICAgICAgICAgICAgICAgICAgeG1sRWxlbWVudE5hbWU6ICJTaWduZWRJZGVudGlmaWVyIiwKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogInBhcnNlZFJlc3BvbnNlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTZXF1ZW5jZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQ29tcG9zaXRlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJTaWduZWRJZGVudGlmaWVyIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGhlYWRlcnNNYXBwZXI6IENvbnRhaW5lckdldEFjY2Vzc1BvbGljeUhlYWRlcnMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVmYXVsdDogewogICAgICAgICAgICAgICAgYm9keU1hcHBlcjogU3RvcmFnZUVycm9yCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGlzWE1MOiB0cnVlLAogICAgICAgIHNlcmlhbGl6ZXI6IHNlcmlhbGl6ZXIkMgogICAgfTsKICAgIHZhciBzZXRBY2Nlc3NQb2xpY3lPcGVyYXRpb25TcGVjID0gewogICAgICAgIGh0dHBNZXRob2Q6ICJQVVQiLAogICAgICAgIHBhdGg6ICJ7Y29udGFpbmVyTmFtZX0iLAogICAgICAgIHVybFBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdXJsCiAgICAgICAgXSwKICAgICAgICBxdWVyeVBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdGltZW91dCwKICAgICAgICAgICAgcmVzdHlwZTIsCiAgICAgICAgICAgIGNvbXA2CiAgICAgICAgXSwKICAgICAgICBoZWFkZXJQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIGFjY2VzcywKICAgICAgICAgICAgdmVyc2lvbiwKICAgICAgICAgICAgcmVxdWVzdElkLAogICAgICAgICAgICBsZWFzZUlkMCwKICAgICAgICAgICAgaWZNb2RpZmllZFNpbmNlLAogICAgICAgICAgICBpZlVubW9kaWZpZWRTaW5jZQogICAgICAgIF0sCiAgICAgICAgcmVxdWVzdEJvZHk6IHsKICAgICAgICAgICAgcGFyYW1ldGVyUGF0aDogWwogICAgICAgICAgICAgICAgIm9wdGlvbnMiLAogICAgICAgICAgICAgICAgImNvbnRhaW5lckFjbCIKICAgICAgICAgICAgXSwKICAgICAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgICAgICB4bWxOYW1lOiAiU2lnbmVkSWRlbnRpZmllcnMiLAogICAgICAgICAgICAgICAgeG1sRWxlbWVudE5hbWU6ICJTaWduZWRJZGVudGlmaWVyIiwKICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiY29udGFpbmVyQWNsIiwKICAgICAgICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU2VxdWVuY2UiLAogICAgICAgICAgICAgICAgICAgIGVsZW1lbnQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkNvbXBvc2l0ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJTaWduZWRJZGVudGlmaWVyIgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBjb250ZW50VHlwZTogImFwcGxpY2F0aW9uL3htbDsgY2hhcnNldD11dGYtOCIsCiAgICAgICAgcmVzcG9uc2VzOiB7CiAgICAgICAgICAgIDIwMDogewogICAgICAgICAgICAgICAgaGVhZGVyc01hcHBlcjogQ29udGFpbmVyU2V0QWNjZXNzUG9saWN5SGVhZGVycwogICAgICAgICAgICB9LAogICAgICAgICAgICBkZWZhdWx0OiB7CiAgICAgICAgICAgICAgICBib2R5TWFwcGVyOiBTdG9yYWdlRXJyb3IKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgaXNYTUw6IHRydWUsCiAgICAgICAgc2VyaWFsaXplcjogc2VyaWFsaXplciQyCiAgICB9OwogICAgdmFyIGFjcXVpcmVMZWFzZU9wZXJhdGlvblNwZWMgPSB7CiAgICAgICAgaHR0cE1ldGhvZDogIlBVVCIsCiAgICAgICAgcGF0aDogIntjb250YWluZXJOYW1lfSIsCiAgICAgICAgdXJsUGFyYW1ldGVyczogWwogICAgICAgICAgICB1cmwKICAgICAgICBdLAogICAgICAgIHF1ZXJ5UGFyYW1ldGVyczogWwogICAgICAgICAgICB0aW1lb3V0LAogICAgICAgICAgICBjb21wNywKICAgICAgICAgICAgcmVzdHlwZTIKICAgICAgICBdLAogICAgICAgIGhlYWRlclBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgZHVyYXRpb24sCiAgICAgICAgICAgIHByb3Bvc2VkTGVhc2VJZDAsCiAgICAgICAgICAgIHZlcnNpb24sCiAgICAgICAgICAgIHJlcXVlc3RJZCwKICAgICAgICAgICAgYWN0aW9uMCwKICAgICAgICAgICAgaWZNb2RpZmllZFNpbmNlLAogICAgICAgICAgICBpZlVubW9kaWZpZWRTaW5jZQogICAgICAgIF0sCiAgICAgICAgcmVzcG9uc2VzOiB7CiAgICAgICAgICAgIDIwMTogewogICAgICAgICAgICAgICAgaGVhZGVyc01hcHBlcjogQ29udGFpbmVyQWNxdWlyZUxlYXNlSGVhZGVycwogICAgICAgICAgICB9LAogICAgICAgICAgICBkZWZhdWx0OiB7CiAgICAgICAgICAgICAgICBib2R5TWFwcGVyOiBTdG9yYWdlRXJyb3IKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgaXNYTUw6IHRydWUsCiAgICAgICAgc2VyaWFsaXplcjogc2VyaWFsaXplciQyCiAgICB9OwogICAgdmFyIHJlbGVhc2VMZWFzZU9wZXJhdGlvblNwZWMgPSB7CiAgICAgICAgaHR0cE1ldGhvZDogIlBVVCIsCiAgICAgICAgcGF0aDogIntjb250YWluZXJOYW1lfSIsCiAgICAgICAgdXJsUGFyYW1ldGVyczogWwogICAgICAgICAgICB1cmwKICAgICAgICBdLAogICAgICAgIHF1ZXJ5UGFyYW1ldGVyczogWwogICAgICAgICAgICB0aW1lb3V0LAogICAgICAgICAgICBjb21wNywKICAgICAgICAgICAgcmVzdHlwZTIKICAgICAgICBdLAogICAgICAgIGhlYWRlclBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgbGVhc2VJZDEsCiAgICAgICAgICAgIHZlcnNpb24sCiAgICAgICAgICAgIHJlcXVlc3RJZCwKICAgICAgICAgICAgYWN0aW9uMSwKICAgICAgICAgICAgaWZNb2RpZmllZFNpbmNlLAogICAgICAgICAgICBpZlVubW9kaWZpZWRTaW5jZQogICAgICAgIF0sCiAgICAgICAgcmVzcG9uc2VzOiB7CiAgICAgICAgICAgIDIwMDogewogICAgICAgICAgICAgICAgaGVhZGVyc01hcHBlcjogQ29udGFpbmVyUmVsZWFzZUxlYXNlSGVhZGVycwogICAgICAgICAgICB9LAogICAgICAgICAgICBkZWZhdWx0OiB7CiAgICAgICAgICAgICAgICBib2R5TWFwcGVyOiBTdG9yYWdlRXJyb3IKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgaXNYTUw6IHRydWUsCiAgICAgICAgc2VyaWFsaXplcjogc2VyaWFsaXplciQyCiAgICB9OwogICAgdmFyIHJlbmV3TGVhc2VPcGVyYXRpb25TcGVjID0gewogICAgICAgIGh0dHBNZXRob2Q6ICJQVVQiLAogICAgICAgIHBhdGg6ICJ7Y29udGFpbmVyTmFtZX0iLAogICAgICAgIHVybFBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdXJsCiAgICAgICAgXSwKICAgICAgICBxdWVyeVBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdGltZW91dCwKICAgICAgICAgICAgY29tcDcsCiAgICAgICAgICAgIHJlc3R5cGUyCiAgICAgICAgXSwKICAgICAgICBoZWFkZXJQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIGxlYXNlSWQxLAogICAgICAgICAgICB2ZXJzaW9uLAogICAgICAgICAgICByZXF1ZXN0SWQsCiAgICAgICAgICAgIGFjdGlvbjIsCiAgICAgICAgICAgIGlmTW9kaWZpZWRTaW5jZSwKICAgICAgICAgICAgaWZVbm1vZGlmaWVkU2luY2UKICAgICAgICBdLAogICAgICAgIHJlc3BvbnNlczogewogICAgICAgICAgICAyMDA6IHsKICAgICAgICAgICAgICAgIGhlYWRlcnNNYXBwZXI6IENvbnRhaW5lclJlbmV3TGVhc2VIZWFkZXJzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICAgIGJvZHlNYXBwZXI6IFN0b3JhZ2VFcnJvcgogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBpc1hNTDogdHJ1ZSwKICAgICAgICBzZXJpYWxpemVyOiBzZXJpYWxpemVyJDIKICAgIH07CiAgICB2YXIgYnJlYWtMZWFzZU9wZXJhdGlvblNwZWMgPSB7CiAgICAgICAgaHR0cE1ldGhvZDogIlBVVCIsCiAgICAgICAgcGF0aDogIntjb250YWluZXJOYW1lfSIsCiAgICAgICAgdXJsUGFyYW1ldGVyczogWwogICAgICAgICAgICB1cmwKICAgICAgICBdLAogICAgICAgIHF1ZXJ5UGFyYW1ldGVyczogWwogICAgICAgICAgICB0aW1lb3V0LAogICAgICAgICAgICBjb21wNywKICAgICAgICAgICAgcmVzdHlwZTIKICAgICAgICBdLAogICAgICAgIGhlYWRlclBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgYnJlYWtQZXJpb2QsCiAgICAgICAgICAgIHZlcnNpb24sCiAgICAgICAgICAgIHJlcXVlc3RJZCwKICAgICAgICAgICAgYWN0aW9uMywKICAgICAgICAgICAgaWZNb2RpZmllZFNpbmNlLAogICAgICAgICAgICBpZlVubW9kaWZpZWRTaW5jZQogICAgICAgIF0sCiAgICAgICAgcmVzcG9uc2VzOiB7CiAgICAgICAgICAgIDIwMjogewogICAgICAgICAgICAgICAgaGVhZGVyc01hcHBlcjogQ29udGFpbmVyQnJlYWtMZWFzZUhlYWRlcnMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVmYXVsdDogewogICAgICAgICAgICAgICAgYm9keU1hcHBlcjogU3RvcmFnZUVycm9yCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGlzWE1MOiB0cnVlLAogICAgICAgIHNlcmlhbGl6ZXI6IHNlcmlhbGl6ZXIkMgogICAgfTsKICAgIHZhciBjaGFuZ2VMZWFzZU9wZXJhdGlvblNwZWMgPSB7CiAgICAgICAgaHR0cE1ldGhvZDogIlBVVCIsCiAgICAgICAgcGF0aDogIntjb250YWluZXJOYW1lfSIsCiAgICAgICAgdXJsUGFyYW1ldGVyczogWwogICAgICAgICAgICB1cmwKICAgICAgICBdLAogICAgICAgIHF1ZXJ5UGFyYW1ldGVyczogWwogICAgICAgICAgICB0aW1lb3V0LAogICAgICAgICAgICBjb21wNywKICAgICAgICAgICAgcmVzdHlwZTIKICAgICAgICBdLAogICAgICAgIGhlYWRlclBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgbGVhc2VJZDEsCiAgICAgICAgICAgIHByb3Bvc2VkTGVhc2VJZDEsCiAgICAgICAgICAgIHZlcnNpb24sCiAgICAgICAgICAgIHJlcXVlc3RJZCwKICAgICAgICAgICAgYWN0aW9uNCwKICAgICAgICAgICAgaWZNb2RpZmllZFNpbmNlLAogICAgICAgICAgICBpZlVubW9kaWZpZWRTaW5jZQogICAgICAgIF0sCiAgICAgICAgcmVzcG9uc2VzOiB7CiAgICAgICAgICAgIDIwMDogewogICAgICAgICAgICAgICAgaGVhZGVyc01hcHBlcjogQ29udGFpbmVyQ2hhbmdlTGVhc2VIZWFkZXJzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICAgIGJvZHlNYXBwZXI6IFN0b3JhZ2VFcnJvcgogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBpc1hNTDogdHJ1ZSwKICAgICAgICBzZXJpYWxpemVyOiBzZXJpYWxpemVyJDIKICAgIH07CiAgICB2YXIgbGlzdEJsb2JGbGF0U2VnbWVudE9wZXJhdGlvblNwZWMgPSB7CiAgICAgICAgaHR0cE1ldGhvZDogIkdFVCIsCiAgICAgICAgcGF0aDogIntjb250YWluZXJOYW1lfSIsCiAgICAgICAgdXJsUGFyYW1ldGVyczogWwogICAgICAgICAgICB1cmwKICAgICAgICBdLAogICAgICAgIHF1ZXJ5UGFyYW1ldGVyczogWwogICAgICAgICAgICBwcmVmaXgsCiAgICAgICAgICAgIG1hcmtlcjAsCiAgICAgICAgICAgIG1heHJlc3VsdHMsCiAgICAgICAgICAgIGluY2x1ZGUxLAogICAgICAgICAgICB0aW1lb3V0LAogICAgICAgICAgICByZXN0eXBlMiwKICAgICAgICAgICAgY29tcDIKICAgICAgICBdLAogICAgICAgIGhlYWRlclBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdmVyc2lvbiwKICAgICAgICAgICAgcmVxdWVzdElkCiAgICAgICAgXSwKICAgICAgICByZXNwb25zZXM6IHsKICAgICAgICAgICAgMjAwOiB7CiAgICAgICAgICAgICAgICBib2R5TWFwcGVyOiBMaXN0QmxvYnNGbGF0U2VnbWVudFJlc3BvbnNlLAogICAgICAgICAgICAgICAgaGVhZGVyc01hcHBlcjogQ29udGFpbmVyTGlzdEJsb2JGbGF0U2VnbWVudEhlYWRlcnMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVmYXVsdDogewogICAgICAgICAgICAgICAgYm9keU1hcHBlcjogU3RvcmFnZUVycm9yCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGlzWE1MOiB0cnVlLAogICAgICAgIHNlcmlhbGl6ZXI6IHNlcmlhbGl6ZXIkMgogICAgfTsKICAgIHZhciBsaXN0QmxvYkhpZXJhcmNoeVNlZ21lbnRPcGVyYXRpb25TcGVjID0gewogICAgICAgIGh0dHBNZXRob2Q6ICJHRVQiLAogICAgICAgIHBhdGg6ICJ7Y29udGFpbmVyTmFtZX0iLAogICAgICAgIHVybFBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdXJsCiAgICAgICAgXSwKICAgICAgICBxdWVyeVBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgcHJlZml4LAogICAgICAgICAgICBkZWxpbWl0ZXIsCiAgICAgICAgICAgIG1hcmtlcjAsCiAgICAgICAgICAgIG1heHJlc3VsdHMsCiAgICAgICAgICAgIGluY2x1ZGUxLAogICAgICAgICAgICB0aW1lb3V0LAogICAgICAgICAgICByZXN0eXBlMiwKICAgICAgICAgICAgY29tcDIKICAgICAgICBdLAogICAgICAgIGhlYWRlclBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdmVyc2lvbiwKICAgICAgICAgICAgcmVxdWVzdElkCiAgICAgICAgXSwKICAgICAgICByZXNwb25zZXM6IHsKICAgICAgICAgICAgMjAwOiB7CiAgICAgICAgICAgICAgICBib2R5TWFwcGVyOiBMaXN0QmxvYnNIaWVyYXJjaHlTZWdtZW50UmVzcG9uc2UsCiAgICAgICAgICAgICAgICBoZWFkZXJzTWFwcGVyOiBDb250YWluZXJMaXN0QmxvYkhpZXJhcmNoeVNlZ21lbnRIZWFkZXJzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICAgIGJvZHlNYXBwZXI6IFN0b3JhZ2VFcnJvcgogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBpc1hNTDogdHJ1ZSwKICAgICAgICBzZXJpYWxpemVyOiBzZXJpYWxpemVyJDIKICAgIH07CiAgICB2YXIgZ2V0QWNjb3VudEluZm9PcGVyYXRpb25TcGVjJDEgPSB7CiAgICAgICAgaHR0cE1ldGhvZDogIkdFVCIsCiAgICAgICAgcGF0aDogIntjb250YWluZXJOYW1lfSIsCiAgICAgICAgdXJsUGFyYW1ldGVyczogWwogICAgICAgICAgICB1cmwKICAgICAgICBdLAogICAgICAgIHF1ZXJ5UGFyYW1ldGVyczogWwogICAgICAgICAgICByZXN0eXBlMSwKICAgICAgICAgICAgY29tcDAKICAgICAgICBdLAogICAgICAgIGhlYWRlclBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdmVyc2lvbgogICAgICAgIF0sCiAgICAgICAgcmVzcG9uc2VzOiB7CiAgICAgICAgICAgIDIwMDogewogICAgICAgICAgICAgICAgaGVhZGVyc01hcHBlcjogQ29udGFpbmVyR2V0QWNjb3VudEluZm9IZWFkZXJzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICAgIGJvZHlNYXBwZXI6IFN0b3JhZ2VFcnJvcgogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBpc1hNTDogdHJ1ZSwKICAgICAgICBzZXJpYWxpemVyOiBzZXJpYWxpemVyJDIKICAgIH07CgogICAgLyoKICAgICAqIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogICAgICogTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi4KICAgICAqCiAgICAgKiBDb2RlIGdlbmVyYXRlZCBieSBNaWNyb3NvZnQgKFIpIEF1dG9SZXN0IENvZGUgR2VuZXJhdG9yLgogICAgICogQ2hhbmdlcyBtYXkgY2F1c2UgaW5jb3JyZWN0IGJlaGF2aW9yIGFuZCB3aWxsIGJlIGxvc3QgaWYgdGhlIGNvZGUgaXMgcmVnZW5lcmF0ZWQuCiAgICAgKi8KCiAgICB2YXIgTWFwcGVycyQyID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogICAgICAgIEJsb2JBYm9ydENvcHlGcm9tVVJMSGVhZGVyczogQmxvYkFib3J0Q29weUZyb21VUkxIZWFkZXJzLAogICAgICAgIEJsb2JBY3F1aXJlTGVhc2VIZWFkZXJzOiBCbG9iQWNxdWlyZUxlYXNlSGVhZGVycywKICAgICAgICBCbG9iQnJlYWtMZWFzZUhlYWRlcnM6IEJsb2JCcmVha0xlYXNlSGVhZGVycywKICAgICAgICBCbG9iQ2hhbmdlTGVhc2VIZWFkZXJzOiBCbG9iQ2hhbmdlTGVhc2VIZWFkZXJzLAogICAgICAgIEJsb2JDb3B5RnJvbVVSTEhlYWRlcnM6IEJsb2JDb3B5RnJvbVVSTEhlYWRlcnMsCiAgICAgICAgQmxvYkNyZWF0ZVNuYXBzaG90SGVhZGVyczogQmxvYkNyZWF0ZVNuYXBzaG90SGVhZGVycywKICAgICAgICBCbG9iRGVsZXRlSGVhZGVyczogQmxvYkRlbGV0ZUhlYWRlcnMsCiAgICAgICAgQmxvYkRvd25sb2FkSGVhZGVyczogQmxvYkRvd25sb2FkSGVhZGVycywKICAgICAgICBCbG9iR2V0QWNjZXNzQ29udHJvbEhlYWRlcnM6IEJsb2JHZXRBY2Nlc3NDb250cm9sSGVhZGVycywKICAgICAgICBCbG9iR2V0QWNjb3VudEluZm9IZWFkZXJzOiBCbG9iR2V0QWNjb3VudEluZm9IZWFkZXJzLAogICAgICAgIEJsb2JHZXRQcm9wZXJ0aWVzSGVhZGVyczogQmxvYkdldFByb3BlcnRpZXNIZWFkZXJzLAogICAgICAgIEJsb2JSZWxlYXNlTGVhc2VIZWFkZXJzOiBCbG9iUmVsZWFzZUxlYXNlSGVhZGVycywKICAgICAgICBCbG9iUmVuYW1lSGVhZGVyczogQmxvYlJlbmFtZUhlYWRlcnMsCiAgICAgICAgQmxvYlJlbmV3TGVhc2VIZWFkZXJzOiBCbG9iUmVuZXdMZWFzZUhlYWRlcnMsCiAgICAgICAgQmxvYlNldEFjY2Vzc0NvbnRyb2xIZWFkZXJzOiBCbG9iU2V0QWNjZXNzQ29udHJvbEhlYWRlcnMsCiAgICAgICAgQmxvYlNldEhUVFBIZWFkZXJzSGVhZGVyczogQmxvYlNldEhUVFBIZWFkZXJzSGVhZGVycywKICAgICAgICBCbG9iU2V0TWV0YWRhdGFIZWFkZXJzOiBCbG9iU2V0TWV0YWRhdGFIZWFkZXJzLAogICAgICAgIEJsb2JTZXRUaWVySGVhZGVyczogQmxvYlNldFRpZXJIZWFkZXJzLAogICAgICAgIEJsb2JTdGFydENvcHlGcm9tVVJMSGVhZGVyczogQmxvYlN0YXJ0Q29weUZyb21VUkxIZWFkZXJzLAogICAgICAgIEJsb2JVbmRlbGV0ZUhlYWRlcnM6IEJsb2JVbmRlbGV0ZUhlYWRlcnMsCiAgICAgICAgRGF0YUxha2VTdG9yYWdlRXJyb3I6IERhdGFMYWtlU3RvcmFnZUVycm9yLAogICAgICAgIERhdGFMYWtlU3RvcmFnZUVycm9yRXJyb3I6IERhdGFMYWtlU3RvcmFnZUVycm9yRXJyb3IsCiAgICAgICAgU3RvcmFnZUVycm9yOiBTdG9yYWdlRXJyb3IKICAgIH0pOwoKICAgIC8qCiAgICAgKiBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICAgICAqIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS4gU2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yCiAgICAgKiBsaWNlbnNlIGluZm9ybWF0aW9uLgogICAgICoKICAgICAqIENvZGUgZ2VuZXJhdGVkIGJ5IE1pY3Jvc29mdCAoUikgQXV0b1Jlc3QgQ29kZSBHZW5lcmF0b3IuCiAgICAgKiBDaGFuZ2VzIG1heSBjYXVzZSBpbmNvcnJlY3QgYmVoYXZpb3IgYW5kIHdpbGwgYmUgbG9zdCBpZiB0aGUgY29kZSBpcwogICAgICogcmVnZW5lcmF0ZWQuCiAgICAgKi8KICAgIC8qKiBDbGFzcyByZXByZXNlbnRpbmcgYSBCbG9iLiAqLwogICAgdmFyIEJsb2IkMSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGUgYSBCbG9iLgogICAgICAgICAqIEBwYXJhbSB7U3RvcmFnZUNsaWVudENvbnRleHR9IGNsaWVudCBSZWZlcmVuY2UgdG8gdGhlIHNlcnZpY2UgY2xpZW50LgogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIEJsb2IoY2xpZW50KSB7CiAgICAgICAgICAgIHRoaXMuY2xpZW50ID0gY2xpZW50OwogICAgICAgIH0KICAgICAgICBCbG9iLnByb3RvdHlwZS5kb3dubG9hZCA9IGZ1bmN0aW9uIChvcHRpb25zLCBjYWxsYmFjaykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jbGllbnQuc2VuZE9wZXJhdGlvblJlcXVlc3QoewogICAgICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucwogICAgICAgICAgICB9LCBkb3dubG9hZE9wZXJhdGlvblNwZWMsIGNhbGxiYWNrKTsKICAgICAgICB9OwogICAgICAgIEJsb2IucHJvdG90eXBlLmdldFByb3BlcnRpZXMgPSBmdW5jdGlvbiAob3B0aW9ucywgY2FsbGJhY2spIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2xpZW50LnNlbmRPcGVyYXRpb25SZXF1ZXN0KHsKICAgICAgICAgICAgICAgIG9wdGlvbnM6IG9wdGlvbnMKICAgICAgICAgICAgfSwgZ2V0UHJvcGVydGllc09wZXJhdGlvblNwZWMkMiwgY2FsbGJhY2spOwogICAgICAgIH07CiAgICAgICAgQmxvYi5wcm90b3R5cGUuZGVsZXRlTWV0aG9kID0gZnVuY3Rpb24gKG9wdGlvbnMsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNsaWVudC5zZW5kT3BlcmF0aW9uUmVxdWVzdCh7CiAgICAgICAgICAgICAgICBvcHRpb25zOiBvcHRpb25zCiAgICAgICAgICAgIH0sIGRlbGV0ZU1ldGhvZE9wZXJhdGlvblNwZWMkMSwgY2FsbGJhY2spOwogICAgICAgIH07CiAgICAgICAgQmxvYi5wcm90b3R5cGUuc2V0QWNjZXNzQ29udHJvbCA9IGZ1bmN0aW9uIChvcHRpb25zLCBjYWxsYmFjaykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jbGllbnQuc2VuZE9wZXJhdGlvblJlcXVlc3QoewogICAgICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucwogICAgICAgICAgICB9LCBzZXRBY2Nlc3NDb250cm9sT3BlcmF0aW9uU3BlYywgY2FsbGJhY2spOwogICAgICAgIH07CiAgICAgICAgQmxvYi5wcm90b3R5cGUuZ2V0QWNjZXNzQ29udHJvbCA9IGZ1bmN0aW9uIChvcHRpb25zLCBjYWxsYmFjaykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jbGllbnQuc2VuZE9wZXJhdGlvblJlcXVlc3QoewogICAgICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucwogICAgICAgICAgICB9LCBnZXRBY2Nlc3NDb250cm9sT3BlcmF0aW9uU3BlYywgY2FsbGJhY2spOwogICAgICAgIH07CiAgICAgICAgQmxvYi5wcm90b3R5cGUucmVuYW1lID0gZnVuY3Rpb24gKHJlbmFtZVNvdXJjZSwgb3B0aW9ucywgY2FsbGJhY2spIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2xpZW50LnNlbmRPcGVyYXRpb25SZXF1ZXN0KHsKICAgICAgICAgICAgICAgIHJlbmFtZVNvdXJjZTogcmVuYW1lU291cmNlLAogICAgICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucwogICAgICAgICAgICB9LCByZW5hbWVPcGVyYXRpb25TcGVjLCBjYWxsYmFjayk7CiAgICAgICAgfTsKICAgICAgICBCbG9iLnByb3RvdHlwZS51bmRlbGV0ZSA9IGZ1bmN0aW9uIChvcHRpb25zLCBjYWxsYmFjaykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jbGllbnQuc2VuZE9wZXJhdGlvblJlcXVlc3QoewogICAgICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucwogICAgICAgICAgICB9LCB1bmRlbGV0ZU9wZXJhdGlvblNwZWMsIGNhbGxiYWNrKTsKICAgICAgICB9OwogICAgICAgIEJsb2IucHJvdG90eXBlLnNldEhUVFBIZWFkZXJzID0gZnVuY3Rpb24gKG9wdGlvbnMsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNsaWVudC5zZW5kT3BlcmF0aW9uUmVxdWVzdCh7CiAgICAgICAgICAgICAgICBvcHRpb25zOiBvcHRpb25zCiAgICAgICAgICAgIH0sIHNldEhUVFBIZWFkZXJzT3BlcmF0aW9uU3BlYywgY2FsbGJhY2spOwogICAgICAgIH07CiAgICAgICAgQmxvYi5wcm90b3R5cGUuc2V0TWV0YWRhdGEgPSBmdW5jdGlvbiAob3B0aW9ucywgY2FsbGJhY2spIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2xpZW50LnNlbmRPcGVyYXRpb25SZXF1ZXN0KHsKICAgICAgICAgICAgICAgIG9wdGlvbnM6IG9wdGlvbnMKICAgICAgICAgICAgfSwgc2V0TWV0YWRhdGFPcGVyYXRpb25TcGVjJDEsIGNhbGxiYWNrKTsKICAgICAgICB9OwogICAgICAgIEJsb2IucHJvdG90eXBlLmFjcXVpcmVMZWFzZSA9IGZ1bmN0aW9uIChvcHRpb25zLCBjYWxsYmFjaykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jbGllbnQuc2VuZE9wZXJhdGlvblJlcXVlc3QoewogICAgICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucwogICAgICAgICAgICB9LCBhY3F1aXJlTGVhc2VPcGVyYXRpb25TcGVjJDEsIGNhbGxiYWNrKTsKICAgICAgICB9OwogICAgICAgIEJsb2IucHJvdG90eXBlLnJlbGVhc2VMZWFzZSA9IGZ1bmN0aW9uIChsZWFzZUlkLCBvcHRpb25zLCBjYWxsYmFjaykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jbGllbnQuc2VuZE9wZXJhdGlvblJlcXVlc3QoewogICAgICAgICAgICAgICAgbGVhc2VJZDogbGVhc2VJZCwKICAgICAgICAgICAgICAgIG9wdGlvbnM6IG9wdGlvbnMKICAgICAgICAgICAgfSwgcmVsZWFzZUxlYXNlT3BlcmF0aW9uU3BlYyQxLCBjYWxsYmFjayk7CiAgICAgICAgfTsKICAgICAgICBCbG9iLnByb3RvdHlwZS5yZW5ld0xlYXNlID0gZnVuY3Rpb24gKGxlYXNlSWQsIG9wdGlvbnMsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNsaWVudC5zZW5kT3BlcmF0aW9uUmVxdWVzdCh7CiAgICAgICAgICAgICAgICBsZWFzZUlkOiBsZWFzZUlkLAogICAgICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucwogICAgICAgICAgICB9LCByZW5ld0xlYXNlT3BlcmF0aW9uU3BlYyQxLCBjYWxsYmFjayk7CiAgICAgICAgfTsKICAgICAgICBCbG9iLnByb3RvdHlwZS5jaGFuZ2VMZWFzZSA9IGZ1bmN0aW9uIChsZWFzZUlkLCBwcm9wb3NlZExlYXNlSWQsIG9wdGlvbnMsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNsaWVudC5zZW5kT3BlcmF0aW9uUmVxdWVzdCh7CiAgICAgICAgICAgICAgICBsZWFzZUlkOiBsZWFzZUlkLAogICAgICAgICAgICAgICAgcHJvcG9zZWRMZWFzZUlkOiBwcm9wb3NlZExlYXNlSWQsCiAgICAgICAgICAgICAgICBvcHRpb25zOiBvcHRpb25zCiAgICAgICAgICAgIH0sIGNoYW5nZUxlYXNlT3BlcmF0aW9uU3BlYyQxLCBjYWxsYmFjayk7CiAgICAgICAgfTsKICAgICAgICBCbG9iLnByb3RvdHlwZS5icmVha0xlYXNlID0gZnVuY3Rpb24gKG9wdGlvbnMsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNsaWVudC5zZW5kT3BlcmF0aW9uUmVxdWVzdCh7CiAgICAgICAgICAgICAgICBvcHRpb25zOiBvcHRpb25zCiAgICAgICAgICAgIH0sIGJyZWFrTGVhc2VPcGVyYXRpb25TcGVjJDEsIGNhbGxiYWNrKTsKICAgICAgICB9OwogICAgICAgIEJsb2IucHJvdG90eXBlLmNyZWF0ZVNuYXBzaG90ID0gZnVuY3Rpb24gKG9wdGlvbnMsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNsaWVudC5zZW5kT3BlcmF0aW9uUmVxdWVzdCh7CiAgICAgICAgICAgICAgICBvcHRpb25zOiBvcHRpb25zCiAgICAgICAgICAgIH0sIGNyZWF0ZVNuYXBzaG90T3BlcmF0aW9uU3BlYywgY2FsbGJhY2spOwogICAgICAgIH07CiAgICAgICAgQmxvYi5wcm90b3R5cGUuc3RhcnRDb3B5RnJvbVVSTCA9IGZ1bmN0aW9uIChjb3B5U291cmNlLCBvcHRpb25zLCBjYWxsYmFjaykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jbGllbnQuc2VuZE9wZXJhdGlvblJlcXVlc3QoewogICAgICAgICAgICAgICAgY29weVNvdXJjZTogY29weVNvdXJjZSwKICAgICAgICAgICAgICAgIG9wdGlvbnM6IG9wdGlvbnMKICAgICAgICAgICAgfSwgc3RhcnRDb3B5RnJvbVVSTE9wZXJhdGlvblNwZWMsIGNhbGxiYWNrKTsKICAgICAgICB9OwogICAgICAgIEJsb2IucHJvdG90eXBlLmNvcHlGcm9tVVJMID0gZnVuY3Rpb24gKGNvcHlTb3VyY2UsIG9wdGlvbnMsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNsaWVudC5zZW5kT3BlcmF0aW9uUmVxdWVzdCh7CiAgICAgICAgICAgICAgICBjb3B5U291cmNlOiBjb3B5U291cmNlLAogICAgICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucwogICAgICAgICAgICB9LCBjb3B5RnJvbVVSTE9wZXJhdGlvblNwZWMsIGNhbGxiYWNrKTsKICAgICAgICB9OwogICAgICAgIEJsb2IucHJvdG90eXBlLmFib3J0Q29weUZyb21VUkwgPSBmdW5jdGlvbiAoY29weUlkLCBvcHRpb25zLCBjYWxsYmFjaykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jbGllbnQuc2VuZE9wZXJhdGlvblJlcXVlc3QoewogICAgICAgICAgICAgICAgY29weUlkOiBjb3B5SWQsCiAgICAgICAgICAgICAgICBvcHRpb25zOiBvcHRpb25zCiAgICAgICAgICAgIH0sIGFib3J0Q29weUZyb21VUkxPcGVyYXRpb25TcGVjLCBjYWxsYmFjayk7CiAgICAgICAgfTsKICAgICAgICBCbG9iLnByb3RvdHlwZS5zZXRUaWVyID0gZnVuY3Rpb24gKHRpZXIsIG9wdGlvbnMsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNsaWVudC5zZW5kT3BlcmF0aW9uUmVxdWVzdCh7CiAgICAgICAgICAgICAgICB0aWVyOiB0aWVyLAogICAgICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucwogICAgICAgICAgICB9LCBzZXRUaWVyT3BlcmF0aW9uU3BlYywgY2FsbGJhY2spOwogICAgICAgIH07CiAgICAgICAgQmxvYi5wcm90b3R5cGUuZ2V0QWNjb3VudEluZm8gPSBmdW5jdGlvbiAob3B0aW9ucywgY2FsbGJhY2spIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2xpZW50LnNlbmRPcGVyYXRpb25SZXF1ZXN0KHsKICAgICAgICAgICAgICAgIG9wdGlvbnM6IG9wdGlvbnMKICAgICAgICAgICAgfSwgZ2V0QWNjb3VudEluZm9PcGVyYXRpb25TcGVjJDIsIGNhbGxiYWNrKTsKICAgICAgICB9OwogICAgICAgIHJldHVybiBCbG9iOwogICAgfSgpKTsKICAgIC8vIE9wZXJhdGlvbiBTcGVjaWZpY2F0aW9ucwogICAgdmFyIHNlcmlhbGl6ZXIkMyA9IG5ldyBTZXJpYWxpemVyKE1hcHBlcnMkMiwgdHJ1ZSk7CiAgICB2YXIgZG93bmxvYWRPcGVyYXRpb25TcGVjID0gewogICAgICAgIGh0dHBNZXRob2Q6ICJHRVQiLAogICAgICAgIHBhdGg6ICJ7Y29udGFpbmVyTmFtZX0ve2Jsb2J9IiwKICAgICAgICB1cmxQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHVybAogICAgICAgIF0sCiAgICAgICAgcXVlcnlQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHNuYXBzaG90LAogICAgICAgICAgICB0aW1lb3V0CiAgICAgICAgXSwKICAgICAgICBoZWFkZXJQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHJhbmdlMCwKICAgICAgICAgICAgcmFuZ2VHZXRDb250ZW50TUQ1LAogICAgICAgICAgICByYW5nZUdldENvbnRlbnRDUkM2NCwKICAgICAgICAgICAgdmVyc2lvbiwKICAgICAgICAgICAgcmVxdWVzdElkLAogICAgICAgICAgICBsZWFzZUlkMCwKICAgICAgICAgICAgZW5jcnlwdGlvbktleSwKICAgICAgICAgICAgZW5jcnlwdGlvbktleVNoYTI1NiwKICAgICAgICAgICAgZW5jcnlwdGlvbkFsZ29yaXRobSwKICAgICAgICAgICAgaWZNb2RpZmllZFNpbmNlLAogICAgICAgICAgICBpZlVubW9kaWZpZWRTaW5jZSwKICAgICAgICAgICAgaWZNYXRjaCwKICAgICAgICAgICAgaWZOb25lTWF0Y2gKICAgICAgICBdLAogICAgICAgIHJlc3BvbnNlczogewogICAgICAgICAgICAyMDA6IHsKICAgICAgICAgICAgICAgIGJvZHlNYXBwZXI6IHsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogInBhcnNlZFJlc3BvbnNlIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJlYW0iCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGhlYWRlcnNNYXBwZXI6IEJsb2JEb3dubG9hZEhlYWRlcnMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgMjA2OiB7CiAgICAgICAgICAgICAgICBib2R5TWFwcGVyOiB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZE5hbWU6ICJwYXJzZWRSZXNwb25zZSIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU3RyZWFtIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBoZWFkZXJzTWFwcGVyOiBCbG9iRG93bmxvYWRIZWFkZXJzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICAgIGJvZHlNYXBwZXI6IFN0b3JhZ2VFcnJvcgogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBpc1hNTDogdHJ1ZSwKICAgICAgICBzZXJpYWxpemVyOiBzZXJpYWxpemVyJDMKICAgIH07CiAgICB2YXIgZ2V0UHJvcGVydGllc09wZXJhdGlvblNwZWMkMiA9IHsKICAgICAgICBodHRwTWV0aG9kOiAiSEVBRCIsCiAgICAgICAgcGF0aDogIntjb250YWluZXJOYW1lfS97YmxvYn0iLAogICAgICAgIHVybFBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdXJsCiAgICAgICAgXSwKICAgICAgICBxdWVyeVBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgc25hcHNob3QsCiAgICAgICAgICAgIHRpbWVvdXQKICAgICAgICBdLAogICAgICAgIGhlYWRlclBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdmVyc2lvbiwKICAgICAgICAgICAgcmVxdWVzdElkLAogICAgICAgICAgICBsZWFzZUlkMCwKICAgICAgICAgICAgZW5jcnlwdGlvbktleSwKICAgICAgICAgICAgZW5jcnlwdGlvbktleVNoYTI1NiwKICAgICAgICAgICAgZW5jcnlwdGlvbkFsZ29yaXRobSwKICAgICAgICAgICAgaWZNb2RpZmllZFNpbmNlLAogICAgICAgICAgICBpZlVubW9kaWZpZWRTaW5jZSwKICAgICAgICAgICAgaWZNYXRjaCwKICAgICAgICAgICAgaWZOb25lTWF0Y2gKICAgICAgICBdLAogICAgICAgIHJlc3BvbnNlczogewogICAgICAgICAgICAyMDA6IHsKICAgICAgICAgICAgICAgIGhlYWRlcnNNYXBwZXI6IEJsb2JHZXRQcm9wZXJ0aWVzSGVhZGVycwogICAgICAgICAgICB9LAogICAgICAgICAgICBkZWZhdWx0OiB7CiAgICAgICAgICAgICAgICBib2R5TWFwcGVyOiBTdG9yYWdlRXJyb3IKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgaXNYTUw6IHRydWUsCiAgICAgICAgc2VyaWFsaXplcjogc2VyaWFsaXplciQzCiAgICB9OwogICAgdmFyIGRlbGV0ZU1ldGhvZE9wZXJhdGlvblNwZWMkMSA9IHsKICAgICAgICBodHRwTWV0aG9kOiAiREVMRVRFIiwKICAgICAgICBwYXRoOiAie2NvbnRhaW5lck5hbWV9L3tibG9ifSIsCiAgICAgICAgdXJsUGFyYW1ldGVyczogWwogICAgICAgICAgICB1cmwKICAgICAgICBdLAogICAgICAgIHF1ZXJ5UGFyYW1ldGVyczogWwogICAgICAgICAgICBzbmFwc2hvdCwKICAgICAgICAgICAgdGltZW91dAogICAgICAgIF0sCiAgICAgICAgaGVhZGVyUGFyYW1ldGVyczogWwogICAgICAgICAgICBkZWxldGVTbmFwc2hvdHMsCiAgICAgICAgICAgIHZlcnNpb24sCiAgICAgICAgICAgIHJlcXVlc3RJZCwKICAgICAgICAgICAgbGVhc2VJZDAsCiAgICAgICAgICAgIGlmTW9kaWZpZWRTaW5jZSwKICAgICAgICAgICAgaWZVbm1vZGlmaWVkU2luY2UsCiAgICAgICAgICAgIGlmTWF0Y2gsCiAgICAgICAgICAgIGlmTm9uZU1hdGNoCiAgICAgICAgXSwKICAgICAgICByZXNwb25zZXM6IHsKICAgICAgICAgICAgMjAyOiB7CiAgICAgICAgICAgICAgICBoZWFkZXJzTWFwcGVyOiBCbG9iRGVsZXRlSGVhZGVycwogICAgICAgICAgICB9LAogICAgICAgICAgICBkZWZhdWx0OiB7CiAgICAgICAgICAgICAgICBib2R5TWFwcGVyOiBTdG9yYWdlRXJyb3IKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgaXNYTUw6IHRydWUsCiAgICAgICAgc2VyaWFsaXplcjogc2VyaWFsaXplciQzCiAgICB9OwogICAgdmFyIHNldEFjY2Vzc0NvbnRyb2xPcGVyYXRpb25TcGVjID0gewogICAgICAgIGh0dHBNZXRob2Q6ICJQQVRDSCIsCiAgICAgICAgcGF0aDogIntmaWxlc3lzdGVtfS97cGF0aH0iLAogICAgICAgIHVybFBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdXJsCiAgICAgICAgXSwKICAgICAgICBxdWVyeVBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdGltZW91dCwKICAgICAgICAgICAgYWN0aW9uNQogICAgICAgIF0sCiAgICAgICAgaGVhZGVyUGFyYW1ldGVyczogWwogICAgICAgICAgICBvd25lciwKICAgICAgICAgICAgZ3JvdXAsCiAgICAgICAgICAgIHBvc2l4UGVybWlzc2lvbnMsCiAgICAgICAgICAgIHBvc2l4QWNsLAogICAgICAgICAgICByZXF1ZXN0SWQsCiAgICAgICAgICAgIHZlcnNpb24sCiAgICAgICAgICAgIGxlYXNlSWQwLAogICAgICAgICAgICBpZk1hdGNoLAogICAgICAgICAgICBpZk5vbmVNYXRjaCwKICAgICAgICAgICAgaWZNb2RpZmllZFNpbmNlLAogICAgICAgICAgICBpZlVubW9kaWZpZWRTaW5jZQogICAgICAgIF0sCiAgICAgICAgcmVzcG9uc2VzOiB7CiAgICAgICAgICAgIDIwMDogewogICAgICAgICAgICAgICAgaGVhZGVyc01hcHBlcjogQmxvYlNldEFjY2Vzc0NvbnRyb2xIZWFkZXJzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICAgIGJvZHlNYXBwZXI6IERhdGFMYWtlU3RvcmFnZUVycm9yCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGlzWE1MOiB0cnVlLAogICAgICAgIHNlcmlhbGl6ZXI6IHNlcmlhbGl6ZXIkMwogICAgfTsKICAgIHZhciBnZXRBY2Nlc3NDb250cm9sT3BlcmF0aW9uU3BlYyA9IHsKICAgICAgICBodHRwTWV0aG9kOiAiSEVBRCIsCiAgICAgICAgcGF0aDogIntmaWxlc3lzdGVtfS97cGF0aH0iLAogICAgICAgIHVybFBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdXJsCiAgICAgICAgXSwKICAgICAgICBxdWVyeVBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdGltZW91dCwKICAgICAgICAgICAgdXBuLAogICAgICAgICAgICBhY3Rpb242CiAgICAgICAgXSwKICAgICAgICBoZWFkZXJQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHJlcXVlc3RJZCwKICAgICAgICAgICAgdmVyc2lvbiwKICAgICAgICAgICAgbGVhc2VJZDAsCiAgICAgICAgICAgIGlmTWF0Y2gsCiAgICAgICAgICAgIGlmTm9uZU1hdGNoLAogICAgICAgICAgICBpZk1vZGlmaWVkU2luY2UsCiAgICAgICAgICAgIGlmVW5tb2RpZmllZFNpbmNlCiAgICAgICAgXSwKICAgICAgICByZXNwb25zZXM6IHsKICAgICAgICAgICAgMjAwOiB7CiAgICAgICAgICAgICAgICBoZWFkZXJzTWFwcGVyOiBCbG9iR2V0QWNjZXNzQ29udHJvbEhlYWRlcnMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVmYXVsdDogewogICAgICAgICAgICAgICAgYm9keU1hcHBlcjogRGF0YUxha2VTdG9yYWdlRXJyb3IKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgaXNYTUw6IHRydWUsCiAgICAgICAgc2VyaWFsaXplcjogc2VyaWFsaXplciQzCiAgICB9OwogICAgdmFyIHJlbmFtZU9wZXJhdGlvblNwZWMgPSB7CiAgICAgICAgaHR0cE1ldGhvZDogIlBVVCIsCiAgICAgICAgcGF0aDogIntmaWxlc3lzdGVtfS97cGF0aH0iLAogICAgICAgIHVybFBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdXJsCiAgICAgICAgXSwKICAgICAgICBxdWVyeVBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdGltZW91dCwKICAgICAgICAgICAgcGF0aFJlbmFtZU1vZGUKICAgICAgICBdLAogICAgICAgIGhlYWRlclBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgcmVuYW1lU291cmNlLAogICAgICAgICAgICBkaXJlY3RvcnlQcm9wZXJ0aWVzLAogICAgICAgICAgICBwb3NpeFBlcm1pc3Npb25zLAogICAgICAgICAgICBwb3NpeFVtYXNrLAogICAgICAgICAgICBzb3VyY2VMZWFzZUlkLAogICAgICAgICAgICB2ZXJzaW9uLAogICAgICAgICAgICByZXF1ZXN0SWQsCiAgICAgICAgICAgIGNhY2hlQ29udHJvbCwKICAgICAgICAgICAgY29udGVudFR5cGUsCiAgICAgICAgICAgIGNvbnRlbnRFbmNvZGluZywKICAgICAgICAgICAgY29udGVudExhbmd1YWdlLAogICAgICAgICAgICBjb250ZW50RGlzcG9zaXRpb24sCiAgICAgICAgICAgIGxlYXNlSWQwLAogICAgICAgICAgICBpZk1vZGlmaWVkU2luY2UsCiAgICAgICAgICAgIGlmVW5tb2RpZmllZFNpbmNlLAogICAgICAgICAgICBpZk1hdGNoLAogICAgICAgICAgICBpZk5vbmVNYXRjaCwKICAgICAgICAgICAgc291cmNlSWZNb2RpZmllZFNpbmNlLAogICAgICAgICAgICBzb3VyY2VJZlVubW9kaWZpZWRTaW5jZSwKICAgICAgICAgICAgc291cmNlSWZNYXRjaCwKICAgICAgICAgICAgc291cmNlSWZOb25lTWF0Y2gKICAgICAgICBdLAogICAgICAgIHJlc3BvbnNlczogewogICAgICAgICAgICAyMDE6IHsKICAgICAgICAgICAgICAgIGhlYWRlcnNNYXBwZXI6IEJsb2JSZW5hbWVIZWFkZXJzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICAgIGJvZHlNYXBwZXI6IERhdGFMYWtlU3RvcmFnZUVycm9yCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGlzWE1MOiB0cnVlLAogICAgICAgIHNlcmlhbGl6ZXI6IHNlcmlhbGl6ZXIkMwogICAgfTsKICAgIHZhciB1bmRlbGV0ZU9wZXJhdGlvblNwZWMgPSB7CiAgICAgICAgaHR0cE1ldGhvZDogIlBVVCIsCiAgICAgICAgcGF0aDogIntjb250YWluZXJOYW1lfS97YmxvYn0iLAogICAgICAgIHVybFBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdXJsCiAgICAgICAgXSwKICAgICAgICBxdWVyeVBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdGltZW91dCwKICAgICAgICAgICAgY29tcDgKICAgICAgICBdLAogICAgICAgIGhlYWRlclBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdmVyc2lvbiwKICAgICAgICAgICAgcmVxdWVzdElkCiAgICAgICAgXSwKICAgICAgICByZXNwb25zZXM6IHsKICAgICAgICAgICAgMjAwOiB7CiAgICAgICAgICAgICAgICBoZWFkZXJzTWFwcGVyOiBCbG9iVW5kZWxldGVIZWFkZXJzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICAgIGJvZHlNYXBwZXI6IFN0b3JhZ2VFcnJvcgogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBpc1hNTDogdHJ1ZSwKICAgICAgICBzZXJpYWxpemVyOiBzZXJpYWxpemVyJDMKICAgIH07CiAgICB2YXIgc2V0SFRUUEhlYWRlcnNPcGVyYXRpb25TcGVjID0gewogICAgICAgIGh0dHBNZXRob2Q6ICJQVVQiLAogICAgICAgIHBhdGg6ICJ7Y29udGFpbmVyTmFtZX0ve2Jsb2J9IiwKICAgICAgICB1cmxQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHVybAogICAgICAgIF0sCiAgICAgICAgcXVlcnlQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHRpbWVvdXQsCiAgICAgICAgICAgIGNvbXAwCiAgICAgICAgXSwKICAgICAgICBoZWFkZXJQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHZlcnNpb24sCiAgICAgICAgICAgIHJlcXVlc3RJZCwKICAgICAgICAgICAgYmxvYkNhY2hlQ29udHJvbCwKICAgICAgICAgICAgYmxvYkNvbnRlbnRUeXBlLAogICAgICAgICAgICBibG9iQ29udGVudE1ENSwKICAgICAgICAgICAgYmxvYkNvbnRlbnRFbmNvZGluZywKICAgICAgICAgICAgYmxvYkNvbnRlbnRMYW5ndWFnZSwKICAgICAgICAgICAgYmxvYkNvbnRlbnREaXNwb3NpdGlvbiwKICAgICAgICAgICAgbGVhc2VJZDAsCiAgICAgICAgICAgIGlmTW9kaWZpZWRTaW5jZSwKICAgICAgICAgICAgaWZVbm1vZGlmaWVkU2luY2UsCiAgICAgICAgICAgIGlmTWF0Y2gsCiAgICAgICAgICAgIGlmTm9uZU1hdGNoCiAgICAgICAgXSwKICAgICAgICByZXNwb25zZXM6IHsKICAgICAgICAgICAgMjAwOiB7CiAgICAgICAgICAgICAgICBoZWFkZXJzTWFwcGVyOiBCbG9iU2V0SFRUUEhlYWRlcnNIZWFkZXJzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICAgIGJvZHlNYXBwZXI6IFN0b3JhZ2VFcnJvcgogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBpc1hNTDogdHJ1ZSwKICAgICAgICBzZXJpYWxpemVyOiBzZXJpYWxpemVyJDMKICAgIH07CiAgICB2YXIgc2V0TWV0YWRhdGFPcGVyYXRpb25TcGVjJDEgPSB7CiAgICAgICAgaHR0cE1ldGhvZDogIlBVVCIsCiAgICAgICAgcGF0aDogIntjb250YWluZXJOYW1lfS97YmxvYn0iLAogICAgICAgIHVybFBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdXJsCiAgICAgICAgXSwKICAgICAgICBxdWVyeVBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdGltZW91dCwKICAgICAgICAgICAgY29tcDUKICAgICAgICBdLAogICAgICAgIGhlYWRlclBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgbWV0YWRhdGEsCiAgICAgICAgICAgIHZlcnNpb24sCiAgICAgICAgICAgIHJlcXVlc3RJZCwKICAgICAgICAgICAgbGVhc2VJZDAsCiAgICAgICAgICAgIGVuY3J5cHRpb25LZXksCiAgICAgICAgICAgIGVuY3J5cHRpb25LZXlTaGEyNTYsCiAgICAgICAgICAgIGVuY3J5cHRpb25BbGdvcml0aG0sCiAgICAgICAgICAgIGlmTW9kaWZpZWRTaW5jZSwKICAgICAgICAgICAgaWZVbm1vZGlmaWVkU2luY2UsCiAgICAgICAgICAgIGlmTWF0Y2gsCiAgICAgICAgICAgIGlmTm9uZU1hdGNoCiAgICAgICAgXSwKICAgICAgICByZXNwb25zZXM6IHsKICAgICAgICAgICAgMjAwOiB7CiAgICAgICAgICAgICAgICBoZWFkZXJzTWFwcGVyOiBCbG9iU2V0TWV0YWRhdGFIZWFkZXJzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICAgIGJvZHlNYXBwZXI6IFN0b3JhZ2VFcnJvcgogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBpc1hNTDogdHJ1ZSwKICAgICAgICBzZXJpYWxpemVyOiBzZXJpYWxpemVyJDMKICAgIH07CiAgICB2YXIgYWNxdWlyZUxlYXNlT3BlcmF0aW9uU3BlYyQxID0gewogICAgICAgIGh0dHBNZXRob2Q6ICJQVVQiLAogICAgICAgIHBhdGg6ICJ7Y29udGFpbmVyTmFtZX0ve2Jsb2J9IiwKICAgICAgICB1cmxQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHVybAogICAgICAgIF0sCiAgICAgICAgcXVlcnlQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHRpbWVvdXQsCiAgICAgICAgICAgIGNvbXA3CiAgICAgICAgXSwKICAgICAgICBoZWFkZXJQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIGR1cmF0aW9uLAogICAgICAgICAgICBwcm9wb3NlZExlYXNlSWQwLAogICAgICAgICAgICB2ZXJzaW9uLAogICAgICAgICAgICByZXF1ZXN0SWQsCiAgICAgICAgICAgIGFjdGlvbjAsCiAgICAgICAgICAgIGlmTW9kaWZpZWRTaW5jZSwKICAgICAgICAgICAgaWZVbm1vZGlmaWVkU2luY2UsCiAgICAgICAgICAgIGlmTWF0Y2gsCiAgICAgICAgICAgIGlmTm9uZU1hdGNoCiAgICAgICAgXSwKICAgICAgICByZXNwb25zZXM6IHsKICAgICAgICAgICAgMjAxOiB7CiAgICAgICAgICAgICAgICBoZWFkZXJzTWFwcGVyOiBCbG9iQWNxdWlyZUxlYXNlSGVhZGVycwogICAgICAgICAgICB9LAogICAgICAgICAgICBkZWZhdWx0OiB7CiAgICAgICAgICAgICAgICBib2R5TWFwcGVyOiBTdG9yYWdlRXJyb3IKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgaXNYTUw6IHRydWUsCiAgICAgICAgc2VyaWFsaXplcjogc2VyaWFsaXplciQzCiAgICB9OwogICAgdmFyIHJlbGVhc2VMZWFzZU9wZXJhdGlvblNwZWMkMSA9IHsKICAgICAgICBodHRwTWV0aG9kOiAiUFVUIiwKICAgICAgICBwYXRoOiAie2NvbnRhaW5lck5hbWV9L3tibG9ifSIsCiAgICAgICAgdXJsUGFyYW1ldGVyczogWwogICAgICAgICAgICB1cmwKICAgICAgICBdLAogICAgICAgIHF1ZXJ5UGFyYW1ldGVyczogWwogICAgICAgICAgICB0aW1lb3V0LAogICAgICAgICAgICBjb21wNwogICAgICAgIF0sCiAgICAgICAgaGVhZGVyUGFyYW1ldGVyczogWwogICAgICAgICAgICBsZWFzZUlkMSwKICAgICAgICAgICAgdmVyc2lvbiwKICAgICAgICAgICAgcmVxdWVzdElkLAogICAgICAgICAgICBhY3Rpb24xLAogICAgICAgICAgICBpZk1vZGlmaWVkU2luY2UsCiAgICAgICAgICAgIGlmVW5tb2RpZmllZFNpbmNlLAogICAgICAgICAgICBpZk1hdGNoLAogICAgICAgICAgICBpZk5vbmVNYXRjaAogICAgICAgIF0sCiAgICAgICAgcmVzcG9uc2VzOiB7CiAgICAgICAgICAgIDIwMDogewogICAgICAgICAgICAgICAgaGVhZGVyc01hcHBlcjogQmxvYlJlbGVhc2VMZWFzZUhlYWRlcnMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVmYXVsdDogewogICAgICAgICAgICAgICAgYm9keU1hcHBlcjogU3RvcmFnZUVycm9yCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGlzWE1MOiB0cnVlLAogICAgICAgIHNlcmlhbGl6ZXI6IHNlcmlhbGl6ZXIkMwogICAgfTsKICAgIHZhciByZW5ld0xlYXNlT3BlcmF0aW9uU3BlYyQxID0gewogICAgICAgIGh0dHBNZXRob2Q6ICJQVVQiLAogICAgICAgIHBhdGg6ICJ7Y29udGFpbmVyTmFtZX0ve2Jsb2J9IiwKICAgICAgICB1cmxQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHVybAogICAgICAgIF0sCiAgICAgICAgcXVlcnlQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHRpbWVvdXQsCiAgICAgICAgICAgIGNvbXA3CiAgICAgICAgXSwKICAgICAgICBoZWFkZXJQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIGxlYXNlSWQxLAogICAgICAgICAgICB2ZXJzaW9uLAogICAgICAgICAgICByZXF1ZXN0SWQsCiAgICAgICAgICAgIGFjdGlvbjIsCiAgICAgICAgICAgIGlmTW9kaWZpZWRTaW5jZSwKICAgICAgICAgICAgaWZVbm1vZGlmaWVkU2luY2UsCiAgICAgICAgICAgIGlmTWF0Y2gsCiAgICAgICAgICAgIGlmTm9uZU1hdGNoCiAgICAgICAgXSwKICAgICAgICByZXNwb25zZXM6IHsKICAgICAgICAgICAgMjAwOiB7CiAgICAgICAgICAgICAgICBoZWFkZXJzTWFwcGVyOiBCbG9iUmVuZXdMZWFzZUhlYWRlcnMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVmYXVsdDogewogICAgICAgICAgICAgICAgYm9keU1hcHBlcjogU3RvcmFnZUVycm9yCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGlzWE1MOiB0cnVlLAogICAgICAgIHNlcmlhbGl6ZXI6IHNlcmlhbGl6ZXIkMwogICAgfTsKICAgIHZhciBjaGFuZ2VMZWFzZU9wZXJhdGlvblNwZWMkMSA9IHsKICAgICAgICBodHRwTWV0aG9kOiAiUFVUIiwKICAgICAgICBwYXRoOiAie2NvbnRhaW5lck5hbWV9L3tibG9ifSIsCiAgICAgICAgdXJsUGFyYW1ldGVyczogWwogICAgICAgICAgICB1cmwKICAgICAgICBdLAogICAgICAgIHF1ZXJ5UGFyYW1ldGVyczogWwogICAgICAgICAgICB0aW1lb3V0LAogICAgICAgICAgICBjb21wNwogICAgICAgIF0sCiAgICAgICAgaGVhZGVyUGFyYW1ldGVyczogWwogICAgICAgICAgICBsZWFzZUlkMSwKICAgICAgICAgICAgcHJvcG9zZWRMZWFzZUlkMSwKICAgICAgICAgICAgdmVyc2lvbiwKICAgICAgICAgICAgcmVxdWVzdElkLAogICAgICAgICAgICBhY3Rpb240LAogICAgICAgICAgICBpZk1vZGlmaWVkU2luY2UsCiAgICAgICAgICAgIGlmVW5tb2RpZmllZFNpbmNlLAogICAgICAgICAgICBpZk1hdGNoLAogICAgICAgICAgICBpZk5vbmVNYXRjaAogICAgICAgIF0sCiAgICAgICAgcmVzcG9uc2VzOiB7CiAgICAgICAgICAgIDIwMDogewogICAgICAgICAgICAgICAgaGVhZGVyc01hcHBlcjogQmxvYkNoYW5nZUxlYXNlSGVhZGVycwogICAgICAgICAgICB9LAogICAgICAgICAgICBkZWZhdWx0OiB7CiAgICAgICAgICAgICAgICBib2R5TWFwcGVyOiBTdG9yYWdlRXJyb3IKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgaXNYTUw6IHRydWUsCiAgICAgICAgc2VyaWFsaXplcjogc2VyaWFsaXplciQzCiAgICB9OwogICAgdmFyIGJyZWFrTGVhc2VPcGVyYXRpb25TcGVjJDEgPSB7CiAgICAgICAgaHR0cE1ldGhvZDogIlBVVCIsCiAgICAgICAgcGF0aDogIntjb250YWluZXJOYW1lfS97YmxvYn0iLAogICAgICAgIHVybFBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdXJsCiAgICAgICAgXSwKICAgICAgICBxdWVyeVBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdGltZW91dCwKICAgICAgICAgICAgY29tcDcKICAgICAgICBdLAogICAgICAgIGhlYWRlclBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgYnJlYWtQZXJpb2QsCiAgICAgICAgICAgIHZlcnNpb24sCiAgICAgICAgICAgIHJlcXVlc3RJZCwKICAgICAgICAgICAgYWN0aW9uMywKICAgICAgICAgICAgaWZNb2RpZmllZFNpbmNlLAogICAgICAgICAgICBpZlVubW9kaWZpZWRTaW5jZSwKICAgICAgICAgICAgaWZNYXRjaCwKICAgICAgICAgICAgaWZOb25lTWF0Y2gKICAgICAgICBdLAogICAgICAgIHJlc3BvbnNlczogewogICAgICAgICAgICAyMDI6IHsKICAgICAgICAgICAgICAgIGhlYWRlcnNNYXBwZXI6IEJsb2JCcmVha0xlYXNlSGVhZGVycwogICAgICAgICAgICB9LAogICAgICAgICAgICBkZWZhdWx0OiB7CiAgICAgICAgICAgICAgICBib2R5TWFwcGVyOiBTdG9yYWdlRXJyb3IKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgaXNYTUw6IHRydWUsCiAgICAgICAgc2VyaWFsaXplcjogc2VyaWFsaXplciQzCiAgICB9OwogICAgdmFyIGNyZWF0ZVNuYXBzaG90T3BlcmF0aW9uU3BlYyA9IHsKICAgICAgICBodHRwTWV0aG9kOiAiUFVUIiwKICAgICAgICBwYXRoOiAie2NvbnRhaW5lck5hbWV9L3tibG9ifSIsCiAgICAgICAgdXJsUGFyYW1ldGVyczogWwogICAgICAgICAgICB1cmwKICAgICAgICBdLAogICAgICAgIHF1ZXJ5UGFyYW1ldGVyczogWwogICAgICAgICAgICB0aW1lb3V0LAogICAgICAgICAgICBjb21wOQogICAgICAgIF0sCiAgICAgICAgaGVhZGVyUGFyYW1ldGVyczogWwogICAgICAgICAgICBtZXRhZGF0YSwKICAgICAgICAgICAgdmVyc2lvbiwKICAgICAgICAgICAgcmVxdWVzdElkLAogICAgICAgICAgICBlbmNyeXB0aW9uS2V5LAogICAgICAgICAgICBlbmNyeXB0aW9uS2V5U2hhMjU2LAogICAgICAgICAgICBlbmNyeXB0aW9uQWxnb3JpdGhtLAogICAgICAgICAgICBpZk1vZGlmaWVkU2luY2UsCiAgICAgICAgICAgIGlmVW5tb2RpZmllZFNpbmNlLAogICAgICAgICAgICBpZk1hdGNoLAogICAgICAgICAgICBpZk5vbmVNYXRjaCwKICAgICAgICAgICAgbGVhc2VJZDAKICAgICAgICBdLAogICAgICAgIHJlc3BvbnNlczogewogICAgICAgICAgICAyMDE6IHsKICAgICAgICAgICAgICAgIGhlYWRlcnNNYXBwZXI6IEJsb2JDcmVhdGVTbmFwc2hvdEhlYWRlcnMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVmYXVsdDogewogICAgICAgICAgICAgICAgYm9keU1hcHBlcjogU3RvcmFnZUVycm9yCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGlzWE1MOiB0cnVlLAogICAgICAgIHNlcmlhbGl6ZXI6IHNlcmlhbGl6ZXIkMwogICAgfTsKICAgIHZhciBzdGFydENvcHlGcm9tVVJMT3BlcmF0aW9uU3BlYyA9IHsKICAgICAgICBodHRwTWV0aG9kOiAiUFVUIiwKICAgICAgICBwYXRoOiAie2NvbnRhaW5lck5hbWV9L3tibG9ifSIsCiAgICAgICAgdXJsUGFyYW1ldGVyczogWwogICAgICAgICAgICB1cmwKICAgICAgICBdLAogICAgICAgIHF1ZXJ5UGFyYW1ldGVyczogWwogICAgICAgICAgICB0aW1lb3V0CiAgICAgICAgXSwKICAgICAgICBoZWFkZXJQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIG1ldGFkYXRhLAogICAgICAgICAgICB0aWVyMCwKICAgICAgICAgICAgcmVoeWRyYXRlUHJpb3JpdHksCiAgICAgICAgICAgIGNvcHlTb3VyY2UsCiAgICAgICAgICAgIHZlcnNpb24sCiAgICAgICAgICAgIHJlcXVlc3RJZCwKICAgICAgICAgICAgc291cmNlSWZNb2RpZmllZFNpbmNlLAogICAgICAgICAgICBzb3VyY2VJZlVubW9kaWZpZWRTaW5jZSwKICAgICAgICAgICAgc291cmNlSWZNYXRjaCwKICAgICAgICAgICAgc291cmNlSWZOb25lTWF0Y2gsCiAgICAgICAgICAgIGlmTW9kaWZpZWRTaW5jZSwKICAgICAgICAgICAgaWZVbm1vZGlmaWVkU2luY2UsCiAgICAgICAgICAgIGlmTWF0Y2gsCiAgICAgICAgICAgIGlmTm9uZU1hdGNoLAogICAgICAgICAgICBsZWFzZUlkMAogICAgICAgIF0sCiAgICAgICAgcmVzcG9uc2VzOiB7CiAgICAgICAgICAgIDIwMjogewogICAgICAgICAgICAgICAgaGVhZGVyc01hcHBlcjogQmxvYlN0YXJ0Q29weUZyb21VUkxIZWFkZXJzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICAgIGJvZHlNYXBwZXI6IFN0b3JhZ2VFcnJvcgogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBpc1hNTDogdHJ1ZSwKICAgICAgICBzZXJpYWxpemVyOiBzZXJpYWxpemVyJDMKICAgIH07CiAgICB2YXIgY29weUZyb21VUkxPcGVyYXRpb25TcGVjID0gewogICAgICAgIGh0dHBNZXRob2Q6ICJQVVQiLAogICAgICAgIHBhdGg6ICJ7Y29udGFpbmVyTmFtZX0ve2Jsb2J9IiwKICAgICAgICB1cmxQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHVybAogICAgICAgIF0sCiAgICAgICAgcXVlcnlQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHRpbWVvdXQKICAgICAgICBdLAogICAgICAgIGhlYWRlclBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgbWV0YWRhdGEsCiAgICAgICAgICAgIHRpZXIwLAogICAgICAgICAgICBjb3B5U291cmNlLAogICAgICAgICAgICB2ZXJzaW9uLAogICAgICAgICAgICByZXF1ZXN0SWQsCiAgICAgICAgICAgIHhNc1JlcXVpcmVzU3luYywKICAgICAgICAgICAgc291cmNlSWZNb2RpZmllZFNpbmNlLAogICAgICAgICAgICBzb3VyY2VJZlVubW9kaWZpZWRTaW5jZSwKICAgICAgICAgICAgc291cmNlSWZNYXRjaCwKICAgICAgICAgICAgc291cmNlSWZOb25lTWF0Y2gsCiAgICAgICAgICAgIGlmTW9kaWZpZWRTaW5jZSwKICAgICAgICAgICAgaWZVbm1vZGlmaWVkU2luY2UsCiAgICAgICAgICAgIGlmTWF0Y2gsCiAgICAgICAgICAgIGlmTm9uZU1hdGNoLAogICAgICAgICAgICBsZWFzZUlkMAogICAgICAgIF0sCiAgICAgICAgcmVzcG9uc2VzOiB7CiAgICAgICAgICAgIDIwMjogewogICAgICAgICAgICAgICAgaGVhZGVyc01hcHBlcjogQmxvYkNvcHlGcm9tVVJMSGVhZGVycwogICAgICAgICAgICB9LAogICAgICAgICAgICBkZWZhdWx0OiB7CiAgICAgICAgICAgICAgICBib2R5TWFwcGVyOiBTdG9yYWdlRXJyb3IKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgaXNYTUw6IHRydWUsCiAgICAgICAgc2VyaWFsaXplcjogc2VyaWFsaXplciQzCiAgICB9OwogICAgdmFyIGFib3J0Q29weUZyb21VUkxPcGVyYXRpb25TcGVjID0gewogICAgICAgIGh0dHBNZXRob2Q6ICJQVVQiLAogICAgICAgIHBhdGg6ICJ7Y29udGFpbmVyTmFtZX0ve2Jsb2J9IiwKICAgICAgICB1cmxQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHVybAogICAgICAgIF0sCiAgICAgICAgcXVlcnlQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIGNvcHlJZCwKICAgICAgICAgICAgdGltZW91dCwKICAgICAgICAgICAgY29tcDEwCiAgICAgICAgXSwKICAgICAgICBoZWFkZXJQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHZlcnNpb24sCiAgICAgICAgICAgIHJlcXVlc3RJZCwKICAgICAgICAgICAgY29weUFjdGlvbkFib3J0Q29uc3RhbnQsCiAgICAgICAgICAgIGxlYXNlSWQwCiAgICAgICAgXSwKICAgICAgICByZXNwb25zZXM6IHsKICAgICAgICAgICAgMjA0OiB7CiAgICAgICAgICAgICAgICBoZWFkZXJzTWFwcGVyOiBCbG9iQWJvcnRDb3B5RnJvbVVSTEhlYWRlcnMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVmYXVsdDogewogICAgICAgICAgICAgICAgYm9keU1hcHBlcjogU3RvcmFnZUVycm9yCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGlzWE1MOiB0cnVlLAogICAgICAgIHNlcmlhbGl6ZXI6IHNlcmlhbGl6ZXIkMwogICAgfTsKICAgIHZhciBzZXRUaWVyT3BlcmF0aW9uU3BlYyA9IHsKICAgICAgICBodHRwTWV0aG9kOiAiUFVUIiwKICAgICAgICBwYXRoOiAie2NvbnRhaW5lck5hbWV9L3tibG9ifSIsCiAgICAgICAgdXJsUGFyYW1ldGVyczogWwogICAgICAgICAgICB1cmwKICAgICAgICBdLAogICAgICAgIHF1ZXJ5UGFyYW1ldGVyczogWwogICAgICAgICAgICB0aW1lb3V0LAogICAgICAgICAgICBjb21wMTEKICAgICAgICBdLAogICAgICAgIGhlYWRlclBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdGllcjEsCiAgICAgICAgICAgIHJlaHlkcmF0ZVByaW9yaXR5LAogICAgICAgICAgICB2ZXJzaW9uLAogICAgICAgICAgICByZXF1ZXN0SWQsCiAgICAgICAgICAgIGxlYXNlSWQwCiAgICAgICAgXSwKICAgICAgICByZXNwb25zZXM6IHsKICAgICAgICAgICAgMjAwOiB7CiAgICAgICAgICAgICAgICBoZWFkZXJzTWFwcGVyOiBCbG9iU2V0VGllckhlYWRlcnMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgMjAyOiB7CiAgICAgICAgICAgICAgICBoZWFkZXJzTWFwcGVyOiBCbG9iU2V0VGllckhlYWRlcnMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVmYXVsdDogewogICAgICAgICAgICAgICAgYm9keU1hcHBlcjogU3RvcmFnZUVycm9yCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGlzWE1MOiB0cnVlLAogICAgICAgIHNlcmlhbGl6ZXI6IHNlcmlhbGl6ZXIkMwogICAgfTsKICAgIHZhciBnZXRBY2NvdW50SW5mb09wZXJhdGlvblNwZWMkMiA9IHsKICAgICAgICBodHRwTWV0aG9kOiAiR0VUIiwKICAgICAgICBwYXRoOiAie2NvbnRhaW5lck5hbWV9L3tibG9ifSIsCiAgICAgICAgdXJsUGFyYW1ldGVyczogWwogICAgICAgICAgICB1cmwKICAgICAgICBdLAogICAgICAgIHF1ZXJ5UGFyYW1ldGVyczogWwogICAgICAgICAgICByZXN0eXBlMSwKICAgICAgICAgICAgY29tcDAKICAgICAgICBdLAogICAgICAgIGhlYWRlclBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdmVyc2lvbgogICAgICAgIF0sCiAgICAgICAgcmVzcG9uc2VzOiB7CiAgICAgICAgICAgIDIwMDogewogICAgICAgICAgICAgICAgaGVhZGVyc01hcHBlcjogQmxvYkdldEFjY291bnRJbmZvSGVhZGVycwogICAgICAgICAgICB9LAogICAgICAgICAgICBkZWZhdWx0OiB7CiAgICAgICAgICAgICAgICBib2R5TWFwcGVyOiBTdG9yYWdlRXJyb3IKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgaXNYTUw6IHRydWUsCiAgICAgICAgc2VyaWFsaXplcjogc2VyaWFsaXplciQzCiAgICB9OwoKICAgIC8qCiAgICAgKiBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICAgICAqIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS4gU2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24uCiAgICAgKgogICAgICogQ29kZSBnZW5lcmF0ZWQgYnkgTWljcm9zb2Z0IChSKSBBdXRvUmVzdCBDb2RlIEdlbmVyYXRvci4KICAgICAqIENoYW5nZXMgbWF5IGNhdXNlIGluY29ycmVjdCBiZWhhdmlvciBhbmQgd2lsbCBiZSBsb3N0IGlmIHRoZSBjb2RlIGlzIHJlZ2VuZXJhdGVkLgogICAgICovCgogICAgdmFyIE1hcHBlcnMkMyA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICAgICAgICBDbGVhclJhbmdlOiBDbGVhclJhbmdlLAogICAgICAgIFBhZ2VCbG9iQ2xlYXJQYWdlc0hlYWRlcnM6IFBhZ2VCbG9iQ2xlYXJQYWdlc0hlYWRlcnMsCiAgICAgICAgUGFnZUJsb2JDb3B5SW5jcmVtZW50YWxIZWFkZXJzOiBQYWdlQmxvYkNvcHlJbmNyZW1lbnRhbEhlYWRlcnMsCiAgICAgICAgUGFnZUJsb2JDcmVhdGVIZWFkZXJzOiBQYWdlQmxvYkNyZWF0ZUhlYWRlcnMsCiAgICAgICAgUGFnZUJsb2JHZXRQYWdlUmFuZ2VzRGlmZkhlYWRlcnM6IFBhZ2VCbG9iR2V0UGFnZVJhbmdlc0RpZmZIZWFkZXJzLAogICAgICAgIFBhZ2VCbG9iR2V0UGFnZVJhbmdlc0hlYWRlcnM6IFBhZ2VCbG9iR2V0UGFnZVJhbmdlc0hlYWRlcnMsCiAgICAgICAgUGFnZUJsb2JSZXNpemVIZWFkZXJzOiBQYWdlQmxvYlJlc2l6ZUhlYWRlcnMsCiAgICAgICAgUGFnZUJsb2JVcGRhdGVTZXF1ZW5jZU51bWJlckhlYWRlcnM6IFBhZ2VCbG9iVXBkYXRlU2VxdWVuY2VOdW1iZXJIZWFkZXJzLAogICAgICAgIFBhZ2VCbG9iVXBsb2FkUGFnZXNGcm9tVVJMSGVhZGVyczogUGFnZUJsb2JVcGxvYWRQYWdlc0Zyb21VUkxIZWFkZXJzLAogICAgICAgIFBhZ2VCbG9iVXBsb2FkUGFnZXNIZWFkZXJzOiBQYWdlQmxvYlVwbG9hZFBhZ2VzSGVhZGVycywKICAgICAgICBQYWdlTGlzdDogUGFnZUxpc3QsCiAgICAgICAgUGFnZVJhbmdlOiBQYWdlUmFuZ2UsCiAgICAgICAgU3RvcmFnZUVycm9yOiBTdG9yYWdlRXJyb3IKICAgIH0pOwoKICAgIC8qCiAgICAgKiBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICAgICAqIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS4gU2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yCiAgICAgKiBsaWNlbnNlIGluZm9ybWF0aW9uLgogICAgICoKICAgICAqIENvZGUgZ2VuZXJhdGVkIGJ5IE1pY3Jvc29mdCAoUikgQXV0b1Jlc3QgQ29kZSBHZW5lcmF0b3IuCiAgICAgKiBDaGFuZ2VzIG1heSBjYXVzZSBpbmNvcnJlY3QgYmVoYXZpb3IgYW5kIHdpbGwgYmUgbG9zdCBpZiB0aGUgY29kZSBpcwogICAgICogcmVnZW5lcmF0ZWQuCiAgICAgKi8KICAgIC8qKiBDbGFzcyByZXByZXNlbnRpbmcgYSBQYWdlQmxvYi4gKi8KICAgIHZhciBQYWdlQmxvYiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGUgYSBQYWdlQmxvYi4KICAgICAgICAgKiBAcGFyYW0ge1N0b3JhZ2VDbGllbnRDb250ZXh0fSBjbGllbnQgUmVmZXJlbmNlIHRvIHRoZSBzZXJ2aWNlIGNsaWVudC4KICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBQYWdlQmxvYihjbGllbnQpIHsKICAgICAgICAgICAgdGhpcy5jbGllbnQgPSBjbGllbnQ7CiAgICAgICAgfQogICAgICAgIFBhZ2VCbG9iLnByb3RvdHlwZS5jcmVhdGUgPSBmdW5jdGlvbiAoY29udGVudExlbmd0aCwgYmxvYkNvbnRlbnRMZW5ndGgsIG9wdGlvbnMsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNsaWVudC5zZW5kT3BlcmF0aW9uUmVxdWVzdCh7CiAgICAgICAgICAgICAgICBjb250ZW50TGVuZ3RoOiBjb250ZW50TGVuZ3RoLAogICAgICAgICAgICAgICAgYmxvYkNvbnRlbnRMZW5ndGg6IGJsb2JDb250ZW50TGVuZ3RoLAogICAgICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucwogICAgICAgICAgICB9LCBjcmVhdGVPcGVyYXRpb25TcGVjJDEsIGNhbGxiYWNrKTsKICAgICAgICB9OwogICAgICAgIFBhZ2VCbG9iLnByb3RvdHlwZS51cGxvYWRQYWdlcyA9IGZ1bmN0aW9uIChib2R5LCBjb250ZW50TGVuZ3RoLCBvcHRpb25zLCBjYWxsYmFjaykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jbGllbnQuc2VuZE9wZXJhdGlvblJlcXVlc3QoewogICAgICAgICAgICAgICAgYm9keTogYm9keSwKICAgICAgICAgICAgICAgIGNvbnRlbnRMZW5ndGg6IGNvbnRlbnRMZW5ndGgsCiAgICAgICAgICAgICAgICBvcHRpb25zOiBvcHRpb25zCiAgICAgICAgICAgIH0sIHVwbG9hZFBhZ2VzT3BlcmF0aW9uU3BlYywgY2FsbGJhY2spOwogICAgICAgIH07CiAgICAgICAgUGFnZUJsb2IucHJvdG90eXBlLmNsZWFyUGFnZXMgPSBmdW5jdGlvbiAoY29udGVudExlbmd0aCwgb3B0aW9ucywgY2FsbGJhY2spIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2xpZW50LnNlbmRPcGVyYXRpb25SZXF1ZXN0KHsKICAgICAgICAgICAgICAgIGNvbnRlbnRMZW5ndGg6IGNvbnRlbnRMZW5ndGgsCiAgICAgICAgICAgICAgICBvcHRpb25zOiBvcHRpb25zCiAgICAgICAgICAgIH0sIGNsZWFyUGFnZXNPcGVyYXRpb25TcGVjLCBjYWxsYmFjayk7CiAgICAgICAgfTsKICAgICAgICBQYWdlQmxvYi5wcm90b3R5cGUudXBsb2FkUGFnZXNGcm9tVVJMID0gZnVuY3Rpb24gKHNvdXJjZVVybCwgc291cmNlUmFuZ2UsIGNvbnRlbnRMZW5ndGgsIHJhbmdlLCBvcHRpb25zLCBjYWxsYmFjaykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jbGllbnQuc2VuZE9wZXJhdGlvblJlcXVlc3QoewogICAgICAgICAgICAgICAgc291cmNlVXJsOiBzb3VyY2VVcmwsCiAgICAgICAgICAgICAgICBzb3VyY2VSYW5nZTogc291cmNlUmFuZ2UsCiAgICAgICAgICAgICAgICBjb250ZW50TGVuZ3RoOiBjb250ZW50TGVuZ3RoLAogICAgICAgICAgICAgICAgcmFuZ2U6IHJhbmdlLAogICAgICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucwogICAgICAgICAgICB9LCB1cGxvYWRQYWdlc0Zyb21VUkxPcGVyYXRpb25TcGVjLCBjYWxsYmFjayk7CiAgICAgICAgfTsKICAgICAgICBQYWdlQmxvYi5wcm90b3R5cGUuZ2V0UGFnZVJhbmdlcyA9IGZ1bmN0aW9uIChvcHRpb25zLCBjYWxsYmFjaykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jbGllbnQuc2VuZE9wZXJhdGlvblJlcXVlc3QoewogICAgICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucwogICAgICAgICAgICB9LCBnZXRQYWdlUmFuZ2VzT3BlcmF0aW9uU3BlYywgY2FsbGJhY2spOwogICAgICAgIH07CiAgICAgICAgUGFnZUJsb2IucHJvdG90eXBlLmdldFBhZ2VSYW5nZXNEaWZmID0gZnVuY3Rpb24gKG9wdGlvbnMsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNsaWVudC5zZW5kT3BlcmF0aW9uUmVxdWVzdCh7CiAgICAgICAgICAgICAgICBvcHRpb25zOiBvcHRpb25zCiAgICAgICAgICAgIH0sIGdldFBhZ2VSYW5nZXNEaWZmT3BlcmF0aW9uU3BlYywgY2FsbGJhY2spOwogICAgICAgIH07CiAgICAgICAgUGFnZUJsb2IucHJvdG90eXBlLnJlc2l6ZSA9IGZ1bmN0aW9uIChibG9iQ29udGVudExlbmd0aCwgb3B0aW9ucywgY2FsbGJhY2spIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2xpZW50LnNlbmRPcGVyYXRpb25SZXF1ZXN0KHsKICAgICAgICAgICAgICAgIGJsb2JDb250ZW50TGVuZ3RoOiBibG9iQ29udGVudExlbmd0aCwKICAgICAgICAgICAgICAgIG9wdGlvbnM6IG9wdGlvbnMKICAgICAgICAgICAgfSwgcmVzaXplT3BlcmF0aW9uU3BlYywgY2FsbGJhY2spOwogICAgICAgIH07CiAgICAgICAgUGFnZUJsb2IucHJvdG90eXBlLnVwZGF0ZVNlcXVlbmNlTnVtYmVyID0gZnVuY3Rpb24gKHNlcXVlbmNlTnVtYmVyQWN0aW9uLCBvcHRpb25zLCBjYWxsYmFjaykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jbGllbnQuc2VuZE9wZXJhdGlvblJlcXVlc3QoewogICAgICAgICAgICAgICAgc2VxdWVuY2VOdW1iZXJBY3Rpb246IHNlcXVlbmNlTnVtYmVyQWN0aW9uLAogICAgICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucwogICAgICAgICAgICB9LCB1cGRhdGVTZXF1ZW5jZU51bWJlck9wZXJhdGlvblNwZWMsIGNhbGxiYWNrKTsKICAgICAgICB9OwogICAgICAgIFBhZ2VCbG9iLnByb3RvdHlwZS5jb3B5SW5jcmVtZW50YWwgPSBmdW5jdGlvbiAoY29weVNvdXJjZSwgb3B0aW9ucywgY2FsbGJhY2spIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2xpZW50LnNlbmRPcGVyYXRpb25SZXF1ZXN0KHsKICAgICAgICAgICAgICAgIGNvcHlTb3VyY2U6IGNvcHlTb3VyY2UsCiAgICAgICAgICAgICAgICBvcHRpb25zOiBvcHRpb25zCiAgICAgICAgICAgIH0sIGNvcHlJbmNyZW1lbnRhbE9wZXJhdGlvblNwZWMsIGNhbGxiYWNrKTsKICAgICAgICB9OwogICAgICAgIHJldHVybiBQYWdlQmxvYjsKICAgIH0oKSk7CiAgICAvLyBPcGVyYXRpb24gU3BlY2lmaWNhdGlvbnMKICAgIHZhciBzZXJpYWxpemVyJDQgPSBuZXcgU2VyaWFsaXplcihNYXBwZXJzJDMsIHRydWUpOwogICAgdmFyIGNyZWF0ZU9wZXJhdGlvblNwZWMkMSA9IHsKICAgICAgICBodHRwTWV0aG9kOiAiUFVUIiwKICAgICAgICBwYXRoOiAie2NvbnRhaW5lck5hbWV9L3tibG9ifSIsCiAgICAgICAgdXJsUGFyYW1ldGVyczogWwogICAgICAgICAgICB1cmwKICAgICAgICBdLAogICAgICAgIHF1ZXJ5UGFyYW1ldGVyczogWwogICAgICAgICAgICB0aW1lb3V0CiAgICAgICAgXSwKICAgICAgICBoZWFkZXJQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIGNvbnRlbnRMZW5ndGgsCiAgICAgICAgICAgIG1ldGFkYXRhLAogICAgICAgICAgICBibG9iQ29udGVudExlbmd0aCwKICAgICAgICAgICAgYmxvYlNlcXVlbmNlTnVtYmVyLAogICAgICAgICAgICB2ZXJzaW9uLAogICAgICAgICAgICByZXF1ZXN0SWQsCiAgICAgICAgICAgIHRpZXIwLAogICAgICAgICAgICBibG9iVHlwZTAsCiAgICAgICAgICAgIGJsb2JDb250ZW50VHlwZSwKICAgICAgICAgICAgYmxvYkNvbnRlbnRFbmNvZGluZywKICAgICAgICAgICAgYmxvYkNvbnRlbnRMYW5ndWFnZSwKICAgICAgICAgICAgYmxvYkNvbnRlbnRNRDUsCiAgICAgICAgICAgIGJsb2JDYWNoZUNvbnRyb2wsCiAgICAgICAgICAgIGJsb2JDb250ZW50RGlzcG9zaXRpb24sCiAgICAgICAgICAgIGxlYXNlSWQwLAogICAgICAgICAgICBlbmNyeXB0aW9uS2V5LAogICAgICAgICAgICBlbmNyeXB0aW9uS2V5U2hhMjU2LAogICAgICAgICAgICBlbmNyeXB0aW9uQWxnb3JpdGhtLAogICAgICAgICAgICBpZk1vZGlmaWVkU2luY2UsCiAgICAgICAgICAgIGlmVW5tb2RpZmllZFNpbmNlLAogICAgICAgICAgICBpZk1hdGNoLAogICAgICAgICAgICBpZk5vbmVNYXRjaAogICAgICAgIF0sCiAgICAgICAgcmVzcG9uc2VzOiB7CiAgICAgICAgICAgIDIwMTogewogICAgICAgICAgICAgICAgaGVhZGVyc01hcHBlcjogUGFnZUJsb2JDcmVhdGVIZWFkZXJzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICAgIGJvZHlNYXBwZXI6IFN0b3JhZ2VFcnJvcgogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBpc1hNTDogdHJ1ZSwKICAgICAgICBzZXJpYWxpemVyOiBzZXJpYWxpemVyJDQKICAgIH07CiAgICB2YXIgdXBsb2FkUGFnZXNPcGVyYXRpb25TcGVjID0gewogICAgICAgIGh0dHBNZXRob2Q6ICJQVVQiLAogICAgICAgIHBhdGg6ICJ7Y29udGFpbmVyTmFtZX0ve2Jsb2J9IiwKICAgICAgICB1cmxQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHVybAogICAgICAgIF0sCiAgICAgICAgcXVlcnlQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHRpbWVvdXQsCiAgICAgICAgICAgIGNvbXAxMgogICAgICAgIF0sCiAgICAgICAgaGVhZGVyUGFyYW1ldGVyczogWwogICAgICAgICAgICBjb250ZW50TGVuZ3RoLAogICAgICAgICAgICB0cmFuc2FjdGlvbmFsQ29udGVudE1ENSwKICAgICAgICAgICAgdHJhbnNhY3Rpb25hbENvbnRlbnRDcmM2NCwKICAgICAgICAgICAgcmFuZ2UwLAogICAgICAgICAgICB2ZXJzaW9uLAogICAgICAgICAgICByZXF1ZXN0SWQsCiAgICAgICAgICAgIHBhZ2VXcml0ZTAsCiAgICAgICAgICAgIGxlYXNlSWQwLAogICAgICAgICAgICBlbmNyeXB0aW9uS2V5LAogICAgICAgICAgICBlbmNyeXB0aW9uS2V5U2hhMjU2LAogICAgICAgICAgICBlbmNyeXB0aW9uQWxnb3JpdGhtLAogICAgICAgICAgICBpZlNlcXVlbmNlTnVtYmVyTGVzc1RoYW5PckVxdWFsVG8sCiAgICAgICAgICAgIGlmU2VxdWVuY2VOdW1iZXJMZXNzVGhhbiwKICAgICAgICAgICAgaWZTZXF1ZW5jZU51bWJlckVxdWFsVG8sCiAgICAgICAgICAgIGlmTW9kaWZpZWRTaW5jZSwKICAgICAgICAgICAgaWZVbm1vZGlmaWVkU2luY2UsCiAgICAgICAgICAgIGlmTWF0Y2gsCiAgICAgICAgICAgIGlmTm9uZU1hdGNoCiAgICAgICAgXSwKICAgICAgICByZXF1ZXN0Qm9keTogewogICAgICAgICAgICBwYXJhbWV0ZXJQYXRoOiAiYm9keSIsCiAgICAgICAgICAgIG1hcHBlcjogewogICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImJvZHkiLAogICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJlYW0iCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGNvbnRlbnRUeXBlOiAiYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtIiwKICAgICAgICByZXNwb25zZXM6IHsKICAgICAgICAgICAgMjAxOiB7CiAgICAgICAgICAgICAgICBoZWFkZXJzTWFwcGVyOiBQYWdlQmxvYlVwbG9hZFBhZ2VzSGVhZGVycwogICAgICAgICAgICB9LAogICAgICAgICAgICBkZWZhdWx0OiB7CiAgICAgICAgICAgICAgICBib2R5TWFwcGVyOiBTdG9yYWdlRXJyb3IKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgaXNYTUw6IHRydWUsCiAgICAgICAgc2VyaWFsaXplcjogc2VyaWFsaXplciQ0CiAgICB9OwogICAgdmFyIGNsZWFyUGFnZXNPcGVyYXRpb25TcGVjID0gewogICAgICAgIGh0dHBNZXRob2Q6ICJQVVQiLAogICAgICAgIHBhdGg6ICJ7Y29udGFpbmVyTmFtZX0ve2Jsb2J9IiwKICAgICAgICB1cmxQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHVybAogICAgICAgIF0sCiAgICAgICAgcXVlcnlQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHRpbWVvdXQsCiAgICAgICAgICAgIGNvbXAxMgogICAgICAgIF0sCiAgICAgICAgaGVhZGVyUGFyYW1ldGVyczogWwogICAgICAgICAgICBjb250ZW50TGVuZ3RoLAogICAgICAgICAgICByYW5nZTAsCiAgICAgICAgICAgIHZlcnNpb24sCiAgICAgICAgICAgIHJlcXVlc3RJZCwKICAgICAgICAgICAgcGFnZVdyaXRlMSwKICAgICAgICAgICAgbGVhc2VJZDAsCiAgICAgICAgICAgIGVuY3J5cHRpb25LZXksCiAgICAgICAgICAgIGVuY3J5cHRpb25LZXlTaGEyNTYsCiAgICAgICAgICAgIGVuY3J5cHRpb25BbGdvcml0aG0sCiAgICAgICAgICAgIGlmU2VxdWVuY2VOdW1iZXJMZXNzVGhhbk9yRXF1YWxUbywKICAgICAgICAgICAgaWZTZXF1ZW5jZU51bWJlckxlc3NUaGFuLAogICAgICAgICAgICBpZlNlcXVlbmNlTnVtYmVyRXF1YWxUbywKICAgICAgICAgICAgaWZNb2RpZmllZFNpbmNlLAogICAgICAgICAgICBpZlVubW9kaWZpZWRTaW5jZSwKICAgICAgICAgICAgaWZNYXRjaCwKICAgICAgICAgICAgaWZOb25lTWF0Y2gKICAgICAgICBdLAogICAgICAgIHJlc3BvbnNlczogewogICAgICAgICAgICAyMDE6IHsKICAgICAgICAgICAgICAgIGhlYWRlcnNNYXBwZXI6IFBhZ2VCbG9iQ2xlYXJQYWdlc0hlYWRlcnMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVmYXVsdDogewogICAgICAgICAgICAgICAgYm9keU1hcHBlcjogU3RvcmFnZUVycm9yCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGlzWE1MOiB0cnVlLAogICAgICAgIHNlcmlhbGl6ZXI6IHNlcmlhbGl6ZXIkNAogICAgfTsKICAgIHZhciB1cGxvYWRQYWdlc0Zyb21VUkxPcGVyYXRpb25TcGVjID0gewogICAgICAgIGh0dHBNZXRob2Q6ICJQVVQiLAogICAgICAgIHBhdGg6ICJ7Y29udGFpbmVyTmFtZX0ve2Jsb2J9IiwKICAgICAgICB1cmxQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHVybAogICAgICAgIF0sCiAgICAgICAgcXVlcnlQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHRpbWVvdXQsCiAgICAgICAgICAgIGNvbXAxMgogICAgICAgIF0sCiAgICAgICAgaGVhZGVyUGFyYW1ldGVyczogWwogICAgICAgICAgICBzb3VyY2VVcmwsCiAgICAgICAgICAgIHNvdXJjZVJhbmdlMCwKICAgICAgICAgICAgc291cmNlQ29udGVudE1ENSwKICAgICAgICAgICAgc291cmNlQ29udGVudENyYzY0LAogICAgICAgICAgICBjb250ZW50TGVuZ3RoLAogICAgICAgICAgICByYW5nZTEsCiAgICAgICAgICAgIHZlcnNpb24sCiAgICAgICAgICAgIHJlcXVlc3RJZCwKICAgICAgICAgICAgcGFnZVdyaXRlMCwKICAgICAgICAgICAgZW5jcnlwdGlvbktleSwKICAgICAgICAgICAgZW5jcnlwdGlvbktleVNoYTI1NiwKICAgICAgICAgICAgZW5jcnlwdGlvbkFsZ29yaXRobSwKICAgICAgICAgICAgbGVhc2VJZDAsCiAgICAgICAgICAgIGlmU2VxdWVuY2VOdW1iZXJMZXNzVGhhbk9yRXF1YWxUbywKICAgICAgICAgICAgaWZTZXF1ZW5jZU51bWJlckxlc3NUaGFuLAogICAgICAgICAgICBpZlNlcXVlbmNlTnVtYmVyRXF1YWxUbywKICAgICAgICAgICAgaWZNb2RpZmllZFNpbmNlLAogICAgICAgICAgICBpZlVubW9kaWZpZWRTaW5jZSwKICAgICAgICAgICAgaWZNYXRjaCwKICAgICAgICAgICAgaWZOb25lTWF0Y2gsCiAgICAgICAgICAgIHNvdXJjZUlmTW9kaWZpZWRTaW5jZSwKICAgICAgICAgICAgc291cmNlSWZVbm1vZGlmaWVkU2luY2UsCiAgICAgICAgICAgIHNvdXJjZUlmTWF0Y2gsCiAgICAgICAgICAgIHNvdXJjZUlmTm9uZU1hdGNoCiAgICAgICAgXSwKICAgICAgICByZXNwb25zZXM6IHsKICAgICAgICAgICAgMjAxOiB7CiAgICAgICAgICAgICAgICBoZWFkZXJzTWFwcGVyOiBQYWdlQmxvYlVwbG9hZFBhZ2VzRnJvbVVSTEhlYWRlcnMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVmYXVsdDogewogICAgICAgICAgICAgICAgYm9keU1hcHBlcjogU3RvcmFnZUVycm9yCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGlzWE1MOiB0cnVlLAogICAgICAgIHNlcmlhbGl6ZXI6IHNlcmlhbGl6ZXIkNAogICAgfTsKICAgIHZhciBnZXRQYWdlUmFuZ2VzT3BlcmF0aW9uU3BlYyA9IHsKICAgICAgICBodHRwTWV0aG9kOiAiR0VUIiwKICAgICAgICBwYXRoOiAie2NvbnRhaW5lck5hbWV9L3tibG9ifSIsCiAgICAgICAgdXJsUGFyYW1ldGVyczogWwogICAgICAgICAgICB1cmwKICAgICAgICBdLAogICAgICAgIHF1ZXJ5UGFyYW1ldGVyczogWwogICAgICAgICAgICBzbmFwc2hvdCwKICAgICAgICAgICAgdGltZW91dCwKICAgICAgICAgICAgY29tcDEzCiAgICAgICAgXSwKICAgICAgICBoZWFkZXJQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHJhbmdlMCwKICAgICAgICAgICAgdmVyc2lvbiwKICAgICAgICAgICAgcmVxdWVzdElkLAogICAgICAgICAgICBsZWFzZUlkMCwKICAgICAgICAgICAgaWZNb2RpZmllZFNpbmNlLAogICAgICAgICAgICBpZlVubW9kaWZpZWRTaW5jZSwKICAgICAgICAgICAgaWZNYXRjaCwKICAgICAgICAgICAgaWZOb25lTWF0Y2gKICAgICAgICBdLAogICAgICAgIHJlc3BvbnNlczogewogICAgICAgICAgICAyMDA6IHsKICAgICAgICAgICAgICAgIGJvZHlNYXBwZXI6IFBhZ2VMaXN0LAogICAgICAgICAgICAgICAgaGVhZGVyc01hcHBlcjogUGFnZUJsb2JHZXRQYWdlUmFuZ2VzSGVhZGVycwogICAgICAgICAgICB9LAogICAgICAgICAgICBkZWZhdWx0OiB7CiAgICAgICAgICAgICAgICBib2R5TWFwcGVyOiBTdG9yYWdlRXJyb3IKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgaXNYTUw6IHRydWUsCiAgICAgICAgc2VyaWFsaXplcjogc2VyaWFsaXplciQ0CiAgICB9OwogICAgdmFyIGdldFBhZ2VSYW5nZXNEaWZmT3BlcmF0aW9uU3BlYyA9IHsKICAgICAgICBodHRwTWV0aG9kOiAiR0VUIiwKICAgICAgICBwYXRoOiAie2NvbnRhaW5lck5hbWV9L3tibG9ifSIsCiAgICAgICAgdXJsUGFyYW1ldGVyczogWwogICAgICAgICAgICB1cmwKICAgICAgICBdLAogICAgICAgIHF1ZXJ5UGFyYW1ldGVyczogWwogICAgICAgICAgICBzbmFwc2hvdCwKICAgICAgICAgICAgdGltZW91dCwKICAgICAgICAgICAgcHJldnNuYXBzaG90LAogICAgICAgICAgICBjb21wMTMKICAgICAgICBdLAogICAgICAgIGhlYWRlclBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgcmFuZ2UwLAogICAgICAgICAgICB2ZXJzaW9uLAogICAgICAgICAgICByZXF1ZXN0SWQsCiAgICAgICAgICAgIGxlYXNlSWQwLAogICAgICAgICAgICBpZk1vZGlmaWVkU2luY2UsCiAgICAgICAgICAgIGlmVW5tb2RpZmllZFNpbmNlLAogICAgICAgICAgICBpZk1hdGNoLAogICAgICAgICAgICBpZk5vbmVNYXRjaAogICAgICAgIF0sCiAgICAgICAgcmVzcG9uc2VzOiB7CiAgICAgICAgICAgIDIwMDogewogICAgICAgICAgICAgICAgYm9keU1hcHBlcjogUGFnZUxpc3QsCiAgICAgICAgICAgICAgICBoZWFkZXJzTWFwcGVyOiBQYWdlQmxvYkdldFBhZ2VSYW5nZXNEaWZmSGVhZGVycwogICAgICAgICAgICB9LAogICAgICAgICAgICBkZWZhdWx0OiB7CiAgICAgICAgICAgICAgICBib2R5TWFwcGVyOiBTdG9yYWdlRXJyb3IKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgaXNYTUw6IHRydWUsCiAgICAgICAgc2VyaWFsaXplcjogc2VyaWFsaXplciQ0CiAgICB9OwogICAgdmFyIHJlc2l6ZU9wZXJhdGlvblNwZWMgPSB7CiAgICAgICAgaHR0cE1ldGhvZDogIlBVVCIsCiAgICAgICAgcGF0aDogIntjb250YWluZXJOYW1lfS97YmxvYn0iLAogICAgICAgIHVybFBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdXJsCiAgICAgICAgXSwKICAgICAgICBxdWVyeVBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdGltZW91dCwKICAgICAgICAgICAgY29tcDAKICAgICAgICBdLAogICAgICAgIGhlYWRlclBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgYmxvYkNvbnRlbnRMZW5ndGgsCiAgICAgICAgICAgIHZlcnNpb24sCiAgICAgICAgICAgIHJlcXVlc3RJZCwKICAgICAgICAgICAgbGVhc2VJZDAsCiAgICAgICAgICAgIGVuY3J5cHRpb25LZXksCiAgICAgICAgICAgIGVuY3J5cHRpb25LZXlTaGEyNTYsCiAgICAgICAgICAgIGVuY3J5cHRpb25BbGdvcml0aG0sCiAgICAgICAgICAgIGlmTW9kaWZpZWRTaW5jZSwKICAgICAgICAgICAgaWZVbm1vZGlmaWVkU2luY2UsCiAgICAgICAgICAgIGlmTWF0Y2gsCiAgICAgICAgICAgIGlmTm9uZU1hdGNoCiAgICAgICAgXSwKICAgICAgICByZXNwb25zZXM6IHsKICAgICAgICAgICAgMjAwOiB7CiAgICAgICAgICAgICAgICBoZWFkZXJzTWFwcGVyOiBQYWdlQmxvYlJlc2l6ZUhlYWRlcnMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVmYXVsdDogewogICAgICAgICAgICAgICAgYm9keU1hcHBlcjogU3RvcmFnZUVycm9yCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGlzWE1MOiB0cnVlLAogICAgICAgIHNlcmlhbGl6ZXI6IHNlcmlhbGl6ZXIkNAogICAgfTsKICAgIHZhciB1cGRhdGVTZXF1ZW5jZU51bWJlck9wZXJhdGlvblNwZWMgPSB7CiAgICAgICAgaHR0cE1ldGhvZDogIlBVVCIsCiAgICAgICAgcGF0aDogIntjb250YWluZXJOYW1lfS97YmxvYn0iLAogICAgICAgIHVybFBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdXJsCiAgICAgICAgXSwKICAgICAgICBxdWVyeVBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdGltZW91dCwKICAgICAgICAgICAgY29tcDAKICAgICAgICBdLAogICAgICAgIGhlYWRlclBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgc2VxdWVuY2VOdW1iZXJBY3Rpb24sCiAgICAgICAgICAgIGJsb2JTZXF1ZW5jZU51bWJlciwKICAgICAgICAgICAgdmVyc2lvbiwKICAgICAgICAgICAgcmVxdWVzdElkLAogICAgICAgICAgICBsZWFzZUlkMCwKICAgICAgICAgICAgaWZNb2RpZmllZFNpbmNlLAogICAgICAgICAgICBpZlVubW9kaWZpZWRTaW5jZSwKICAgICAgICAgICAgaWZNYXRjaCwKICAgICAgICAgICAgaWZOb25lTWF0Y2gKICAgICAgICBdLAogICAgICAgIHJlc3BvbnNlczogewogICAgICAgICAgICAyMDA6IHsKICAgICAgICAgICAgICAgIGhlYWRlcnNNYXBwZXI6IFBhZ2VCbG9iVXBkYXRlU2VxdWVuY2VOdW1iZXJIZWFkZXJzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICAgIGJvZHlNYXBwZXI6IFN0b3JhZ2VFcnJvcgogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBpc1hNTDogdHJ1ZSwKICAgICAgICBzZXJpYWxpemVyOiBzZXJpYWxpemVyJDQKICAgIH07CiAgICB2YXIgY29weUluY3JlbWVudGFsT3BlcmF0aW9uU3BlYyA9IHsKICAgICAgICBodHRwTWV0aG9kOiAiUFVUIiwKICAgICAgICBwYXRoOiAie2NvbnRhaW5lck5hbWV9L3tibG9ifSIsCiAgICAgICAgdXJsUGFyYW1ldGVyczogWwogICAgICAgICAgICB1cmwKICAgICAgICBdLAogICAgICAgIHF1ZXJ5UGFyYW1ldGVyczogWwogICAgICAgICAgICB0aW1lb3V0LAogICAgICAgICAgICBjb21wMTQKICAgICAgICBdLAogICAgICAgIGhlYWRlclBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgY29weVNvdXJjZSwKICAgICAgICAgICAgdmVyc2lvbiwKICAgICAgICAgICAgcmVxdWVzdElkLAogICAgICAgICAgICBpZk1vZGlmaWVkU2luY2UsCiAgICAgICAgICAgIGlmVW5tb2RpZmllZFNpbmNlLAogICAgICAgICAgICBpZk1hdGNoLAogICAgICAgICAgICBpZk5vbmVNYXRjaAogICAgICAgIF0sCiAgICAgICAgcmVzcG9uc2VzOiB7CiAgICAgICAgICAgIDIwMjogewogICAgICAgICAgICAgICAgaGVhZGVyc01hcHBlcjogUGFnZUJsb2JDb3B5SW5jcmVtZW50YWxIZWFkZXJzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICAgIGJvZHlNYXBwZXI6IFN0b3JhZ2VFcnJvcgogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBpc1hNTDogdHJ1ZSwKICAgICAgICBzZXJpYWxpemVyOiBzZXJpYWxpemVyJDQKICAgIH07CgogICAgLyoKICAgICAqIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogICAgICogTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi4KICAgICAqCiAgICAgKiBDb2RlIGdlbmVyYXRlZCBieSBNaWNyb3NvZnQgKFIpIEF1dG9SZXN0IENvZGUgR2VuZXJhdG9yLgogICAgICogQ2hhbmdlcyBtYXkgY2F1c2UgaW5jb3JyZWN0IGJlaGF2aW9yIGFuZCB3aWxsIGJlIGxvc3QgaWYgdGhlIGNvZGUgaXMgcmVnZW5lcmF0ZWQuCiAgICAgKi8KCiAgICB2YXIgTWFwcGVycyQ0ID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogICAgICAgIEFwcGVuZEJsb2JBcHBlbmRCbG9ja0Zyb21VcmxIZWFkZXJzOiBBcHBlbmRCbG9iQXBwZW5kQmxvY2tGcm9tVXJsSGVhZGVycywKICAgICAgICBBcHBlbmRCbG9iQXBwZW5kQmxvY2tIZWFkZXJzOiBBcHBlbmRCbG9iQXBwZW5kQmxvY2tIZWFkZXJzLAogICAgICAgIEFwcGVuZEJsb2JDcmVhdGVIZWFkZXJzOiBBcHBlbmRCbG9iQ3JlYXRlSGVhZGVycywKICAgICAgICBTdG9yYWdlRXJyb3I6IFN0b3JhZ2VFcnJvcgogICAgfSk7CgogICAgLyoKICAgICAqIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogICAgICogTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IKICAgICAqIGxpY2Vuc2UgaW5mb3JtYXRpb24uCiAgICAgKgogICAgICogQ29kZSBnZW5lcmF0ZWQgYnkgTWljcm9zb2Z0IChSKSBBdXRvUmVzdCBDb2RlIEdlbmVyYXRvci4KICAgICAqIENoYW5nZXMgbWF5IGNhdXNlIGluY29ycmVjdCBiZWhhdmlvciBhbmQgd2lsbCBiZSBsb3N0IGlmIHRoZSBjb2RlIGlzCiAgICAgKiByZWdlbmVyYXRlZC4KICAgICAqLwogICAgLyoqIENsYXNzIHJlcHJlc2VudGluZyBhIEFwcGVuZEJsb2IuICovCiAgICB2YXIgQXBwZW5kQmxvYiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGUgYSBBcHBlbmRCbG9iLgogICAgICAgICAqIEBwYXJhbSB7U3RvcmFnZUNsaWVudENvbnRleHR9IGNsaWVudCBSZWZlcmVuY2UgdG8gdGhlIHNlcnZpY2UgY2xpZW50LgogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIEFwcGVuZEJsb2IoY2xpZW50KSB7CiAgICAgICAgICAgIHRoaXMuY2xpZW50ID0gY2xpZW50OwogICAgICAgIH0KICAgICAgICBBcHBlbmRCbG9iLnByb3RvdHlwZS5jcmVhdGUgPSBmdW5jdGlvbiAoY29udGVudExlbmd0aCwgb3B0aW9ucywgY2FsbGJhY2spIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2xpZW50LnNlbmRPcGVyYXRpb25SZXF1ZXN0KHsKICAgICAgICAgICAgICAgIGNvbnRlbnRMZW5ndGg6IGNvbnRlbnRMZW5ndGgsCiAgICAgICAgICAgICAgICBvcHRpb25zOiBvcHRpb25zCiAgICAgICAgICAgIH0sIGNyZWF0ZU9wZXJhdGlvblNwZWMkMiwgY2FsbGJhY2spOwogICAgICAgIH07CiAgICAgICAgQXBwZW5kQmxvYi5wcm90b3R5cGUuYXBwZW5kQmxvY2sgPSBmdW5jdGlvbiAoYm9keSwgY29udGVudExlbmd0aCwgb3B0aW9ucywgY2FsbGJhY2spIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2xpZW50LnNlbmRPcGVyYXRpb25SZXF1ZXN0KHsKICAgICAgICAgICAgICAgIGJvZHk6IGJvZHksCiAgICAgICAgICAgICAgICBjb250ZW50TGVuZ3RoOiBjb250ZW50TGVuZ3RoLAogICAgICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucwogICAgICAgICAgICB9LCBhcHBlbmRCbG9ja09wZXJhdGlvblNwZWMsIGNhbGxiYWNrKTsKICAgICAgICB9OwogICAgICAgIEFwcGVuZEJsb2IucHJvdG90eXBlLmFwcGVuZEJsb2NrRnJvbVVybCA9IGZ1bmN0aW9uIChzb3VyY2VVcmwsIGNvbnRlbnRMZW5ndGgsIG9wdGlvbnMsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNsaWVudC5zZW5kT3BlcmF0aW9uUmVxdWVzdCh7CiAgICAgICAgICAgICAgICBzb3VyY2VVcmw6IHNvdXJjZVVybCwKICAgICAgICAgICAgICAgIGNvbnRlbnRMZW5ndGg6IGNvbnRlbnRMZW5ndGgsCiAgICAgICAgICAgICAgICBvcHRpb25zOiBvcHRpb25zCiAgICAgICAgICAgIH0sIGFwcGVuZEJsb2NrRnJvbVVybE9wZXJhdGlvblNwZWMsIGNhbGxiYWNrKTsKICAgICAgICB9OwogICAgICAgIHJldHVybiBBcHBlbmRCbG9iOwogICAgfSgpKTsKICAgIC8vIE9wZXJhdGlvbiBTcGVjaWZpY2F0aW9ucwogICAgdmFyIHNlcmlhbGl6ZXIkNSA9IG5ldyBTZXJpYWxpemVyKE1hcHBlcnMkNCwgdHJ1ZSk7CiAgICB2YXIgY3JlYXRlT3BlcmF0aW9uU3BlYyQyID0gewogICAgICAgIGh0dHBNZXRob2Q6ICJQVVQiLAogICAgICAgIHBhdGg6ICJ7Y29udGFpbmVyTmFtZX0ve2Jsb2J9IiwKICAgICAgICB1cmxQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHVybAogICAgICAgIF0sCiAgICAgICAgcXVlcnlQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHRpbWVvdXQKICAgICAgICBdLAogICAgICAgIGhlYWRlclBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgY29udGVudExlbmd0aCwKICAgICAgICAgICAgbWV0YWRhdGEsCiAgICAgICAgICAgIHZlcnNpb24sCiAgICAgICAgICAgIHJlcXVlc3RJZCwKICAgICAgICAgICAgYmxvYlR5cGUxLAogICAgICAgICAgICBibG9iQ29udGVudFR5cGUsCiAgICAgICAgICAgIGJsb2JDb250ZW50RW5jb2RpbmcsCiAgICAgICAgICAgIGJsb2JDb250ZW50TGFuZ3VhZ2UsCiAgICAgICAgICAgIGJsb2JDb250ZW50TUQ1LAogICAgICAgICAgICBibG9iQ2FjaGVDb250cm9sLAogICAgICAgICAgICBibG9iQ29udGVudERpc3Bvc2l0aW9uLAogICAgICAgICAgICBsZWFzZUlkMCwKICAgICAgICAgICAgZW5jcnlwdGlvbktleSwKICAgICAgICAgICAgZW5jcnlwdGlvbktleVNoYTI1NiwKICAgICAgICAgICAgZW5jcnlwdGlvbkFsZ29yaXRobSwKICAgICAgICAgICAgaWZNb2RpZmllZFNpbmNlLAogICAgICAgICAgICBpZlVubW9kaWZpZWRTaW5jZSwKICAgICAgICAgICAgaWZNYXRjaCwKICAgICAgICAgICAgaWZOb25lTWF0Y2gKICAgICAgICBdLAogICAgICAgIHJlc3BvbnNlczogewogICAgICAgICAgICAyMDE6IHsKICAgICAgICAgICAgICAgIGhlYWRlcnNNYXBwZXI6IEFwcGVuZEJsb2JDcmVhdGVIZWFkZXJzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICAgIGJvZHlNYXBwZXI6IFN0b3JhZ2VFcnJvcgogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBpc1hNTDogdHJ1ZSwKICAgICAgICBzZXJpYWxpemVyOiBzZXJpYWxpemVyJDUKICAgIH07CiAgICB2YXIgYXBwZW5kQmxvY2tPcGVyYXRpb25TcGVjID0gewogICAgICAgIGh0dHBNZXRob2Q6ICJQVVQiLAogICAgICAgIHBhdGg6ICJ7Y29udGFpbmVyTmFtZX0ve2Jsb2J9IiwKICAgICAgICB1cmxQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHVybAogICAgICAgIF0sCiAgICAgICAgcXVlcnlQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHRpbWVvdXQsCiAgICAgICAgICAgIGNvbXAxNQogICAgICAgIF0sCiAgICAgICAgaGVhZGVyUGFyYW1ldGVyczogWwogICAgICAgICAgICBjb250ZW50TGVuZ3RoLAogICAgICAgICAgICB0cmFuc2FjdGlvbmFsQ29udGVudE1ENSwKICAgICAgICAgICAgdHJhbnNhY3Rpb25hbENvbnRlbnRDcmM2NCwKICAgICAgICAgICAgdmVyc2lvbiwKICAgICAgICAgICAgcmVxdWVzdElkLAogICAgICAgICAgICBsZWFzZUlkMCwKICAgICAgICAgICAgbWF4U2l6ZSwKICAgICAgICAgICAgYXBwZW5kUG9zaXRpb24sCiAgICAgICAgICAgIGVuY3J5cHRpb25LZXksCiAgICAgICAgICAgIGVuY3J5cHRpb25LZXlTaGEyNTYsCiAgICAgICAgICAgIGVuY3J5cHRpb25BbGdvcml0aG0sCiAgICAgICAgICAgIGlmTW9kaWZpZWRTaW5jZSwKICAgICAgICAgICAgaWZVbm1vZGlmaWVkU2luY2UsCiAgICAgICAgICAgIGlmTWF0Y2gsCiAgICAgICAgICAgIGlmTm9uZU1hdGNoCiAgICAgICAgXSwKICAgICAgICByZXF1ZXN0Qm9keTogewogICAgICAgICAgICBwYXJhbWV0ZXJQYXRoOiAiYm9keSIsCiAgICAgICAgICAgIG1hcHBlcjogewogICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgICAgICBzZXJpYWxpemVkTmFtZTogImJvZHkiLAogICAgICAgICAgICAgICAgdHlwZTogewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJlYW0iCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGNvbnRlbnRUeXBlOiAiYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtIiwKICAgICAgICByZXNwb25zZXM6IHsKICAgICAgICAgICAgMjAxOiB7CiAgICAgICAgICAgICAgICBoZWFkZXJzTWFwcGVyOiBBcHBlbmRCbG9iQXBwZW5kQmxvY2tIZWFkZXJzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICAgIGJvZHlNYXBwZXI6IFN0b3JhZ2VFcnJvcgogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBpc1hNTDogdHJ1ZSwKICAgICAgICBzZXJpYWxpemVyOiBzZXJpYWxpemVyJDUKICAgIH07CiAgICB2YXIgYXBwZW5kQmxvY2tGcm9tVXJsT3BlcmF0aW9uU3BlYyA9IHsKICAgICAgICBodHRwTWV0aG9kOiAiUFVUIiwKICAgICAgICBwYXRoOiAie2NvbnRhaW5lck5hbWV9L3tibG9ifSIsCiAgICAgICAgdXJsUGFyYW1ldGVyczogWwogICAgICAgICAgICB1cmwKICAgICAgICBdLAogICAgICAgIHF1ZXJ5UGFyYW1ldGVyczogWwogICAgICAgICAgICB0aW1lb3V0LAogICAgICAgICAgICBjb21wMTUKICAgICAgICBdLAogICAgICAgIGhlYWRlclBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgc291cmNlVXJsLAogICAgICAgICAgICBzb3VyY2VSYW5nZTEsCiAgICAgICAgICAgIHNvdXJjZUNvbnRlbnRNRDUsCiAgICAgICAgICAgIHNvdXJjZUNvbnRlbnRDcmM2NCwKICAgICAgICAgICAgY29udGVudExlbmd0aCwKICAgICAgICAgICAgdHJhbnNhY3Rpb25hbENvbnRlbnRNRDUsCiAgICAgICAgICAgIHZlcnNpb24sCiAgICAgICAgICAgIHJlcXVlc3RJZCwKICAgICAgICAgICAgZW5jcnlwdGlvbktleSwKICAgICAgICAgICAgZW5jcnlwdGlvbktleVNoYTI1NiwKICAgICAgICAgICAgZW5jcnlwdGlvbkFsZ29yaXRobSwKICAgICAgICAgICAgbGVhc2VJZDAsCiAgICAgICAgICAgIG1heFNpemUsCiAgICAgICAgICAgIGFwcGVuZFBvc2l0aW9uLAogICAgICAgICAgICBpZk1vZGlmaWVkU2luY2UsCiAgICAgICAgICAgIGlmVW5tb2RpZmllZFNpbmNlLAogICAgICAgICAgICBpZk1hdGNoLAogICAgICAgICAgICBpZk5vbmVNYXRjaCwKICAgICAgICAgICAgc291cmNlSWZNb2RpZmllZFNpbmNlLAogICAgICAgICAgICBzb3VyY2VJZlVubW9kaWZpZWRTaW5jZSwKICAgICAgICAgICAgc291cmNlSWZNYXRjaCwKICAgICAgICAgICAgc291cmNlSWZOb25lTWF0Y2gKICAgICAgICBdLAogICAgICAgIHJlc3BvbnNlczogewogICAgICAgICAgICAyMDE6IHsKICAgICAgICAgICAgICAgIGhlYWRlcnNNYXBwZXI6IEFwcGVuZEJsb2JBcHBlbmRCbG9ja0Zyb21VcmxIZWFkZXJzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICAgIGJvZHlNYXBwZXI6IFN0b3JhZ2VFcnJvcgogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBpc1hNTDogdHJ1ZSwKICAgICAgICBzZXJpYWxpemVyOiBzZXJpYWxpemVyJDUKICAgIH07CgogICAgLyoKICAgICAqIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogICAgICogTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi4KICAgICAqCiAgICAgKiBDb2RlIGdlbmVyYXRlZCBieSBNaWNyb3NvZnQgKFIpIEF1dG9SZXN0IENvZGUgR2VuZXJhdG9yLgogICAgICogQ2hhbmdlcyBtYXkgY2F1c2UgaW5jb3JyZWN0IGJlaGF2aW9yIGFuZCB3aWxsIGJlIGxvc3QgaWYgdGhlIGNvZGUgaXMgcmVnZW5lcmF0ZWQuCiAgICAgKi8KCiAgICB2YXIgTWFwcGVycyQ1ID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogICAgICAgIEJsb2NrOiBCbG9jaywKICAgICAgICBCbG9ja0Jsb2JDb21taXRCbG9ja0xpc3RIZWFkZXJzOiBCbG9ja0Jsb2JDb21taXRCbG9ja0xpc3RIZWFkZXJzLAogICAgICAgIEJsb2NrQmxvYkdldEJsb2NrTGlzdEhlYWRlcnM6IEJsb2NrQmxvYkdldEJsb2NrTGlzdEhlYWRlcnMsCiAgICAgICAgQmxvY2tCbG9iU3RhZ2VCbG9ja0Zyb21VUkxIZWFkZXJzOiBCbG9ja0Jsb2JTdGFnZUJsb2NrRnJvbVVSTEhlYWRlcnMsCiAgICAgICAgQmxvY2tCbG9iU3RhZ2VCbG9ja0hlYWRlcnM6IEJsb2NrQmxvYlN0YWdlQmxvY2tIZWFkZXJzLAogICAgICAgIEJsb2NrQmxvYlVwbG9hZEhlYWRlcnM6IEJsb2NrQmxvYlVwbG9hZEhlYWRlcnMsCiAgICAgICAgQmxvY2tMaXN0OiBCbG9ja0xpc3QsCiAgICAgICAgQmxvY2tMb29rdXBMaXN0OiBCbG9ja0xvb2t1cExpc3QsCiAgICAgICAgU3RvcmFnZUVycm9yOiBTdG9yYWdlRXJyb3IKICAgIH0pOwoKICAgIC8qCiAgICAgKiBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICAgICAqIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS4gU2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yCiAgICAgKiBsaWNlbnNlIGluZm9ybWF0aW9uLgogICAgICoKICAgICAqIENvZGUgZ2VuZXJhdGVkIGJ5IE1pY3Jvc29mdCAoUikgQXV0b1Jlc3QgQ29kZSBHZW5lcmF0b3IuCiAgICAgKiBDaGFuZ2VzIG1heSBjYXVzZSBpbmNvcnJlY3QgYmVoYXZpb3IgYW5kIHdpbGwgYmUgbG9zdCBpZiB0aGUgY29kZSBpcwogICAgICogcmVnZW5lcmF0ZWQuCiAgICAgKi8KICAgIC8qKiBDbGFzcyByZXByZXNlbnRpbmcgYSBCbG9ja0Jsb2IuICovCiAgICB2YXIgQmxvY2tCbG9iID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewogICAgICAgIC8qKgogICAgICAgICAqIENyZWF0ZSBhIEJsb2NrQmxvYi4KICAgICAgICAgKiBAcGFyYW0ge1N0b3JhZ2VDbGllbnRDb250ZXh0fSBjbGllbnQgUmVmZXJlbmNlIHRvIHRoZSBzZXJ2aWNlIGNsaWVudC4KICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBCbG9ja0Jsb2IoY2xpZW50KSB7CiAgICAgICAgICAgIHRoaXMuY2xpZW50ID0gY2xpZW50OwogICAgICAgIH0KICAgICAgICBCbG9ja0Jsb2IucHJvdG90eXBlLnVwbG9hZCA9IGZ1bmN0aW9uIChib2R5LCBjb250ZW50TGVuZ3RoLCBvcHRpb25zLCBjYWxsYmFjaykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jbGllbnQuc2VuZE9wZXJhdGlvblJlcXVlc3QoewogICAgICAgICAgICAgICAgYm9keTogYm9keSwKICAgICAgICAgICAgICAgIGNvbnRlbnRMZW5ndGg6IGNvbnRlbnRMZW5ndGgsCiAgICAgICAgICAgICAgICBvcHRpb25zOiBvcHRpb25zCiAgICAgICAgICAgIH0sIHVwbG9hZE9wZXJhdGlvblNwZWMsIGNhbGxiYWNrKTsKICAgICAgICB9OwogICAgICAgIEJsb2NrQmxvYi5wcm90b3R5cGUuc3RhZ2VCbG9jayA9IGZ1bmN0aW9uIChibG9ja0lkLCBjb250ZW50TGVuZ3RoLCBib2R5LCBvcHRpb25zLCBjYWxsYmFjaykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jbGllbnQuc2VuZE9wZXJhdGlvblJlcXVlc3QoewogICAgICAgICAgICAgICAgYmxvY2tJZDogYmxvY2tJZCwKICAgICAgICAgICAgICAgIGNvbnRlbnRMZW5ndGg6IGNvbnRlbnRMZW5ndGgsCiAgICAgICAgICAgICAgICBib2R5OiBib2R5LAogICAgICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucwogICAgICAgICAgICB9LCBzdGFnZUJsb2NrT3BlcmF0aW9uU3BlYywgY2FsbGJhY2spOwogICAgICAgIH07CiAgICAgICAgQmxvY2tCbG9iLnByb3RvdHlwZS5zdGFnZUJsb2NrRnJvbVVSTCA9IGZ1bmN0aW9uIChibG9ja0lkLCBjb250ZW50TGVuZ3RoLCBzb3VyY2VVcmwsIG9wdGlvbnMsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNsaWVudC5zZW5kT3BlcmF0aW9uUmVxdWVzdCh7CiAgICAgICAgICAgICAgICBibG9ja0lkOiBibG9ja0lkLAogICAgICAgICAgICAgICAgY29udGVudExlbmd0aDogY29udGVudExlbmd0aCwKICAgICAgICAgICAgICAgIHNvdXJjZVVybDogc291cmNlVXJsLAogICAgICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucwogICAgICAgICAgICB9LCBzdGFnZUJsb2NrRnJvbVVSTE9wZXJhdGlvblNwZWMsIGNhbGxiYWNrKTsKICAgICAgICB9OwogICAgICAgIEJsb2NrQmxvYi5wcm90b3R5cGUuY29tbWl0QmxvY2tMaXN0ID0gZnVuY3Rpb24gKGJsb2Nrcywgb3B0aW9ucywgY2FsbGJhY2spIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2xpZW50LnNlbmRPcGVyYXRpb25SZXF1ZXN0KHsKICAgICAgICAgICAgICAgIGJsb2NrczogYmxvY2tzLAogICAgICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucwogICAgICAgICAgICB9LCBjb21taXRCbG9ja0xpc3RPcGVyYXRpb25TcGVjLCBjYWxsYmFjayk7CiAgICAgICAgfTsKICAgICAgICBCbG9ja0Jsb2IucHJvdG90eXBlLmdldEJsb2NrTGlzdCA9IGZ1bmN0aW9uIChsaXN0VHlwZSwgb3B0aW9ucywgY2FsbGJhY2spIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2xpZW50LnNlbmRPcGVyYXRpb25SZXF1ZXN0KHsKICAgICAgICAgICAgICAgIGxpc3RUeXBlOiBsaXN0VHlwZSwKICAgICAgICAgICAgICAgIG9wdGlvbnM6IG9wdGlvbnMKICAgICAgICAgICAgfSwgZ2V0QmxvY2tMaXN0T3BlcmF0aW9uU3BlYywgY2FsbGJhY2spOwogICAgICAgIH07CiAgICAgICAgcmV0dXJuIEJsb2NrQmxvYjsKICAgIH0oKSk7CiAgICAvLyBPcGVyYXRpb24gU3BlY2lmaWNhdGlvbnMKICAgIHZhciBzZXJpYWxpemVyJDYgPSBuZXcgU2VyaWFsaXplcihNYXBwZXJzJDUsIHRydWUpOwogICAgdmFyIHVwbG9hZE9wZXJhdGlvblNwZWMgPSB7CiAgICAgICAgaHR0cE1ldGhvZDogIlBVVCIsCiAgICAgICAgcGF0aDogIntjb250YWluZXJOYW1lfS97YmxvYn0iLAogICAgICAgIHVybFBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdXJsCiAgICAgICAgXSwKICAgICAgICBxdWVyeVBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdGltZW91dAogICAgICAgIF0sCiAgICAgICAgaGVhZGVyUGFyYW1ldGVyczogWwogICAgICAgICAgICBjb250ZW50TGVuZ3RoLAogICAgICAgICAgICBtZXRhZGF0YSwKICAgICAgICAgICAgdGllcjAsCiAgICAgICAgICAgIHZlcnNpb24sCiAgICAgICAgICAgIHJlcXVlc3RJZCwKICAgICAgICAgICAgYmxvYlR5cGUyLAogICAgICAgICAgICBibG9iQ29udGVudFR5cGUsCiAgICAgICAgICAgIGJsb2JDb250ZW50RW5jb2RpbmcsCiAgICAgICAgICAgIGJsb2JDb250ZW50TGFuZ3VhZ2UsCiAgICAgICAgICAgIGJsb2JDb250ZW50TUQ1LAogICAgICAgICAgICBibG9iQ2FjaGVDb250cm9sLAogICAgICAgICAgICBibG9iQ29udGVudERpc3Bvc2l0aW9uLAogICAgICAgICAgICBsZWFzZUlkMCwKICAgICAgICAgICAgZW5jcnlwdGlvbktleSwKICAgICAgICAgICAgZW5jcnlwdGlvbktleVNoYTI1NiwKICAgICAgICAgICAgZW5jcnlwdGlvbkFsZ29yaXRobSwKICAgICAgICAgICAgaWZNb2RpZmllZFNpbmNlLAogICAgICAgICAgICBpZlVubW9kaWZpZWRTaW5jZSwKICAgICAgICAgICAgaWZNYXRjaCwKICAgICAgICAgICAgaWZOb25lTWF0Y2gKICAgICAgICBdLAogICAgICAgIHJlcXVlc3RCb2R5OiB7CiAgICAgICAgICAgIHBhcmFtZXRlclBhdGg6ICJib2R5IiwKICAgICAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiYm9keSIsCiAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmVhbSIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgY29udGVudFR5cGU6ICJhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0iLAogICAgICAgIHJlc3BvbnNlczogewogICAgICAgICAgICAyMDE6IHsKICAgICAgICAgICAgICAgIGhlYWRlcnNNYXBwZXI6IEJsb2NrQmxvYlVwbG9hZEhlYWRlcnMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVmYXVsdDogewogICAgICAgICAgICAgICAgYm9keU1hcHBlcjogU3RvcmFnZUVycm9yCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGlzWE1MOiB0cnVlLAogICAgICAgIHNlcmlhbGl6ZXI6IHNlcmlhbGl6ZXIkNgogICAgfTsKICAgIHZhciBzdGFnZUJsb2NrT3BlcmF0aW9uU3BlYyA9IHsKICAgICAgICBodHRwTWV0aG9kOiAiUFVUIiwKICAgICAgICBwYXRoOiAie2NvbnRhaW5lck5hbWV9L3tibG9ifSIsCiAgICAgICAgdXJsUGFyYW1ldGVyczogWwogICAgICAgICAgICB1cmwKICAgICAgICBdLAogICAgICAgIHF1ZXJ5UGFyYW1ldGVyczogWwogICAgICAgICAgICBibG9ja0lkLAogICAgICAgICAgICB0aW1lb3V0LAogICAgICAgICAgICBjb21wMTYKICAgICAgICBdLAogICAgICAgIGhlYWRlclBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgY29udGVudExlbmd0aCwKICAgICAgICAgICAgdHJhbnNhY3Rpb25hbENvbnRlbnRNRDUsCiAgICAgICAgICAgIHRyYW5zYWN0aW9uYWxDb250ZW50Q3JjNjQsCiAgICAgICAgICAgIHZlcnNpb24sCiAgICAgICAgICAgIHJlcXVlc3RJZCwKICAgICAgICAgICAgbGVhc2VJZDAsCiAgICAgICAgICAgIGVuY3J5cHRpb25LZXksCiAgICAgICAgICAgIGVuY3J5cHRpb25LZXlTaGEyNTYsCiAgICAgICAgICAgIGVuY3J5cHRpb25BbGdvcml0aG0KICAgICAgICBdLAogICAgICAgIHJlcXVlc3RCb2R5OiB7CiAgICAgICAgICAgIHBhcmFtZXRlclBhdGg6ICJib2R5IiwKICAgICAgICAgICAgbWFwcGVyOiB7CiAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWROYW1lOiAiYm9keSIsCiAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cmVhbSIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgY29udGVudFR5cGU6ICJhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0iLAogICAgICAgIHJlc3BvbnNlczogewogICAgICAgICAgICAyMDE6IHsKICAgICAgICAgICAgICAgIGhlYWRlcnNNYXBwZXI6IEJsb2NrQmxvYlN0YWdlQmxvY2tIZWFkZXJzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICAgIGJvZHlNYXBwZXI6IFN0b3JhZ2VFcnJvcgogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBpc1hNTDogdHJ1ZSwKICAgICAgICBzZXJpYWxpemVyOiBzZXJpYWxpemVyJDYKICAgIH07CiAgICB2YXIgc3RhZ2VCbG9ja0Zyb21VUkxPcGVyYXRpb25TcGVjID0gewogICAgICAgIGh0dHBNZXRob2Q6ICJQVVQiLAogICAgICAgIHBhdGg6ICJ7Y29udGFpbmVyTmFtZX0ve2Jsb2J9IiwKICAgICAgICB1cmxQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIHVybAogICAgICAgIF0sCiAgICAgICAgcXVlcnlQYXJhbWV0ZXJzOiBbCiAgICAgICAgICAgIGJsb2NrSWQsCiAgICAgICAgICAgIHRpbWVvdXQsCiAgICAgICAgICAgIGNvbXAxNgogICAgICAgIF0sCiAgICAgICAgaGVhZGVyUGFyYW1ldGVyczogWwogICAgICAgICAgICBjb250ZW50TGVuZ3RoLAogICAgICAgICAgICBzb3VyY2VVcmwsCiAgICAgICAgICAgIHNvdXJjZVJhbmdlMSwKICAgICAgICAgICAgc291cmNlQ29udGVudE1ENSwKICAgICAgICAgICAgc291cmNlQ29udGVudENyYzY0LAogICAgICAgICAgICB2ZXJzaW9uLAogICAgICAgICAgICByZXF1ZXN0SWQsCiAgICAgICAgICAgIGVuY3J5cHRpb25LZXksCiAgICAgICAgICAgIGVuY3J5cHRpb25LZXlTaGEyNTYsCiAgICAgICAgICAgIGVuY3J5cHRpb25BbGdvcml0aG0sCiAgICAgICAgICAgIGxlYXNlSWQwLAogICAgICAgICAgICBzb3VyY2VJZk1vZGlmaWVkU2luY2UsCiAgICAgICAgICAgIHNvdXJjZUlmVW5tb2RpZmllZFNpbmNlLAogICAgICAgICAgICBzb3VyY2VJZk1hdGNoLAogICAgICAgICAgICBzb3VyY2VJZk5vbmVNYXRjaAogICAgICAgIF0sCiAgICAgICAgcmVzcG9uc2VzOiB7CiAgICAgICAgICAgIDIwMTogewogICAgICAgICAgICAgICAgaGVhZGVyc01hcHBlcjogQmxvY2tCbG9iU3RhZ2VCbG9ja0Zyb21VUkxIZWFkZXJzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICAgIGJvZHlNYXBwZXI6IFN0b3JhZ2VFcnJvcgogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBpc1hNTDogdHJ1ZSwKICAgICAgICBzZXJpYWxpemVyOiBzZXJpYWxpemVyJDYKICAgIH07CiAgICB2YXIgY29tbWl0QmxvY2tMaXN0T3BlcmF0aW9uU3BlYyA9IHsKICAgICAgICBodHRwTWV0aG9kOiAiUFVUIiwKICAgICAgICBwYXRoOiAie2NvbnRhaW5lck5hbWV9L3tibG9ifSIsCiAgICAgICAgdXJsUGFyYW1ldGVyczogWwogICAgICAgICAgICB1cmwKICAgICAgICBdLAogICAgICAgIHF1ZXJ5UGFyYW1ldGVyczogWwogICAgICAgICAgICB0aW1lb3V0LAogICAgICAgICAgICBjb21wMTcKICAgICAgICBdLAogICAgICAgIGhlYWRlclBhcmFtZXRlcnM6IFsKICAgICAgICAgICAgdHJhbnNhY3Rpb25hbENvbnRlbnRNRDUsCiAgICAgICAgICAgIHRyYW5zYWN0aW9uYWxDb250ZW50Q3JjNjQsCiAgICAgICAgICAgIG1ldGFkYXRhLAogICAgICAgICAgICB0aWVyMCwKICAgICAgICAgICAgdmVyc2lvbiwKICAgICAgICAgICAgcmVxdWVzdElkLAogICAgICAgICAgICBibG9iQ2FjaGVDb250cm9sLAogICAgICAgICAgICBibG9iQ29udGVudFR5cGUsCiAgICAgICAgICAgIGJsb2JDb250ZW50RW5jb2RpbmcsCiAgICAgICAgICAgIGJsb2JDb250ZW50TGFuZ3VhZ2UsCiAgICAgICAgICAgIGJsb2JDb250ZW50TUQ1LAogICAgICAgICAgICBibG9iQ29udGVudERpc3Bvc2l0aW9uLAogICAgICAgICAgICBsZWFzZUlkMCwKICAgICAgICAgICAgZW5jcnlwdGlvbktleSwKICAgICAgICAgICAgZW5jcnlwdGlvbktleVNoYTI1NiwKICAgICAgICAgICAgZW5jcnlwdGlvbkFsZ29yaXRobSwKICAgICAgICAgICAgaWZNb2RpZmllZFNpbmNlLAogICAgICAgICAgICBpZlVubW9kaWZpZWRTaW5jZSwKICAgICAgICAgICAgaWZNYXRjaCwKICAgICAgICAgICAgaWZOb25lTWF0Y2gKICAgICAgICBdLAogICAgICAgIHJlcXVlc3RCb2R5OiB7CiAgICAgICAgICAgIHBhcmFtZXRlclBhdGg6ICJibG9ja3MiLAogICAgICAgICAgICBtYXBwZXI6IF9fYXNzaWduKHt9LCBCbG9ja0xvb2t1cExpc3QsIHsgcmVxdWlyZWQ6IHRydWUgfSkKICAgICAgICB9LAogICAgICAgIGNvbnRlbnRUeXBlOiAiYXBwbGljYXRpb24veG1sOyBjaGFyc2V0PXV0Zi04IiwKICAgICAgICByZXNwb25zZXM6IHsKICAgICAgICAgICAgMjAxOiB7CiAgICAgICAgICAgICAgICBoZWFkZXJzTWFwcGVyOiBCbG9ja0Jsb2JDb21taXRCbG9ja0xpc3RIZWFkZXJzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICAgIGJvZHlNYXBwZXI6IFN0b3JhZ2VFcnJvcgogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBpc1hNTDogdHJ1ZSwKICAgICAgICBzZXJpYWxpemVyOiBzZXJpYWxpemVyJDYKICAgIH07CiAgICB2YXIgZ2V0QmxvY2tMaXN0T3BlcmF0aW9uU3BlYyA9IHsKICAgICAgICBodHRwTWV0aG9kOiAiR0VUIiwKICAgICAgICBwYXRoOiAie2NvbnRhaW5lck5hbWV9L3tibG9ifSIsCiAgICAgICAgdXJsUGFyYW1ldGVyczogWwogICAgICAgICAgICB1cmwKICAgICAgICBdLAogICAgICAgIHF1ZXJ5UGFyYW1ldGVyczogWwogICAgICAgICAgICBzbmFwc2hvdCwKICAgICAgICAgICAgbGlzdFR5cGUsCiAgICAgICAgICAgIHRpbWVvdXQsCiAgICAgICAgICAgIGNvbXAxNwogICAgICAgIF0sCiAgICAgICAgaGVhZGVyUGFyYW1ldGVyczogWwogICAgICAgICAgICB2ZXJzaW9uLAogICAgICAgICAgICByZXF1ZXN0SWQsCiAgICAgICAgICAgIGxlYXNlSWQwCiAgICAgICAgXSwKICAgICAgICByZXNwb25zZXM6IHsKICAgICAgICAgICAgMjAwOiB7CiAgICAgICAgICAgICAgICBib2R5TWFwcGVyOiBCbG9ja0xpc3QsCiAgICAgICAgICAgICAgICBoZWFkZXJzTWFwcGVyOiBCbG9ja0Jsb2JHZXRCbG9ja0xpc3RIZWFkZXJzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICAgIGJvZHlNYXBwZXI6IFN0b3JhZ2VFcnJvcgogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBpc1hNTDogdHJ1ZSwKICAgICAgICBzZXJpYWxpemVyOiBzZXJpYWxpemVyJDYKICAgIH07CgogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBhIHJhbmdlIHN0cmluZy4gRm9yIGV4YW1wbGU6CiAgICAgKgogICAgICogImJ5dGVzPTI1NS0iIG9yICJieXRlcz0wLTUxMSIKICAgICAqCiAgICAgKiBAZXhwb3J0CiAgICAgKiBAcGFyYW0ge0lSYW5nZX0gaVJhbmdlCiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfQogICAgICovCiAgICBmdW5jdGlvbiByYW5nZVRvU3RyaW5nKGlSYW5nZSkgewogICAgICAgIGlmIChpUmFuZ2Uub2Zmc2V0IDwgMCkgewogICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiSVJhbmdlLm9mZnNldCBjYW5ub3QgYmUgc21hbGxlciB0aGFuIDAuIik7CiAgICAgICAgfQogICAgICAgIGlmIChpUmFuZ2UuY291bnQgJiYgaVJhbmdlLmNvdW50IDw9IDApIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoIklSYW5nZS5jb3VudCBtdXN0IGJlIGxhcmdlciB0aGFuIDAuIExlYXZlIGl0IHVuZGVmaW5lZCBpZiB5b3Ugd2FudCBhIHJhbmdlIGZyb20gb2Zmc2V0IHRvIHRoZSBlbmQuIik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBpUmFuZ2UuY291bnQKICAgICAgICAgICAgPyAiYnl0ZXM9IiArIGlSYW5nZS5vZmZzZXQgKyAiLSIgKyAoaVJhbmdlLm9mZnNldCArIGlSYW5nZS5jb3VudCAtIDEpCiAgICAgICAgICAgIDogImJ5dGVzPSIgKyBpUmFuZ2Uub2Zmc2V0ICsgIi0iOwogICAgfQoKICAgIHZhciBCTE9DS19CTE9CX01BWF9VUExPQURfQkxPQl9CWVRFUyA9IDI1NiAqIDEwMjQgKiAxMDI0OyAvLyAyNTZNQgogICAgdmFyIEJMT0NLX0JMT0JfTUFYX1NUQUdFX0JMT0NLX0JZVEVTID0gMTAwICogMTAyNCAqIDEwMjQ7IC8vIDEwME1CCiAgICB2YXIgQkxPQ0tfQkxPQl9NQVhfQkxPQ0tTID0gNTAwMDA7CiAgICB2YXIgREVGQVVMVF9CTE9CX0RPV05MT0FEX0JMT0NLX0JZVEVTID0gNCAqIDEwMjQgKiAxMDI0OyAvLyA0TUIKICAgIHZhciBERUZBVUxUX01BWF9ET1dOTE9BRF9SRVRSWV9SRVFVRVNUUyA9IDU7CiAgICB2YXIgVVJMQ29uc3RhbnRzID0gewogICAgICAgIFBhcmFtZXRlcnM6IHsKICAgICAgICAgICAgRk9SQ0VfQlJPV1NFUl9OT19DQUNIRTogIl8iLAogICAgICAgICAgICBTSUdOQVRVUkU6ICJzaWciLAogICAgICAgICAgICBTTkFQU0hPVDogInNuYXBzaG90IiwKICAgICAgICAgICAgVElNRU9VVDogInRpbWVvdXQiCiAgICAgICAgfQogICAgfTsKICAgIHZhciBIVFRQVVJMQ29ubmVjdGlvbiA9IHsKICAgICAgICBIVFRQX0FDQ0VQVEVEOiAyMDIsCiAgICAgICAgSFRUUF9DT05GTElDVDogNDA5LAogICAgICAgIEhUVFBfTk9UX0ZPVU5EOiA0MDQsCiAgICAgICAgSFRUUF9QUkVDT05fRkFJTEVEOiA0MTIsCiAgICAgICAgSFRUUF9SQU5HRV9OT1RfU0FUSVNGSUFCTEU6IDQxNgogICAgfTsKICAgIHZhciBIZWFkZXJDb25zdGFudHMgPSB7CiAgICAgICAgQVVUSE9SSVpBVElPTjogIkF1dGhvcml6YXRpb24iLAogICAgICAgIEFVVEhPUklaQVRJT05fU0NIRU1FOiAiQmVhcmVyIiwKICAgICAgICBDT05URU5UX0VOQ09ESU5HOiAiQ29udGVudC1FbmNvZGluZyIsCiAgICAgICAgQ09OVEVOVF9JRDogIkNvbnRlbnQtSUQiLAogICAgICAgIENPTlRFTlRfTEFOR1VBR0U6ICJDb250ZW50LUxhbmd1YWdlIiwKICAgICAgICBDT05URU5UX0xFTkdUSDogIkNvbnRlbnQtTGVuZ3RoIiwKICAgICAgICBDT05URU5UX01ENTogIkNvbnRlbnQtTWQ1IiwKICAgICAgICBDT05URU5UX1RSQU5TRkVSX0VOQ09ESU5HOiAiQ29udGVudC1UcmFuc2Zlci1FbmNvZGluZyIsCiAgICAgICAgQ09OVEVOVF9UWVBFOiAiQ29udGVudC1UeXBlIiwKICAgICAgICBDT09LSUU6ICJDb29raWUiLAogICAgICAgIERBVEU6ICJkYXRlIiwKICAgICAgICBJRl9NQVRDSDogImlmLW1hdGNoIiwKICAgICAgICBJRl9NT0RJRklFRF9TSU5DRTogImlmLW1vZGlmaWVkLXNpbmNlIiwKICAgICAgICBJRl9OT05FX01BVENIOiAiaWYtbm9uZS1tYXRjaCIsCiAgICAgICAgSUZfVU5NT0RJRklFRF9TSU5DRTogImlmLXVubW9kaWZpZWQtc2luY2UiLAogICAgICAgIFBSRUZJWF9GT1JfU1RPUkFHRTogIngtbXMtIiwKICAgICAgICBSQU5HRTogIlJhbmdlIiwKICAgICAgICBVU0VSX0FHRU5UOiAiVXNlci1BZ2VudCIsCiAgICAgICAgWF9NU19DTElFTlRfUkVRVUVTVF9JRDogIngtbXMtY2xpZW50LXJlcXVlc3QtaWQiLAogICAgICAgIFhfTVNfREFURTogIngtbXMtZGF0ZSIsCiAgICAgICAgWF9NU19FUlJPUl9DT0RFOiAieC1tcy1lcnJvci1jb2RlIiwKICAgICAgICBYX01TX1ZFUlNJT046ICJ4LW1zLXZlcnNpb24iCiAgICB9OwogICAgdmFyIEVUYWdOb25lID0gIiI7CiAgICB2YXIgQkFUQ0hfTUFYX1JFUVVFU1QgPSAyNTY7CiAgICB2YXIgSFRUUF9MSU5FX0VORElORyA9ICJcclxuIjsKICAgIHZhciBIVFRQX1ZFUlNJT05fMV8xID0gIkhUVFAvMS4xIjsKICAgIHZhciBFbmNyeXB0aW9uQWxnb3JpdGhtQUVTMjUgPSAiQUVTMjU2IjsKCiAgICAoZnVuY3Rpb24gKEJsb2NrQmxvYlRpZXIpIHsKICAgICAgICBCbG9ja0Jsb2JUaWVyWyJIb3QiXSA9ICJIb3QiOwogICAgICAgIEJsb2NrQmxvYlRpZXJbIkNvb2wiXSA9ICJDb29sIjsKICAgICAgICBCbG9ja0Jsb2JUaWVyWyJBcmNoaXZlIl0gPSAiQXJjaGl2ZSI7CiAgICB9KShleHBvcnRzLkJsb2NrQmxvYlRpZXIgfHwgKGV4cG9ydHMuQmxvY2tCbG9iVGllciA9IHt9KSk7CiAgICAoZnVuY3Rpb24gKFByZW1pdW1QYWdlQmxvYlRpZXIpIHsKICAgICAgICBQcmVtaXVtUGFnZUJsb2JUaWVyWyJQNCJdID0gIlA0IjsKICAgICAgICBQcmVtaXVtUGFnZUJsb2JUaWVyWyJQNiJdID0gIlA2IjsKICAgICAgICBQcmVtaXVtUGFnZUJsb2JUaWVyWyJQMTAiXSA9ICJQMTAiOwogICAgICAgIFByZW1pdW1QYWdlQmxvYlRpZXJbIlAxNSJdID0gIlAxNSI7CiAgICAgICAgUHJlbWl1bVBhZ2VCbG9iVGllclsiUDIwIl0gPSAiUDIwIjsKICAgICAgICBQcmVtaXVtUGFnZUJsb2JUaWVyWyJQMzAiXSA9ICJQMzAiOwogICAgICAgIFByZW1pdW1QYWdlQmxvYlRpZXJbIlA0MCJdID0gIlA0MCI7CiAgICAgICAgUHJlbWl1bVBhZ2VCbG9iVGllclsiUDUwIl0gPSAiUDUwIjsKICAgICAgICBQcmVtaXVtUGFnZUJsb2JUaWVyWyJQNjAiXSA9ICJQNjAiOwogICAgICAgIFByZW1pdW1QYWdlQmxvYlRpZXJbIlA3MCJdID0gIlA3MCI7CiAgICAgICAgUHJlbWl1bVBhZ2VCbG9iVGllclsiUDgwIl0gPSAiUDgwIjsKICAgIH0pKGV4cG9ydHMuUHJlbWl1bVBhZ2VCbG9iVGllciB8fCAoZXhwb3J0cy5QcmVtaXVtUGFnZUJsb2JUaWVyID0ge30pKTsKICAgIGZ1bmN0aW9uIHRvQWNjZXNzVGllcih0aWVyKSB7CiAgICAgICAgaWYgKHRpZXIgPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aWVyOyAvLyBObyBtb3JlIGNoZWNrIGlmIHN0cmluZyBpcyBhIHZhbGlkIEFjY2Vzc1RpZXIsIGFuZCBsZWZ0IHRoaXMgdG8gdW5kZXJsYXkgbG9naWMgdG8gZGVjaWRlKHNlcnZpY2UpLgogICAgfQogICAgZnVuY3Rpb24gZW5zdXJlQ3BrSWZTcGVjaWZpZWQoY3BrLCBpc0h0dHBzKSB7CiAgICAgICAgaWYgKGNwayAmJiAhaXNIdHRwcykgewogICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiQ3VzdG9tZXItcHJvdmlkZWQgZW5jcnlwdGlvbiBrZXkgbXVzdCBiZSB1c2VkIG92ZXIgSFRUUFMuIik7CiAgICAgICAgfQogICAgICAgIGlmIChjcGsgJiYgIWNway5lbmNyeXB0aW9uQWxnb3JpdGhtKSB7CiAgICAgICAgICAgIGNway5lbmNyeXB0aW9uQWxnb3JpdGhtID0gRW5jcnlwdGlvbkFsZ29yaXRobUFFUzI1OwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJlc2VydmVkIFVSTCBjaGFyYWN0ZXJzIG11c3QgYmUgcHJvcGVybHkgZXNjYXBlZCBmb3IgU3RvcmFnZSBzZXJ2aWNlcyBsaWtlIEJsb2Igb3IgRmlsZS4KICAgICAqCiAgICAgKiAjIyBVUkwgZW5jb2RlIGFuZCBlc2NhcGUgc3RyYXRlZ3kgZm9yIEpTdjEwIFNES3MKICAgICAqCiAgICAgKiBXaGVuIGN1c3RvbWVycyBwYXNzIGEgVVJMIHN0cmluZyBpbnRvIFhYWFVSTCBjbGFzc2VzIGNvbnN0cmN1dG9yLCB0aGUgVVJMIHN0cmluZyBtYXkgYWxyZWFkeSBiZSBVUkwgZW5jb2RlZCBvciBub3QuCiAgICAgKiBCdXQgYmVmb3JlIHNlbmRpbmcgdG8gQXp1cmUgU3RvcmFnZSBzZXJ2ZXIsIHRoZSBVUkwgbXVzdCBiZSBlbmNvZGVkLiBIb3dldmVyLCBpdCdzIGhhcmQgZm9yIGEgU0RLIHRvIGd1ZXNzIHdoZXRoZXIgdGhlIFVSTAogICAgICogc3RyaW5nIGhhcyBiZWVuIGVuY29kZWQgb3Igbm90LiBXZSBoYXZlIDIgcG90ZW50aWFsIHN0cmF0ZWdpZXMsIGFuZCBjaG9zZSBzdHJhdGVneSB0d28gZm9yIHRoZSBYWFhVUkwgY29uc3RydWN0b3JzLgogICAgICoKICAgICAqICMjIyBTdHJhdGVneSBPbmU6IEFzc3VtZSB0aGUgY3VzdG9tZXIgVVJMIHN0cmluZyBpcyBub3QgZW5jb2RlZCwgYW5kIGFsd2F5cyBlbmNvZGUgVVJMIHN0cmluZyBpbiBTREsuCiAgICAgKgogICAgICogVGhpcyBpcyB3aGF0IGxlZ2FjeSBWMiBTREsgZG9lcywgc2ltcGxlIGFuZCB3b3JrcyBmb3IgbW9zdCBvZiB0aGUgY2FzZXMuCiAgICAgKiAtIFdoZW4gY3VzdG9tZXIgVVJMIHN0cmluZyBpcyAiaHR0cDovL2FjY291bnQuYmxvYi5jb3JlLndpbmRvd3MubmV0L2Nvbi9iOiIsCiAgICAgKiAgIFNESyB3aWxsIGVuY29kZSBpdCB0byAiaHR0cDovL2FjY291bnQuYmxvYi5jb3JlLndpbmRvd3MubmV0L2Nvbi9iJTNBIiBhbmQgc2VuZCB0byBzZXJ2ZXIuIEEgYmxvYiBuYW1lZCAiYjoiIHdpbGwgYmUgY3JlYXRlZC4KICAgICAqIC0gV2hlbiBjdXN0b21lciBVUkwgc3RyaW5nIGlzICJodHRwOi8vYWNjb3VudC5ibG9iLmNvcmUud2luZG93cy5uZXQvY29uL2IlM0EiLAogICAgICogICBTREsgd2lsbCBlbmNvZGUgaXQgdG8gImh0dHA6Ly9hY2NvdW50LmJsb2IuY29yZS53aW5kb3dzLm5ldC9jb24vYiUyNTNBIiBhbmQgc2VuZCB0byBzZXJ2ZXIuIEEgYmxvYiBuYW1lZCAiYiUzQSIgd2lsbCBiZSBjcmVhdGVkLgogICAgICoKICAgICAqIEJ1dCB0aGlzIHN0cmF0ZWd5IHdpbGwgbWFrZSBpdCBub3QgcG9zc2libGUgdG8gY3JlYXRlIGEgYmxvYiB3aXRoICI/IiBpbiBpdCdzIG5hbWUuIEJlY2F1c2Ugd2hlbiBjdXN0b21lciBVUkwgc3RyaW5nIGlzCiAgICAgKiAiaHR0cDovL2FjY291bnQuYmxvYi5jb3JlLndpbmRvd3MubmV0L2Nvbi9ibG9iP25hbWUiLCB0aGUgIj9uYW1lIiB3aWxsIGJlIHRyZWF0ZWQgYXMgVVJMIHBhcmFtdGVyIGluc3RlYWQgb2YgYmxvYiBuYW1lLgogICAgICogSWYgY3VzdG9tZXIgVVJMIHN0cmluZyBpcyAiaHR0cDovL2FjY291bnQuYmxvYi5jb3JlLndpbmRvd3MubmV0L2Nvbi9ibG9iJTNGbmFtZSIsIGEgYmxvYiBuYW1lZCAiYmxvYiUzRm5hbWUiIHdpbGwgYmUgY3JlYXRlZC4KICAgICAqIFYyIFNESyBkb2Vzbid0IGhhdmUgdGhpcyBpc3N1ZSBiZWNhdXNlIGl0IGRvZXNuJ3QgYWxsb3cgY3VzdG9tZXIgcGFzcyBpbiBhIGZ1bGwgVVJMLCBpdCBhY2NlcHRzIGEgc2VwYXJhdGUgYmxvYiBuYW1lIGFuZCBlbmNvZGVVUklDb21wb25lbnQgZm9yIGl0LgogICAgICogV2UgY2Fubm90IGFjY2VwdCBhIFNESyBjYW5ub3QgY3JlYXRlIGEgYmxvYiBuYW1lIHdpdGggIj8iLiBTbyB3ZSBpbXBsZW1lbnQgc3RyYXRlZ3kgdHdvOgogICAgICoKICAgICAqICMjIyBTdHJhdGVneSBUd286IFNESyBkb2Vzbid0IGFzc3VtZSB0aGUgVVJMIGhhcyBiZWVuIGVuY29kZWQgb3Igbm90LiBJdCB3aWxsIGp1c3QgZXNjYXBlIHRoZSBzcGVjaWFsIGNoYXJhY3RlcnMuCiAgICAgKgogICAgICogVGhpcyBpcyB3aGF0IFYxMCBCbG9iIEdvIFNESyBkb2VzLiBJdCBhY2NlcHRzIGEgVVJMIHR5cGUgaW4gR28sIGFuZCBjYWxsIHVybC5Fc2NhcGVkUGF0aCgpIHRvIGVzY2FwZSB0aGUgc3BlY2lhbCBjaGFycyB1bmVzY2FwZWQuCiAgICAgKiAtIFdoZW4gY3VzdG9tZXIgVVJMIHN0cmluZyBpcyAiaHR0cDovL2FjY291bnQuYmxvYi5jb3JlLndpbmRvd3MubmV0L2Nvbi9iOiIsCiAgICAgKiAgIFNESyB3aWxsIGVzY2FwZSAiOiIgbGlrZSAiaHR0cDovL2FjY291bnQuYmxvYi5jb3JlLndpbmRvd3MubmV0L2Nvbi9iJTNBIiBhbmQgc2VuZCB0byBzZXJ2ZXIuIEEgYmxvYiBuYW1lZCAiYjoiIHdpbGwgYmUgY3JlYXRlZC4KICAgICAqIC0gV2hlbiBjdXN0b21lciBVUkwgc3RyaW5nIGlzICJodHRwOi8vYWNjb3VudC5ibG9iLmNvcmUud2luZG93cy5uZXQvY29uL2IlM0EiLAogICAgICogICBUaGVyZSBpcyBubyBzcGVjaWFsIGNoYXJhY3RlcnMsIHNvIHNlbmQgImh0dHA6Ly9hY2NvdW50LmJsb2IuY29yZS53aW5kb3dzLm5ldC9jb24vYiUzQSIgdG8gc2VydmVyLiBBIGJsb2IgbmFtZWQgImI6IiB3aWxsIGJlIGNyZWF0ZWQuCiAgICAgKiAtIFdoZW4gY3VzdG9tZXIgVVJMIHN0cmluZyBpcyAiaHR0cDovL2FjY291bnQuYmxvYi5jb3JlLndpbmRvd3MubmV0L2Nvbi9iJTI1M0EiLAogICAgICogICBUaGVyZSBpcyBubyBzcGVjaWFsIGNoYXJhY3RlcnMsIHNvIHNlbmQgImh0dHA6Ly9hY2NvdW50LmJsb2IuY29yZS53aW5kb3dzLm5ldC9jb24vYiUyNTNBIiB0byBzZXJ2ZXIuIEEgYmxvYiBuYW1lZCAiYiUzQSIgd2lsbCBiZSBjcmVhdGVkLgogICAgICoKICAgICAqIFRoaXMgc3RyYXRlZ3kgZ2l2ZXMgdXMgZmxleGliaWxpdHkgdG8gY3JlYXRlIHdpdGggYW55IHNwZWNpYWwgY2hhcmFjdGVycy4gQnV0ICIlIiB3aWxsIGJlIHRyZWF0ZWQgYXMgYSBzcGVjaWFsIGNoYXJhY3RlcnMsIGlmIHRoZSBVUkwgc3RyaW5nCiAgICAgKiBpcyBub3QgZW5jb2RlZCwgdGhlcmUgc2hvdWxkbid0IGEgIiUiIGluIHRoZSBVUkwgc3RyaW5nLCBvdGhlcndpc2UgdGhlIFVSTCBpcyBub3QgYSB2YWxpZCBVUkwuCiAgICAgKiBJZiBjdXN0b21lciBuZWVkcyB0byBjcmVhdGUgYSBibG9iIHdpdGggIiUiIGluIGl0J3MgYmxvYiBuYW1lLCB1c2UgIiUyNSIgaW5zZWFkIG9mICIlIi4gSnVzdCBsaWtlIGFib3ZlIDNyZCBzYW1wbGUuCiAgICAgKiBBbmQgZm9sbG93aW5nIFVSTCBzdHJpbmdzIGFyZSBpbnZhbGlkOgogICAgICogLSAiaHR0cDovL2FjY291bnQuYmxvYi5jb3JlLndpbmRvd3MubmV0L2Nvbi9iJSIKICAgICAqIC0gImh0dHA6Ly9hY2NvdW50LmJsb2IuY29yZS53aW5kb3dzLm5ldC9jb24vYiUyIgogICAgICogLSAiaHR0cDovL2FjY291bnQuYmxvYi5jb3JlLndpbmRvd3MubmV0L2Nvbi9iJUciCiAgICAgKgogICAgICogQW5vdGhlciBzcGVjaWFsIGNoYXJhY3RlciBpcyAiPyIsIHVzZSAiJTJGIiB0byByZXByZXNlbnQgYSBibG9iIG5hbWUgd2l0aCAiPyIgaW4gYSBVUkwgc3RyaW5nLgogICAgICoKICAgICAqICMjIyBTdHJhdGVneSBmb3IgY29udGFpbmVyTmFtZSwgYmxvYk5hbWUgb3Igb3RoZXIgc3BlY2lmaWMgWFhYTmFtZSBwYXJhbWV0ZXJzIGluIG1ldGhvZHMgc3VjaCBhcyBgQmxvYlVSTC5mcm9tQ29udGFpbmVyVVJMKGNvbnRhaW5lclVSTCwgYmxvYk5hbWUpYAogICAgICoKICAgICAqIFdlIHdpbGwgYXBwbHkgc3RyYXRlZ3kgb25lLCBhbmQgY2FsbCBlbmNvZGVVUklDb21wb25lbnQgZm9yIHRoZXNlIHBhcmFtZXRlcnMgbGlrZSBibG9iTmFtZS4gQmVjYXVzZSB3aGF0IGN1c3RvbWVycyBwYXNzZXMgaW4gaXMgYSBwbGFpbiBuYW1lIGluc3RlYWQgb2YgYSBVUkwuCiAgICAgKgogICAgICogQHNlZSBodHRwczovL2RvY3MubWljcm9zb2Z0LmNvbS9lbi11cy9yZXN0L2FwaS9zdG9yYWdlc2VydmljZXMvbmFtaW5nLWFuZC1yZWZlcmVuY2luZy1jb250YWluZXJzLS1ibG9icy0tYW5kLW1ldGFkYXRhCiAgICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5taWNyb3NvZnQuY29tL2VuLXVzL3Jlc3QvYXBpL3N0b3JhZ2VzZXJ2aWNlcy9uYW1pbmctYW5kLXJlZmVyZW5jaW5nLXNoYXJlcy0tZGlyZWN0b3JpZXMtLWZpbGVzLS1hbmQtbWV0YWRhdGEKICAgICAqCiAgICAgKiBAZXhwb3J0CiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsCiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfQogICAgICovCiAgICBmdW5jdGlvbiBlc2NhcGVVUkxQYXRoKHVybCkgewogICAgICAgIHZhciB1cmxQYXJzZWQgPSBVUkxCdWlsZGVyLnBhcnNlKHVybCk7CiAgICAgICAgdmFyIHBhdGggPSB1cmxQYXJzZWQuZ2V0UGF0aCgpOwogICAgICAgIHBhdGggPSBwYXRoIHx8ICIvIjsKICAgICAgICBwYXRoID0gZXNjYXBlKHBhdGgpOwogICAgICAgIHVybFBhcnNlZC5zZXRQYXRoKHBhdGgpOwogICAgICAgIHJldHVybiB1cmxQYXJzZWQudG9TdHJpbmcoKTsKICAgIH0KICAgIC8qKgogICAgICogSW50ZXJuYWwgZXNjYXBlIG1ldGhvZCBpbXBsbWVudGVkIFN0cmF0ZWd5IFR3byBtZW50aW9uZWQgaW4gZXNjYXBlVVJMKCkgZGVzY3JpcHRpb24uCiAgICAgKgogICAgICogQHBhcmFtIHtzdHJpbmd9IHRleHQKICAgICAqIEByZXR1cm5zIHtzdHJpbmd9CiAgICAgKi8KICAgIGZ1bmN0aW9uIGVzY2FwZSh0ZXh0KSB7CiAgICAgICAgcmV0dXJuIGVuY29kZVVSSUNvbXBvbmVudCh0ZXh0KQogICAgICAgICAgICAucmVwbGFjZSgvJTJGL2csICIvIikgLy8gRG9uJ3QgZXNjYXBlIGZvciAiLyIKICAgICAgICAgICAgLnJlcGxhY2UoLycvZywgIiUyNyIpIC8vIEVzY2FwZSBmb3IgIiciCiAgICAgICAgICAgIC5yZXBsYWNlKC9cKy9nLCAiJTIwIikKICAgICAgICAgICAgLnJlcGxhY2UoLyUyNS9nLCAiJSIpOyAvLyBSZXZlcnQgZW5jb2RlZCAiJSIKICAgIH0KICAgIC8qKgogICAgICogQXBwZW5kIGEgc3RyaW5nIHRvIFVSTCBwYXRoLiBXaWxsIHJlbW92ZSBkdXBsaWNhdGVkICIvIiBpbiBmcm9udCBvZiB0aGUgc3RyaW5nCiAgICAgKiB3aGVuIFVSTCBwYXRoIGVuZHMgd2l0aCBhICIvIi4KICAgICAqCiAgICAgKiBAZXhwb3J0CiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsIFNvdXJjZSBVUkwgc3RyaW5nCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZSBTdHJpbmcgdG8gYmUgYXBwZW5kZWQgdG8gVVJMCiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBBbiB1cGRhdGVkIFVSTCBzdHJpbmcKICAgICAqLwogICAgZnVuY3Rpb24gYXBwZW5kVG9VUkxQYXRoKHVybCwgbmFtZSkgewogICAgICAgIHZhciB1cmxQYXJzZWQgPSBVUkxCdWlsZGVyLnBhcnNlKHVybCk7CiAgICAgICAgdmFyIHBhdGggPSB1cmxQYXJzZWQuZ2V0UGF0aCgpOwogICAgICAgIHBhdGggPSBwYXRoID8gKHBhdGguZW5kc1dpdGgoIi8iKSA/ICIiICsgcGF0aCArIG5hbWUgOiBwYXRoICsgIi8iICsgbmFtZSkgOiBuYW1lOwogICAgICAgIHVybFBhcnNlZC5zZXRQYXRoKHBhdGgpOwogICAgICAgIHJldHVybiB1cmxQYXJzZWQudG9TdHJpbmcoKTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IFVSTCBwYXJhbWV0ZXIgbmFtZSBhbmQgdmFsdWUuIElmIG5hbWUgZXhpc3RzIGluIFVSTCBwYXJhbWV0ZXJzLCBvbGQgdmFsdWUKICAgICAqIHdpbGwgYmUgcmVwbGFjZWQgYnkgbmFtZSBrZXkuIElmIG5vdCBwcm92aWRlIHZhbHVlLCB0aGUgcGFyYW1ldGVyIHdpbGwgYmUgZGVsZXRlZC4KICAgICAqCiAgICAgKiBAZXhwb3J0CiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsIFNvdXJjZSBVUkwgc3RyaW5nCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZSBQYXJhbWV0ZXIgbmFtZQogICAgICogQHBhcmFtIHtzdHJpbmd9IFt2YWx1ZV0gUGFyYW1ldGVyIHZhbHVlCiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBBbiB1cGRhdGVkIFVSTCBzdHJpbmcKICAgICAqLwogICAgZnVuY3Rpb24gc2V0VVJMUGFyYW1ldGVyKHVybCwgbmFtZSwgdmFsdWUpIHsKICAgICAgICB2YXIgdXJsUGFyc2VkID0gVVJMQnVpbGRlci5wYXJzZSh1cmwpOwogICAgICAgIHVybFBhcnNlZC5zZXRRdWVyeVBhcmFtZXRlcihuYW1lLCB2YWx1ZSk7CiAgICAgICAgcmV0dXJuIHVybFBhcnNlZC50b1N0cmluZygpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgVVJMIHBhcmFtZXRlciBieSBuYW1lLgogICAgICoKICAgICAqIEBleHBvcnQKICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cmwKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lCiAgICAgKiBAcmV0dXJucyB7KHN0cmluZyB8IHN0cmluZ1tdIHwgdW5kZWZpbmVkKX0KICAgICAqLwogICAgZnVuY3Rpb24gZ2V0VVJMUGFyYW1ldGVyKHVybCwgbmFtZSkgewogICAgICAgIHZhciB1cmxQYXJzZWQgPSBVUkxCdWlsZGVyLnBhcnNlKHVybCk7CiAgICAgICAgcmV0dXJuIHVybFBhcnNlZC5nZXRRdWVyeVBhcmFtZXRlclZhbHVlKG5hbWUpOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgVVJMIGhvc3QuCiAgICAgKgogICAgICogQGV4cG9ydAogICAgICogQHBhcmFtIHtzdHJpbmd9IHVybCBTb3VyY2UgVVJMIHN0cmluZwogICAgICogQHBhcmFtIHtzdHJpbmd9IGhvc3QgTmV3IGhvc3Qgc3RyaW5nCiAgICAgKiBAcmV0dXJucyBBbiB1cGRhdGVkIFVSTCBzdHJpbmcKICAgICAqLwogICAgZnVuY3Rpb24gc2V0VVJMSG9zdCh1cmwsIGhvc3QpIHsKICAgICAgICB2YXIgdXJsUGFyc2VkID0gVVJMQnVpbGRlci5wYXJzZSh1cmwpOwogICAgICAgIHVybFBhcnNlZC5zZXRIb3N0KGhvc3QpOwogICAgICAgIHJldHVybiB1cmxQYXJzZWQudG9TdHJpbmcoKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IFVSTCBwYXRoIGZyb20gYW4gVVJMIHN0cmluZy4KICAgICAqCiAgICAgKiBAZXhwb3J0CiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsIFNvdXJjZSBVUkwgc3RyaW5nCiAgICAgKiBAcmV0dXJucyB7KHN0cmluZyB8IHVuZGVmaW5lZCl9CiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldFVSTFBhdGgodXJsKSB7CiAgICAgICAgdmFyIHVybFBhcnNlZCA9IFVSTEJ1aWxkZXIucGFyc2UodXJsKTsKICAgICAgICByZXR1cm4gdXJsUGFyc2VkLmdldFBhdGgoKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IFVSTCBzY2hlbWUgZnJvbSBhbiBVUkwgc3RyaW5nLgogICAgICoKICAgICAqIEBleHBvcnQKICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgU291cmNlIFVSTCBzdHJpbmcKICAgICAqIEByZXR1cm5zIHsoc3RyaW5nIHwgdW5kZWZpbmVkKX0KICAgICAqLwogICAgZnVuY3Rpb24gZ2V0VVJMU2NoZW1lKHVybCkgewogICAgICAgIHZhciB1cmxQYXJzZWQgPSBVUkxCdWlsZGVyLnBhcnNlKHVybCk7CiAgICAgICAgcmV0dXJuIHVybFBhcnNlZC5nZXRTY2hlbWUoKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IFVSTCBwYXRoIGFuZCBxdWVyeSBmcm9tIGFuIFVSTCBzdHJpbmcuCiAgICAgKgogICAgICogQGV4cG9ydAogICAgICogQHBhcmFtIHtzdHJpbmd9IHVybCBTb3VyY2UgVVJMIHN0cmluZwogICAgICogQHJldHVybnMgeyhzdHJpbmcgfCB1bmRlZmluZWQpfQogICAgICovCiAgICBmdW5jdGlvbiBnZXRVUkxQYXRoQW5kUXVlcnkodXJsKSB7CiAgICAgICAgdmFyIHVybFBhcnNlZCA9IFVSTEJ1aWxkZXIucGFyc2UodXJsKTsKICAgICAgICB2YXIgcGF0aFN0cmluZyA9IHVybFBhcnNlZC5nZXRQYXRoKCk7CiAgICAgICAgaWYgKCFwYXRoU3RyaW5nKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCJJbnZhbGlkIHVybCB3aXRob3V0IHZhbGlkIHBhdGguIik7CiAgICAgICAgfQogICAgICAgIHZhciBxdWVyeVN0cmluZyA9IHVybFBhcnNlZC5nZXRRdWVyeSgpIHx8ICIiOwogICAgICAgIHF1ZXJ5U3RyaW5nID0gcXVlcnlTdHJpbmcudHJpbSgpOwogICAgICAgIGlmIChxdWVyeVN0cmluZyAhPSAiIikgewogICAgICAgICAgICBxdWVyeVN0cmluZyA9IHF1ZXJ5U3RyaW5nLnN0YXJ0c1dpdGgoIj8iKSA/IHF1ZXJ5U3RyaW5nIDogIj8iICsgcXVlcnlTdHJpbmc7IC8vIEVuc3VyZSBxdWVyeSBzdHJpbmcgc3RhcnQgd2l0aCAnPycKICAgICAgICB9CiAgICAgICAgcmV0dXJuICIiICsgcGF0aFN0cmluZyArIHF1ZXJ5U3RyaW5nOwogICAgfQogICAgLyoqCiAgICAgKiBSb3VuZHMgYSBkYXRlIG9mZiB0byBzZWNvbmRzLgogICAgICoKICAgICAqIEBleHBvcnQKICAgICAqIEBwYXJhbSB7RGF0ZX0gZGF0ZQogICAgICogQHBhcmFtIHtib29sZWFufSBbd2l0aE1pbGxpc2Vjb25kcz10cnVlXSBJZiB0cnVlLCBZWVlZLU1NLUREVGhoOm1tOnNzLmZmZmZmZmZaIHdpbGwgYmUgcmV0dXJuZWQ7CiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElmIGZhbHNlLCBZWVlZLU1NLUREVGhoOm1tOnNzWiB3aWxsIGJlIHJldHVybmVkLgogICAgICogQHJldHVybnMge3N0cmluZ30gRGF0ZSBzdHJpbmcgaW4gSVNPODA2MSBmb3JtYXQsIHdpdGggb3Igd2l0aG91dCA3IG1pbGxpc2Vjb25kcyBjb21wb25lbnQKICAgICAqLwogICAgZnVuY3Rpb24gdHJ1bmNhdGVkSVNPODA2MURhdGUoZGF0ZSwgd2l0aE1pbGxpc2Vjb25kcykgewogICAgICAgIGlmICh3aXRoTWlsbGlzZWNvbmRzID09PSB2b2lkIDApIHsgd2l0aE1pbGxpc2Vjb25kcyA9IHRydWU7IH0KICAgICAgICAvLyBEYXRlLnRvSVNPU3RyaW5nKCkgd2lsbCByZXR1cm4gbGlrZSAiMjAxOC0xMC0yOVQwNjozNDozNi4xMzlaIgogICAgICAgIHZhciBkYXRlU3RyaW5nID0gZGF0ZS50b0lTT1N0cmluZygpOwogICAgICAgIHJldHVybiB3aXRoTWlsbGlzZWNvbmRzCiAgICAgICAgICAgID8gZGF0ZVN0cmluZy5zdWJzdHJpbmcoMCwgZGF0ZVN0cmluZy5sZW5ndGggLSAxKSArICIwMDAwIiArICJaIgogICAgICAgICAgICA6IGRhdGVTdHJpbmcuc3Vic3RyaW5nKDAsIGRhdGVTdHJpbmcubGVuZ3RoIC0gNSkgKyAiWiI7CiAgICB9CiAgICAvKioKICAgICAqIEJhc2U2NCBlbmNvZGUuCiAgICAgKgogICAgICogQGV4cG9ydAogICAgICogQHBhcmFtIHtzdHJpbmd9IGNvbnRlbnQKICAgICAqIEByZXR1cm5zIHtzdHJpbmd9CiAgICAgKi8KICAgIGZ1bmN0aW9uIGJhc2U2NGVuY29kZShjb250ZW50KSB7CiAgICAgICAgcmV0dXJuICFpc05vZGUgPyBidG9hKGNvbnRlbnQpIDogQnVmZmVyLmZyb20oY29udGVudCkudG9TdHJpbmcoImJhc2U2NCIpOwogICAgfQogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBhIDY0IGJ5dGVzIGJhc2U2NCBibG9jayBJRCBzdHJpbmcuCiAgICAgKgogICAgICogQGV4cG9ydAogICAgICogQHBhcmFtIHtudW1iZXJ9IGJsb2NrSW5kZXgKICAgICAqIEByZXR1cm5zIHtzdHJpbmd9CiAgICAgKi8KICAgIGZ1bmN0aW9uIGdlbmVyYXRlQmxvY2tJRChibG9ja0lEUHJlZml4LCBibG9ja0luZGV4KSB7CiAgICAgICAgLy8gVG8gZ2VuZXJhdGUgYSA2NCBieXRlcyBiYXNlNjQgc3RyaW5nLCBzb3VyY2Ugc3RyaW5nIHNob3VsZCBiZSA0OAogICAgICAgIHZhciBtYXhTb3VyY2VTdHJpbmdMZW5ndGggPSA0ODsKICAgICAgICAvLyBBIGJsb2IgY2FuIGhhdmUgYSBtYXhpbXVtIG9mIDEwMCwwMDAgdW5jb21taXR0ZWQgYmxvY2tzIGF0IGFueSBnaXZlbiB0aW1lCiAgICAgICAgdmFyIG1heEJsb2NrSW5kZXhMZW5ndGggPSA2OwogICAgICAgIHZhciBtYXhBbGxvd2VkQmxvY2tJRFByZWZpeExlbmd0aCA9IG1heFNvdXJjZVN0cmluZ0xlbmd0aCAtIG1heEJsb2NrSW5kZXhMZW5ndGg7CiAgICAgICAgaWYgKGJsb2NrSURQcmVmaXgubGVuZ3RoID4gbWF4QWxsb3dlZEJsb2NrSURQcmVmaXhMZW5ndGgpIHsKICAgICAgICAgICAgYmxvY2tJRFByZWZpeCA9IGJsb2NrSURQcmVmaXguc2xpY2UoMCwgbWF4QWxsb3dlZEJsb2NrSURQcmVmaXhMZW5ndGgpOwogICAgICAgIH0KICAgICAgICB2YXIgcmVzID0gYmxvY2tJRFByZWZpeCArCiAgICAgICAgICAgIHBhZFN0YXJ0KGJsb2NrSW5kZXgudG9TdHJpbmcoKSwgbWF4U291cmNlU3RyaW5nTGVuZ3RoIC0gYmxvY2tJRFByZWZpeC5sZW5ndGgsICIwIik7CiAgICAgICAgcmV0dXJuIGJhc2U2NGVuY29kZShyZXMpOwogICAgfQogICAgLyoqCiAgICAgKiBEZWxheSBzcGVjaWZpZWQgdGltZSBpbnRlcnZhbC4KICAgICAqCiAgICAgKiBAZXhwb3J0CiAgICAgKiBAcGFyYW0ge251bWJlcn0gdGltZUluTXMKICAgICAqIEBwYXJhbSB7QWJvcnRTaWduYWxMaWtlfSBbYWJvcnRlcl0KICAgICAqIEBwYXJhbSB7RXJyb3J9IFthYm9ydEVycm9yXQogICAgICovCiAgICBmdW5jdGlvbiBkZWxheSQxKHRpbWVJbk1zLCBhYm9ydGVyLCBhYm9ydEVycm9yKSB7CiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGltZW91dDsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFib3J0SGFuZGxlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aW1lb3V0ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoYWJvcnRFcnJvcik7CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXNvbHZlSGFuZGxlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYm9ydGVyICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYm9ydGVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoImFib3J0IiwgYWJvcnRIYW5kbGVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgdGltZW91dCA9IHNldFRpbWVvdXQocmVzb2x2ZUhhbmRsZXIsIHRpbWVJbk1zKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFib3J0ZXIgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWJvcnRlci5hZGRFdmVudExpc3RlbmVyKCJhYm9ydCIsIGFib3J0SGFuZGxlcik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KV07CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfQogICAgLyoqCiAgICAgKiBTdHJpbmcucHJvdG90eXBlLnBhZFN0YXJ0KCkKICAgICAqCiAgICAgKiBAZXhwb3J0CiAgICAgKiBAcGFyYW0ge3N0cmluZ30gY3VycmVudFN0cmluZwogICAgICogQHBhcmFtIHtudW1iZXJ9IHRhcmdldExlbmd0aAogICAgICogQHBhcmFtIHtzdHJpbmd9IFtwYWRTdHJpbmc9IiAiXQogICAgICogQHJldHVybnMge3N0cmluZ30KICAgICAqLwogICAgZnVuY3Rpb24gcGFkU3RhcnQoY3VycmVudFN0cmluZywgdGFyZ2V0TGVuZ3RoLCBwYWRTdHJpbmcpIHsKICAgICAgICBpZiAocGFkU3RyaW5nID09PSB2b2lkIDApIHsgcGFkU3RyaW5nID0gIiAiOyB9CiAgICAgICAgaWYgKFN0cmluZy5wcm90b3R5cGUucGFkU3RhcnQpIHsKICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRTdHJpbmcucGFkU3RhcnQodGFyZ2V0TGVuZ3RoLCBwYWRTdHJpbmcpOwogICAgICAgIH0KICAgICAgICBwYWRTdHJpbmcgPSBwYWRTdHJpbmcgfHwgIiAiOwogICAgICAgIGlmIChjdXJyZW50U3RyaW5nLmxlbmd0aCA+IHRhcmdldExlbmd0aCkgewogICAgICAgICAgICByZXR1cm4gY3VycmVudFN0cmluZzsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHRhcmdldExlbmd0aCA9IHRhcmdldExlbmd0aCAtIGN1cnJlbnRTdHJpbmcubGVuZ3RoOwogICAgICAgICAgICBpZiAodGFyZ2V0TGVuZ3RoID4gcGFkU3RyaW5nLmxlbmd0aCkgewogICAgICAgICAgICAgICAgcGFkU3RyaW5nICs9IHBhZFN0cmluZy5yZXBlYXQodGFyZ2V0TGVuZ3RoIC8gcGFkU3RyaW5nLmxlbmd0aCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHBhZFN0cmluZy5zbGljZSgwLCB0YXJnZXRMZW5ndGgpICsgY3VycmVudFN0cmluZzsKICAgICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIElmIHR3byBzdHJpbmdzIGFyZSBlcXVhbCB3aGVuIGNvbXBhcmVkIGNhc2UgaW5zZW5zaXRpdmUuCiAgICAgKgogICAgICogQGV4cG9ydAogICAgICogQHBhcmFtIHtzdHJpbmd9IHN0cjEKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBzdHIyCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0KICAgICAqLwogICAgZnVuY3Rpb24gaUVxdWFsKHN0cjEsIHN0cjIpIHsKICAgICAgICByZXR1cm4gc3RyMS50b0xvY2FsZUxvd2VyQ2FzZSgpID09PSBzdHIyLnRvTG9jYWxlTG93ZXJDYXNlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBCcm93c2VyUG9saWN5IHdpbGwgaGFuZGxlIGRpZmZlcmVuY2VzIGJldHdlZW4gTm9kZS5qcyBhbmQgYnJvd3NlciBydW50aW1lLCBpbmNsdWRpbmc6CiAgICAgKgogICAgICogMS4gQnJvd3NlcnMgY2FjaGUgR0VUL0hFQUQgcmVxdWVzdHMgYnkgYWRkaW5nIGNvbmRpdGlvbmFsIGhlYWRlcnMgc3VjaCBhcyAnSUZfTU9ESUZJRURfU0lOQ0UnLgogICAgICogQnJvd3NlclBvbGljeSBpcyBhIHBvbGljeSB1c2VkIHRvIGFkZCBhIHRpbWVzdGFtcCBxdWVyeSB0byBHRVQvSEVBRCByZXF1ZXN0IFVSTAogICAgICogdGh1cyBhdm9pZCB0aGUgYnJvd3NlciBjYWNoZS4KICAgICAqCiAgICAgKiAyLiBSZW1vdmUgY29va2llIGhlYWRlciBmb3Igc2VjdXJpdHkKICAgICAqCiAgICAgKiAzLiBSZW1vdmUgY29udGVudC1sZW5ndGggaGVhZGVyIHRvIGF2b2lkIGJyb3dzZXJzIHdhcm5pbmcKICAgICAqCiAgICAgKiBAY2xhc3MgQnJvd3NlclBvbGljeQogICAgICogQGV4dGVuZHMge0Jhc2VSZXF1ZXN0UG9saWN5fQogICAgICovCiAgICB2YXIgQnJvd3NlclBvbGljeSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKICAgICAgICBfX2V4dGVuZHMoQnJvd3NlclBvbGljeSwgX3N1cGVyKTsKICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIEJyb3dzZXJQb2xpY3kuCiAgICAgICAgICogQHBhcmFtIHtSZXF1ZXN0UG9saWN5fSBuZXh0UG9saWN5CiAgICAgICAgICogQHBhcmFtIHtSZXF1ZXN0UG9saWN5T3B0aW9uc30gb3B0aW9ucwogICAgICAgICAqIEBtZW1iZXJvZiBCcm93c2VyUG9saWN5CiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gQnJvd3NlclBvbGljeShuZXh0UG9saWN5LCBvcHRpb25zKSB7CiAgICAgICAgICAgIHJldHVybiBfc3VwZXIuY2FsbCh0aGlzLCBuZXh0UG9saWN5LCBvcHRpb25zKSB8fCB0aGlzOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZW5kcyBvdXQgcmVxdWVzdC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7V2ViUmVzb3VyY2V9IHJlcXVlc3QKICAgICAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxIdHRwT3BlcmF0aW9uUmVzcG9uc2U+fQogICAgICAgICAqIEBtZW1iZXJvZiBCcm93c2VyUG9saWN5CiAgICAgICAgICovCiAgICAgICAgQnJvd3NlclBvbGljeS5wcm90b3R5cGUuc2VuZFJlcXVlc3QgPSBmdW5jdGlvbiAocmVxdWVzdCkgewogICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcXVlc3QubWV0aG9kLnRvVXBwZXJDYXNlKCkgPT09ICJHRVQiIHx8IHJlcXVlc3QubWV0aG9kLnRvVXBwZXJDYXNlKCkgPT09ICJIRUFEIikgewogICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnVybCA9IHNldFVSTFBhcmFtZXRlcihyZXF1ZXN0LnVybCwgVVJMQ29uc3RhbnRzLlBhcmFtZXRlcnMuRk9SQ0VfQlJPV1NFUl9OT19DQUNIRSwgbmV3IERhdGUoKS5nZXRUaW1lKCkudG9TdHJpbmcoKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuaGVhZGVycy5yZW1vdmUoSGVhZGVyQ29uc3RhbnRzLkNPT0tJRSk7CiAgICAgICAgICAgICAgICAgICAgLy8gQWNjb3JkaW5nIHRvIFhIUiBzdGFuZGFyZHMsIGNvbnRlbnQtbGVuZ3RoIHNob3VsZCBiZSBmdWxseSBjb250cm9sbGVkIGJ5IGJyb3dzZXJzCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5oZWFkZXJzLnJlbW92ZShIZWFkZXJDb25zdGFudHMuQ09OVEVOVF9MRU5HVEgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCB0aGlzLl9uZXh0UG9saWN5LnNlbmRSZXF1ZXN0KHJlcXVlc3QpXTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICAgIHJldHVybiBCcm93c2VyUG9saWN5OwogICAgfShCYXNlUmVxdWVzdFBvbGljeSkpOwoKICAgIC8qKgogICAgICogQnJvd3NlclBvbGljeUZhY3RvcnkgaXMgYSBmYWN0b3J5IGNsYXNzIGhlbHBpbmcgZ2VuZXJhdGluZyBCcm93c2VyUG9saWN5IG9iamVjdHMuCiAgICAgKgogICAgICogQGV4cG9ydAogICAgICogQGNsYXNzIEJyb3dzZXJQb2xpY3lGYWN0b3J5CiAgICAgKiBAaW1wbGVtZW50cyB7UmVxdWVzdFBvbGljeUZhY3Rvcnl9CiAgICAgKi8KICAgIHZhciBCcm93c2VyUG9saWN5RmFjdG9yeSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBCcm93c2VyUG9saWN5RmFjdG9yeSgpIHsKICAgICAgICB9CiAgICAgICAgQnJvd3NlclBvbGljeUZhY3RvcnkucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uIChuZXh0UG9saWN5LCBvcHRpb25zKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgQnJvd3NlclBvbGljeShuZXh0UG9saWN5LCBvcHRpb25zKTsKICAgICAgICB9OwogICAgICAgIHJldHVybiBCcm93c2VyUG9saWN5RmFjdG9yeTsKICAgIH0oKSk7CgogICAgLyoqCiAgICAgKiBDcmVkZW50aWFsIGlzIGFuIGFic3RyYWN0IGNsYXNzIGZvciBBenVyZSBTdG9yYWdlIEhUVFAgcmVxdWVzdHMgc2lnbmluZy4gVGhpcwogICAgICogY2xhc3Mgd2lsbCBob3N0IGFuIGNyZWRlbnRpYWxQb2xpY3lDcmVhdG9yIGZhY3Rvcnkgd2hpY2ggZ2VuZXJhdGVzIENyZWRlbnRpYWxQb2xpY3kuCiAgICAgKgogICAgICogQGV4cG9ydAogICAgICogQGFic3RyYWN0CiAgICAgKiBAY2xhc3MgQ3JlZGVudGlhbAogICAgICovCiAgICB2YXIgQ3JlZGVudGlhbCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBDcmVkZW50aWFsKCkgewogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGVzIGEgUmVxdWVzdFBvbGljeSBvYmplY3QuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge1JlcXVlc3RQb2xpY3l9IF9uZXh0UG9saWN5CiAgICAgICAgICogQHBhcmFtIHtSZXF1ZXN0UG9saWN5T3B0aW9uc30gX29wdGlvbnMKICAgICAgICAgKiBAcmV0dXJucyB7UmVxdWVzdFBvbGljeX0KICAgICAgICAgKiBAbWVtYmVyb2YgQ3JlZGVudGlhbAogICAgICAgICAqLwogICAgICAgIENyZWRlbnRpYWwucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uICgKICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6dmFyaWFibGUtbmFtZQogICAgICAgIF9uZXh0UG9saWN5LCAKICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6dmFyaWFibGUtbmFtZQogICAgICAgIF9vcHRpb25zKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiTWV0aG9kIHNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBjaGlsZHJlbiBjbGFzc2VzLiIpOwogICAgICAgIH07CiAgICAgICAgcmV0dXJuIENyZWRlbnRpYWw7CiAgICB9KCkpOwoKICAgIC8qCiAgICAgKiBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICAgICAqIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS4gU2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yCiAgICAgKiBsaWNlbnNlIGluZm9ybWF0aW9uLgogICAgICoKICAgICAqIENvZGUgZ2VuZXJhdGVkIGJ5IE1pY3Jvc29mdCAoUikgQXV0b1Jlc3QgQ29kZSBHZW5lcmF0b3IuCiAgICAgKiBDaGFuZ2VzIG1heSBjYXVzZSBpbmNvcnJlY3QgYmVoYXZpb3IgYW5kIHdpbGwgYmUgbG9zdCBpZiB0aGUgY29kZSBpcwogICAgICogcmVnZW5lcmF0ZWQuCiAgICAgKi8KICAgIHZhciBwYWNrYWdlTmFtZSA9ICJhenVyZS1zdG9yYWdlLWJsb2IiOwogICAgdmFyIHBhY2thZ2VWZXJzaW9uID0gIjEuMC4wIjsKICAgIHZhciBTdG9yYWdlQ2xpZW50Q29udGV4dCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKICAgICAgICBfX2V4dGVuZHMoU3RvcmFnZUNsaWVudENvbnRleHQsIF9zdXBlcik7CiAgICAgICAgLyoqCiAgICAgICAgICogSW5pdGlhbGl6ZXMgYSBuZXcgaW5zdGFuY2Ugb2YgdGhlIFN0b3JhZ2VDbGllbnRDb250ZXh0IGNsYXNzLgogICAgICAgICAqIEBwYXJhbSB1cmwgVGhlIFVSTCBvZiB0aGUgc2VydmljZSBhY2NvdW50LCBjb250YWluZXIsIG9yIGJsb2IgdGhhdCBpcyB0aGUgdGFyZ2Ugb2YgdGhlIGRlc2lyZWQKICAgICAgICAgKiBvcGVyYXRpb24uCiAgICAgICAgICogQHBhcmFtIFtvcHRpb25zXSBUaGUgcGFyYW1ldGVyIG9wdGlvbnMKICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBTdG9yYWdlQ2xpZW50Q29udGV4dCh1cmwsIG9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICAgICAgaWYgKHVybCA9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiJ3VybCcgY2Fubm90IGJlIG51bGwuIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFvcHRpb25zKSB7CiAgICAgICAgICAgICAgICBvcHRpb25zID0ge307CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFvcHRpb25zLnVzZXJBZ2VudCkgewogICAgICAgICAgICAgICAgdmFyIGRlZmF1bHRVc2VyQWdlbnQgPSBnZXREZWZhdWx0VXNlckFnZW50VmFsdWUoKTsKICAgICAgICAgICAgICAgIG9wdGlvbnMudXNlckFnZW50ID0gcGFja2FnZU5hbWUgKyAiLyIgKyBwYWNrYWdlVmVyc2lvbiArICIgIiArIGRlZmF1bHRVc2VyQWdlbnQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCB1bmRlZmluZWQsIG9wdGlvbnMpIHx8IHRoaXM7CiAgICAgICAgICAgIF90aGlzLnZlcnNpb24gPSAnMjAxOS0wMi0wMic7CiAgICAgICAgICAgIF90aGlzLmJhc2VVcmkgPSAie3VybH0iOwogICAgICAgICAgICBfdGhpcy5yZXF1ZXN0Q29udGVudFR5cGUgPSAiYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOCI7CiAgICAgICAgICAgIF90aGlzLnVybCA9IHVybDsKICAgICAgICAgICAgaWYgKG9wdGlvbnMucGF0aFJlbmFtZU1vZGUgIT09IG51bGwgJiYgb3B0aW9ucy5wYXRoUmVuYW1lTW9kZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBfdGhpcy5wYXRoUmVuYW1lTW9kZSA9IG9wdGlvbnMucGF0aFJlbmFtZU1vZGU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIF90aGlzOwogICAgICAgIH0KICAgICAgICByZXR1cm4gU3RvcmFnZUNsaWVudENvbnRleHQ7CiAgICB9KFNlcnZpY2VDbGllbnQpKTsKCiAgICAvKioKICAgICAqIEtlZXBBbGl2ZVBvbGljeSBpcyBhIHBvbGljeSB1c2VkIHRvIGNvbnRyb2wga2VlcCBhbGl2ZSBzZXR0aW5ncyBmb3IgZXZlcnkgcmVxdWVzdC4KICAgICAqCiAgICAgKiBAY2xhc3MgS2VlcEFsaXZlUG9saWN5CiAgICAgKiBAZXh0ZW5kcyB7QmFzZVJlcXVlc3RQb2xpY3l9CiAgICAgKi8KICAgIHZhciBLZWVwQWxpdmVQb2xpY3kgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CiAgICAgICAgX19leHRlbmRzKEtlZXBBbGl2ZVBvbGljeSwgX3N1cGVyKTsKICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIEtlZXBBbGl2ZVBvbGljeS4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7UmVxdWVzdFBvbGljeX0gbmV4dFBvbGljeQogICAgICAgICAqIEBwYXJhbSB7UmVxdWVzdFBvbGljeU9wdGlvbnN9IG9wdGlvbnMKICAgICAgICAgKiBAcGFyYW0ge0lLZWVwQWxpdmVPcHRpb25zfSBba2VlcEFsaXZlT3B0aW9uc10KICAgICAgICAgKiBAbWVtYmVyb2YgS2VlcEFsaXZlUG9saWN5CiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gS2VlcEFsaXZlUG9saWN5KG5leHRQb2xpY3ksIG9wdGlvbnMsIGtlZXBBbGl2ZU9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgbmV4dFBvbGljeSwgb3B0aW9ucykgfHwgdGhpczsKICAgICAgICAgICAgX3RoaXMua2VlcEFsaXZlT3B0aW9ucyA9IGtlZXBBbGl2ZU9wdGlvbnM7CiAgICAgICAgICAgIHJldHVybiBfdGhpczsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2VuZHMgb3V0IHJlcXVlc3QuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge1dlYlJlc291cmNlfSByZXF1ZXN0CiAgICAgICAgICogQHJldHVybnMge1Byb21pc2U8SHR0cE9wZXJhdGlvblJlc3BvbnNlPn0KICAgICAgICAgKiBAbWVtYmVyb2YgS2VlcEFsaXZlUG9saWN5CiAgICAgICAgICovCiAgICAgICAgS2VlcEFsaXZlUG9saWN5LnByb3RvdHlwZS5zZW5kUmVxdWVzdCA9IGZ1bmN0aW9uIChyZXF1ZXN0KSB7CiAgICAgICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHsKICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LmtlZXBBbGl2ZSA9IHRoaXMua2VlcEFsaXZlT3B0aW9ucy5lbmFibGU7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHRoaXMuX25leHRQb2xpY3kuc2VuZFJlcXVlc3QocmVxdWVzdCldOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgcmV0dXJuIEtlZXBBbGl2ZVBvbGljeTsKICAgIH0oQmFzZVJlcXVlc3RQb2xpY3kpKTsKCiAgICAvKioKICAgICAqIEtlZXBBbGl2ZVBvbGljeUZhY3RvcnkgaXMgYSBmYWN0b3J5IGNsYXNzIGhlbHBpbmcgZ2VuZXJhdGluZyBLZWVwQWxpdmVQb2xpY3kgb2JqZWN0cy4KICAgICAqCiAgICAgKiBAZXhwb3J0CiAgICAgKiBAY2xhc3MgS2VlcEFsaXZlUG9saWN5RmFjdG9yeQogICAgICogQGltcGxlbWVudHMge1JlcXVlc3RQb2xpY3lGYWN0b3J5fQogICAgICovCiAgICB2YXIgS2VlcEFsaXZlUG9saWN5RmFjdG9yeSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIEtlZXBBbGl2ZVBvbGljeUZhY3RvcnkuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge0lLZWVwQWxpdmVPcHRpb25zfSBbdGVsZW1ldHJ5XQogICAgICAgICAqIEBtZW1iZXJvZiBLZWVwQWxpdmVQb2xpY3lGYWN0b3J5CiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gS2VlcEFsaXZlUG9saWN5RmFjdG9yeShrZWVwQWxpdmVPcHRpb25zKSB7CiAgICAgICAgICAgIGlmIChrZWVwQWxpdmVPcHRpb25zID09PSB2b2lkIDApIHsga2VlcEFsaXZlT3B0aW9ucyA9IHsgZW5hYmxlOiB0cnVlIH07IH0KICAgICAgICAgICAgdGhpcy5rZWVwQWxpdmVPcHRpb25zID0ga2VlcEFsaXZlT3B0aW9uczsKICAgICAgICB9CiAgICAgICAgS2VlcEFsaXZlUG9saWN5RmFjdG9yeS5wcm90b3R5cGUuY3JlYXRlID0gZnVuY3Rpb24gKG5leHRQb2xpY3ksIG9wdGlvbnMpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBLZWVwQWxpdmVQb2xpY3kobmV4dFBvbGljeSwgb3B0aW9ucywgdGhpcy5rZWVwQWxpdmVPcHRpb25zKTsKICAgICAgICB9OwogICAgICAgIHJldHVybiBLZWVwQWxpdmVQb2xpY3lGYWN0b3J5OwogICAgfSgpKTsKCiAgICAvLyBEZWZhdWx0IHZhbHVlcyBvZiBJUmV0cnlPcHRpb25zCiAgICB2YXIgREVGQVVMVF9SRVFVRVNUX0xPR19PUFRJT05TID0gewogICAgICAgIGxvZ1dhcm5pbmdJZlRyeU92ZXJUaHJlc2hvbGQ6IDMwMDAKICAgIH07CiAgICAvKioKICAgICAqIExvZ2dpbmdQb2xpY3kgaXMgYSBwb2xpY3kgdXNlZCB0byBsb2cgcmVxdWVzdHMuCiAgICAgKgogICAgICogQGNsYXNzIExvZ2dpbmdQb2xpY3kKICAgICAqIEBleHRlbmRzIHtCYXNlUmVxdWVzdFBvbGljeX0KICAgICAqLwogICAgdmFyIExvZ2dpbmdQb2xpY3kgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CiAgICAgICAgX19leHRlbmRzKExvZ2dpbmdQb2xpY3ksIF9zdXBlcik7CiAgICAgICAgLyoqCiAgICAgICAgICogQ3JlYXRlcyBhbiBpbnN0YW5jZSBvZiBMb2dnaW5nUG9saWN5LgogICAgICAgICAqIEBwYXJhbSB7UmVxdWVzdFBvbGljeX0gbmV4dFBvbGljeQogICAgICAgICAqIEBwYXJhbSB7UmVxdWVzdFBvbGljeU9wdGlvbnN9IG9wdGlvbnMKICAgICAgICAgKiBAcGFyYW0ge0lSZXF1ZXN0TG9nT3B0aW9uc30gW2xvZ2dpbmdPcHRpb25zPURFRkFVTFRfUkVRVUVTVF9MT0dfT1BUSU9OU10KICAgICAgICAgKiBAbWVtYmVyb2YgTG9nZ2luZ1BvbGljeQogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIExvZ2dpbmdQb2xpY3kobmV4dFBvbGljeSwgb3B0aW9ucywgbG9nZ2luZ09wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKGxvZ2dpbmdPcHRpb25zID09PSB2b2lkIDApIHsgbG9nZ2luZ09wdGlvbnMgPSBERUZBVUxUX1JFUVVFU1RfTE9HX09QVElPTlM7IH0KICAgICAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgbmV4dFBvbGljeSwgb3B0aW9ucykgfHwgdGhpczsKICAgICAgICAgICAgX3RoaXMudHJ5Q291bnQgPSAwOwogICAgICAgICAgICBfdGhpcy5vcGVyYXRpb25TdGFydFRpbWUgPSBuZXcgRGF0ZSgpOwogICAgICAgICAgICBfdGhpcy5yZXF1ZXN0U3RhcnRUaW1lID0gbmV3IERhdGUoKTsKICAgICAgICAgICAgX3RoaXMubG9nZ2luZ09wdGlvbnMgPSBsb2dnaW5nT3B0aW9uczsKICAgICAgICAgICAgcmV0dXJuIF90aGlzOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZW5kcyBvdXQgcmVxdWVzdC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7V2ViUmVzb3VyY2V9IHJlcXVlc3QKICAgICAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxIdHRwT3BlcmF0aW9uUmVzcG9uc2U+fQogICAgICAgICAqIEBtZW1iZXJvZiBMb2dnaW5nUG9saWN5CiAgICAgICAgICovCiAgICAgICAgTG9nZ2luZ1BvbGljeS5wcm90b3R5cGUuc2VuZFJlcXVlc3QgPSBmdW5jdGlvbiAocmVxdWVzdCkgewogICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgc2FmZVVSTCwgcmVzcG9uc2UsIHJlcXVlc3RFbmRUaW1lLCByZXF1ZXN0Q29tcGxldGlvblRpbWUsIG9wZXJhdGlvbkR1cmF0aW9uLCBjdXJyZW50TGV2ZWwsIGxvZ01lc3NhZ2UsIGVycm9yU3RyaW5nLCBtZXNzYWdlSW5mbywgZXJyXzE7CiAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyeUNvdW50Kys7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlcXVlc3RTdGFydFRpbWUgPSBuZXcgRGF0ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudHJ5Q291bnQgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9wZXJhdGlvblN0YXJ0VGltZSA9IHRoaXMucmVxdWVzdFN0YXJ0VGltZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhZmVVUkwgPSByZXF1ZXN0LnVybDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnZXRVUkxQYXJhbWV0ZXIoc2FmZVVSTCwgVVJMQ29uc3RhbnRzLlBhcmFtZXRlcnMuU0lHTkFUVVJFKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhZmVVUkwgPSBzZXRVUkxQYXJhbWV0ZXIoc2FmZVVSTCwgVVJMQ29uc3RhbnRzLlBhcmFtZXRlcnMuU0lHTkFUVVJFLCAiKioqKioiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nKGV4cG9ydHMuSHR0cFBpcGVsaW5lTG9nTGV2ZWwuSU5GTywgIiciICsgc2FmZVVSTCArICInPT0+IE9VVEdPSU5HIFJFUVVFU1QgKFRyeSBudW1iZXI9IiArIHRoaXMudHJ5Q291bnQgKyAiKS4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9hLmxhYmVsID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2EudHJ5cy5wdXNoKFsxLCAzLCAsIDRdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHRoaXMuX25leHRQb2xpY3kuc2VuZFJlcXVlc3QocmVxdWVzdCldOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IF9hLnNlbnQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3RFbmRUaW1lID0gbmV3IERhdGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3RDb21wbGV0aW9uVGltZSA9IHJlcXVlc3RFbmRUaW1lLmdldFRpbWUoKSAtIHRoaXMucmVxdWVzdFN0YXJ0VGltZS5nZXRUaW1lKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVyYXRpb25EdXJhdGlvbiA9IHJlcXVlc3RFbmRUaW1lLmdldFRpbWUoKSAtIHRoaXMub3BlcmF0aW9uU3RhcnRUaW1lLmdldFRpbWUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRMZXZlbCA9IGV4cG9ydHMuSHR0cFBpcGVsaW5lTG9nTGV2ZWwuSU5GTzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ01lc3NhZ2UgPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnNob3VsZExvZyhleHBvcnRzLkh0dHBQaXBlbGluZUxvZ0xldmVsLklORk8pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQXNzdW1lIHN1Y2Nlc3MgYW5kIGRlZmF1bHQgdG8gaW5mb3JtYXRpb25hbCBsb2dnaW5nLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ01lc3NhZ2UgPSAiU3VjY2Vzc2Z1bGx5IFJlY2VpdmVkIFJlc3BvbnNlLiAiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIHJlc3BvbnNlIHRvb2sgdG9vIGxvbmcsIHdlJ2xsIHVwZ3JhZGUgdG8gd2FybmluZy4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXF1ZXN0Q29tcGxldGlvblRpbWUgPj0gdGhpcy5sb2dnaW5nT3B0aW9ucy5sb2dXYXJuaW5nSWZUcnlPdmVyVGhyZXNob2xkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTG9nIGEgd2FybmluZyBpZiB0aGUgdHJ5IGR1cmF0aW9uIGV4Y2VlZGVkIHRoZSBzcGVjaWZpZWQgdGhyZXNob2xkLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnNob3VsZExvZyhleHBvcnRzLkh0dHBQaXBlbGluZUxvZ0xldmVsLldBUk5JTkcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRMZXZlbCA9IGV4cG9ydHMuSHR0cFBpcGVsaW5lTG9nTGV2ZWwuV0FSTklORzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nTWVzc2FnZSA9ICJTTE9XIE9QRVJBVElPTi4gRHVyYXRpb24gPiAiICsgdGhpcy5sb2dnaW5nT3B0aW9ucy5sb2dXYXJuaW5nSWZUcnlPdmVyVGhyZXNob2xkICsgIiBtcy4gIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKHJlc3BvbnNlLnN0YXR1cyA+PSA0MDAgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5zdGF0dXMgPD0gNDk5ICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHJlc3BvbnNlLnN0YXR1cyAhPT0gSFRUUFVSTENvbm5lY3Rpb24uSFRUUF9OT1RfRk9VTkQgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzICE9PSBIVFRQVVJMQ29ubmVjdGlvbi5IVFRQX0NPTkZMSUNUICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cyAhPT0gSFRUUFVSTENvbm5lY3Rpb24uSFRUUF9QUkVDT05fRkFJTEVEICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cyAhPT0gSFRUUFVSTENvbm5lY3Rpb24uSFRUUF9SQU5HRV9OT1RfU0FUSVNGSUFCTEUpKSB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChyZXNwb25zZS5zdGF0dXMgPj0gNTAwICYmIHJlc3BvbnNlLnN0YXR1cyA8PSA1MDkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JTdHJpbmcgPSAiUkVRVUVTVCBFUlJPUjogSFRUUCByZXF1ZXN0IGZhaWxlZCB3aXRoIHN0YXR1cyBjb2RlOiAiICsgcmVzcG9uc2Uuc3RhdHVzICsgIi4gIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dNZXNzYWdlID0gZXJyb3JTdHJpbmc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudExldmVsID0gZXhwb3J0cy5IdHRwUGlwZWxpbmVMb2dMZXZlbC5FUlJPUjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VJbmZvID0gIlJlcXVlc3QgdHJ5OiIgKyB0aGlzLnRyeUNvdW50ICsgIiwgc3RhdHVzOiIgKyByZXNwb25zZS5zdGF0dXMgKyAiIHJlcXVlc3QgZHVyYXRpb246IiArIHJlcXVlc3RDb21wbGV0aW9uVGltZSArICIgbXMsIG9wZXJhdGlvbiBkdXJhdGlvbjoiICsgb3BlcmF0aW9uRHVyYXRpb24gKyAiIG1zXG4iOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2coY3VycmVudExldmVsLCBsb2dNZXNzYWdlICsgbWVzc2FnZUluZm8pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHJlc3BvbnNlXTsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyXzEgPSBfYS5zZW50KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZyhleHBvcnRzLkh0dHBQaXBlbGluZUxvZ0xldmVsLkVSUk9SLCAiVW5leHBlY3RlZCBmYWlsdXJlIGF0dGVtcHRpbmcgdG8gbWFrZSByZXF1ZXN0LiBFcnJvciBtZXNzYWdlOiAiICsgZXJyXzEubWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnJfMTsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA0OiByZXR1cm4gWzIgLypyZXR1cm4qL107CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgcmV0dXJuIExvZ2dpbmdQb2xpY3k7CiAgICB9KEJhc2VSZXF1ZXN0UG9saWN5KSk7CgogICAgLyoqCiAgICAgKiBMb2dnaW5nUG9saWN5RmFjdG9yeSBpcyBhIGZhY3RvcnkgY2xhc3MgaGVscGluZyBnZW5lcmF0aW5nIExvZ2dpbmdQb2xpY3kgb2JqZWN0cy4KICAgICAqCiAgICAgKiBAZXhwb3J0CiAgICAgKiBAY2xhc3MgTG9nZ2luZ1BvbGljeUZhY3RvcnkKICAgICAqIEBpbXBsZW1lbnRzIHtSZXF1ZXN0UG9saWN5RmFjdG9yeX0KICAgICAqLwogICAgdmFyIExvZ2dpbmdQb2xpY3lGYWN0b3J5ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIExvZ2dpbmdQb2xpY3lGYWN0b3J5KGxvZ2dpbmdPcHRpb25zKSB7CiAgICAgICAgICAgIHRoaXMubG9nZ2luZ09wdGlvbnMgPSBsb2dnaW5nT3B0aW9uczsKICAgICAgICB9CiAgICAgICAgTG9nZ2luZ1BvbGljeUZhY3RvcnkucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uIChuZXh0UG9saWN5LCBvcHRpb25zKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgTG9nZ2luZ1BvbGljeShuZXh0UG9saWN5LCBvcHRpb25zLCB0aGlzLmxvZ2dpbmdPcHRpb25zKTsKICAgICAgICB9OwogICAgICAgIHJldHVybiBMb2dnaW5nUG9saWN5RmFjdG9yeTsKICAgIH0oKSk7CgogICAgLyoqCiAgICAgKiBBIFBpcGVsaW5lIGNsYXNzIGNvbnRhaW5pbmcgSFRUUCByZXF1ZXN0IHBvbGljaWVzLgogICAgICogWW91IGNhbiBjcmVhdGUgYSBkZWZhdWx0IFBpcGVsaW5lIGJ5IGNhbGxpbmcgU3RvcmFnZVVSTC5uZXdQaXBlbGluZSgpLgogICAgICogT3IgeW91IGNhbiBjcmVhdGUgYSBQaXBlbGluZSB3aXRoIHlvdXIgb3duIHBvbGljaWVzIGJ5IHRoZSBjb25zdHJ1Y3RvciBvZiBQaXBlbGluZS4KICAgICAqIFJlZmVyIHRvIFN0b3JhZ2VVUkwubmV3UGlwZWxpbmUoKSBhbmQgcHJvdmlkZWQgcG9saWNpZXMgYXMgcmVmZXJlbmNlIGJlZm9yZQogICAgICogaW1wbGVtZW50aW5nIHlvdXIgY3VzdG9taXplZCBQaXBlbGluZS4KICAgICAqCiAgICAgKiBAZXhwb3J0CiAgICAgKiBAY2xhc3MgUGlwZWxpbmUKICAgICAqLwogICAgdmFyIFBpcGVsaW5lID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewogICAgICAgIC8qKgogICAgICAgICAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgUGlwZWxpbmUuIEN1c3RvbWl6ZSBIVFRQQ2xpZW50IGJ5IGltcGxlbWVudGluZyBJSHR0cENsaWVudCBpbnRlcmZhY2UuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge1JlcXVlc3RQb2xpY3lGYWN0b3J5W119IGZhY3RvcmllcwogICAgICAgICAqIEBwYXJhbSB7SVBpcGVsaW5lT3B0aW9uc30gW29wdGlvbnM9e31dCiAgICAgICAgICogQG1lbWJlcm9mIFBpcGVsaW5lCiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gUGlwZWxpbmUoZmFjdG9yaWVzLCBvcHRpb25zKSB7CiAgICAgICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsgb3B0aW9ucyA9IHt9OyB9CiAgICAgICAgICAgIHRoaXMuZmFjdG9yaWVzID0gZmFjdG9yaWVzOwogICAgICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBUcmFuc2ZlciBQaXBlbGluZSBvYmplY3QgdG8gU2VydmljZUNsaWVudE9wdGlvbnMgb2JqZWN0IHdoaWNoIHJlcXVpcmVkIGJ5CiAgICAgICAgICogU2VydmljZUNsaWVudCBjb25zdHJ1Y3Rvci4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm5zIHtTZXJ2aWNlQ2xpZW50T3B0aW9uc30KICAgICAgICAgKiBAbWVtYmVyb2YgUGlwZWxpbmUKICAgICAgICAgKi8KICAgICAgICBQaXBlbGluZS5wcm90b3R5cGUudG9TZXJ2aWNlQ2xpZW50T3B0aW9ucyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGh0dHBDbGllbnQ6IHRoaXMub3B0aW9ucy5IVFRQQ2xpZW50LAogICAgICAgICAgICAgICAgaHR0cFBpcGVsaW5lTG9nZ2VyOiB0aGlzLm9wdGlvbnMubG9nZ2VyLAogICAgICAgICAgICAgICAgcmVxdWVzdFBvbGljeUZhY3RvcmllczogdGhpcy5mYWN0b3JpZXMKICAgICAgICAgICAgfTsKICAgICAgICB9OwogICAgICAgIHJldHVybiBQaXBlbGluZTsKICAgIH0oKSk7CgogICAgKGZ1bmN0aW9uIChSZXRyeVBvbGljeVR5cGUpIHsKICAgICAgICAvKioKICAgICAgICAgKiBFeHBvbmVudGlhbCByZXRyeS4gUmV0cnkgdGltZSBkZWxheSBncm93cyBleHBvbmVudGlhbGx5LgogICAgICAgICAqLwogICAgICAgIFJldHJ5UG9saWN5VHlwZVtSZXRyeVBvbGljeVR5cGVbIkVYUE9ORU5USUFMIl0gPSAwXSA9ICJFWFBPTkVOVElBTCI7CiAgICAgICAgLyoqCiAgICAgICAgICogTGluZWFyIHJldHJ5LiBSZXRyeSB0aW1lIGRlbGF5IGdyb3dzIGxpbmVhcmx5LgogICAgICAgICAqLwogICAgICAgIFJldHJ5UG9saWN5VHlwZVtSZXRyeVBvbGljeVR5cGVbIkZJWEVEIl0gPSAxXSA9ICJGSVhFRCI7CiAgICB9KShleHBvcnRzLlJldHJ5UG9saWN5VHlwZSB8fCAoZXhwb3J0cy5SZXRyeVBvbGljeVR5cGUgPSB7fSkpOwogICAgLy8gRGVmYXVsdCB2YWx1ZXMgb2YgSVJldHJ5T3B0aW9ucwogICAgdmFyIERFRkFVTFRfUkVUUllfT1BUSU9OUyA9IHsKICAgICAgICBtYXhSZXRyeURlbGF5SW5NczogMTIwICogMTAwMCwKICAgICAgICBtYXhUcmllczogNCwKICAgICAgICByZXRyeURlbGF5SW5NczogNCAqIDEwMDAsCiAgICAgICAgcmV0cnlQb2xpY3lUeXBlOiBleHBvcnRzLlJldHJ5UG9saWN5VHlwZS5FWFBPTkVOVElBTCwKICAgICAgICBzZWNvbmRhcnlIb3N0OiAiIiwKICAgICAgICB0cnlUaW1lb3V0SW5NczogdW5kZWZpbmVkIC8vIFVzZSBzZXJ2ZXIgc2lkZSBkZWZhdWx0IHRpbWVvdXQgc3RyYXRlZ3kKICAgIH07CiAgICB2YXIgUkVUUllfQUJPUlRfRVJST1IgPSBuZXcgUmVzdEVycm9yKCJUaGUgcmVxdWVzdCB3YXMgYWJvcnRlZCIsIFJlc3RFcnJvci5SRVFVRVNUX0FCT1JURURfRVJST1IpOwogICAgLyoqCiAgICAgKiBSZXRyeSBwb2xpY3kgd2l0aCBleHBvbmVudGlhbCByZXRyeSBhbmQgbGluZWFyIHJldHJ5IGltcGxlbWVudGVkLgogICAgICoKICAgICAqIEBjbGFzcyBSZXRyeVBvbGljeQogICAgICogQGV4dGVuZHMge0Jhc2VSZXF1ZXN0UG9saWN5fQogICAgICovCiAgICB2YXIgUmV0cnlQb2xpY3kgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CiAgICAgICAgX19leHRlbmRzKFJldHJ5UG9saWN5LCBfc3VwZXIpOwogICAgICAgIC8qKgogICAgICAgICAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgUmV0cnlQb2xpY3kuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge1JlcXVlc3RQb2xpY3l9IG5leHRQb2xpY3kKICAgICAgICAgKiBAcGFyYW0ge1JlcXVlc3RQb2xpY3lPcHRpb25zfSBvcHRpb25zCiAgICAgICAgICogQHBhcmFtIHtJUmV0cnlPcHRpb25zfSBbcmV0cnlPcHRpb25zPURFRkFVTFRfUkVUUllfT1BUSU9OU10KICAgICAgICAgKiBAbWVtYmVyb2YgUmV0cnlQb2xpY3kKICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBSZXRyeVBvbGljeShuZXh0UG9saWN5LCBvcHRpb25zLCByZXRyeU9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKHJldHJ5T3B0aW9ucyA9PT0gdm9pZCAwKSB7IHJldHJ5T3B0aW9ucyA9IERFRkFVTFRfUkVUUllfT1BUSU9OUzsgfQogICAgICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBuZXh0UG9saWN5LCBvcHRpb25zKSB8fCB0aGlzOwogICAgICAgICAgICAvLyBJbml0aWFsaXplIHJldHJ5IG9wdGlvbnMKICAgICAgICAgICAgX3RoaXMucmV0cnlPcHRpb25zID0gewogICAgICAgICAgICAgICAgcmV0cnlQb2xpY3lUeXBlOiByZXRyeU9wdGlvbnMucmV0cnlQb2xpY3lUeXBlCiAgICAgICAgICAgICAgICAgICAgPyByZXRyeU9wdGlvbnMucmV0cnlQb2xpY3lUeXBlCiAgICAgICAgICAgICAgICAgICAgOiBERUZBVUxUX1JFVFJZX09QVElPTlMucmV0cnlQb2xpY3lUeXBlLAogICAgICAgICAgICAgICAgbWF4VHJpZXM6IHJldHJ5T3B0aW9ucy5tYXhUcmllcyAmJiByZXRyeU9wdGlvbnMubWF4VHJpZXMgPj0gMQogICAgICAgICAgICAgICAgICAgID8gTWF0aC5mbG9vcihyZXRyeU9wdGlvbnMubWF4VHJpZXMpCiAgICAgICAgICAgICAgICAgICAgOiBERUZBVUxUX1JFVFJZX09QVElPTlMubWF4VHJpZXMsCiAgICAgICAgICAgICAgICB0cnlUaW1lb3V0SW5NczogcmV0cnlPcHRpb25zLnRyeVRpbWVvdXRJbk1zICYmIHJldHJ5T3B0aW9ucy50cnlUaW1lb3V0SW5NcyA+PSAwCiAgICAgICAgICAgICAgICAgICAgPyByZXRyeU9wdGlvbnMudHJ5VGltZW91dEluTXMKICAgICAgICAgICAgICAgICAgICA6IERFRkFVTFRfUkVUUllfT1BUSU9OUy50cnlUaW1lb3V0SW5NcywKICAgICAgICAgICAgICAgIHJldHJ5RGVsYXlJbk1zOiByZXRyeU9wdGlvbnMucmV0cnlEZWxheUluTXMgJiYgcmV0cnlPcHRpb25zLnJldHJ5RGVsYXlJbk1zID49IDAKICAgICAgICAgICAgICAgICAgICA/IE1hdGgubWluKHJldHJ5T3B0aW9ucy5yZXRyeURlbGF5SW5NcywgcmV0cnlPcHRpb25zLm1heFJldHJ5RGVsYXlJbk1zCiAgICAgICAgICAgICAgICAgICAgICAgID8gcmV0cnlPcHRpb25zLm1heFJldHJ5RGVsYXlJbk1zCiAgICAgICAgICAgICAgICAgICAgICAgIDogREVGQVVMVF9SRVRSWV9PUFRJT05TLm1heFJldHJ5RGVsYXlJbk1zKQogICAgICAgICAgICAgICAgICAgIDogREVGQVVMVF9SRVRSWV9PUFRJT05TLnJldHJ5RGVsYXlJbk1zLAogICAgICAgICAgICAgICAgbWF4UmV0cnlEZWxheUluTXM6IHJldHJ5T3B0aW9ucy5tYXhSZXRyeURlbGF5SW5NcyAmJiByZXRyeU9wdGlvbnMubWF4UmV0cnlEZWxheUluTXMgPj0gMAogICAgICAgICAgICAgICAgICAgID8gcmV0cnlPcHRpb25zLm1heFJldHJ5RGVsYXlJbk1zCiAgICAgICAgICAgICAgICAgICAgOiBERUZBVUxUX1JFVFJZX09QVElPTlMubWF4UmV0cnlEZWxheUluTXMsCiAgICAgICAgICAgICAgICBzZWNvbmRhcnlIb3N0OiByZXRyeU9wdGlvbnMuc2Vjb25kYXJ5SG9zdAogICAgICAgICAgICAgICAgICAgID8gcmV0cnlPcHRpb25zLnNlY29uZGFyeUhvc3QKICAgICAgICAgICAgICAgICAgICA6IERFRkFVTFRfUkVUUllfT1BUSU9OUy5zZWNvbmRhcnlIb3N0CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiBfdGhpczsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2VuZHMgcmVxdWVzdC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7V2ViUmVzb3VyY2V9IHJlcXVlc3QKICAgICAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxIdHRwT3BlcmF0aW9uUmVzcG9uc2U+fQogICAgICAgICAqIEBtZW1iZXJvZiBSZXRyeVBvbGljeQogICAgICAgICAqLwogICAgICAgIFJldHJ5UG9saWN5LnByb3RvdHlwZS5zZW5kUmVxdWVzdCA9IGZ1bmN0aW9uIChyZXF1ZXN0KSB7CiAgICAgICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgdGhpcy5hdHRlbXB0U2VuZFJlcXVlc3QocmVxdWVzdCwgZmFsc2UsIDEpXTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICAgIC8qKgogICAgICAgICAqIERlY2lkZSBhbmQgcGVyZm9ybSBuZXh0IHJldHJ5LiBXb24ndCBtdXRhdGUgcmVxdWVzdCBwYXJhbWV0ZXIuCiAgICAgICAgICoKICAgICAgICAgKiBAcHJvdGVjdGVkCiAgICAgICAgICogQHBhcmFtIHtXZWJSZXNvdXJjZX0gcmVxdWVzdAogICAgICAgICAqIEBwYXJhbSB7SHR0cE9wZXJhdGlvblJlc3BvbnNlfSByZXNwb25zZQogICAgICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gc2Vjb25kYXJ5SGFzNDA0ICBJZiBhdHRlbXB0IHdhcyBhZ2FpbnN0IHRoZSBzZWNvbmRhcnkgJiBpdCByZXR1cm5lZCBhIFN0YXR1c05vdEZvdW5kICg0MDQpLCB0aGVuCiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZSByZXNvdXJjZSB3YXMgbm90IGZvdW5kLiBUaGlzIG1heSBiZSBkdWUgdG8gcmVwbGljYXRpb24gZGVsYXkuIFNvLCBpbiB0aGlzCiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UsIHdlJ2xsIG5ldmVyIHRyeSB0aGUgc2Vjb25kYXJ5IGFnYWluIGZvciB0aGlzIG9wZXJhdGlvbi4KICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gYXR0ZW1wdCAgICAgICAgICAgSG93IG1hbnkgcmV0cmllcyBoYXMgYmVlbiBhdHRlbXB0ZWQgdG8gcGVyZm9ybWVkLCBzdGFydGluZyBmcm9tIDEsIHdoaWNoIGluY2x1ZGVzCiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZSBhdHRlbXB0IHdpbGwgYmUgcGVyZm9ybWVkIGJ5IHRoaXMgbWV0aG9kIGNhbGwuCiAgICAgICAgICogQHJldHVybnMge1Byb21pc2U8SHR0cE9wZXJhdGlvblJlc3BvbnNlPn0KICAgICAgICAgKiBAbWVtYmVyb2YgUmV0cnlQb2xpY3kKICAgICAgICAgKi8KICAgICAgICBSZXRyeVBvbGljeS5wcm90b3R5cGUuYXR0ZW1wdFNlbmRSZXF1ZXN0ID0gZnVuY3Rpb24gKHJlcXVlc3QsIHNlY29uZGFyeUhhczQwNCwgYXR0ZW1wdCkgewogICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgbmV3UmVxdWVzdCwgaXNQcmltYXJ5UmV0cnksIHJlc3BvbnNlLCBlcnJfMTsKICAgICAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1JlcXVlc3QgPSByZXF1ZXN0LmNsb25lKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1ByaW1hcnlSZXRyeSA9IHNlY29uZGFyeUhhczQwNCB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICF0aGlzLnJldHJ5T3B0aW9ucy5zZWNvbmRhcnlIb3N0IHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIShyZXF1ZXN0Lm1ldGhvZCA9PT0gIkdFVCIgfHwgcmVxdWVzdC5tZXRob2QgPT09ICJIRUFEIiB8fCByZXF1ZXN0Lm1ldGhvZCA9PT0gIk9QVElPTlMiKSB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dGVtcHQgJSAyID09PSAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpc1ByaW1hcnlSZXRyeSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1JlcXVlc3QudXJsID0gc2V0VVJMSG9zdChuZXdSZXF1ZXN0LnVybCwgdGhpcy5yZXRyeU9wdGlvbnMuc2Vjb25kYXJ5SG9zdCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIHNlcnZlci1zaWRlIHRpbWVvdXQgcXVlcnkgcGFyYW1ldGVyICJ0aW1lb3V0PVtzZWNvbmRzXSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnJldHJ5T3B0aW9ucy50cnlUaW1lb3V0SW5NcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1JlcXVlc3QudXJsID0gc2V0VVJMUGFyYW1ldGVyKG5ld1JlcXVlc3QudXJsLCBVUkxDb25zdGFudHMuUGFyYW1ldGVycy5USU1FT1VULCBNYXRoLmZsb29yKHRoaXMucmV0cnlPcHRpb25zLnRyeVRpbWVvdXRJbk1zIC8gMTAwMCkudG9TdHJpbmcoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfYS5sYWJlbCA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9hLnRyeXMucHVzaChbMSwgMywgLCA0XSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2YoZXhwb3J0cy5IdHRwUGlwZWxpbmVMb2dMZXZlbC5JTkZPLCAiUmV0cnlQb2xpY3k6ID09PT09PiBUcnk9IiArIGF0dGVtcHQgKyAiICIgKyAoaXNQcmltYXJ5UmV0cnkgPyAiUHJpbWFyeSIgOiAiU2Vjb25kYXJ5IikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgdGhpcy5fbmV4dFBvbGljeS5zZW5kUmVxdWVzdChuZXdSZXF1ZXN0KV07CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gX2Euc2VudCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLnNob3VsZFJldHJ5KGlzUHJpbWFyeVJldHJ5LCBhdHRlbXB0LCByZXNwb25zZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgcmVzcG9uc2VdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vjb25kYXJ5SGFzNDA0ID0gc2Vjb25kYXJ5SGFzNDA0IHx8ICghaXNQcmltYXJ5UmV0cnkgJiYgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgNF07CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycl8xID0gX2Euc2VudCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dmKGV4cG9ydHMuSHR0cFBpcGVsaW5lTG9nTGV2ZWwuRVJST1IsICJSZXRyeVBvbGljeTogQ2F1Z2h0IGVycm9yLCBtZXNzYWdlOiAiICsgZXJyXzEubWVzc2FnZSArICIsIGNvZGU6ICIgKyBlcnJfMS5jb2RlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5zaG91bGRSZXRyeShpc1ByaW1hcnlSZXRyeSwgYXR0ZW1wdCwgcmVzcG9uc2UsIGVycl8xKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGVycl8xOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgNF07CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNDogcmV0dXJuIFs0IC8qeWllbGQqLywgdGhpcy5kZWxheShpc1ByaW1hcnlSZXRyeSwgYXR0ZW1wdCwgcmVxdWVzdC5hYm9ydFNpZ25hbCldOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCB0aGlzLmF0dGVtcHRTZW5kUmVxdWVzdChyZXF1ZXN0LCBzZWNvbmRhcnlIYXM0MDQsICsrYXR0ZW1wdCldOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDY6IHJldHVybiBbMiAvKnJldHVybiovLCBfYS5zZW50KCldOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICAgIC8qKgogICAgICAgICAqIERlY2lkZSB3aGV0aGVyIHRvIHJldHJ5IGFjY29yZGluZyB0byBsYXN0IEhUVFAgcmVzcG9uc2UgYW5kIHJldHJ5IGNvdW50ZXJzLgogICAgICAgICAqCiAgICAgICAgICogQHByb3RlY3RlZAogICAgICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gaXNQcmltYXJ5UmV0cnkKICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gYXR0ZW1wdAogICAgICAgICAqIEBwYXJhbSB7SHR0cE9wZXJhdGlvblJlc3BvbnNlfSBbcmVzcG9uc2VdCiAgICAgICAgICogQHBhcmFtIHtSZXN0RXJyb3J9IFtlcnJdCiAgICAgICAgICogQHJldHVybnMge2Jvb2xlYW59CiAgICAgICAgICogQG1lbWJlcm9mIFJldHJ5UG9saWN5CiAgICAgICAgICovCiAgICAgICAgUmV0cnlQb2xpY3kucHJvdG90eXBlLnNob3VsZFJldHJ5ID0gZnVuY3Rpb24gKGlzUHJpbWFyeVJldHJ5LCBhdHRlbXB0LCByZXNwb25zZSwgZXJyKSB7CiAgICAgICAgICAgIGlmIChhdHRlbXB0ID49IHRoaXMucmV0cnlPcHRpb25zLm1heFRyaWVzKSB7CiAgICAgICAgICAgICAgICB0aGlzLmxvZ2YoZXhwb3J0cy5IdHRwUGlwZWxpbmVMb2dMZXZlbC5JTkZPLCAiUmV0cnlQb2xpY3k6IEF0dGVtcHQocykgIiArIGF0dGVtcHQgKyAiID49IG1heFRyaWVzICIgKyB0aGlzLnJldHJ5T3B0aW9ucwogICAgICAgICAgICAgICAgICAgIC5tYXhUcmllcyArICIsIG5vIGZ1cnRoZXIgdHJ5LiIpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIEhhbmRsZSBuZXR3b3JrIGZhaWx1cmVzLCB5b3UgbWF5IG5lZWQgdG8gY3VzdG9taXplIHRoZSBsaXN0IHdoZW4geW91IGltcGxlbWVudAogICAgICAgICAgICAvLyB5b3VyIG93biBodHRwIGNsaWVudAogICAgICAgICAgICB2YXIgcmV0cmlhYmxlRXJyb3JzID0gWwogICAgICAgICAgICAgICAgIkVUSU1FRE9VVCIsCiAgICAgICAgICAgICAgICAiRVNPQ0tFVFRJTUVET1VUIiwKICAgICAgICAgICAgICAgICJFQ09OTlJFRlVTRUQiLAogICAgICAgICAgICAgICAgIkVDT05OUkVTRVQiLAogICAgICAgICAgICAgICAgIkVOT0VOVCIsCiAgICAgICAgICAgICAgICAiRU5PVEZPVU5EIiwKICAgICAgICAgICAgICAgICJUSU1FT1VUIiwKICAgICAgICAgICAgICAgICJSRVFVRVNUX1NFTkRfRVJST1IiIC8vIEZvciBkZWZhdWx0IHhociBiYXNlZCBodHRwIGNsaWVudCBwcm92aWRlZCBpbiBtcy1yZXN0LWpzCiAgICAgICAgICAgIF07CiAgICAgICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgICAgICAgIGZvciAodmFyIF9pID0gMCwgcmV0cmlhYmxlRXJyb3JzXzEgPSByZXRyaWFibGVFcnJvcnM7IF9pIDwgcmV0cmlhYmxlRXJyb3JzXzEubGVuZ3RoOyBfaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHJldHJpYWJsZUVycm9yID0gcmV0cmlhYmxlRXJyb3JzXzFbX2ldOwogICAgICAgICAgICAgICAgICAgIGlmIChlcnIubmFtZS50b1VwcGVyQ2FzZSgpLmluY2x1ZGVzKHJldHJpYWJsZUVycm9yKSB8fAogICAgICAgICAgICAgICAgICAgICAgICBlcnIubWVzc2FnZS50b1VwcGVyQ2FzZSgpLmluY2x1ZGVzKHJldHJpYWJsZUVycm9yKSB8fAogICAgICAgICAgICAgICAgICAgICAgICAoZXJyLmNvZGUgJiYgZXJyLmNvZGUudG9TdHJpbmcoKS50b1VwcGVyQ2FzZSgpLmluY2x1ZGVzKHJldHJpYWJsZUVycm9yKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dmKGV4cG9ydHMuSHR0cFBpcGVsaW5lTG9nTGV2ZWwuSU5GTywgIlJldHJ5UG9saWN5OiBOZXR3b3JrIGVycm9yICIgKyByZXRyaWFibGVFcnJvciArICIgZm91bmQsIHdpbGwgcmV0cnkuIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBJZiBhdHRlbXB0IHdhcyBhZ2FpbnN0IHRoZSBzZWNvbmRhcnkgJiBpdCByZXR1cm5lZCBhIFN0YXR1c05vdEZvdW5kICg0MDQpLCB0aGVuCiAgICAgICAgICAgIC8vIHRoZSByZXNvdXJjZSB3YXMgbm90IGZvdW5kLiBUaGlzIG1heSBiZSBkdWUgdG8gcmVwbGljYXRpb24gZGVsYXkuIFNvLCBpbiB0aGlzCiAgICAgICAgICAgIC8vIGNhc2UsIHdlJ2xsIG5ldmVyIHRyeSB0aGUgc2Vjb25kYXJ5IGFnYWluIGZvciB0aGlzIG9wZXJhdGlvbi4KICAgICAgICAgICAgaWYgKHJlc3BvbnNlIHx8IGVycikgewogICAgICAgICAgICAgICAgdmFyIHN0YXR1c0NvZGUgPSByZXNwb25zZSA/IHJlc3BvbnNlLnN0YXR1cyA6IGVyciA/IGVyci5zdGF0dXNDb2RlIDogMDsKICAgICAgICAgICAgICAgIGlmICghaXNQcmltYXJ5UmV0cnkgJiYgc3RhdHVzQ29kZSA9PT0gNDA0KSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dmKGV4cG9ydHMuSHR0cFBpcGVsaW5lTG9nTGV2ZWwuSU5GTywgIlJldHJ5UG9saWN5OiBTZWNvbmRhcnkgYWNjZXNzIHdpdGggNDA0LCB3aWxsIHJldHJ5LiIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gU2VydmVyIGludGVybmFsIGVycm9yIG9yIHNlcnZlciB0aW1lb3V0CiAgICAgICAgICAgICAgICBpZiAoc3RhdHVzQ29kZSA9PT0gNTAzIHx8IHN0YXR1c0NvZGUgPT09IDUwMCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZihleHBvcnRzLkh0dHBQaXBlbGluZUxvZ0xldmVsLklORk8sICJSZXRyeVBvbGljeTogV2lsbCByZXRyeSBmb3Igc3RhdHVzIGNvZGUgIiArIHN0YXR1c0NvZGUgKyAiLiIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9OwogICAgICAgIC8qKgogICAgICAgICAqIFRoaXMgaXMgdG8gbG9nIGZvciBkZWJ1Z2dpbmcgcHVycG9zZXMgb25seS4KICAgICAgICAgKiBDb21tZW50L3VuY29tbWVudCBhcyBuZWNlc3NhcnkgZm9yIHJlbGVhc2luZy9kZWJ1Z2dpbmcuCiAgICAgICAgICoKICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAqIEBwYXJhbSB7SHR0cFBpcGVsaW5lTG9nTGV2ZWx9IGxldmVsCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IG1lc3NhZ2UKICAgICAgICAgKiBAbWVtYmVyb2YgUmV0cnlQb2xpY3kKICAgICAgICAgKi8KICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6dmFyaWFibGUtbmFtZQogICAgICAgIFJldHJ5UG9saWN5LnByb3RvdHlwZS5sb2dmID0gZnVuY3Rpb24gKF9sZXZlbCwgX21lc3NhZ2UpIHsKICAgICAgICAgICAgLy8gdGhpcy5sb2coX2xldmVsLCBfbWVzc2FnZSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBEZWxheSBhIGNhbGN1bGF0ZWQgdGltZSBiZXR3ZWVuIHJldHJpZXMuCiAgICAgICAgICoKICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gaXNQcmltYXJ5UmV0cnkKICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gYXR0ZW1wdAogICAgICAgICAqIEBwYXJhbSB7QWJvcnRTaWduYWxMaWtlfSBbYWJvcnRTaWduYWxdCiAgICAgICAgICogQHJldHVybnMKICAgICAgICAgKiBAbWVtYmVyb2YgUmV0cnlQb2xpY3kKICAgICAgICAgKi8KICAgICAgICBSZXRyeVBvbGljeS5wcm90b3R5cGUuZGVsYXkgPSBmdW5jdGlvbiAoaXNQcmltYXJ5UmV0cnksIGF0dGVtcHQsIGFib3J0U2lnbmFsKSB7CiAgICAgICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBkZWxheVRpbWVJbk1zOwogICAgICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkgewogICAgICAgICAgICAgICAgICAgIGRlbGF5VGltZUluTXMgPSAwOwogICAgICAgICAgICAgICAgICAgIGlmIChpc1ByaW1hcnlSZXRyeSkgewogICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHRoaXMucmV0cnlPcHRpb25zLnJldHJ5UG9saWN5VHlwZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBleHBvcnRzLlJldHJ5UG9saWN5VHlwZS5FWFBPTkVOVElBTDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxheVRpbWVJbk1zID0gTWF0aC5taW4oKE1hdGgucG93KDIsIGF0dGVtcHQgLSAxKSAtIDEpICogdGhpcy5yZXRyeU9wdGlvbnMucmV0cnlEZWxheUluTXMsIHRoaXMucmV0cnlPcHRpb25zLm1heFJldHJ5RGVsYXlJbk1zKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgZXhwb3J0cy5SZXRyeVBvbGljeVR5cGUuRklYRUQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsYXlUaW1lSW5NcyA9IHRoaXMucmV0cnlPcHRpb25zLnJldHJ5RGVsYXlJbk1zOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBkZWxheVRpbWVJbk1zID0gTWF0aC5yYW5kb20oKSAqIDEwMDA7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZihleHBvcnRzLkh0dHBQaXBlbGluZUxvZ0xldmVsLklORk8sICJSZXRyeVBvbGljeTogRGVsYXkgZm9yICIgKyBkZWxheVRpbWVJbk1zICsgIm1zIik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIGRlbGF5JDEoZGVsYXlUaW1lSW5NcywgYWJvcnRTaWduYWwsIFJFVFJZX0FCT1JUX0VSUk9SKV07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gUmV0cnlQb2xpY3k7CiAgICB9KEJhc2VSZXF1ZXN0UG9saWN5KSk7CgogICAgLyoqCiAgICAgKiBSZXRyeVBvbGljeUZhY3RvcnkgaXMgYSBmYWN0b3J5IGNsYXNzIGhlbHBpbmcgZ2VuZXJhdGluZyBSZXRyeVBvbGljeSBvYmplY3RzLgogICAgICoKICAgICAqIEBleHBvcnQKICAgICAqIEBjbGFzcyBSZXRyeVBvbGljeUZhY3RvcnkKICAgICAqIEBpbXBsZW1lbnRzIHtSZXF1ZXN0UG9saWN5RmFjdG9yeX0KICAgICAqLwogICAgdmFyIFJldHJ5UG9saWN5RmFjdG9yeSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIFJldHJ5UG9saWN5RmFjdG9yeS4KICAgICAgICAgKiBAcGFyYW0ge0lSZXRyeU9wdGlvbnN9IFtyZXRyeU9wdGlvbnNdCiAgICAgICAgICogQG1lbWJlcm9mIFJldHJ5UG9saWN5RmFjdG9yeQogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIFJldHJ5UG9saWN5RmFjdG9yeShyZXRyeU9wdGlvbnMpIHsKICAgICAgICAgICAgdGhpcy5yZXRyeU9wdGlvbnMgPSByZXRyeU9wdGlvbnM7CiAgICAgICAgfQogICAgICAgIFJldHJ5UG9saWN5RmFjdG9yeS5wcm90b3R5cGUuY3JlYXRlID0gZnVuY3Rpb24gKG5leHRQb2xpY3ksIG9wdGlvbnMpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBSZXRyeVBvbGljeShuZXh0UG9saWN5LCBvcHRpb25zLCB0aGlzLnJldHJ5T3B0aW9ucyk7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gUmV0cnlQb2xpY3lGYWN0b3J5OwogICAgfSgpKTsKCiAgICAvKioKICAgICAqIFRlbGVtZXRyeVBvbGljeSBpcyBhIHBvbGljeSB1c2VkIHRvIHRhZyB1c2VyLWFnZW50IGhlYWRlciBmb3IgZXZlcnkgcmVxdWVzdHMuCiAgICAgKgogICAgICogQGNsYXNzIFRlbGVtZXRyeVBvbGljeQogICAgICogQGV4dGVuZHMge0Jhc2VSZXF1ZXN0UG9saWN5fQogICAgICovCiAgICB2YXIgVGVsZW1ldHJ5UG9saWN5ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewogICAgICAgIF9fZXh0ZW5kcyhUZWxlbWV0cnlQb2xpY3ksIF9zdXBlcik7CiAgICAgICAgLyoqCiAgICAgICAgICogQ3JlYXRlcyBhbiBpbnN0YW5jZSBvZiBUZWxlbWV0cnlQb2xpY3kuCiAgICAgICAgICogQHBhcmFtIHtSZXF1ZXN0UG9saWN5fSBuZXh0UG9saWN5CiAgICAgICAgICogQHBhcmFtIHtSZXF1ZXN0UG9saWN5T3B0aW9uc30gb3B0aW9ucwogICAgICAgICAqIEBwYXJhbSB7SVRlbGVtZXRyeU9wdGlvbnN9IFt0ZWxlbWV0cnldCiAgICAgICAgICogQG1lbWJlcm9mIFRlbGVtZXRyeVBvbGljeQogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIFRlbGVtZXRyeVBvbGljeShuZXh0UG9saWN5LCBvcHRpb25zLCB0ZWxlbWV0cnkpIHsKICAgICAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgbmV4dFBvbGljeSwgb3B0aW9ucykgfHwgdGhpczsKICAgICAgICAgICAgX3RoaXMudGVsZW1ldHJ5ID0gdGVsZW1ldHJ5OwogICAgICAgICAgICByZXR1cm4gX3RoaXM7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNlbmRzIG91dCByZXF1ZXN0LgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtXZWJSZXNvdXJjZX0gcmVxdWVzdAogICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlPEh0dHBPcGVyYXRpb25SZXNwb25zZT59CiAgICAgICAgICogQG1lbWJlcm9mIFRlbGVtZXRyeVBvbGljeQogICAgICAgICAqLwogICAgICAgIFRlbGVtZXRyeVBvbGljeS5wcm90b3R5cGUuc2VuZFJlcXVlc3QgPSBmdW5jdGlvbiAocmVxdWVzdCkgewogICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHRoaXMuX25leHRQb2xpY3kuc2VuZFJlcXVlc3QocmVxdWVzdCldOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgcmV0dXJuIFRlbGVtZXRyeVBvbGljeTsKICAgIH0oQmFzZVJlcXVlc3RQb2xpY3kpKTsKCiAgICAvKioKICAgICAqIFRlbGVtZXRyeVBvbGljeUZhY3RvcnkgaXMgYSBmYWN0b3J5IGNsYXNzIGhlbHBpbmcgZ2VuZXJhdGluZyBUZWxlbWV0cnlQb2xpY3kgb2JqZWN0cy4KICAgICAqCiAgICAgKiBAZXhwb3J0CiAgICAgKiBAY2xhc3MgVGVsZW1ldHJ5UG9saWN5RmFjdG9yeQogICAgICogQGltcGxlbWVudHMge1JlcXVlc3RQb2xpY3lGYWN0b3J5fQogICAgICovCiAgICB2YXIgVGVsZW1ldHJ5UG9saWN5RmFjdG9yeSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIFRlbGVtZXRyeVBvbGljeUZhY3RvcnkuCiAgICAgICAgICogQHBhcmFtIHtJVGVsZW1ldHJ5T3B0aW9uc30gW3RlbGVtZXRyeV0KICAgICAgICAgKiBAbWVtYmVyb2YgVGVsZW1ldHJ5UG9saWN5RmFjdG9yeQogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIFRlbGVtZXRyeVBvbGljeUZhY3RvcnkodGVsZW1ldHJ5KSB7CiAgICAgICAgICAgIHZhciB1c2VyQWdlbnRJbmZvID0gW107CiAgICAgICAgICAgIHRoaXMudGVsZW1ldHJ5U3RyaW5nID0gdXNlckFnZW50SW5mby5qb2luKCIgIik7CiAgICAgICAgfQogICAgICAgIFRlbGVtZXRyeVBvbGljeUZhY3RvcnkucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uIChuZXh0UG9saWN5LCBvcHRpb25zKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgVGVsZW1ldHJ5UG9saWN5KG5leHRQb2xpY3ksIG9wdGlvbnMsIHRoaXMudGVsZW1ldHJ5U3RyaW5nKTsKICAgICAgICB9OwogICAgICAgIHJldHVybiBUZWxlbWV0cnlQb2xpY3lGYWN0b3J5OwogICAgfSgpKTsKCiAgICAvKioKICAgICAqIFVuaXF1ZVJlcXVlc3RJRFBvbGljeSBnZW5lcmF0ZXMgYW4gVVVJRCBhcyB4LW1zLXJlcXVlc3QtaWQgaGVhZGVyIHZhbHVlLgogICAgICoKICAgICAqIEBjbGFzcyBVbmlxdWVSZXF1ZXN0SURQb2xpY3kKICAgICAqIEBleHRlbmRzIHtCYXNlUmVxdWVzdFBvbGljeX0KICAgICAqLwogICAgdmFyIFVuaXF1ZVJlcXVlc3RJRFBvbGljeSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKICAgICAgICBfX2V4dGVuZHMoVW5pcXVlUmVxdWVzdElEUG9saWN5LCBfc3VwZXIpOwogICAgICAgIC8qKgogICAgICAgICAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgVW5pcXVlUmVxdWVzdElEUG9saWN5LgogICAgICAgICAqIEBwYXJhbSB7UmVxdWVzdFBvbGljeX0gbmV4dFBvbGljeQogICAgICAgICAqIEBwYXJhbSB7UmVxdWVzdFBvbGljeU9wdGlvbnN9IG9wdGlvbnMKICAgICAgICAgKiBAbWVtYmVyb2YgVW5pcXVlUmVxdWVzdElEUG9saWN5CiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gVW5pcXVlUmVxdWVzdElEUG9saWN5KG5leHRQb2xpY3ksIG9wdGlvbnMpIHsKICAgICAgICAgICAgcmV0dXJuIF9zdXBlci5jYWxsKHRoaXMsIG5leHRQb2xpY3ksIG9wdGlvbnMpIHx8IHRoaXM7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNlbmRzIHJlcXVlc3QuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge1dlYlJlc291cmNlfSByZXF1ZXN0CiAgICAgICAgICogQHJldHVybnMge1Byb21pc2U8SHR0cE9wZXJhdGlvblJlc3BvbnNlPn0KICAgICAgICAgKiBAbWVtYmVyb2YgVW5pcXVlUmVxdWVzdElEUG9saWN5CiAgICAgICAgICovCiAgICAgICAgVW5pcXVlUmVxdWVzdElEUG9saWN5LnByb3RvdHlwZS5zZW5kUmVxdWVzdCA9IGZ1bmN0aW9uIChyZXF1ZXN0KSB7CiAgICAgICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIXJlcXVlc3QuaGVhZGVycy5jb250YWlucyhIZWFkZXJDb25zdGFudHMuWF9NU19DTElFTlRfUkVRVUVTVF9JRCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5oZWFkZXJzLnNldChIZWFkZXJDb25zdGFudHMuWF9NU19DTElFTlRfUkVRVUVTVF9JRCwgZ2VuZXJhdGVVdWlkKCkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgdGhpcy5fbmV4dFBvbGljeS5zZW5kUmVxdWVzdChyZXF1ZXN0KV07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gVW5pcXVlUmVxdWVzdElEUG9saWN5OwogICAgfShCYXNlUmVxdWVzdFBvbGljeSkpOwoKICAgIC8qKgogICAgICogVW5pcXVlUmVxdWVzdElEUG9saWN5RmFjdG9yeSBpcyBhIGZhY3RvcnkgY2xhc3MgaGVscGluZyBnZW5lcmF0aW5nIFVuaXF1ZVJlcXVlc3RJRFBvbGljeSBvYmplY3RzLgogICAgICoKICAgICAqIEBleHBvcnQKICAgICAqIEBjbGFzcyBVbmlxdWVSZXF1ZXN0SURQb2xpY3lGYWN0b3J5CiAgICAgKiBAaW1wbGVtZW50cyB7UmVxdWVzdFBvbGljeUZhY3Rvcnl9CiAgICAgKi8KICAgIHZhciBVbmlxdWVSZXF1ZXN0SURQb2xpY3lGYWN0b3J5ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIFVuaXF1ZVJlcXVlc3RJRFBvbGljeUZhY3RvcnkoKSB7CiAgICAgICAgfQogICAgICAgIFVuaXF1ZVJlcXVlc3RJRFBvbGljeUZhY3RvcnkucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uIChuZXh0UG9saWN5LCBvcHRpb25zKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgVW5pcXVlUmVxdWVzdElEUG9saWN5KG5leHRQb2xpY3ksIG9wdGlvbnMpOwogICAgICAgIH07CiAgICAgICAgcmV0dXJuIFVuaXF1ZVJlcXVlc3RJRFBvbGljeUZhY3Rvcnk7CiAgICB9KCkpOwoKICAgIC8qKgogICAgICogQ3JlZGVudGlhbCBwb2xpY3kgdXNlZCB0byBzaWduIEhUVFAoUykgcmVxdWVzdHMgYmVmb3JlIHNlbmRpbmcuIFRoaXMgaXMgYW4KICAgICAqIGFic3RyYWN0IGNsYXNzLgogICAgICoKICAgICAqIEBleHBvcnQKICAgICAqIEBhYnN0cmFjdAogICAgICogQGNsYXNzIENyZWRlbnRpYWxQb2xpY3kKICAgICAqIEBleHRlbmRzIHtCYXNlUmVxdWVzdFBvbGljeX0KICAgICAqLwogICAgdmFyIENyZWRlbnRpYWxQb2xpY3kgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CiAgICAgICAgX19leHRlbmRzKENyZWRlbnRpYWxQb2xpY3ksIF9zdXBlcik7CiAgICAgICAgZnVuY3Rpb24gQ3JlZGVudGlhbFBvbGljeSgpIHsKICAgICAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZW5kcyBvdXQgcmVxdWVzdC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7V2ViUmVzb3VyY2V9IHJlcXVlc3QKICAgICAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxIdHRwT3BlcmF0aW9uUmVzcG9uc2U+fQogICAgICAgICAqIEBtZW1iZXJvZiBDcmVkZW50aWFsUG9saWN5CiAgICAgICAgICovCiAgICAgICAgQ3JlZGVudGlhbFBvbGljeS5wcm90b3R5cGUuc2VuZFJlcXVlc3QgPSBmdW5jdGlvbiAocmVxdWVzdCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbmV4dFBvbGljeS5zZW5kUmVxdWVzdCh0aGlzLnNpZ25SZXF1ZXN0KHJlcXVlc3QpKTsKICAgICAgICB9OwogICAgICAgIC8qKgogICAgICAgICAqIENoaWxkIGNsYXNzZXMgbXVzdCBpbXBsZW1lbnQgdGhpcyBtZXRob2Qgd2l0aCByZXF1ZXN0IHNpZ25pbmcuIFRoaXMgbWV0aG9kCiAgICAgICAgICogd2lsbCBiZSBleGVjdXRlZCBpbiBzZW5kUmVxdWVzdCgpLgogICAgICAgICAqCiAgICAgICAgICogQHByb3RlY3RlZAogICAgICAgICAqIEBhYnN0cmFjdAogICAgICAgICAqIEBwYXJhbSB7V2ViUmVzb3VyY2V9IHJlcXVlc3QKICAgICAgICAgKiBAcmV0dXJucyB7V2ViUmVzb3VyY2V9CiAgICAgICAgICogQG1lbWJlcm9mIENyZWRlbnRpYWxQb2xpY3kKICAgICAgICAgKi8KICAgICAgICBDcmVkZW50aWFsUG9saWN5LnByb3RvdHlwZS5zaWduUmVxdWVzdCA9IGZ1bmN0aW9uIChyZXF1ZXN0KSB7CiAgICAgICAgICAgIC8vIENoaWxkIGNsYXNzZXMgbXVzdCBvdmVycmlkZSB0aGlzIG1ldGhvZCB3aXRoIHJlcXVlc3Qgc2lnbmluZy4gVGhpcyBtZXRob2QKICAgICAgICAgICAgLy8gd2lsbCBiZSBleGVjdXRlZCBpbiBzZW5kUmVxdWVzdCgpLgogICAgICAgICAgICByZXR1cm4gcmVxdWVzdDsKICAgICAgICB9OwogICAgICAgIHJldHVybiBDcmVkZW50aWFsUG9saWN5OwogICAgfShCYXNlUmVxdWVzdFBvbGljeSkpOwoKICAgIC8qKgogICAgICogQW5vbnltb3VzQ3JlZGVudGlhbFBvbGljeSBpcyB1c2VkIHdpdGggSFRUUChTKSByZXF1ZXN0cyB0aGF0IHJlYWQgcHVibGljIHJlc291cmNlcwogICAgICogb3IgZm9yIHVzZSB3aXRoIFNoYXJlZCBBY2Nlc3MgU2lnbmF0dXJlcyAoU0FTKS4KICAgICAqCiAgICAgKiBAZXhwb3J0CiAgICAgKiBAY2xhc3MgQW5vbnltb3VzQ3JlZGVudGlhbFBvbGljeQogICAgICogQGV4dGVuZHMge0NyZWRlbnRpYWxQb2xpY3l9CiAgICAgKi8KICAgIHZhciBBbm9ueW1vdXNDcmVkZW50aWFsUG9saWN5ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewogICAgICAgIF9fZXh0ZW5kcyhBbm9ueW1vdXNDcmVkZW50aWFsUG9saWN5LCBfc3VwZXIpOwogICAgICAgIC8qKgogICAgICAgICAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgQW5vbnltb3VzQ3JlZGVudGlhbFBvbGljeS4KICAgICAgICAgKiBAcGFyYW0ge1JlcXVlc3RQb2xpY3l9IG5leHRQb2xpY3kKICAgICAgICAgKiBAcGFyYW0ge1JlcXVlc3RQb2xpY3lPcHRpb25zfSBvcHRpb25zCiAgICAgICAgICogQG1lbWJlcm9mIEFub255bW91c0NyZWRlbnRpYWxQb2xpY3kKICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBBbm9ueW1vdXNDcmVkZW50aWFsUG9saWN5KG5leHRQb2xpY3ksIG9wdGlvbnMpIHsKICAgICAgICAgICAgcmV0dXJuIF9zdXBlci5jYWxsKHRoaXMsIG5leHRQb2xpY3ksIG9wdGlvbnMpIHx8IHRoaXM7CiAgICAgICAgfQogICAgICAgIHJldHVybiBBbm9ueW1vdXNDcmVkZW50aWFsUG9saWN5OwogICAgfShDcmVkZW50aWFsUG9saWN5KSk7CgogICAgLyoqCiAgICAgKiBBbm9ueW1vdXNDcmVkZW50aWFsIHByb3ZpZGVzIGEgY3JlZGVudGlhbFBvbGljeUNyZWF0b3IgbWVtYmVyIHVzZWQgdG8gY3JlYXRlCiAgICAgKiBBbm9ueW1vdXNDcmVkZW50aWFsUG9saWN5IG9iamVjdHMuIEFub255bW91c0NyZWRlbnRpYWxQb2xpY3kgaXMgdXNlZCB3aXRoCiAgICAgKiBIVFRQKFMpIHJlcXVlc3RzIHRoYXQgcmVhZCBwdWJsaWMgcmVzb3VyY2VzIG9yIGZvciB1c2Ugd2l0aCBTaGFyZWQgQWNjZXNzCiAgICAgKiBTaWduYXR1cmVzIChTQVMpLgogICAgICoKICAgICAqIEBleHBvcnQKICAgICAqIEBjbGFzcyBBbm9ueW1vdXNDcmVkZW50aWFsCiAgICAgKiBAZXh0ZW5kcyB7Q3JlZGVudGlhbH0KICAgICAqLwogICAgdmFyIEFub255bW91c0NyZWRlbnRpYWwgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CiAgICAgICAgX19leHRlbmRzKEFub255bW91c0NyZWRlbnRpYWwsIF9zdXBlcik7CiAgICAgICAgZnVuY3Rpb24gQW5vbnltb3VzQ3JlZGVudGlhbCgpIHsKICAgICAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGVzIGFuIEFub255bW91c0NyZWRlbnRpYWxQb2xpY3kgb2JqZWN0LgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtSZXF1ZXN0UG9saWN5fSBuZXh0UG9saWN5CiAgICAgICAgICogQHBhcmFtIHtSZXF1ZXN0UG9saWN5T3B0aW9uc30gb3B0aW9ucwogICAgICAgICAqIEByZXR1cm5zIHtBbm9ueW1vdXNDcmVkZW50aWFsUG9saWN5fQogICAgICAgICAqIEBtZW1iZXJvZiBBbm9ueW1vdXNDcmVkZW50aWFsCiAgICAgICAgICovCiAgICAgICAgQW5vbnltb3VzQ3JlZGVudGlhbC5wcm90b3R5cGUuY3JlYXRlID0gZnVuY3Rpb24gKG5leHRQb2xpY3ksIG9wdGlvbnMpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBBbm9ueW1vdXNDcmVkZW50aWFsUG9saWN5KG5leHRQb2xpY3ksIG9wdGlvbnMpOwogICAgICAgIH07CiAgICAgICAgcmV0dXJuIEFub255bW91c0NyZWRlbnRpYWw7CiAgICB9KENyZWRlbnRpYWwpKTsKCiAgICAvKioKICAgICAqIEEgU2VydmljZVVSTCByZXByZXNlbnRzIGEgYmFzZWQgVVJMIGNsYXNzIGZvciBTZXJ2aWNlVVJMLCBDb250YWluZXJVUkwgYW5kIGV0Yy4KICAgICAqCiAgICAgKiBAZXhwb3J0CiAgICAgKiBAY2xhc3MgU3RvcmFnZVVSTAogICAgICovCiAgICB2YXIgU3RvcmFnZVVSTCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIFN0b3JhZ2VVUkwuCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHVybAogICAgICAgICAqIEBwYXJhbSB7UGlwZWxpbmV9IHBpcGVsaW5lCiAgICAgICAgICogQG1lbWJlcm9mIFN0b3JhZ2VVUkwKICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBTdG9yYWdlVVJMKHVybCwgcGlwZWxpbmUpIHsKICAgICAgICAgICAgLy8gVVJMIHNob3VsZCBiZSBlbmNvZGVkIGFuZCBvbmx5IG9uY2UsIHByb3RvY29sIGxheWVyIHNob3VsZG4ndCBlbmNvZGUgVVJMIGFnYWluCiAgICAgICAgICAgIHRoaXMudXJsID0gZXNjYXBlVVJMUGF0aCh1cmwpOwogICAgICAgICAgICB0aGlzLnBpcGVsaW5lID0gcGlwZWxpbmU7CiAgICAgICAgICAgIHRoaXMuc3RvcmFnZUNsaWVudENvbnRleHQgPSBuZXcgU3RvcmFnZUNsaWVudENvbnRleHQodGhpcy51cmwsIHBpcGVsaW5lLnRvU2VydmljZUNsaWVudE9wdGlvbnMoKSk7CiAgICAgICAgICAgIHRoaXMuaXNIdHRwcyA9IGlFcXVhbChnZXRVUkxTY2hlbWUodGhpcy51cmwpIHx8ICIiLCAiaHR0cHMiKTsKICAgICAgICAgICAgdGhpcy5jcmVkZW50aWFsID0gbmV3IEFub255bW91c0NyZWRlbnRpYWwoKTsKICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IHRoaXMucGlwZWxpbmUuZmFjdG9yaWVzOyBfaSA8IF9hLmxlbmd0aDsgX2krKykgewogICAgICAgICAgICAgICAgdmFyIGZhY3RvcnkgPSBfYVtfaV07CiAgICAgICAgICAgICAgICBpZiAoZmFjdG9yeSBpbnN0YW5jZW9mIENyZWRlbnRpYWwpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNyZWRlbnRpYWwgPSBmYWN0b3J5OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIE92ZXJyaWRlIHByb3RvY29sIGxheWVyJ3MgZGVmYXVsdCBjb250ZW50LXR5cGUKICAgICAgICAgICAgdmFyIHN0b3JhZ2VDbGllbnRDb250ZXh0ID0gdGhpcy5zdG9yYWdlQ2xpZW50Q29udGV4dDsKICAgICAgICAgICAgc3RvcmFnZUNsaWVudENvbnRleHQucmVxdWVzdENvbnRlbnRUeXBlID0gdW5kZWZpbmVkOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBBIHN0YXRpYyBtZXRob2QgdXNlZCB0byBjcmVhdGUgYSBuZXcgUGlwZWxpbmUgb2JqZWN0IHdpdGggQ3JlZGVudGlhbCBwcm92aWRlZC4KICAgICAgICAgKgogICAgICAgICAqIEBzdGF0aWMKICAgICAgICAgKiBAcGFyYW0ge0NyZWRlbnRpYWx9IGNyZWRlbnRpYWwgU3VjaCBhcyBBbm9ueW1vdXNDcmVkZW50aWFsLCBTaGFyZWRLZXlDcmVkZW50aWFsIG9yIFRva2VuQ3JlZGVudGlhbC4KICAgICAgICAgKiBAcGFyYW0ge0lOZXdQaXBlbGluZU9wdGlvbnN9IFtwaXBlbGluZU9wdGlvbnNdIE9wdGlvbmFsLiBPcHRpb25zLgogICAgICAgICAqIEByZXR1cm5zIHtQaXBlbGluZX0gQSBuZXcgUGlwZWxpbmUgb2JqZWN0LgogICAgICAgICAqIEBtZW1iZXJvZiBQaXBlbGluZQogICAgICAgICAqLwogICAgICAgIFN0b3JhZ2VVUkwubmV3UGlwZWxpbmUgPSBmdW5jdGlvbiAoY3JlZGVudGlhbCwgcGlwZWxpbmVPcHRpb25zKSB7CiAgICAgICAgICAgIGlmIChwaXBlbGluZU9wdGlvbnMgPT09IHZvaWQgMCkgeyBwaXBlbGluZU9wdGlvbnMgPSB7fTsgfQogICAgICAgICAgICAvLyBPcmRlciBpcyBpbXBvcnRhbnQuIENsb3NlciB0byB0aGUgQVBJIGF0IHRoZSB0b3AgJiBjbG9zZXIgdG8gdGhlIG5ldHdvcmsgYXQgdGhlIGJvdHRvbS4KICAgICAgICAgICAgLy8gVGhlIGNyZWRlbnRpYWwncyBwb2xpY3kgZmFjdG9yeSBtdXN0IGFwcGVhciBjbG9zZSB0byB0aGUgd2lyZSBzbyBpdCBjYW4gc2lnbiBhbnkKICAgICAgICAgICAgLy8gY2hhbmdlcyBtYWRlIGJ5IG90aGVyIGZhY3RvcmllcyAobGlrZSBVbmlxdWVSZXF1ZXN0SURQb2xpY3lGYWN0b3J5KQogICAgICAgICAgICB2YXIgZmFjdG9yaWVzID0gWwogICAgICAgICAgICAgICAgbmV3IEtlZXBBbGl2ZVBvbGljeUZhY3RvcnkocGlwZWxpbmVPcHRpb25zLmtlZXBBbGl2ZU9wdGlvbnMpLAogICAgICAgICAgICAgICAgbmV3IFRlbGVtZXRyeVBvbGljeUZhY3RvcnkocGlwZWxpbmVPcHRpb25zLnRlbGVtZXRyeSksCiAgICAgICAgICAgICAgICBuZXcgVW5pcXVlUmVxdWVzdElEUG9saWN5RmFjdG9yeSgpLAogICAgICAgICAgICAgICAgbmV3IEJyb3dzZXJQb2xpY3lGYWN0b3J5KCksCiAgICAgICAgICAgICAgICBkZXNlcmlhbGl6YXRpb25Qb2xpY3koKSwKICAgICAgICAgICAgICAgIG5ldyBSZXRyeVBvbGljeUZhY3RvcnkocGlwZWxpbmVPcHRpb25zLnJldHJ5T3B0aW9ucyksCiAgICAgICAgICAgICAgICBuZXcgTG9nZ2luZ1BvbGljeUZhY3RvcnkoKSwKICAgICAgICAgICAgICAgIGNyZWRlbnRpYWwKICAgICAgICAgICAgXTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBQaXBlbGluZShmYWN0b3JpZXMsIHsKICAgICAgICAgICAgICAgIEhUVFBDbGllbnQ6IHBpcGVsaW5lT3B0aW9ucy5odHRwQ2xpZW50LAogICAgICAgICAgICAgICAgbG9nZ2VyOiBwaXBlbGluZU9wdGlvbnMubG9nZ2VyCiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgcmV0dXJuIFN0b3JhZ2VVUkw7CiAgICB9KCkpOwoKICAgIC8qKgogICAgICogQSBCbG9iVVJMIHJlcHJlc2VudHMgYSBVUkwgdG8gYW4gQXp1cmUgU3RvcmFnZSBibG9iOyB0aGUgYmxvYiBtYXkgYmUgYSBibG9jayBibG9iLAogICAgICogYXBwZW5kIGJsb2IsIG9yIHBhZ2UgYmxvYi4KICAgICAqCiAgICAgKiBAZXhwb3J0CiAgICAgKiBAY2xhc3MgQmxvYlVSTAogICAgICogQGV4dGVuZHMge1N0b3JhZ2VVUkx9CiAgICAgKi8KICAgIHZhciBCbG9iVVJMID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewogICAgICAgIF9fZXh0ZW5kcyhCbG9iVVJMLCBfc3VwZXIpOwogICAgICAgIC8qKgogICAgICAgICAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgQmxvYlVSTC4KICAgICAgICAgKiBUaGlzIG1ldGhvZCBhY2NlcHRzIGFuIGVuY29kZWQgVVJMIG9yIG5vbi1lbmNvZGVkIFVSTCBwb2ludGluZyB0byBhIGJsb2IuCiAgICAgICAgICogRW5jb2RlZCBVUkwgc3RyaW5nIHdpbGwgTk9UIGJlIGVzY2FwZWQgdHdpY2UsIG9ubHkgc3BlY2lhbCBjaGFyYWN0ZXJzIGluIFVSTCBwYXRoIHdpbGwgYmUgZXNjYXBlZC4KICAgICAgICAgKiBJZiBhIGJsb2IgbmFtZSBpbmNsdWRlcyA/IG9yICUsIGJsb2IgbmFtZSBtdXN0IGJlIGVuY29kZWQgaW4gdGhlIFVSTC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgQSBVUkwgc3RyaW5nIHBvaW50aW5nIHRvIEF6dXJlIFN0b3JhZ2UgYmxvYiwgc3VjaCBhcwogICAgICAgICAqICAgICAgICAgICAgICAgICAgICAgImh0dHBzOi8vbXlhY2NvdW50LmJsb2IuY29yZS53aW5kb3dzLm5ldC9teWNvbnRhaW5lci9ibG9iIi4KICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgIFlvdSBjYW4gYXBwZW5kIGEgU0FTIGlmIHVzaW5nIEFub255bW91c0NyZWRlbnRpYWwsIHN1Y2ggYXMKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICJodHRwczovL215YWNjb3VudC5ibG9iLmNvcmUud2luZG93cy5uZXQvbXljb250YWluZXIvYmxvYj9zYXNTdHJpbmciLgogICAgICAgICAqICAgICAgICAgICAgICAgICAgICAgVGhpcyBtZXRob2QgYWNjZXB0cyBhbiBlbmNvZGVkIFVSTCBvciBub24tZW5jb2RlZCBVUkwgcG9pbnRpbmcgdG8gYSBibG9iLgogICAgICAgICAqICAgICAgICAgICAgICAgICAgICAgRW5jb2RlZCBVUkwgc3RyaW5nIHdpbGwgTk9UIGJlIGVzY2FwZWQgdHdpY2UsIG9ubHkgc3BlY2lhbCBjaGFyYWN0ZXJzIGluIFVSTCBwYXRoIHdpbGwgYmUgZXNjYXBlZC4KICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgIEhvd2V2ZXIsIGlmIGEgYmxvYiBuYW1lIGluY2x1ZGVzID8gb3IgJSwgYmxvYiBuYW1lIG11c3QgYmUgZW5jb2RlZCBpbiB0aGUgVVJMLgogICAgICAgICAqICAgICAgICAgICAgICAgICAgICAgU3VjaCBhcyBhIGJsb2IgbmFtZWQgIm15P2Jsb2IlIiwgdGhlIFVSTCBzaG91bGQgYmUgImh0dHBzOi8vbXlhY2NvdW50LmJsb2IuY29yZS53aW5kb3dzLm5ldC9teWNvbnRhaW5lci9teSUzRmJsb2IlMjUiLgogICAgICAgICAqIEBwYXJhbSB7UGlwZWxpbmV9IHBpcGVsaW5lIENhbGwgU3RvcmFnZVVSTC5uZXdQaXBlbGluZSgpIHRvIGNyZWF0ZSBhIGRlZmF1bHQKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaXBlbGluZSwgb3IgcHJvdmlkZSBhIGN1c3RvbWl6ZWQgcGlwZWxpbmUuCiAgICAgICAgICogQG1lbWJlcm9mIEJsb2JVUkwKICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBCbG9iVVJMKHVybCwgcGlwZWxpbmUpIHsKICAgICAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgdXJsLCBwaXBlbGluZSkgfHwgdGhpczsKICAgICAgICAgICAgX3RoaXMuYmxvYkNvbnRleHQgPSBuZXcgQmxvYiQxKF90aGlzLnN0b3JhZ2VDbGllbnRDb250ZXh0KTsKICAgICAgICAgICAgcmV0dXJuIF90aGlzOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGVzIGEgQmxvYlVSTCBvYmplY3QgZnJvbSBhbiBDb250YWluZXJVUkwgb2JqZWN0LgogICAgICAgICAqCiAgICAgICAgICogQHN0YXRpYwogICAgICAgICAqIEBwYXJhbSB7Q29udGFpbmVyVVJMfSBjb250YWluZXJVUkwgQSBDb250YWluZXJVUkwgb2JqZWN0CiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IGJsb2JOYW1lIEEgYmxvYiBuYW1lCiAgICAgICAgICogQHJldHVybnMKICAgICAgICAgKiBAbWVtYmVyb2YgQmxvYlVSTAogICAgICAgICAqLwogICAgICAgIEJsb2JVUkwuZnJvbUNvbnRhaW5lclVSTCA9IGZ1bmN0aW9uIChjb250YWluZXJVUkwsIGJsb2JOYW1lKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgQmxvYlVSTChhcHBlbmRUb1VSTFBhdGgoY29udGFpbmVyVVJMLnVybCwgZW5jb2RlVVJJQ29tcG9uZW50KGJsb2JOYW1lKSksIGNvbnRhaW5lclVSTC5waXBlbGluZSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGVzIGEgbmV3IEJsb2JVUkwgb2JqZWN0IGlkZW50aWNhbCB0byB0aGUgc291cmNlIGJ1dCB3aXRoIHRoZQogICAgICAgICAqIHNwZWNpZmllZCByZXF1ZXN0IHBvbGljeSBwaXBlbGluZS4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7UGlwZWxpbmV9IHBpcGVsaW5lCiAgICAgICAgICogQHJldHVybnMge0Jsb2JVUkx9CiAgICAgICAgICogQG1lbWJlcm9mIEJsb2JVUkwKICAgICAgICAgKi8KICAgICAgICBCbG9iVVJMLnByb3RvdHlwZS53aXRoUGlwZWxpbmUgPSBmdW5jdGlvbiAocGlwZWxpbmUpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBCbG9iVVJMKHRoaXMudXJsLCBwaXBlbGluZSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGVzIGEgbmV3IEJsb2JVUkwgb2JqZWN0IGlkZW50aWNhbCB0byB0aGUgc291cmNlIGJ1dCB3aXRoIHRoZSBzcGVjaWZpZWQgc25hcHNob3QgdGltZXN0YW1wLgogICAgICAgICAqIFByb3ZpZGUgIiIgd2lsbCByZW1vdmUgdGhlIHNuYXBzaG90IGFuZCByZXR1cm4gYSBVUkwgdG8gdGhlIGJhc2UgYmxvYi4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBzbmFwc2hvdAogICAgICAgICAqIEByZXR1cm5zIHtCbG9iVVJMfSBBIG5ldyBCbG9iVVJMIG9iamVjdCBpZGVudGljYWwgdG8gdGhlIHNvdXJjZSBidXQgd2l0aCB0aGUgc3BlY2lmaWVkIHNuYXBzaG90IHRpbWVzdGFtcAogICAgICAgICAqIEBtZW1iZXJvZiBCbG9iVVJMCiAgICAgICAgICovCiAgICAgICAgQmxvYlVSTC5wcm90b3R5cGUud2l0aFNuYXBzaG90ID0gZnVuY3Rpb24gKHNuYXBzaG90KSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgQmxvYlVSTChzZXRVUkxQYXJhbWV0ZXIodGhpcy51cmwsIFVSTENvbnN0YW50cy5QYXJhbWV0ZXJzLlNOQVBTSE9ULCBzbmFwc2hvdC5sZW5ndGggPT09IDAgPyB1bmRlZmluZWQgOiBzbmFwc2hvdCksIHRoaXMucGlwZWxpbmUpOwogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogUmVhZHMgb3IgZG93bmxvYWRzIGEgYmxvYiBmcm9tIHRoZSBzeXN0ZW0sIGluY2x1ZGluZyBpdHMgbWV0YWRhdGEgYW5kIHByb3BlcnRpZXMuCiAgICAgICAgICogWW91IGNhbiBhbHNvIGNhbGwgR2V0IEJsb2IgdG8gcmVhZCBhIHNuYXBzaG90LgogICAgICAgICAqCiAgICAgICAgICogKiBJbiBOb2RlLmpzLCBkYXRhIHJldHVybnMgaW4gYSBSZWFkYWJsZSBzdHJlYW0gcmVhZGFibGVTdHJlYW1Cb2R5CiAgICAgICAgICogKiBJbiBicm93c2VycywgZGF0YSByZXR1cm5zIGluIGEgcHJvbWlzZSBibG9iQm9keQogICAgICAgICAqCiAgICAgICAgICogQHNlZSBodHRwczovL2RvY3MubWljcm9zb2Z0LmNvbS9lbi11cy9yZXN0L2FwaS9zdG9yYWdlc2VydmljZXMvZ2V0LWJsb2IKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7QWJvcnRlcn0gYWJvcnRlciBDcmVhdGUgYSBuZXcgQWJvcnRlciBpbnN0YW5jZSB3aXRoIEFib3J0ZXIubm9uZSBvciBBYm9ydGVyLnRpbWVvdXQoKSwKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgZ290byBkb2N1bWVudHMgb2YgQWJvcnRlciBmb3IgbW9yZSBleGFtcGxlcyBhYm91dCByZXF1ZXN0IGNhbmNlbGxhdGlvbgogICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBvZmZzZXQgRnJvbSB3aGljaCBwb3NpdGlvbiBvZiB0aGUgYmxvYiB0byBkb3dubG9hZCwgPj0gMAogICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbY291bnRdIEhvdyBtdWNoIGRhdGEgdG8gYmUgZG93bmxvYWRlZCwgPiAwLiBXaWxsIGRvd25sb2FkIHRvIHRoZSBlbmQgd2hlbiB1bmRlZmluZWQKICAgICAgICAgKiBAcGFyYW0ge0lCbG9iRG93bmxvYWRPcHRpb25zfSBbb3B0aW9uc10KICAgICAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxNb2RlbHMuQmxvYkRvd25sb2FkUmVzcG9uc2U+fQogICAgICAgICAqIEBtZW1iZXJvZiBCbG9iVVJMCiAgICAgICAgICovCiAgICAgICAgQmxvYlVSTC5wcm90b3R5cGUuZG93bmxvYWQgPSBmdW5jdGlvbiAoYWJvcnRlciwgb2Zmc2V0LCBjb3VudCwgb3B0aW9ucykgewogICAgICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7IG9wdGlvbnMgPSB7fTsgfQogICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgcmVzOwogICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYmxvYkFjY2Vzc0NvbmRpdGlvbnMgPSBvcHRpb25zLmJsb2JBY2Nlc3NDb25kaXRpb25zIHx8IHt9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5ibG9iQWNjZXNzQ29uZGl0aW9ucy5tb2RpZmllZEFjY2Vzc0NvbmRpdGlvbnMgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYmxvYkFjY2Vzc0NvbmRpdGlvbnMubW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zIHx8IHt9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5zdXJlQ3BrSWZTcGVjaWZpZWQob3B0aW9ucy5jdXN0b21lclByb3ZpZGVkS2V5LCB0aGlzLmlzSHR0cHMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgdGhpcy5ibG9iQ29udGV4dC5kb3dubG9hZCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFib3J0U2lnbmFsOiBhYm9ydGVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWFzZUFjY2Vzc0NvbmRpdGlvbnM6IG9wdGlvbnMuYmxvYkFjY2Vzc0NvbmRpdGlvbnMubGVhc2VBY2Nlc3NDb25kaXRpb25zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RpZmllZEFjY2Vzc0NvbmRpdGlvbnM6IG9wdGlvbnMuYmxvYkFjY2Vzc0NvbmRpdGlvbnMubW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkRvd25sb2FkUHJvZ3Jlc3M6IGlzTm9kZSA/IHVuZGVmaW5lZCA6IG9wdGlvbnMucHJvZ3Jlc3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhbmdlOiBvZmZzZXQgPT09IDAgJiYgIWNvdW50ID8gdW5kZWZpbmVkIDogcmFuZ2VUb1N0cmluZyh7IG9mZnNldDogb2Zmc2V0LCBjb3VudDogY291bnQgfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhbmdlR2V0Q29udGVudE1ENTogb3B0aW9ucy5yYW5nZUdldENvbnRlbnRNRDUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhbmdlR2V0Q29udGVudENSQzY0OiBvcHRpb25zLnJhbmdlR2V0Q29udGVudENyYzY0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbmFwc2hvdDogb3B0aW9ucy5zbmFwc2hvdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3BrSW5mbzogb3B0aW9ucy5jdXN0b21lclByb3ZpZGVkS2V5CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSldOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXMgPSBfYS5zZW50KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZXR1cm4gYnJvd3NlciByZXNwb25zZSBpbW1lZGlhdGVseQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpc05vZGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgcmVzXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdlIHN1cHBvcnQgcmV0cnlpbmcgd2hlbiBkb3dubG9hZCBzdHJlYW0gdW5leHBlY3RlZCBlbmRzIGluIE5vZGUuanMgcnVudGltZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRm9sbG93aW5nIGNvZGUgc2hvdWxkbid0IGJlIGJ1bmRsZWQgaW50byBicm93c2VyIGJ1aWxkLCBob3dldmVyIHNvbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJ1bmRsZXJzIG1heSB0cnkgdG8gYnVuZGxlIGZvbGxvd2luZyBjb2RlIGFuZCAiRmlsZVJlYWRSZXNwb25zZS50cyIuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJbiB0aGlzIGNhc2UsICJGaWxlRG93bmxvYWRSZXNwb25zZS5icm93c2VyLnRzIiB3aWxsIGJlIHVzZWQgYXMgYSBzaGltIG9mICJGaWxlRG93bmxvYWRSZXNwb25zZS50cyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZSBjb25maWcgaXMgaW4gcGFja2FnZS5qc29uICJicm93c2VyIiBmaWVsZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMubWF4UmV0cnlSZXF1ZXN0cyA9PT0gdW5kZWZpbmVkIHx8IG9wdGlvbnMubWF4UmV0cnlSZXF1ZXN0cyA8IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUT0RPOiBEZWZhdWx0IHZhbHVlIG9yIG1ha2UgaXQgYSByZXF1aXJlZCBwYXJhbWV0ZXI/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5tYXhSZXRyeVJlcXVlc3RzID0gREVGQVVMVF9NQVhfRE9XTkxPQURfUkVUUllfUkVRVUVTVFM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmNvbnRlbnRMZW5ndGggPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCJGaWxlIGRvd25sb2FkIHJlc3BvbnNlIGRvZXNuJ3QgY29udGFpbiB2YWxpZCBjb250ZW50IGxlbmd0aCBoZWFkZXIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzLmVUYWcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiRmlsZSBkb3dubG9hZCByZXNwb25zZSBkb2Vzbid0IGNvbnRhaW4gdmFsaWQgZXRhZyBoZWFkZXIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCBuZXcgQmxvYkRvd25sb2FkUmVzcG9uc2UoYWJvcnRlciwgcmVzLCBmdW5jdGlvbiAoc3RhcnQpIHsgcmV0dXJuIF9fYXdhaXRlcihfdGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHVwZGF0ZWRPcHRpb25zOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVkT3B0aW9ucyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlYXNlQWNjZXNzQ29uZGl0aW9uczogb3B0aW9ucy5ibG9iQWNjZXNzQ29uZGl0aW9ucy5sZWFzZUFjY2Vzc0NvbmRpdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RpZmllZEFjY2Vzc0NvbmRpdGlvbnM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZk1hdGNoOiBvcHRpb25zLmJsb2JBY2Nlc3NDb25kaXRpb25zLm1vZGlmaWVkQWNjZXNzQ29uZGl0aW9ucy5pZk1hdGNoIHx8IHJlcy5lVGFnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmTW9kaWZpZWRTaW5jZTogb3B0aW9ucy5ibG9iQWNjZXNzQ29uZGl0aW9ucy5tb2RpZmllZEFjY2Vzc0NvbmRpdGlvbnMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmlmTW9kaWZpZWRTaW5jZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZk5vbmVNYXRjaDogb3B0aW9ucy5ibG9iQWNjZXNzQ29uZGl0aW9ucy5tb2RpZmllZEFjY2Vzc0NvbmRpdGlvbnMuaWZOb25lTWF0Y2gsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWZVbm1vZGlmaWVkU2luY2U6IG9wdGlvbnMuYmxvYkFjY2Vzc0NvbmRpdGlvbnMubW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5pZlVubW9kaWZpZWRTaW5jZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhbmdlOiByYW5nZVRvU3RyaW5nKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudDogb2Zmc2V0ICsgcmVzLmNvbnRlbnRMZW5ndGggLSBzdGFydCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXQ6IHN0YXJ0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhbmdlR2V0Q29udGVudE1ENTogb3B0aW9ucy5yYW5nZUdldENvbnRlbnRNRDUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByYW5nZUdldENvbnRlbnRDUkM2NDogb3B0aW9ucy5yYW5nZUdldENvbnRlbnRDcmM2NCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNuYXBzaG90OiBvcHRpb25zLnNuYXBzaG90LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3BrSW5mbzogb3B0aW9ucy5jdXN0b21lclByb3ZpZGVkS2V5CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHRoaXMuYmxvYkNvbnRleHQuZG93bmxvYWQoX19hc3NpZ24oeyBhYm9ydFNpZ25hbDogYWJvcnRlciB9LCB1cGRhdGVkT3B0aW9ucykpXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE6IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIERlYnVnIHB1cnBvc2Ugb25seQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgYFJlYWQgZnJvbSBpbnRlcm5hbCBzdHJlYW0sIHJhbmdlOiAkewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICB1cGRhdGVkT3B0aW9ucy5yYW5nZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgfSwgb3B0aW9uczogJHtKU09OLnN0cmluZ2lmeSh1cGRhdGVkT3B0aW9ucyl9YAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIChfYS5zZW50KCkpLnJlYWRhYmxlU3RyZWFtQm9keV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOyB9LCBvZmZzZXQsIHJlcy5jb250ZW50TGVuZ3RoLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heFJldHJ5UmVxdWVzdHM6IG9wdGlvbnMubWF4UmV0cnlSZXF1ZXN0cywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3M6IG9wdGlvbnMucHJvZ3Jlc3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KV07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJucyBhbGwgdXNlci1kZWZpbmVkIG1ldGFkYXRhLCBzdGFuZGFyZCBIVFRQIHByb3BlcnRpZXMsIGFuZCBzeXN0ZW0gcHJvcGVydGllcwogICAgICAgICAqIGZvciB0aGUgYmxvYi4gSXQgZG9lcyBub3QgcmV0dXJuIHRoZSBjb250ZW50IG9mIHRoZSBibG9iLgogICAgICAgICAqIEBzZWUgaHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvcmVzdC9hcGkvc3RvcmFnZXNlcnZpY2VzL2dldC1ibG9iLXByb3BlcnRpZXMKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7QWJvcnRlcn0gYWJvcnRlciBDcmVhdGUgYSBuZXcgQWJvcnRlciBpbnN0YW5jZSB3aXRoIEFib3J0ZXIubm9uZSBvciBBYm9ydGVyLnRpbWVvdXQoKSwKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgZ290byBkb2N1bWVudHMgb2YgQWJvcnRlciBmb3IgbW9yZSBleGFtcGxlcyBhYm91dCByZXF1ZXN0IGNhbmNlbGxhdGlvbgogICAgICAgICAqIEBwYXJhbSB7SUJsb2JHZXRQcm9wZXJ0aWVzT3B0aW9uc30gW29wdGlvbnNdCiAgICAgICAgICogQHJldHVybnMge1Byb21pc2U8TW9kZWxzLkJsb2JHZXRQcm9wZXJ0aWVzUmVzcG9uc2U+fQogICAgICAgICAqIEBtZW1iZXJvZiBCbG9iVVJMCiAgICAgICAgICovCiAgICAgICAgQmxvYlVSTC5wcm90b3R5cGUuZ2V0UHJvcGVydGllcyA9IGZ1bmN0aW9uIChhYm9ydGVyLCBvcHRpb25zKSB7CiAgICAgICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsgb3B0aW9ucyA9IHt9OyB9CiAgICAgICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHsKICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmJsb2JBY2Nlc3NDb25kaXRpb25zID0gb3B0aW9ucy5ibG9iQWNjZXNzQ29uZGl0aW9ucyB8fCB7fTsKICAgICAgICAgICAgICAgICAgICBlbnN1cmVDcGtJZlNwZWNpZmllZChvcHRpb25zLmN1c3RvbWVyUHJvdmlkZWRLZXksIHRoaXMuaXNIdHRwcyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHRoaXMuYmxvYkNvbnRleHQuZ2V0UHJvcGVydGllcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYm9ydFNpZ25hbDogYWJvcnRlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlYXNlQWNjZXNzQ29uZGl0aW9uczogb3B0aW9ucy5ibG9iQWNjZXNzQ29uZGl0aW9ucy5sZWFzZUFjY2Vzc0NvbmRpdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RpZmllZEFjY2Vzc0NvbmRpdGlvbnM6IG9wdGlvbnMuYmxvYkFjY2Vzc0NvbmRpdGlvbnMubW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3BrSW5mbzogb3B0aW9ucy5jdXN0b21lclByb3ZpZGVkS2V5CiAgICAgICAgICAgICAgICAgICAgICAgIH0pXTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICAgIC8qKgogICAgICAgICAqIE1hcmtzIHRoZSBzcGVjaWZpZWQgYmxvYiBvciBzbmFwc2hvdCBmb3IgZGVsZXRpb24uIFRoZSBibG9iIGlzIGxhdGVyIGRlbGV0ZWQKICAgICAgICAgKiBkdXJpbmcgZ2FyYmFnZSBjb2xsZWN0aW9uLiBOb3RlIHRoYXQgaW4gb3JkZXIgdG8gZGVsZXRlIGEgYmxvYiwgeW91IG11c3QgZGVsZXRlCiAgICAgICAgICogYWxsIG9mIGl0cyBzbmFwc2hvdHMuIFlvdSBjYW4gZGVsZXRlIGJvdGggYXQgdGhlIHNhbWUgdGltZSB3aXRoIHRoZSBEZWxldGUKICAgICAgICAgKiBCbG9iIG9wZXJhdGlvbi4KICAgICAgICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5taWNyb3NvZnQuY29tL2VuLXVzL3Jlc3QvYXBpL3N0b3JhZ2VzZXJ2aWNlcy9kZWxldGUtYmxvYgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtBYm9ydGVyfSBhYm9ydGVyIENyZWF0ZSBhIG5ldyBBYm9ydGVyIGluc3RhbmNlIHdpdGggQWJvcnRlci5ub25lIG9yIEFib3J0ZXIudGltZW91dCgpLAogICAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICBnb3RvIGRvY3VtZW50cyBvZiBBYm9ydGVyIGZvciBtb3JlIGV4YW1wbGVzIGFib3V0IHJlcXVlc3QgY2FuY2VsbGF0aW9uCiAgICAgICAgICogQHBhcmFtIHtJQmxvYkRlbGV0ZU9wdGlvbnN9IFtvcHRpb25zXQogICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlPE1vZGVscy5CbG9iRGVsZXRlUmVzcG9uc2U+fQogICAgICAgICAqIEBtZW1iZXJvZiBCbG9iVVJMCiAgICAgICAgICovCiAgICAgICAgQmxvYlVSTC5wcm90b3R5cGUuZGVsZXRlID0gZnVuY3Rpb24gKGFib3J0ZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgeyBvcHRpb25zID0ge307IH0KICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkgewogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYmxvYkFjY2Vzc0NvbmRpdGlvbnMgPSBvcHRpb25zLmJsb2JBY2Nlc3NDb25kaXRpb25zIHx8IHt9OwogICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCB0aGlzLmJsb2JDb250ZXh0LmRlbGV0ZU1ldGhvZCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYm9ydFNpZ25hbDogYWJvcnRlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZVNuYXBzaG90czogb3B0aW9ucy5kZWxldGVTbmFwc2hvdHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWFzZUFjY2Vzc0NvbmRpdGlvbnM6IG9wdGlvbnMuYmxvYkFjY2Vzc0NvbmRpdGlvbnMubGVhc2VBY2Nlc3NDb25kaXRpb25zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zOiBvcHRpb25zLmJsb2JBY2Nlc3NDb25kaXRpb25zLm1vZGlmaWVkQWNjZXNzQ29uZGl0aW9ucwogICAgICAgICAgICAgICAgICAgICAgICB9KV07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBSZXN0b3JlcyB0aGUgY29udGVudHMgYW5kIG1ldGFkYXRhIG9mIHNvZnQgZGVsZXRlZCBibG9iIGFuZCBhbnkgYXNzb2NpYXRlZAogICAgICAgICAqIHNvZnQgZGVsZXRlZCBzbmFwc2hvdHMuIFVuZGVsZXRlIEJsb2IgaXMgc3VwcG9ydGVkIG9ubHkgb24gdmVyc2lvbiAyMDE3LTA3LTI5CiAgICAgICAgICogb3IgbGF0ZXIuCiAgICAgICAgICogQHNlZSBodHRwczovL2RvY3MubWljcm9zb2Z0LmNvbS9lbi11cy9yZXN0L2FwaS9zdG9yYWdlc2VydmljZXMvdW5kZWxldGUtYmxvYgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtBYm9ydGVyfSBhYm9ydGVyIENyZWF0ZSBhIG5ldyBBYm9ydGVyIGluc3RhbmNlIHdpdGggQWJvcnRlci5ub25lIG9yIEFib3J0ZXIudGltZW91dCgpLAogICAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICBnb3RvIGRvY3VtZW50cyBvZiBBYm9ydGVyIGZvciBtb3JlIGV4YW1wbGVzIGFib3V0IHJlcXVlc3QgY2FuY2VsbGF0aW9uCiAgICAgICAgICogQHJldHVybnMge1Byb21pc2U8TW9kZWxzLkJsb2JVbmRlbGV0ZVJlc3BvbnNlPn0KICAgICAgICAgKiBAbWVtYmVyb2YgQmxvYlVSTAogICAgICAgICAqLwogICAgICAgIEJsb2JVUkwucHJvdG90eXBlLnVuZGVsZXRlID0gZnVuY3Rpb24gKGFib3J0ZXIpIHsKICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCB0aGlzLmJsb2JDb250ZXh0LnVuZGVsZXRlKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFib3J0U2lnbmFsOiBhYm9ydGVyCiAgICAgICAgICAgICAgICAgICAgICAgIH0pXTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICAgIC8qKgogICAgICAgICAqIFNldHMgc3lzdGVtIHByb3BlcnRpZXMgb24gdGhlIGJsb2IuCiAgICAgICAgICoKICAgICAgICAgKiBJZiBubyB2YWx1ZSBwcm92aWRlZCwgb3Igbm8gdmFsdWUgcHJvdmlkZWQgZm9yIHRoZSBzcGVjaWZpY2VkIGJsb2IgSFRUUCBoZWFkZXJzLAogICAgICAgICAqIHRoZXNlIGJsb2IgSFRUUCBoZWFkZXJzIHdpdGhvdXQgYSB2YWx1ZSB3aWxsIGJlIGNsZWFyZWQuCiAgICAgICAgICogQHNlZSBodHRwczovL2RvY3MubWljcm9zb2Z0LmNvbS9lbi11cy9yZXN0L2FwaS9zdG9yYWdlc2VydmljZXMvc2V0LWJsb2ItcHJvcGVydGllcwogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtBYm9ydGVyfSBhYm9ydGVyIENyZWF0ZSBhIG5ldyBBYm9ydGVyIGluc3RhbmNlIHdpdGggQWJvcnRlci5ub25lIG9yIEFib3J0ZXIudGltZW91dCgpLAogICAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICBnb3RvIGRvY3VtZW50cyBvZiBBYm9ydGVyIGZvciBtb3JlIGV4YW1wbGVzIGFib3V0IHJlcXVlc3QgY2FuY2VsbGF0aW9uCiAgICAgICAgICogQHBhcmFtIHtNb2RlbHMuQmxvYkhUVFBIZWFkZXJzfSBbYmxvYkhUVFBIZWFkZXJzXSBJZiBubyB2YWx1ZSBwcm92aWRlZCwgb3Igbm8gdmFsdWUgcHJvdmlkZWQgZm9yCiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGUgc3BlY2lmaWNlZCBibG9iIEhUVFAgaGVhZGVycywgdGhlc2UgYmxvYiBIVFRQCiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzIHdpdGhvdXQgYSB2YWx1ZSB3aWxsIGJlIGNsZWFyZWQuCiAgICAgICAgICogQHBhcmFtIHtJQmxvYlNldEhUVFBIZWFkZXJzT3B0aW9uc30gW29wdGlvbnNdCiAgICAgICAgICogQHJldHVybnMge1Byb21pc2U8TW9kZWxzLkJsb2JTZXRIVFRQSGVhZGVyc1Jlc3BvbnNlPn0KICAgICAgICAgKiBAbWVtYmVyb2YgQmxvYlVSTAogICAgICAgICAqLwogICAgICAgIEJsb2JVUkwucHJvdG90eXBlLnNldEhUVFBIZWFkZXJzID0gZnVuY3Rpb24gKGFib3J0ZXIsIGJsb2JIVFRQSGVhZGVycywgb3B0aW9ucykgewogICAgICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7IG9wdGlvbnMgPSB7fTsgfQogICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7CiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5ibG9iQWNjZXNzQ29uZGl0aW9ucyA9IG9wdGlvbnMuYmxvYkFjY2Vzc0NvbmRpdGlvbnMgfHwge307CiAgICAgICAgICAgICAgICAgICAgZW5zdXJlQ3BrSWZTcGVjaWZpZWQob3B0aW9ucy5jdXN0b21lclByb3ZpZGVkS2V5LCB0aGlzLmlzSHR0cHMpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCB0aGlzLmJsb2JDb250ZXh0LnNldEhUVFBIZWFkZXJzKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFib3J0U2lnbmFsOiBhYm9ydGVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxvYkhUVFBIZWFkZXJzOiBibG9iSFRUUEhlYWRlcnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWFzZUFjY2Vzc0NvbmRpdGlvbnM6IG9wdGlvbnMuYmxvYkFjY2Vzc0NvbmRpdGlvbnMubGVhc2VBY2Nlc3NDb25kaXRpb25zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zOiBvcHRpb25zLmJsb2JBY2Nlc3NDb25kaXRpb25zLm1vZGlmaWVkQWNjZXNzQ29uZGl0aW9ucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNwa0luZm86IG9wdGlvbnMuY3VzdG9tZXJQcm92aWRlZEtleQogICAgICAgICAgICAgICAgICAgICAgICB9KV07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBTZXRzIHVzZXItZGVmaW5lZCBtZXRhZGF0YSBmb3IgdGhlIHNwZWNpZmllZCBibG9iIGFzIG9uZSBvciBtb3JlIG5hbWUtdmFsdWUgcGFpcnMuCiAgICAgICAgICoKICAgICAgICAgKiBJZiBubyBvcHRpb24gcHJvdmlkZWQsIG9yIG5vIG1ldGFkYXRhIGRlZmluZWQgaW4gdGhlIHBhcmFtZXRlciwgdGhlIGJsb2IKICAgICAgICAgKiBtZXRhZGF0YSB3aWxsIGJlIHJlbW92ZWQuCiAgICAgICAgICogQHNlZSBodHRwczovL2RvY3MubWljcm9zb2Z0LmNvbS9lbi11cy9yZXN0L2FwaS9zdG9yYWdlc2VydmljZXMvc2V0LWJsb2ItbWV0YWRhdGEKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7QWJvcnRlcn0gYWJvcnRlciBDcmVhdGUgYSBuZXcgQWJvcnRlciBpbnN0YW5jZSB3aXRoIEFib3J0ZXIubm9uZSBvciBBYm9ydGVyLnRpbWVvdXQoKSwKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgZ290byBkb2N1bWVudHMgb2YgQWJvcnRlciBmb3IgbW9yZSBleGFtcGxlcyBhYm91dCByZXF1ZXN0IGNhbmNlbGxhdGlvbgogICAgICAgICAqIEBwYXJhbSB7SU1ldGFkYXRhfSBbbWV0YWRhdGFdIFJlcGxhY2UgZXhpc3RpbmcgbWV0YWRhdGEgd2l0aCB0aGlzIHZhbHVlLgogICAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElmIG5vIHZhbHVlIHByb3ZpZGVkIHRoZSBleGlzdGluZyBtZXRhZGF0YSB3aWxsIGJlIHJlbW92ZWQuCiAgICAgICAgICogQHBhcmFtIHtJQmxvYlNldE1ldGFkYXRhT3B0aW9uc30gW29wdGlvbnNdCiAgICAgICAgICogQHJldHVybnMge1Byb21pc2U8TW9kZWxzLkJsb2JTZXRNZXRhZGF0YVJlc3BvbnNlPn0KICAgICAgICAgKiBAbWVtYmVyb2YgQmxvYlVSTAogICAgICAgICAqLwogICAgICAgIEJsb2JVUkwucHJvdG90eXBlLnNldE1ldGFkYXRhID0gZnVuY3Rpb24gKGFib3J0ZXIsIG1ldGFkYXRhLCBvcHRpb25zKSB7CiAgICAgICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsgb3B0aW9ucyA9IHt9OyB9CiAgICAgICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHsKICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmJsb2JBY2Nlc3NDb25kaXRpb25zID0gb3B0aW9ucy5ibG9iQWNjZXNzQ29uZGl0aW9ucyB8fCB7fTsKICAgICAgICAgICAgICAgICAgICBlbnN1cmVDcGtJZlNwZWNpZmllZChvcHRpb25zLmN1c3RvbWVyUHJvdmlkZWRLZXksIHRoaXMuaXNIdHRwcyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHRoaXMuYmxvYkNvbnRleHQuc2V0TWV0YWRhdGEoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWJvcnRTaWduYWw6IGFib3J0ZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWFzZUFjY2Vzc0NvbmRpdGlvbnM6IG9wdGlvbnMuYmxvYkFjY2Vzc0NvbmRpdGlvbnMubGVhc2VBY2Nlc3NDb25kaXRpb25zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGE6IG1ldGFkYXRhLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zOiBvcHRpb25zLmJsb2JBY2Nlc3NDb25kaXRpb25zLm1vZGlmaWVkQWNjZXNzQ29uZGl0aW9ucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNwa0luZm86IG9wdGlvbnMuY3VzdG9tZXJQcm92aWRlZEtleQogICAgICAgICAgICAgICAgICAgICAgICB9KV07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBFc3RhYmxpc2hlcyBhbmQgbWFuYWdlcyBhIGxvY2sgb24gYSBibG9iIGZvciB3cml0ZSBhbmQgZGVsZXRlIG9wZXJhdGlvbnMuCiAgICAgICAgICogVGhlIGxvY2sgZHVyYXRpb24gY2FuIGJlIDE1IHRvIDYwIHNlY29uZHMsIG9yIGNhbiBiZSBpbmZpbml0ZS4KICAgICAgICAgKiBJbiB2ZXJzaW9ucyBwcmlvciB0byAyMDEyLTAyLTEyLCB0aGUgbG9jayBkdXJhdGlvbiBpcyA2MCBzZWNvbmRzLgogICAgICAgICAqIEBzZWUgaHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvcmVzdC9hcGkvc3RvcmFnZXNlcnZpY2VzL2xlYXNlLWJsb2IKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7QWJvcnRlcn0gYWJvcnRlciBDcmVhdGUgYSBuZXcgQWJvcnRlciBpbnN0YW5jZSB3aXRoIEFib3J0ZXIubm9uZSBvciBBYm9ydGVyLnRpbWVvdXQoKSwKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgZ290byBkb2N1bWVudHMgb2YgQWJvcnRlciBmb3IgbW9yZSBleGFtcGxlcyBhYm91dCByZXF1ZXN0IGNhbmNlbGxhdGlvbgogICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBwcm9wb3NlZExlYXNlSWQgQ2FuIGJlIHNwZWNpZmllZCBpbiBhbnkgdmFsaWQgR1VJRCBzdHJpbmcgZm9ybWF0CiAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IGR1cmF0aW9uwqBUaGUgbG9jayBkdXJhdGlvbiBjYW4gYmUgMTUgdG8gNjAgc2Vjb25kcywgb3IgY2FuIGJlIGluZmluaXRlCiAgICAgICAgICogQHBhcmFtIHtJQmxvYkFjcXVpcmVMZWFzZU9wdGlvbnN9IFtvcHRpb25zXQogICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlPE1vZGVscy5CbG9iQWNxdWlyZUxlYXNlUmVzcG9uc2U+fQogICAgICAgICAqIEBtZW1iZXJvZiBCbG9iVVJMCiAgICAgICAgICovCiAgICAgICAgQmxvYlVSTC5wcm90b3R5cGUuYWNxdWlyZUxlYXNlID0gZnVuY3Rpb24gKGFib3J0ZXIsIHByb3Bvc2VkTGVhc2VJZCwgZHVyYXRpb24sIG9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgeyBvcHRpb25zID0ge307IH0KICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCB0aGlzLmJsb2JDb250ZXh0LmFjcXVpcmVMZWFzZSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYm9ydFNpZ25hbDogYWJvcnRlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBkdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGlmaWVkQWNjZXNzQ29uZGl0aW9uczogb3B0aW9ucy5tb2RpZmllZEFjY2Vzc0NvbmRpdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wb3NlZExlYXNlSWQ6IHByb3Bvc2VkTGVhc2VJZAogICAgICAgICAgICAgICAgICAgICAgICB9KV07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBUbyBmcmVlIHRoZSBsZWFzZSBpZiBpdCBpcyBubyBsb25nZXIgbmVlZGVkIHNvIHRoYXQgYW5vdGhlciBjbGllbnQgbWF5IGltbWVkaWF0ZWx5CiAgICAgICAgICogYWNxdWlyZSBhIGxlYXNlIGFnYWluc3QgdGhlIGJsb2IuCiAgICAgICAgICogQHNlZSBodHRwczovL2RvY3MubWljcm9zb2Z0LmNvbS9lbi11cy9yZXN0L2FwaS9zdG9yYWdlc2VydmljZXMvbGVhc2UtYmxvYgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtBYm9ydGVyfSBhYm9ydGVyIENyZWF0ZSBhIG5ldyBBYm9ydGVyIGluc3RhbmNlIHdpdGggQWJvcnRlci5ub25lIG9yIEFib3J0ZXIudGltZW91dCgpLAogICAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICBnb3RvIGRvY3VtZW50cyBvZiBBYm9ydGVyIGZvciBtb3JlIGV4YW1wbGVzIGFib3V0IHJlcXVlc3QgY2FuY2VsbGF0aW9uCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IGxlYXNlSWQKICAgICAgICAgKiBAcGFyYW0ge0lCbG9iUmVsZWFzZUxlYXNlT3B0aW9uc30gW29wdGlvbnNdCiAgICAgICAgICogQHJldHVybnMge1Byb21pc2U8TW9kZWxzLkJsb2JSZWxlYXNlTGVhc2VSZXNwb25zZT59CiAgICAgICAgICogQG1lbWJlcm9mIEJsb2JVUkwKICAgICAgICAgKi8KICAgICAgICBCbG9iVVJMLnByb3RvdHlwZS5yZWxlYXNlTGVhc2UgPSBmdW5jdGlvbiAoYWJvcnRlciwgbGVhc2VJZCwgb3B0aW9ucykgewogICAgICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7IG9wdGlvbnMgPSB7fTsgfQogICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHRoaXMuYmxvYkNvbnRleHQucmVsZWFzZUxlYXNlKGxlYXNlSWQsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFib3J0U2lnbmFsOiBhYm9ydGVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zOiBvcHRpb25zLm1vZGlmaWVkQWNjZXNzQ29uZGl0aW9ucwogICAgICAgICAgICAgICAgICAgICAgICB9KV07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBUbyByZW5ldyBhbiBleGlzdGluZyBsZWFzZS4KICAgICAgICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5taWNyb3NvZnQuY29tL2VuLXVzL3Jlc3QvYXBpL3N0b3JhZ2VzZXJ2aWNlcy9sZWFzZS1ibG9iCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge0Fib3J0ZXJ9IGFib3J0ZXIgQ3JlYXRlIGEgbmV3IEFib3J0ZXIgaW5zdGFuY2Ugd2l0aCBBYm9ydGVyLm5vbmUgb3IgQWJvcnRlci50aW1lb3V0KCksCiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgIGdvdG8gZG9jdW1lbnRzIG9mIEFib3J0ZXIgZm9yIG1vcmUgZXhhbXBsZXMgYWJvdXQgcmVxdWVzdCBjYW5jZWxsYXRpb24KICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gbGVhc2VJZAogICAgICAgICAqIEBwYXJhbSB7SUJsb2JSZW5ld0xlYXNlT3B0aW9uc30gW29wdGlvbnNdCiAgICAgICAgICogQHJldHVybnMge1Byb21pc2U8TW9kZWxzLkJsb2JSZW5ld0xlYXNlUmVzcG9uc2U+fQogICAgICAgICAqIEBtZW1iZXJvZiBCbG9iVVJMCiAgICAgICAgICovCiAgICAgICAgQmxvYlVSTC5wcm90b3R5cGUucmVuZXdMZWFzZSA9IGZ1bmN0aW9uIChhYm9ydGVyLCBsZWFzZUlkLCBvcHRpb25zKSB7CiAgICAgICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsgb3B0aW9ucyA9IHt9OyB9CiAgICAgICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgdGhpcy5ibG9iQ29udGV4dC5yZW5ld0xlYXNlKGxlYXNlSWQsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFib3J0U2lnbmFsOiBhYm9ydGVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zOiBvcHRpb25zLm1vZGlmaWVkQWNjZXNzQ29uZGl0aW9ucwogICAgICAgICAgICAgICAgICAgICAgICB9KV07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBUbyBjaGFuZ2UgdGhlIElEIG9mIGFuIGV4aXN0aW5nIGxlYXNlLgogICAgICAgICAqIEBzZWUgaHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvcmVzdC9hcGkvc3RvcmFnZXNlcnZpY2VzL2xlYXNlLWJsb2IKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7QWJvcnRlcn0gYWJvcnRlciBDcmVhdGUgYSBuZXcgQWJvcnRlciBpbnN0YW5jZSB3aXRoIEFib3J0ZXIubm9uZSBvciBBYm9ydGVyLnRpbWVvdXQoKSwKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgZ290byBkb2N1bWVudHMgb2YgQWJvcnRlciBmb3IgbW9yZSBleGFtcGxlcyBhYm91dCByZXF1ZXN0IGNhbmNlbGxhdGlvbgogICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBsZWFzZUlkCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHByb3Bvc2VkTGVhc2VJZAogICAgICAgICAqIEBwYXJhbSB7SUJsb2JDaGFuZ2VMZWFzZU9wdGlvbnN9IFtvcHRpb25zXQogICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlPE1vZGVscy5CbG9iQ2hhbmdlTGVhc2VSZXNwb25zZT59CiAgICAgICAgICogQG1lbWJlcm9mIEJsb2JVUkwKICAgICAgICAgKi8KICAgICAgICBCbG9iVVJMLnByb3RvdHlwZS5jaGFuZ2VMZWFzZSA9IGZ1bmN0aW9uIChhYm9ydGVyLCBsZWFzZUlkLCBwcm9wb3NlZExlYXNlSWQsIG9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgeyBvcHRpb25zID0ge307IH0KICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCB0aGlzLmJsb2JDb250ZXh0LmNoYW5nZUxlYXNlKGxlYXNlSWQsIHByb3Bvc2VkTGVhc2VJZCwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWJvcnRTaWduYWw6IGFib3J0ZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RpZmllZEFjY2Vzc0NvbmRpdGlvbnM6IG9wdGlvbnMubW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zCiAgICAgICAgICAgICAgICAgICAgICAgIH0pXTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICAgIC8qKgogICAgICAgICAqIFRvIGVuZCB0aGUgbGVhc2UgYnV0IGVuc3VyZSB0aGF0IGFub3RoZXIgY2xpZW50IGNhbm5vdCBhY3F1aXJlIGEgbmV3IGxlYXNlCiAgICAgICAgICogdW50aWwgdGhlIGN1cnJlbnQgbGVhc2UgcGVyaW9kIGhhcyBleHBpcmVkLgogICAgICAgICAqIEBzZWUgaHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvcmVzdC9hcGkvc3RvcmFnZXNlcnZpY2VzL2xlYXNlLWJsb2IKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7QWJvcnRlcn0gYWJvcnRlciBDcmVhdGUgYSBuZXcgQWJvcnRlciBpbnN0YW5jZSB3aXRoIEFib3J0ZXIubm9uZSBvciBBYm9ydGVyLnRpbWVvdXQoKSwKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgZ290byBkb2N1bWVudHMgb2YgQWJvcnRlciBmb3IgbW9yZSBleGFtcGxlcyBhYm91dCByZXF1ZXN0IGNhbmNlbGxhdGlvbgogICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbYnJlYWtQZXJpb2RdCiAgICAgICAgICogQHBhcmFtIHtJQmxvYkJyZWFrTGVhc2VPcHRpb25zfSBbb3B0aW9uc10KICAgICAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxNb2RlbHMuQmxvYkJyZWFrTGVhc2VSZXNwb25zZT59CiAgICAgICAgICogQG1lbWJlcm9mIEJsb2JVUkwKICAgICAgICAgKi8KICAgICAgICBCbG9iVVJMLnByb3RvdHlwZS5icmVha0xlYXNlID0gZnVuY3Rpb24gKGFib3J0ZXIsIGJyZWFrUGVyaW9kLCBvcHRpb25zKSB7CiAgICAgICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsgb3B0aW9ucyA9IHt9OyB9CiAgICAgICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgdGhpcy5ibG9iQ29udGV4dC5icmVha0xlYXNlKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFib3J0U2lnbmFsOiBhYm9ydGVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWtQZXJpb2Q6IGJyZWFrUGVyaW9kLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zOiBvcHRpb25zLm1vZGlmaWVkQWNjZXNzQ29uZGl0aW9ucwogICAgICAgICAgICAgICAgICAgICAgICB9KV07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGVzIGEgcmVhZC1vbmx5IHNuYXBzaG90IG9mIGEgYmxvYi4KICAgICAgICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5taWNyb3NvZnQuY29tL2VuLXVzL3Jlc3QvYXBpL3N0b3JhZ2VzZXJ2aWNlcy9zbmFwc2hvdC1ibG9iCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge0Fib3J0ZXJ9IGFib3J0ZXIgQ3JlYXRlIGEgbmV3IEFib3J0ZXIgaW5zdGFuY2Ugd2l0aCBBYm9ydGVyLm5vbmUgb3IgQWJvcnRlci50aW1lb3V0KCksCiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgIGdvdG8gZG9jdW1lbnRzIG9mIEFib3J0ZXIgZm9yIG1vcmUgZXhhbXBsZXMgYWJvdXQgcmVxdWVzdCBjYW5jZWxsYXRpb24KICAgICAgICAgKiBAcGFyYW0ge0lCbG9iQ3JlYXRlU25hcHNob3RPcHRpb25zfSBbb3B0aW9uc10KICAgICAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxNb2RlbHMuQmxvYkNyZWF0ZVNuYXBzaG90UmVzcG9uc2U+fQogICAgICAgICAqIEBtZW1iZXJvZiBCbG9iVVJMCiAgICAgICAgICovCiAgICAgICAgQmxvYlVSTC5wcm90b3R5cGUuY3JlYXRlU25hcHNob3QgPSBmdW5jdGlvbiAoYWJvcnRlciwgb3B0aW9ucykgewogICAgICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7IG9wdGlvbnMgPSB7fTsgfQogICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7CiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5ibG9iQWNjZXNzQ29uZGl0aW9ucyA9IG9wdGlvbnMuYmxvYkFjY2Vzc0NvbmRpdGlvbnMgfHwge307CiAgICAgICAgICAgICAgICAgICAgZW5zdXJlQ3BrSWZTcGVjaWZpZWQob3B0aW9ucy5jdXN0b21lclByb3ZpZGVkS2V5LCB0aGlzLmlzSHR0cHMpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCB0aGlzLmJsb2JDb250ZXh0LmNyZWF0ZVNuYXBzaG90KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFib3J0U2lnbmFsOiBhYm9ydGVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVhc2VBY2Nlc3NDb25kaXRpb25zOiBvcHRpb25zLmJsb2JBY2Nlc3NDb25kaXRpb25zLmxlYXNlQWNjZXNzQ29uZGl0aW9ucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhOiBvcHRpb25zLm1ldGFkYXRhLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zOiBvcHRpb25zLmJsb2JBY2Nlc3NDb25kaXRpb25zLm1vZGlmaWVkQWNjZXNzQ29uZGl0aW9ucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNwa0luZm86IG9wdGlvbnMuY3VzdG9tZXJQcm92aWRlZEtleQogICAgICAgICAgICAgICAgICAgICAgICB9KV07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBBc3luY2hyb25vdXNseSBjb3BpZXMgYSBibG9iIHRvIGEgZGVzdGluYXRpb24gd2l0aGluIHRoZSBzdG9yYWdlIGFjY291bnQuCiAgICAgICAgICogSW4gdmVyc2lvbiAyMDEyLTAyLTEyIGFuZCBsYXRlciwgdGhlIHNvdXJjZSBmb3IgYSBDb3B5IEJsb2Igb3BlcmF0aW9uIGNhbiBiZQogICAgICAgICAqIGEgY29tbWl0dGVkIGJsb2IgaW4gYW55IEF6dXJlIHN0b3JhZ2UgYWNjb3VudC4KICAgICAgICAgKiBCZWdpbm5pbmcgd2l0aCB2ZXJzaW9uIDIwMTUtMDItMjEsIHRoZSBzb3VyY2UgZm9yIGEgQ29weSBCbG9iIG9wZXJhdGlvbiBjYW4gYmUKICAgICAgICAgKiBhbiBBenVyZSBmaWxlIGluIGFueSBBenVyZSBzdG9yYWdlIGFjY291bnQuCiAgICAgICAgICogT25seSBzdG9yYWdlIGFjY291bnRzIGNyZWF0ZWQgb24gb3IgYWZ0ZXIgSnVuZSA3dGgsIDIwMTIgYWxsb3cgdGhlIENvcHkgQmxvYgogICAgICAgICAqIG9wZXJhdGlvbiB0byBjb3B5IGZyb20gYW5vdGhlciBzdG9yYWdlIGFjY291bnQuCiAgICAgICAgICogQHNlZSBodHRwczovL2RvY3MubWljcm9zb2Z0LmNvbS9lbi11cy9yZXN0L2FwaS9zdG9yYWdlc2VydmljZXMvY29weS1ibG9iCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge0Fib3J0ZXJ9IGFib3J0ZXIgQ3JlYXRlIGEgbmV3IEFib3J0ZXIgaW5zdGFuY2Ugd2l0aCBBYm9ydGVyLm5vbmUgb3IgQWJvcnRlci50aW1lb3V0KCksCiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgIGdvdG8gZG9jdW1lbnRzIG9mIEFib3J0ZXIgZm9yIG1vcmUgZXhhbXBsZXMgYWJvdXQgcmVxdWVzdCBjYW5jZWxsYXRpb24KICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gY29weVNvdXJjZQogICAgICAgICAqIEBwYXJhbSB7SUJsb2JTdGFydENvcHlGcm9tVVJMT3B0aW9uc30gW29wdGlvbnNdCiAgICAgICAgICogQHJldHVybnMge1Byb21pc2U8TW9kZWxzLkJsb2JTdGFydENvcHlGcm9tVVJMUmVzcG9uc2U+fQogICAgICAgICAqIEBtZW1iZXJvZiBCbG9iVVJMCiAgICAgICAgICovCiAgICAgICAgQmxvYlVSTC5wcm90b3R5cGUuc3RhcnRDb3B5RnJvbVVSTCA9IGZ1bmN0aW9uIChhYm9ydGVyLCBjb3B5U291cmNlLCBvcHRpb25zKSB7CiAgICAgICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsgb3B0aW9ucyA9IHt9OyB9CiAgICAgICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHsKICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmJsb2JBY2Nlc3NDb25kaXRpb25zID0gb3B0aW9ucy5ibG9iQWNjZXNzQ29uZGl0aW9ucyB8fCB7fTsKICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnNvdXJjZU1vZGlmaWVkQWNjZXNzQ29uZGl0aW9ucyA9IG9wdGlvbnMuc291cmNlTW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zIHx8IHt9OwogICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCB0aGlzLmJsb2JDb250ZXh0LnN0YXJ0Q29weUZyb21VUkwoY29weVNvdXJjZSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWJvcnRTaWduYWw6IGFib3J0ZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWFzZUFjY2Vzc0NvbmRpdGlvbnM6IG9wdGlvbnMuYmxvYkFjY2Vzc0NvbmRpdGlvbnMubGVhc2VBY2Nlc3NDb25kaXRpb25zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGE6IG9wdGlvbnMubWV0YWRhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RpZmllZEFjY2Vzc0NvbmRpdGlvbnM6IG9wdGlvbnMuYmxvYkFjY2Vzc0NvbmRpdGlvbnMubW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlTW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlSWZNYXRjaDogb3B0aW9ucy5zb3VyY2VNb2RpZmllZEFjY2Vzc0NvbmRpdGlvbnMuaWZNYXRjaCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VJZk1vZGlmaWVkU2luY2U6IG9wdGlvbnMuc291cmNlTW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zLmlmTW9kaWZpZWRTaW5jZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VJZk5vbmVNYXRjaDogb3B0aW9ucy5zb3VyY2VNb2RpZmllZEFjY2Vzc0NvbmRpdGlvbnMuaWZOb25lTWF0Y2gsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlSWZVbm1vZGlmaWVkU2luY2U6IG9wdGlvbnMuc291cmNlTW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zLmlmVW5tb2RpZmllZFNpbmNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVoeWRyYXRlUHJpb3JpdHk6IG9wdGlvbnMucmVoeWRyYXRlUHJpb3JpdHksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aWVyOiB0b0FjY2Vzc1RpZXIob3B0aW9ucy50aWVyKQogICAgICAgICAgICAgICAgICAgICAgICB9KV07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBBYm9ydHMgYSBwZW5kaW5nIGFzeW5jaHJvbm91cyBDb3B5IEJsb2Igb3BlcmF0aW9uLCBhbmQgbGVhdmVzIGEgZGVzdGluYXRpb24gYmxvYiB3aXRoIHplcm8KICAgICAgICAgKiBsZW5ndGggYW5kIGZ1bGwgbWV0YWRhdGEuIFZlcnNpb24gMjAxMi0wMi0xMiBhbmQgbmV3ZXIuCiAgICAgICAgICogQHNlZSBodHRwczovL2RvY3MubWljcm9zb2Z0LmNvbS9lbi11cy9yZXN0L2FwaS9zdG9yYWdlc2VydmljZXMvYWJvcnQtY29weS1ibG9iCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge0Fib3J0ZXJ9IGFib3J0ZXIgQ3JlYXRlIGEgbmV3IEFib3J0ZXIgaW5zdGFuY2Ugd2l0aCBBYm9ydGVyLm5vbmUgb3IgQWJvcnRlci50aW1lb3V0KCksCiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgIGdvdG8gZG9jdW1lbnRzIG9mIEFib3J0ZXIgZm9yIG1vcmUgZXhhbXBsZXMgYWJvdXQgcmVxdWVzdCBjYW5jZWxsYXRpb24KICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gY29weUlkCiAgICAgICAgICogQHBhcmFtIHtJQmxvYkFib3J0Q29weUZyb21VUkxPcHRpb25zfSBbb3B0aW9uc10KICAgICAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxNb2RlbHMuQmxvYkFib3J0Q29weUZyb21VUkxSZXNwb25zZT59CiAgICAgICAgICogQG1lbWJlcm9mIEJsb2JVUkwKICAgICAgICAgKi8KICAgICAgICBCbG9iVVJMLnByb3RvdHlwZS5hYm9ydENvcHlGcm9tVVJMID0gZnVuY3Rpb24gKGFib3J0ZXIsIGNvcHlJZCwgb3B0aW9ucykgewogICAgICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7IG9wdGlvbnMgPSB7fTsgfQogICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHRoaXMuYmxvYkNvbnRleHQuYWJvcnRDb3B5RnJvbVVSTChjb3B5SWQsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFib3J0U2lnbmFsOiBhYm9ydGVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVhc2VBY2Nlc3NDb25kaXRpb25zOiBvcHRpb25zLmxlYXNlQWNjZXNzQ29uZGl0aW9ucwogICAgICAgICAgICAgICAgICAgICAgICB9KV07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBUaGUgc3luY2hyb25vdXMgQ29weSBGcm9tIFVSTCBvcGVyYXRpb24gY29waWVzIGEgYmxvYiBvciBhbiBpbnRlcm5ldCByZXNvdXJjZSB0byBhIG5ldyBibG9iLiBJdCB3aWxsIG5vdAogICAgICAgICAqIHJldHVybiBhIHJlc3BvbnNlIHVudGlsIHRoZSBjb3B5IGlzIGNvbXBsZXRlLgogICAgICAgICAqIEBzZWUgaHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvcmVzdC9hcGkvc3RvcmFnZXNlcnZpY2VzL2NvcHktYmxvYi1mcm9tLXVybAogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtBYm9ydGVyfSBhYm9ydGVyIENyZWF0ZSBhIG5ldyBBYm9ydGVyIGluc3RhbmNlIHdpdGggQWJvcnRlci5ub25lIG9yIEFib3J0ZXIudGltZW91dCgpLAogICAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICBnb3RvIGRvY3VtZW50cyBvZiBBYm9ydGVyIGZvciBtb3JlIGV4YW1wbGVzIGFib3V0IHJlcXVlc3QgY2FuY2VsbGF0aW9uCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IGNvcHlTb3VyY2UgVGhlIHNvdXJjZSBVUkwgdG8gY29weSBmcm9tLCBTaGFyZWQgQWNjZXNzIFNpZ25hdHVyZShTQVMpIG1heWJlIG5lZWRlZCBmb3IgYXV0aGVudGljYXRpb24KICAgICAgICAgKiBAcGFyYW0ge0lCbG9iU3luY0NvcHlGcm9tVVJMT3B0aW9uc30gW29wdGlvbnM9e31dCiAgICAgICAgICogQHJldHVybnMge1Byb21pc2U8TW9kZWxzLkJsb2JDb3B5RnJvbVVSTFJlc3BvbnNlPn0KICAgICAgICAgKiBAbWVtYmVyb2YgQmxvYlVSTAogICAgICAgICAqLwogICAgICAgIEJsb2JVUkwucHJvdG90eXBlLnN5bmNDb3B5RnJvbVVSTCA9IGZ1bmN0aW9uIChhYm9ydGVyLCBjb3B5U291cmNlLCBvcHRpb25zKSB7CiAgICAgICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsgb3B0aW9ucyA9IHt9OyB9CiAgICAgICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHsKICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmJsb2JBY2Nlc3NDb25kaXRpb25zID0gb3B0aW9ucy5ibG9iQWNjZXNzQ29uZGl0aW9ucyB8fCB7fTsKICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnNvdXJjZU1vZGlmaWVkQWNjZXNzQ29uZGl0aW9ucyA9IG9wdGlvbnMuc291cmNlTW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zIHx8IHt9OwogICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCB0aGlzLmJsb2JDb250ZXh0LmNvcHlGcm9tVVJMKGNvcHlTb3VyY2UsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFib3J0U2lnbmFsOiBhYm9ydGVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGE6IG9wdGlvbnMubWV0YWRhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWFzZUFjY2Vzc0NvbmRpdGlvbnM6IG9wdGlvbnMuYmxvYkFjY2Vzc0NvbmRpdGlvbnMubGVhc2VBY2Nlc3NDb25kaXRpb25zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zOiBvcHRpb25zLmJsb2JBY2Nlc3NDb25kaXRpb25zLm1vZGlmaWVkQWNjZXNzQ29uZGl0aW9ucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZU1vZGlmaWVkQWNjZXNzQ29uZGl0aW9uczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZUlmTWF0Y2g6IG9wdGlvbnMuc291cmNlTW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zLmlmTWF0Y2gsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlSWZNb2RpZmllZFNpbmNlOiBvcHRpb25zLnNvdXJjZU1vZGlmaWVkQWNjZXNzQ29uZGl0aW9ucy5pZk1vZGlmaWVkU2luY2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlSWZOb25lTWF0Y2g6IG9wdGlvbnMuc291cmNlTW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zLmlmTm9uZU1hdGNoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZUlmVW5tb2RpZmllZFNpbmNlOiBvcHRpb25zLnNvdXJjZU1vZGlmaWVkQWNjZXNzQ29uZGl0aW9ucy5pZlVubW9kaWZpZWRTaW5jZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KV07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBTZXRzIHRoZSB0aWVyIG9uIGEgYmxvYi4gVGhlIG9wZXJhdGlvbiBpcyBhbGxvd2VkIG9uIGEgcGFnZSBibG9iIGluIGEgcHJlbWl1bQogICAgICAgICAqIHN0b3JhZ2UgYWNjb3VudCBhbmQgb24gYSBibG9jayBibG9iIGluIGEgYmxvYiBzdG9yYWdlIGFjY291bnQgKGxvY2FsbHkgcmVkdW5kYW50CiAgICAgICAgICogc3RvcmFnZSBvbmx5KS4gQSBwcmVtaXVtIHBhZ2UgYmxvYidzIHRpZXIgZGV0ZXJtaW5lcyB0aGUgYWxsb3dlZCBzaXplLCBJT1BTLAogICAgICAgICAqIGFuZCBiYW5kd2lkdGggb2YgdGhlIGJsb2IuIEEgYmxvY2sgYmxvYidzIHRpZXIgZGV0ZXJtaW5lcyBIb3QvQ29vbC9BcmNoaXZlCiAgICAgICAgICogc3RvcmFnZSB0eXBlLiBUaGlzIG9wZXJhdGlvbiBkb2VzIG5vdCB1cGRhdGUgdGhlIGJsb2IncyBFVGFnLgogICAgICAgICAqIEBzZWUgaHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvcmVzdC9hcGkvc3RvcmFnZXNlcnZpY2VzL3NldC1ibG9iLXRpZXIKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7QWJvcnRlcn0gYWJvcnRlciBDcmVhdGUgYSBuZXcgQWJvcnRlciBpbnN0YW5jZSB3aXRoIEFib3J0ZXIubm9uZSBvciBBYm9ydGVyLnRpbWVvdXQoKSwKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgZ290byBkb2N1bWVudHMgb2YgQWJvcnRlciBmb3IgbW9yZSBleGFtcGxlcyBhYm91dCByZXF1ZXN0IGNhbmNlbGxhdGlvbgogICAgICAgICAqIEBwYXJhbSB7QmxvY2tCbG9iVGllciB8IFByZW1pdW1QYWdlQmxvYlRpZXIgfCBzdHJpbmd9IHRpZXIKICAgICAgICAgKiBAcGFyYW0ge0lCbG9iU2V0VGllck9wdGlvbnN9IFtvcHRpb25zXQogICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlPE1vZGVscy5CbG9ic1NldFRpZXJSZXNwb25zZT59CiAgICAgICAgICogQG1lbWJlcm9mIEJsb2JVUkwKICAgICAgICAgKi8KICAgICAgICBCbG9iVVJMLnByb3RvdHlwZS5zZXRUaWVyID0gZnVuY3Rpb24gKGFib3J0ZXIsIHRpZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgeyBvcHRpb25zID0ge307IH0KICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOiByZXR1cm4gWzQgLyp5aWVsZCovLCB0aGlzLmJsb2JDb250ZXh0LnNldFRpZXIodG9BY2Nlc3NUaWVyKHRpZXIpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWJvcnRTaWduYWw6IGFib3J0ZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVhc2VBY2Nlc3NDb25kaXRpb25zOiBvcHRpb25zLmxlYXNlQWNjZXNzQ29uZGl0aW9ucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWh5ZHJhdGVQcmlvcml0eTogb3B0aW9ucy5yZWh5ZHJhdGVQcmlvcml0eQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSldOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE6IHJldHVybiBbMiAvKnJldHVybiovLCBfYS5zZW50KCldOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICAgIHJldHVybiBCbG9iVVJMOwogICAgfShTdG9yYWdlVVJMKSk7CgogICAgLyoqCiAgICAgKiBBcHBlbmRCbG9iVVJMIGRlZmluZXMgYSBzZXQgb2Ygb3BlcmF0aW9ucyBhcHBsaWNhYmxlIHRvIGFwcGVuZCBibG9icy4KICAgICAqCiAgICAgKiBAZXhwb3J0CiAgICAgKiBAY2xhc3MgQXBwZW5kQmxvYlVSTAogICAgICogQGV4dGVuZHMge1N0b3JhZ2VVUkx9CiAgICAgKi8KICAgIHZhciBBcHBlbmRCbG9iVVJMID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewogICAgICAgIF9fZXh0ZW5kcyhBcHBlbmRCbG9iVVJMLCBfc3VwZXIpOwogICAgICAgIC8qKgogICAgICAgICAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgQXBwZW5kQmxvYlVSTC4KICAgICAgICAgKiBUaGlzIG1ldGhvZCBhY2NlcHRzIGFuIGVuY29kZWQgVVJMIG9yIG5vbi1lbmNvZGVkIFVSTCBwb2ludGluZyB0byBhbiBhcHBlbmQgYmxvYi4KICAgICAgICAgKiBFbmNvZGVkIFVSTCBzdHJpbmcgd2lsbCBOT1QgYmUgZXNjYXBlZCB0d2ljZSwgb25seSBzcGVjaWFsIGNoYXJhY3RlcnMgaW4gVVJMIHBhdGggd2lsbCBiZSBlc2NhcGVkLgogICAgICAgICAqIElmIGEgYmxvYiBuYW1lIGluY2x1ZGVzID8gb3IgJSwgYmxvYiBuYW1lIG11c3QgYmUgZW5jb2RlZCBpbiB0aGUgVVJMLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHVybCBBIFVSTCBzdHJpbmcgcG9pbnRpbmcgdG8gQXp1cmUgU3RvcmFnZSBhcHBlbmQgYmxvYiwgc3VjaCBhcwogICAgICAgICAqICAgICAgICAgICAgICAgICAgICAgImh0dHBzOi8vbXlhY2NvdW50LmJsb2IuY29yZS53aW5kb3dzLm5ldC9teWNvbnRhaW5lci9hcHBlbmRibG9iIi4gWW91IGNhbgogICAgICAgICAqICAgICAgICAgICAgICAgICAgICAgYXBwZW5kIGEgU0FTIGlmIHVzaW5nIEFub255bW91c0NyZWRlbnRpYWwsIHN1Y2ggYXMKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICJodHRwczovL215YWNjb3VudC5ibG9iLmNvcmUud2luZG93cy5uZXQvbXljb250YWluZXIvYXBwZW5kYmxvYj9zYXNTdHJpbmciLgogICAgICAgICAqICAgICAgICAgICAgICAgICAgICAgVGhpcyBtZXRob2QgYWNjZXB0cyBhbiBlbmNvZGVkIFVSTCBvciBub24tZW5jb2RlZCBVUkwgcG9pbnRpbmcgdG8gYSBibG9iLgogICAgICAgICAqICAgICAgICAgICAgICAgICAgICAgRW5jb2RlZCBVUkwgc3RyaW5nIHdpbGwgTk9UIGJlIGVzY2FwZWQgdHdpY2UsIG9ubHkgc3BlY2lhbCBjaGFyYWN0ZXJzIGluIFVSTCBwYXRoIHdpbGwgYmUgZXNjYXBlZC4KICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgIEhvd2V2ZXIsIGlmIGEgYmxvYiBuYW1lIGluY2x1ZGVzID8gb3IgJSwgYmxvYiBuYW1lIG11c3QgYmUgZW5jb2RlZCBpbiB0aGUgVVJMLgogICAgICAgICAqICAgICAgICAgICAgICAgICAgICAgU3VjaCBhcyBhIGJsb2IgbmFtZWQgIm15P2Jsb2IlIiwgdGhlIFVSTCBzaG91bGQgYmUgImh0dHBzOi8vbXlhY2NvdW50LmJsb2IuY29yZS53aW5kb3dzLm5ldC9teWNvbnRhaW5lci9teSUzRmJsb2IlMjUiLgogICAgICAgICAqIEBwYXJhbSB7UGlwZWxpbmV9IHBpcGVsaW5lIENhbGwgU3RvcmFnZVVSTC5uZXdQaXBlbGluZSgpIHRvIGNyZWF0ZSBhIGRlZmF1bHQKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaXBlbGluZSwgb3IgcHJvdmlkZSBhIGN1c3RvbWl6ZWQgcGlwZWxpbmUuCiAgICAgICAgICogQG1lbWJlcm9mIEFwcGVuZEJsb2JVUkwKICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBBcHBlbmRCbG9iVVJMKHVybCwgcGlwZWxpbmUpIHsKICAgICAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgdXJsLCBwaXBlbGluZSkgfHwgdGhpczsKICAgICAgICAgICAgX3RoaXMuYXBwZW5kQmxvYkNvbnRleHQgPSBuZXcgQXBwZW5kQmxvYihfdGhpcy5zdG9yYWdlQ2xpZW50Q29udGV4dCk7CiAgICAgICAgICAgIHJldHVybiBfdGhpczsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQ3JlYXRlcyBhIEFwcGVuZEJsb2JVUkwgb2JqZWN0IGZyb20gQ29udGFpbmVyVVJMIGluc3RhbmNlLgogICAgICAgICAqCiAgICAgICAgICogQHN0YXRpYwogICAgICAgICAqIEBwYXJhbSB7Q29udGFpbmVyVVJMfSBjb250YWluZXJVUkwgQSBDb250YWluZXJVUkwgb2JqZWN0CiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IGJsb2JOYW1lIEFuIGFwcGVuZCBibG9iIG5hbWUKICAgICAgICAgKiBAcmV0dXJucyB7QXBwZW5kQmxvYlVSTH0KICAgICAgICAgKiBAbWVtYmVyb2YgQXBwZW5kQmxvYlVSTAogICAgICAgICAqLwogICAgICAgIEFwcGVuZEJsb2JVUkwuZnJvbUNvbnRhaW5lclVSTCA9IGZ1bmN0aW9uIChjb250YWluZXJVUkwsIGJsb2JOYW1lKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgQXBwZW5kQmxvYlVSTChhcHBlbmRUb1VSTFBhdGgoY29udGFpbmVyVVJMLnVybCwgZW5jb2RlVVJJQ29tcG9uZW50KGJsb2JOYW1lKSksIGNvbnRhaW5lclVSTC5waXBlbGluZSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGVzIGEgQXBwZW5kQmxvYlVSTCBvYmplY3QgZnJvbSBCbG9iVVJMIGluc3RhbmNlLgogICAgICAgICAqCiAgICAgICAgICogQHN0YXRpYwogICAgICAgICAqIEBwYXJhbSB7QmxvYlVSTH0gYmxvYlVSTAogICAgICAgICAqIEByZXR1cm5zIHtBcHBlbmRCbG9iVVJMfQogICAgICAgICAqIEBtZW1iZXJvZiBBcHBlbmRCbG9iVVJMCiAgICAgICAgICovCiAgICAgICAgQXBwZW5kQmxvYlVSTC5mcm9tQmxvYlVSTCA9IGZ1bmN0aW9uIChibG9iVVJMKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgQXBwZW5kQmxvYlVSTChibG9iVVJMLnVybCwgYmxvYlVSTC5waXBlbGluZSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGVzIGEgbmV3IEFwcGVuZEJsb2JVUkwgb2JqZWN0IGlkZW50aWNhbCB0byB0aGUgc291cmNlIGJ1dCB3aXRoIHRoZQogICAgICAgICAqIHNwZWNpZmllZCByZXF1ZXN0IHBvbGljeSBwaXBlbGluZS4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7UGlwZWxpbmV9IHBpcGVsaW5lCiAgICAgICAgICogQHJldHVybnMge0FwcGVuZEJsb2JVUkx9CiAgICAgICAgICogQG1lbWJlcm9mIEFwcGVuZEJsb2JVUkwKICAgICAgICAgKi8KICAgICAgICBBcHBlbmRCbG9iVVJMLnByb3RvdHlwZS53aXRoUGlwZWxpbmUgPSBmdW5jdGlvbiAocGlwZWxpbmUpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBBcHBlbmRCbG9iVVJMKHRoaXMudXJsLCBwaXBlbGluZSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGVzIGEgbmV3IEFwcGVuZEJsb2JVUkwgb2JqZWN0IGlkZW50aWNhbCB0byB0aGUgc291cmNlIGJ1dCB3aXRoIHRoZQogICAgICAgICAqIHNwZWNpZmllZCBzbmFwc2hvdCB0aW1lc3RhbXAuCiAgICAgICAgICogUHJvdmlkZSAiIiB3aWxsIHJlbW92ZSB0aGUgc25hcHNob3QgYW5kIHJldHVybiBhIFVSTCB0byB0aGUgYmFzZSBibG9iLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHNuYXBzaG90CiAgICAgICAgICogQHJldHVybnMge0FwcGVuZEJsb2JVUkx9CiAgICAgICAgICogQG1lbWJlcm9mIEFwcGVuZEJsb2JVUkwKICAgICAgICAgKi8KICAgICAgICBBcHBlbmRCbG9iVVJMLnByb3RvdHlwZS53aXRoU25hcHNob3QgPSBmdW5jdGlvbiAoc25hcHNob3QpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBBcHBlbmRCbG9iVVJMKHNldFVSTFBhcmFtZXRlcih0aGlzLnVybCwgVVJMQ29uc3RhbnRzLlBhcmFtZXRlcnMuU05BUFNIT1QsIHNuYXBzaG90Lmxlbmd0aCA9PT0gMCA/IHVuZGVmaW5lZCA6IHNuYXBzaG90KSwgdGhpcy5waXBlbGluZSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGVzIGEgMC1sZW5ndGggYXBwZW5kIGJsb2IuIENhbGwgQXBwZW5kQmxvY2sgdG8gYXBwZW5kIGRhdGEgdG8gYW4gYXBwZW5kIGJsb2IuCiAgICAgICAgICogQHNlZSBodHRwczovL2RvY3MubWljcm9zb2Z0LmNvbS9yZXN0L2FwaS9zdG9yYWdlc2VydmljZXMvcHV0LWJsb2IKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7QWJvcnRlcn0gYWJvcnRlciBDcmVhdGUgYSBuZXcgQWJvcnRlciBpbnN0YW5jZSB3aXRoIEFib3J0ZXIubm9uZSBvciBBYm9ydGVyLnRpbWVvdXQoKSwKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgZ290byBkb2N1bWVudHMgb2YgQWJvcnRlciBmb3IgbW9yZSBleGFtcGxlcyBhYm91dCByZXF1ZXN0IGNhbmNlbGxhdGlvbgogICAgICAgICAqIEBwYXJhbSB7SUFwcGVuZEJsb2JDcmVhdGVPcHRpb25zfSBbb3B0aW9uc10KICAgICAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxNb2RlbHMuQXBwZW5kQmxvYnNDcmVhdGVSZXNwb25zZT59CiAgICAgICAgICogQG1lbWJlcm9mIEFwcGVuZEJsb2JVUkwKICAgICAgICAgKi8KICAgICAgICBBcHBlbmRCbG9iVVJMLnByb3RvdHlwZS5jcmVhdGUgPSBmdW5jdGlvbiAoYWJvcnRlciwgb3B0aW9ucykgewogICAgICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7IG9wdGlvbnMgPSB7fTsgfQogICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7CiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5hY2Nlc3NDb25kaXRpb25zID0gb3B0aW9ucy5hY2Nlc3NDb25kaXRpb25zIHx8IHt9OwogICAgICAgICAgICAgICAgICAgIGVuc3VyZUNwa0lmU3BlY2lmaWVkKG9wdGlvbnMuY3VzdG9tZXJQcm92aWRlZEtleSwgdGhpcy5pc0h0dHBzKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgdGhpcy5hcHBlbmRCbG9iQ29udGV4dC5jcmVhdGUoMCwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWJvcnRTaWduYWw6IGFib3J0ZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBibG9iSFRUUEhlYWRlcnM6IG9wdGlvbnMuYmxvYkhUVFBIZWFkZXJzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVhc2VBY2Nlc3NDb25kaXRpb25zOiBvcHRpb25zLmFjY2Vzc0NvbmRpdGlvbnMubGVhc2VBY2Nlc3NDb25kaXRpb25zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGE6IG9wdGlvbnMubWV0YWRhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RpZmllZEFjY2Vzc0NvbmRpdGlvbnM6IG9wdGlvbnMuYWNjZXNzQ29uZGl0aW9ucy5tb2RpZmllZEFjY2Vzc0NvbmRpdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcGtJbmZvOiBvcHRpb25zLmN1c3RvbWVyUHJvdmlkZWRLZXkKICAgICAgICAgICAgICAgICAgICAgICAgfSldOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogQ29tbWl0cyBhIG5ldyBibG9jayBvZiBkYXRhIHRvIHRoZSBlbmQgb2YgdGhlIGV4aXN0aW5nIGFwcGVuZCBibG9iLgogICAgICAgICAqIEBzZWUgaHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vcmVzdC9hcGkvc3RvcmFnZXNlcnZpY2VzL2FwcGVuZC1ibG9jawogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtBYm9ydGVyfSBhYm9ydGVyIENyZWF0ZSBhIG5ldyBBYm9ydGVyIGluc3RhbmNlIHdpdGggQWJvcnRlci5ub25lIG9yIEFib3J0ZXIudGltZW91dCgpLAogICAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICBnb3RvIGRvY3VtZW50cyBvZiBBYm9ydGVyIGZvciBtb3JlIGV4YW1wbGVzIGFib3V0IHJlcXVlc3QgY2FuY2VsbGF0aW9uCiAgICAgICAgICogQHBhcmFtIHtIdHRwUmVxdWVzdEJvZHl9IGJvZHkKICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gY29udGVudExlbmd0aCBMZW5ndGggb2YgdGhlIGJvZHkgaW4gYnl0ZXMKICAgICAgICAgKiBAcGFyYW0ge0lBcHBlbmRCbG9iQXBwZW5kQmxvY2tPcHRpb25zfSBbb3B0aW9uc10KICAgICAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxNb2RlbHMuQXBwZW5kQmxvYnNBcHBlbmRCbG9ja1Jlc3BvbnNlPn0KICAgICAgICAgKiBAbWVtYmVyb2YgQXBwZW5kQmxvYlVSTAogICAgICAgICAqLwogICAgICAgIEFwcGVuZEJsb2JVUkwucHJvdG90eXBlLmFwcGVuZEJsb2NrID0gZnVuY3Rpb24gKGFib3J0ZXIsIGJvZHksIGNvbnRlbnRMZW5ndGgsIG9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgeyBvcHRpb25zID0ge307IH0KICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkgewogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYWNjZXNzQ29uZGl0aW9ucyA9IG9wdGlvbnMuYWNjZXNzQ29uZGl0aW9ucyB8fCB7fTsKICAgICAgICAgICAgICAgICAgICBlbnN1cmVDcGtJZlNwZWNpZmllZChvcHRpb25zLmN1c3RvbWVyUHJvdmlkZWRLZXksIHRoaXMuaXNIdHRwcyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHRoaXMuYXBwZW5kQmxvYkNvbnRleHQuYXBwZW5kQmxvY2soYm9keSwgY29udGVudExlbmd0aCwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWJvcnRTaWduYWw6IGFib3J0ZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRQb3NpdGlvbkFjY2Vzc0NvbmRpdGlvbnM6IG9wdGlvbnMuYWNjZXNzQ29uZGl0aW9ucy5hcHBlbmRQb3NpdGlvbkFjY2Vzc0NvbmRpdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWFzZUFjY2Vzc0NvbmRpdGlvbnM6IG9wdGlvbnMuYWNjZXNzQ29uZGl0aW9ucy5sZWFzZUFjY2Vzc0NvbmRpdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RpZmllZEFjY2Vzc0NvbmRpdGlvbnM6IG9wdGlvbnMuYWNjZXNzQ29uZGl0aW9ucy5tb2RpZmllZEFjY2Vzc0NvbmRpdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblVwbG9hZFByb2dyZXNzOiBvcHRpb25zLnByb2dyZXNzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25hbENvbnRlbnRNRDU6IG9wdGlvbnMudHJhbnNhY3Rpb25hbENvbnRlbnRNRDUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbmFsQ29udGVudENyYzY0OiBvcHRpb25zLnRyYW5zYWN0aW9uYWxDb250ZW50Q3JjNjQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcGtJbmZvOiBvcHRpb25zLmN1c3RvbWVyUHJvdmlkZWRLZXkKICAgICAgICAgICAgICAgICAgICAgICAgfSldOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIEFwcGVuZCBCbG9jayBvcGVyYXRpb24gY29tbWl0cyBhIG5ldyBibG9jayBvZiBkYXRhIHRvIHRoZSBlbmQgb2YgYW4gZXhpc3RpbmcgYXBwZW5kIGJsb2IKICAgICAgICAgKiB3aGVyZSB0aGUgY29udGVudHMgYXJlIHJlYWQgZnJvbSBhIHNvdXJjZSB1cmwuCiAgICAgICAgICogQHNlZSBodHRwczovL2RvY3MubWljcm9zb2Z0LmNvbS9lbi11cy9yZXN0L2FwaS9zdG9yYWdlc2VydmljZXMvYXBwZW5kLWJsb2NrLWZyb20tdXJsCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge0Fib3J0ZXJ9IGFib3J0ZXIgQ3JlYXRlIGEgbmV3IEFib3J0ZXIgaW5zdGFuY2Ugd2l0aCBBYm9ydGVyLm5vbmUgb3IgQWJvcnRlci50aW1lb3V0KCksCiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgIGdvdG8gZG9jdW1lbnRzIG9mIEFib3J0ZXIgZm9yIG1vcmUgZXhhbXBsZXMgYWJvdXQgcmVxdWVzdCBjYW5jZWxsYXRpb24KICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gc291cmNlVVJMCiAgICAgICAgICogICAgICAgICAgICAgICAgIFRoZSB1cmwgdG8gdGhlIGJsb2IgdGhhdCB3aWxsIGJlIHRoZSBzb3VyY2Ugb2YgdGhlIGNvcHkuIEEgc291cmNlIGJsb2IgaW4gdGhlIHNhbWUgc3RvcmFnZSBhY2NvdW50IGNhbgogICAgICAgICAqICAgICAgICAgICAgICAgICBiZSBhdXRoZW50aWNhdGVkIHZpYSBTaGFyZWQgS2V5LiBIb3dldmVyLCBpZiB0aGUgc291cmNlIGlzIGEgYmxvYiBpbiBhbm90aGVyIGFjY291bnQsIHRoZSBzb3VyY2UgYmxvYgogICAgICAgICAqICAgICAgICAgICAgICAgICBtdXN0IGVpdGhlciBiZSBwdWJsaWMgb3IgbXVzdCBiZSBhdXRoZW50aWNhdGVkIHZpYSBhIHNoYXJlZCBhY2Nlc3Mgc2lnbmF0dXJlLiBJZiB0aGUgc291cmNlIGJsb2IgaXMKICAgICAgICAgKiAgICAgICAgICAgICAgICAgcHVibGljLCBubyBhdXRoZW50aWNhdGlvbiBpcyByZXF1aXJlZCB0byBwZXJmb3JtIHRoZSBvcGVyYXRpb24uCiAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IHNvdXJjZU9mZnNldCBPZmZzZXQgaW4gc291cmNlIHRvIGJlIGFwcGVuZGVkCiAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IGNvdW50IE51bWJlciBvZiBieXRlcyB0byBiZSBhcHBlbmRlZCBhcyBhIGJsb2NrCiAgICAgICAgICogQHBhcmFtIHtJQXBwZW5kQmxvYkFwcGVuZEJsb2NrRnJvbVVSTE9wdGlvbnN9IFtvcHRpb25zPXt9XQogICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlPE1vZGVscy5BcHBlbmRCbG9iQXBwZW5kQmxvY2tGcm9tVXJsUmVzcG9uc2U+fQogICAgICAgICAqIEBtZW1iZXJvZiBBcHBlbmRCbG9iVVJMCiAgICAgICAgICovCiAgICAgICAgQXBwZW5kQmxvYlVSTC5wcm90b3R5cGUuYXBwZW5kQmxvY2tGcm9tVVJMID0gZnVuY3Rpb24gKGFib3J0ZXIsIHNvdXJjZVVSTCwgc291cmNlT2Zmc2V0LCBjb3VudCwgb3B0aW9ucykgewogICAgICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7IG9wdGlvbnMgPSB7fTsgfQogICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7CiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5hY2Nlc3NDb25kaXRpb25zID0gb3B0aW9ucy5hY2Nlc3NDb25kaXRpb25zIHx8IHt9OwogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuc291cmNlTW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zID0gb3B0aW9ucy5zb3VyY2VNb2RpZmllZEFjY2Vzc0NvbmRpdGlvbnMgfHwge307CiAgICAgICAgICAgICAgICAgICAgZW5zdXJlQ3BrSWZTcGVjaWZpZWQob3B0aW9ucy5jdXN0b21lclByb3ZpZGVkS2V5LCB0aGlzLmlzSHR0cHMpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCB0aGlzLmFwcGVuZEJsb2JDb250ZXh0LmFwcGVuZEJsb2NrRnJvbVVybChzb3VyY2VVUkwsIDAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFib3J0U2lnbmFsOiBhYm9ydGVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlUmFuZ2U6IHJhbmdlVG9TdHJpbmcoeyBvZmZzZXQ6IHNvdXJjZU9mZnNldCwgY291bnQ6IGNvdW50IH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlQ29udGVudE1ENTogb3B0aW9ucy5zb3VyY2VDb250ZW50TUQ1LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlQ29udGVudENyYzY0OiBvcHRpb25zLnNvdXJjZUNvbnRlbnRDcmM2NCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlYXNlQWNjZXNzQ29uZGl0aW9uczogb3B0aW9ucy5hY2Nlc3NDb25kaXRpb25zLmxlYXNlQWNjZXNzQ29uZGl0aW9ucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZFBvc2l0aW9uQWNjZXNzQ29uZGl0aW9uczogb3B0aW9ucy5hY2Nlc3NDb25kaXRpb25zLmFwcGVuZFBvc2l0aW9uQWNjZXNzQ29uZGl0aW9ucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGlmaWVkQWNjZXNzQ29uZGl0aW9uczogb3B0aW9ucy5hY2Nlc3NDb25kaXRpb25zLm1vZGlmaWVkQWNjZXNzQ29uZGl0aW9ucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZU1vZGlmaWVkQWNjZXNzQ29uZGl0aW9uczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZUlmTWF0Y2g6IG9wdGlvbnMuc291cmNlTW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zLmlmTWF0Y2gsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlSWZNb2RpZmllZFNpbmNlOiBvcHRpb25zLnNvdXJjZU1vZGlmaWVkQWNjZXNzQ29uZGl0aW9ucy5pZk1vZGlmaWVkU2luY2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlSWZOb25lTWF0Y2g6IG9wdGlvbnMuc291cmNlTW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zLmlmTm9uZU1hdGNoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZUlmVW5tb2RpZmllZFNpbmNlOiBvcHRpb25zLnNvdXJjZU1vZGlmaWVkQWNjZXNzQ29uZGl0aW9ucy5pZlVubW9kaWZpZWRTaW5jZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNwa0luZm86IG9wdGlvbnMuY3VzdG9tZXJQcm92aWRlZEtleQogICAgICAgICAgICAgICAgICAgICAgICB9KV07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gQXBwZW5kQmxvYlVSTDsKICAgIH0oQmxvYlVSTCkpOwoKICAgIHZhciBNdXRleExvY2tTdGF0dXM7CiAgICAoZnVuY3Rpb24gKE11dGV4TG9ja1N0YXR1cykgewogICAgICAgIE11dGV4TG9ja1N0YXR1c1tNdXRleExvY2tTdGF0dXNbIkxPQ0tFRCJdID0gMF0gPSAiTE9DS0VEIjsKICAgICAgICBNdXRleExvY2tTdGF0dXNbTXV0ZXhMb2NrU3RhdHVzWyJVTkxPQ0tFRCJdID0gMV0gPSAiVU5MT0NLRUQiOwogICAgfSkoTXV0ZXhMb2NrU3RhdHVzIHx8IChNdXRleExvY2tTdGF0dXMgPSB7fSkpOwogICAgLyoqCiAgICAgKiBBbiBhc3luYyBtdXRleCBsb2NrLgogICAgICoKICAgICAqIEBleHBvcnQKICAgICAqIEBjbGFzcyBNdXRleAogICAgICovCiAgICB2YXIgTXV0ZXggPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CiAgICAgICAgZnVuY3Rpb24gTXV0ZXgoKSB7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIExvY2sgZm9yIGEgc3BlY2lmaWMga2V5LiBJZiB0aGUgbG9jayBoYXMgYmVlbiBhY3F1aXJlZCBieSBhbm90aGVyIGN1c3RvbWVyLCB0aGVuCiAgICAgICAgICogd2lsbCB3YWl0IHVudGlsIGdldHRpbmcgdGhlIGxvY2suCiAgICAgICAgICoKICAgICAgICAgKiBAc3RhdGljCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBsb2NrIGtleQogICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlPHZvaWQ+fQogICAgICAgICAqIEBtZW1iZXJvZiBNdXRleAogICAgICAgICAqLwogICAgICAgIE11dGV4LmxvY2sgPSBmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMua2V5c1trZXldID09PSB1bmRlZmluZWQgfHwgX3RoaXMua2V5c1trZXldID09PSBNdXRleExvY2tTdGF0dXMuVU5MT0NLRUQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5rZXlzW2tleV0gPSBNdXRleExvY2tTdGF0dXMuTE9DS0VEOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLm9uVW5sb2NrRXZlbnQoa2V5LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmtleXNba2V5XSA9IE11dGV4TG9ja1N0YXR1cy5MT0NLRUQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSldOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogVW5sb2NrIGEga2V5LgogICAgICAgICAqCiAgICAgICAgICogQHN0YXRpYwogICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkKICAgICAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTx2b2lkPn0KICAgICAgICAgKiBAbWVtYmVyb2YgTXV0ZXgKICAgICAgICAgKi8KICAgICAgICBNdXRleC51bmxvY2sgPSBmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMua2V5c1trZXldID09PSBNdXRleExvY2tTdGF0dXMuTE9DS0VEKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZW1pdFVubG9ja0V2ZW50KGtleSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgX3RoaXMua2V5c1trZXldOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICB9KV07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICBNdXRleC5vblVubG9ja0V2ZW50ID0gZnVuY3Rpb24gKGtleSwgaGFuZGxlcikgewogICAgICAgICAgICBpZiAodGhpcy5saXN0ZW5lcnNba2V5XSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICB0aGlzLmxpc3RlbmVyc1trZXldID0gW2hhbmRsZXJdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5saXN0ZW5lcnNba2V5XS5wdXNoKGhhbmRsZXIpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBNdXRleC5lbWl0VW5sb2NrRXZlbnQgPSBmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgICAgIGlmICh0aGlzLmxpc3RlbmVyc1trZXldICE9PSB1bmRlZmluZWQgJiYgdGhpcy5saXN0ZW5lcnNba2V5XS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICB2YXIgaGFuZGxlcl8xID0gdGhpcy5saXN0ZW5lcnNba2V5XS5zaGlmdCgpOwogICAgICAgICAgICAgICAgc2V0SW1tZWRpYXRlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBoYW5kbGVyXzEuY2FsbChfdGhpcyk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgTXV0ZXgua2V5cyA9IHt9OwogICAgICAgIE11dGV4Lmxpc3RlbmVycyA9IHt9OwogICAgICAgIHJldHVybiBNdXRleDsKICAgIH0oKSk7CgogICAgLyoqCiAgICAgKiBBIEJhdGNoUmVxdWVzdCByZXByZXNlbnRzIGEgYmFzZWQgY2xhc3MgZm9yIEJhdGNoRGVsZXRlUmVxdWVzdCBhbmQgQmF0Y2hTZXRUaWVyUmVxdWVzdC4KICAgICAqCiAgICAgKiBAZXhwb3J0CiAgICAgKiBAY2xhc3MgQmF0Y2hSZXF1ZXN0CiAgICAgKi8KICAgIHZhciBCYXRjaFJlcXVlc3QgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CiAgICAgICAgZnVuY3Rpb24gQmF0Y2hSZXF1ZXN0KCkgewogICAgICAgICAgICB0aGlzLmJhdGNoID0gImJhdGNoIjsKICAgICAgICAgICAgdGhpcy5iYXRjaFJlcXVlc3QgPSBuZXcgSW5uZXJCYXRjaFJlcXVlc3QoKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogR2V0IHRoZSB2YWx1ZSBvZiBDb250ZW50LVR5cGUgZm9yIGEgYmF0Y2ggcmVxdWVzdC4KICAgICAgICAgKiBUaGUgdmFsdWUgbXVzdCBiZSBtdWx0aXBhcnQvbWl4ZWQgd2l0aCBhIGJhdGNoIGJvdW5kYXJ5LgogICAgICAgICAqIEV4YW1wbGU6IG11bHRpcGFydC9taXhlZDsgYm91bmRhcnk9YmF0Y2hfYTgxNzg2YzgtZTMwMS00ZTQyLWE3MjktYTMyY2EyNGFlMjUyCiAgICAgICAgICovCiAgICAgICAgQmF0Y2hSZXF1ZXN0LnByb3RvdHlwZS5nZXRNdWx0aVBhcnRDb250ZW50VHlwZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuYmF0Y2hSZXF1ZXN0LmdldE11bHRpcGFydENvbnRlbnRUeXBlKCk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBHZXQgYXNzZW1ibGVkIEhUVFAgcmVxdWVzdCBib2R5IGZvciBzdWIgcmVxdWVzdHMuCiAgICAgICAgICovCiAgICAgICAgQmF0Y2hSZXF1ZXN0LnByb3RvdHlwZS5nZXRIdHRwUmVxdWVzdEJvZHkgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmJhdGNoUmVxdWVzdC5nZXRIdHRwUmVxdWVzdEJvZHkoKTsKICAgICAgICB9OwogICAgICAgIC8qKgogICAgICAgICAqIEdldCBzdWIgcmVxdWVzdHMgdGhhdCBhcmUgYWRkZWQgaW50byB0aGUgYmF0Y2ggcmVxdWVzdC4KICAgICAgICAgKi8KICAgICAgICBCYXRjaFJlcXVlc3QucHJvdG90eXBlLmdldFN1YlJlcXVlc3RzID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5iYXRjaFJlcXVlc3QuZ2V0U3ViUmVxdWVzdHMoKTsKICAgICAgICB9OwogICAgICAgIEJhdGNoUmVxdWVzdC5wcm90b3R5cGUuYWRkU3ViUmVxdWVzdEludGVybmFsID0gZnVuY3Rpb24gKHN1YlJlcXVlc3QsIGFzc2VtYmxlU3ViUmVxdWVzdEZ1bmMpIHsKICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOiByZXR1cm4gWzQgLyp5aWVsZCovLCBNdXRleC5sb2NrKHRoaXMuYmF0Y2gpXTsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2EubGFiZWwgPSAyOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfYS50cnlzLnB1c2goWzIsICwgNCwgNl0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5iYXRjaFJlcXVlc3QucHJlQWRkU3ViUmVxdWVzdChzdWJSZXF1ZXN0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIGFzc2VtYmxlU3ViUmVxdWVzdEZ1bmMoKV07CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYmF0Y2hSZXF1ZXN0LnBvc3RBZGRTdWJSZXF1ZXN0KHN1YlJlcXVlc3QpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgNl07CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNDogcmV0dXJuIFs0IC8qeWllbGQqLywgTXV0ZXgudW5sb2NrKHRoaXMuYmF0Y2gpXTsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs3IC8qZW5kZmluYWxseSovXTsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA2OiByZXR1cm4gWzIgLypyZXR1cm4qL107CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgcmV0dXJuIEJhdGNoUmVxdWVzdDsKICAgIH0oKSk7CiAgICAvKioKICAgICAqIEEgQmF0Y2hEZWxldGVSZXF1ZXN0IHJlcHJlc2VudHMgYSBiYXRjaCBkZWxldGUgcmVxdWVzdCwgd2hpY2ggY29uc2lzdHMgb2Ygb25lIG9yIG1vcmUgZGVsZXRlIG9wZXJhdGlvbnMuCiAgICAgKgogICAgICogQGV4cG9ydAogICAgICogQGNsYXNzIEJhdGNoRGVsZXRlUmVxdWVzdAogICAgICogQGV4dGVuZHMge0JhdGNoUmVxdWVzdH0KICAgICAqLwogICAgdmFyIEJhdGNoRGVsZXRlUmVxdWVzdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKICAgICAgICBfX2V4dGVuZHMoQmF0Y2hEZWxldGVSZXF1ZXN0LCBfc3VwZXIpOwogICAgICAgIGZ1bmN0aW9uIEJhdGNoRGVsZXRlUmVxdWVzdCgpIHsKICAgICAgICAgICAgcmV0dXJuIF9zdXBlci5jYWxsKHRoaXMpIHx8IHRoaXM7CiAgICAgICAgfQogICAgICAgIEJhdGNoRGVsZXRlUmVxdWVzdC5wcm90b3R5cGUuYWRkU3ViUmVxdWVzdCA9IGZ1bmN0aW9uICh1cmxPckJsb2JVUkwsIGNyZWRlbnRpYWxPck9wdGlvbnMsIG9wdGlvbnMpIHsKICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIHVybCwgY3JlZGVudGlhbDsKICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHVybE9yQmxvYlVSTCA9PT0gJ3N0cmluZycgJiYgY3JlZGVudGlhbE9yT3B0aW9ucyBpbnN0YW5jZW9mIENyZWRlbnRpYWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBGaXJzdCBvdmVybG9hZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybCA9IHVybE9yQmxvYlVSTDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVkZW50aWFsID0gY3JlZGVudGlhbE9yT3B0aW9uczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHVybE9yQmxvYlVSTCBpbnN0YW5jZW9mIEJsb2JVUkwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZWNvbmQgb3ZlcmxvYWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwgPSB1cmxPckJsb2JVUkwudXJsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWRlbnRpYWwgPSB1cmxPckJsb2JVUkwuY3JlZGVudGlhbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0gY3JlZGVudGlhbE9yT3B0aW9uczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCJJbnZhbGlkIGFyZ3VtZW50cy4gRWl0aGVyIHVybCBhbmQgY3JlZGVudGlhbCwgb3IgQmxvYlVSTCBuZWVkIGJlIHByb3ZpZGVkLiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFvcHRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgX3N1cGVyLnByb3RvdHlwZS5hZGRTdWJSZXF1ZXN0SW50ZXJuYWwuY2FsbCh0aGlzLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVkZW50aWFsOiBjcmVkZW50aWFsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkgeyByZXR1cm4gX19hd2FpdGVyKF90aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOiByZXR1cm4gWzQgLyp5aWVsZCovLCBuZXcgQmxvYlVSTCh1cmwsIHRoaXMuYmF0Y2hSZXF1ZXN0LmNyZWF0ZVBpcGVsaW5lKGNyZWRlbnRpYWwpKS5kZWxldGUoQWJvcnRlci5ub25lLCBvcHRpb25zKV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7IH0pXTsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICAgIHJldHVybiBCYXRjaERlbGV0ZVJlcXVlc3Q7CiAgICB9KEJhdGNoUmVxdWVzdCkpOwogICAgLyoqCiAgICAgKiBBIEJhdGNoU2V0VGllclJlcXVlc3QgcmVwcmVzZW50cyBhIGJhdGNoIHNldCB0aWVyIHJlcXVlc3QsIHdoaWNoIGNvbnNpc3RzIG9mIG9uZSBvciBtb3JlIHNldCB0aWVyIG9wZXJhdGlvbnMuCiAgICAgKgogICAgICogQGV4cG9ydAogICAgICogQGNsYXNzIEJhdGNoU2V0VGllclJlcXVlc3QKICAgICAqIEBleHRlbmRzIHtCYXRjaFJlcXVlc3R9CiAgICAgKi8KICAgIHZhciBCYXRjaFNldFRpZXJSZXF1ZXN0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewogICAgICAgIF9fZXh0ZW5kcyhCYXRjaFNldFRpZXJSZXF1ZXN0LCBfc3VwZXIpOwogICAgICAgIGZ1bmN0aW9uIEJhdGNoU2V0VGllclJlcXVlc3QoKSB7CiAgICAgICAgICAgIHJldHVybiBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzOwogICAgICAgIH0KICAgICAgICBCYXRjaFNldFRpZXJSZXF1ZXN0LnByb3RvdHlwZS5hZGRTdWJSZXF1ZXN0ID0gZnVuY3Rpb24gKHVybE9yQmxvYlVSTCwgY3JlZGVudGlhbE9yVGllciwgdGllck9yT3B0aW9ucywgb3B0aW9ucykgewogICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgdXJsLCBjcmVkZW50aWFsLCB0aWVyOwogICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdXJsT3JCbG9iVVJMID09PSAnc3RyaW5nJyAmJiBjcmVkZW50aWFsT3JUaWVyIGluc3RhbmNlb2YgQ3JlZGVudGlhbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZpcnN0IG92ZXJsb2FkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gdXJsT3JCbG9iVVJMOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWRlbnRpYWwgPSBjcmVkZW50aWFsT3JUaWVyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpZXIgPSB0aWVyT3JPcHRpb25zOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodXJsT3JCbG9iVVJMIGluc3RhbmNlb2YgQmxvYlVSTCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNlY29uZCBvdmVybG9hZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybCA9IHVybE9yQmxvYlVSTC51cmw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlZGVudGlhbCA9IHVybE9yQmxvYlVSTC5jcmVkZW50aWFsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpZXIgPSBjcmVkZW50aWFsT3JUaWVyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSB0aWVyT3JPcHRpb25zOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoIkludmFsaWQgYXJndW1lbnRzLiBFaXRoZXIgdXJsIGFuZCBjcmVkZW50aWFsLCBvciBCbG9iVVJMIG5lZWQgYmUgcHJvdmlkZWQuIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW9wdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0ge307CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBfc3VwZXIucHJvdG90eXBlLmFkZFN1YlJlcXVlc3RJbnRlcm5hbC5jYWxsKHRoaXMsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWRlbnRpYWw6IGNyZWRlbnRpYWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7IHJldHVybiBfX2F3YWl0ZXIoX3RoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6IHJldHVybiBbNCAvKnlpZWxkKi8sIG5ldyBCbG9iVVJMKHVybCwgdGhpcy5iYXRjaFJlcXVlc3QuY3JlYXRlUGlwZWxpbmUoY3JlZGVudGlhbCkpLnNldFRpZXIoQWJvcnRlci5ub25lLCB0aWVyLCBvcHRpb25zKV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7IH0pXTsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICAgIHJldHVybiBCYXRjaFNldFRpZXJSZXF1ZXN0OwogICAgfShCYXRjaFJlcXVlc3QpKTsKICAgIC8qKgogICAgICogSW5uZXIgYmF0Y2ggcmVxdWVzdCBjbGFzcyB3aGljaCBpcyByZXNwb25zaWJsZSBmb3IgYXNzZW1ibGluZyBhbmQgc2VyaWFsaXppbmcgc3ViIHJlcXVlc3RzLgogICAgICogU2VlIGh0dHBzOi8vZG9jcy5taWNyb3NvZnQuY29tL2VuLXVzL3Jlc3QvYXBpL3N0b3JhZ2VzZXJ2aWNlcy9ibG9iLWJhdGNoI3JlcXVlc3QtYm9keSBmb3IgaG93IHJlcXVlc3QgZ2V0IGFzc2VtYmxlZC4KICAgICAqLwogICAgdmFyIElubmVyQmF0Y2hSZXF1ZXN0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIElubmVyQmF0Y2hSZXF1ZXN0KCkgewogICAgICAgICAgICB0aGlzLm9wZXJhdGlvbkNvdW50ID0gMDsKICAgICAgICAgICAgdGhpcy5ib2R5ID0gIiI7CiAgICAgICAgICAgIHZhciB0ZW1wR3VpZCA9IGdlbmVyYXRlVXVpZCgpOwogICAgICAgICAgICAvLyBiYXRjaF97YmF0Y2hpZH0KICAgICAgICAgICAgdGhpcy5ib3VuZGFyeSA9ICJiYXRjaF8iICsgdGVtcEd1aWQ7CiAgICAgICAgICAgIC8vIC0tYmF0Y2hfe2JhdGNoaWR9CiAgICAgICAgICAgIC8vIENvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vaHR0cAogICAgICAgICAgICAvLyBDb250ZW50LVRyYW5zZmVyLUVuY29kaW5nOiBiaW5hcnkKICAgICAgICAgICAgdGhpcy5zdWJSZXF1ZXN0UHJlZml4ID0gIi0tIiArIHRoaXMuYm91bmRhcnkgKyBIVFRQX0xJTkVfRU5ESU5HICsgSGVhZGVyQ29uc3RhbnRzLkNPTlRFTlRfVFlQRSArICI6IGFwcGxpY2F0aW9uL2h0dHAiICsgSFRUUF9MSU5FX0VORElORyArIEhlYWRlckNvbnN0YW50cy5DT05URU5UX1RSQU5TRkVSX0VOQ09ESU5HICsgIjogYmluYXJ5IjsKICAgICAgICAgICAgLy8gbXVsdGlwYXJ0L21peGVkOyBib3VuZGFyeT1iYXRjaF97YmF0Y2hpZH0KICAgICAgICAgICAgdGhpcy5tdWx0aXBhcnRDb250ZW50VHlwZSA9ICJtdWx0aXBhcnQvbWl4ZWQ7IGJvdW5kYXJ5PSIgKyB0aGlzLmJvdW5kYXJ5OwogICAgICAgICAgICAvLyAtLWJhdGNoX3tiYXRjaGlkfS0tCiAgICAgICAgICAgIHRoaXMuYmF0Y2hSZXF1ZXN0RW5kaW5nID0gIi0tIiArIHRoaXMuYm91bmRhcnkgKyAiLS0iOwogICAgICAgICAgICB0aGlzLnN1YlJlcXVlc3RzID0gbmV3IE1hcCgpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGUgcGlwZWxpbmUgdG8gYXNzZW1ibGUgc3ViIHJlcXVlc3RzLiBUaGUgaWRlYSBoZXJlIGlzIHRvIHVzZSBleGlzaW5nCiAgICAgICAgICogY3JlZGVudGlhbCBhbmQgc2VyaWFsaXphdGlvbi9kZXNlcmlhbGl6YXRpb24gY29tcG9uZW50cywgd2l0aCBhZGRpdGlvbmFsIHBvbGljaWVzIHRvCiAgICAgICAgICogZmlsdGVyIHVubmVjZXNzYXJ5IGhlYWRlcnMsIGFzc2VtYmxlIHN1YiByZXF1ZXN0cyBpbnRvIHJlcXVlc3QncyBib2R5CiAgICAgICAgICogYW5kIGludGVyY2VwdCByZXF1ZXN0IGZyb20gZ29pbmcgdG8gd2lyZS4KICAgICAgICAgKiBAcGFyYW0gY3JlZGVudGlhbAogICAgICAgICAqLwogICAgICAgIElubmVyQmF0Y2hSZXF1ZXN0LnByb3RvdHlwZS5jcmVhdGVQaXBlbGluZSA9IGZ1bmN0aW9uIChjcmVkZW50aWFsKSB7CiAgICAgICAgICAgIHZhciBpc0Fub255bW91c0NyZWRzID0gY3JlZGVudGlhbCBpbnN0YW5jZW9mIEFub255bW91c0NyZWRlbnRpYWw7CiAgICAgICAgICAgIHZhciBwb2xpY3lGYWN0b3J5TGVuZ3RoID0gMyArIChpc0Fub255bW91c0NyZWRzID8gMCA6IDEpOyAvLyBbZGVzZXJpbGl6YXRpb25Qb2xpY3ksIEJhdGNoSGVhZGVyRmlsdGVyUG9saWN5RmFjdG9yeSwgKE9wdGlvbmFsKUNyZWRlbnRpYWwsIEJhdGNoUmVxdWVzdEFzc2VtYmxlUG9saWN5RmFjdG9yeV0KICAgICAgICAgICAgdmFyIGZhY3RvcmllcyA9IG5ldyBBcnJheShwb2xpY3lGYWN0b3J5TGVuZ3RoKTsKICAgICAgICAgICAgZmFjdG9yaWVzWzBdID0gZGVzZXJpYWxpemF0aW9uUG9saWN5KCk7IC8vIERlZmF1bHQgZGVzZXJpYWxpemF0aW9uUG9saWN5IGlzIHByb3ZpZGVkIGJ5IHByb3RvY29sIGxheWVyCiAgICAgICAgICAgIGZhY3Rvcmllc1sxXSA9IG5ldyBCYXRjaEhlYWRlckZpbHRlclBvbGljeUZhY3RvcnkoKTsgLy8gVXNlIGJhdGNoIGhlYWRlciBmaWx0ZXIgcG9saWN5IHRvIGV4Y2x1ZGUgdW5uZWNlc3NhcnkgaGVhZGVycwogICAgICAgICAgICBpZiAoIWlzQW5vbnltb3VzQ3JlZHMpIHsKICAgICAgICAgICAgICAgIGZhY3Rvcmllc1syXSA9IGNyZWRlbnRpYWw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZmFjdG9yaWVzW3BvbGljeUZhY3RvcnlMZW5ndGggLSAxXSA9IG5ldyBCYXRjaFJlcXVlc3RBc3NlbWJsZVBvbGljeUZhY3RvcnkodGhpcyk7IC8vIFVzZSBiYXRjaCBhc3NlbWJsZSBwb2xpY3kgdG8gYXNzZW1ibGUgcmVxdWVzdCBhbmQgaW50ZXJjZXB0IHJlcXVlc3QgZnJvbSBnb2luZyB0byB3aXJlCiAgICAgICAgICAgIHJldHVybiBuZXcgUGlwZWxpbmUoZmFjdG9yaWVzLCB7fSk7CiAgICAgICAgfTsKICAgICAgICBJbm5lckJhdGNoUmVxdWVzdC5wcm90b3R5cGUuYXBwZW5kU3ViUmVxdWVzdFRvQm9keSA9IGZ1bmN0aW9uIChyZXF1ZXN0KSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IHRvIGFzc2VtYmxlIHN1YiByZXF1ZXN0CiAgICAgICAgICAgIHRoaXMuYm9keSArPQogICAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgICAgIHRoaXMuc3ViUmVxdWVzdFByZWZpeCwKICAgICAgICAgICAgICAgICAgICBIZWFkZXJDb25zdGFudHMuQ09OVEVOVF9JRCArICI6ICIgKyB0aGlzLm9wZXJhdGlvbkNvdW50LAogICAgICAgICAgICAgICAgICAgICIiLAogICAgICAgICAgICAgICAgICAgIHJlcXVlc3QubWV0aG9kLnRvU3RyaW5nKCkgKyAiICIgKyBnZXRVUkxQYXRoQW5kUXVlcnkocmVxdWVzdC51cmwpICsgIiAiICsgSFRUUF9WRVJTSU9OXzFfMSArIEhUVFBfTElORV9FTkRJTkcgLy8gc3ViIHJlcXVlc3Qgc3RhcnQgbGluZSB3aXRoIG1ldGhvZAogICAgICAgICAgICAgICAgXS5qb2luKEhUVFBfTElORV9FTkRJTkcpOwogICAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gcmVxdWVzdC5oZWFkZXJzLmhlYWRlcnNBcnJheSgpOyBfaSA8IF9hLmxlbmd0aDsgX2krKykgewogICAgICAgICAgICAgICAgdmFyIGhlYWRlciA9IF9hW19pXTsKICAgICAgICAgICAgICAgIHRoaXMuYm9keSArPSBoZWFkZXIubmFtZSArICI6ICIgKyBoZWFkZXIudmFsdWUgKyBIVFRQX0xJTkVfRU5ESU5HOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuYm9keSArPSBIVFRQX0xJTkVfRU5ESU5HOyAvLyBzdWIgcmVxdWVzdCdzIGhlYWRlcnMgbmVlZCBiZSBlbmRpbmcgd2l0aCBhbiBlbXB0eSBsaW5lCiAgICAgICAgICAgIC8vIE5vIGJvZHkgdG8gYXNzZW1ibGUgZm9yIGN1cnJlbnQgYmF0Y2ggcmVxdWVzdCBzdXBwb3J0CiAgICAgICAgICAgIC8vIEVuZCB0byBhc3NlbWJsZSBzdWIgcmVxdWVzdAogICAgICAgIH07CiAgICAgICAgSW5uZXJCYXRjaFJlcXVlc3QucHJvdG90eXBlLnByZUFkZFN1YlJlcXVlc3QgPSBmdW5jdGlvbiAoc3ViUmVxdWVzdCkgewogICAgICAgICAgICBpZiAodGhpcy5vcGVyYXRpb25Db3VudCA+PSBCQVRDSF9NQVhfUkVRVUVTVCkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoIkNhbm5vdCBleGNlZWQgIiArIEJBVENIX01BWF9SRVFVRVNUICsgIiBzdWIgcmVxdWVzdHMgaW4gYSBzaW5nbGUgYmF0Y2giKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBGYXN0IGZhaWwgaWYgdXJsIGZvciBzdWIgcmVxdWVzdCBpcyBpbnZhbGlkCiAgICAgICAgICAgIHZhciBwYXRoID0gZ2V0VVJMUGF0aChzdWJSZXF1ZXN0LnVybCk7CiAgICAgICAgICAgIGlmICghcGF0aCB8fCBwYXRoID09ICIiKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiSW52YWxpZCB1cmwgZm9yIHN1YiByZXF1ZXN0OiAnIiArIHN1YlJlcXVlc3QudXJsICsgIiciKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgSW5uZXJCYXRjaFJlcXVlc3QucHJvdG90eXBlLnBvc3RBZGRTdWJSZXF1ZXN0ID0gZnVuY3Rpb24gKHN1YlJlcXVlc3QpIHsKICAgICAgICAgICAgdGhpcy5zdWJSZXF1ZXN0cy5zZXQodGhpcy5vcGVyYXRpb25Db3VudCwgc3ViUmVxdWVzdCk7CiAgICAgICAgICAgIHRoaXMub3BlcmF0aW9uQ291bnQrKzsKICAgICAgICB9OwogICAgICAgIC8vIFJldHVybiB0aGUgaHR0cCByZXF1ZXN0IGJvZHkgd2l0aCBhc3NlbWJsaW5nIHRoZSBlbmRpbmcgbGluZSB0byB0aGUgc3ViIHJlcXVlc3QgYm9keS4KICAgICAgICBJbm5lckJhdGNoUmVxdWVzdC5wcm90b3R5cGUuZ2V0SHR0cFJlcXVlc3RCb2R5ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gIiIgKyB0aGlzLmJvZHkgKyB0aGlzLmJhdGNoUmVxdWVzdEVuZGluZyArIEhUVFBfTElORV9FTkRJTkc7CiAgICAgICAgfTsKICAgICAgICBJbm5lckJhdGNoUmVxdWVzdC5wcm90b3R5cGUuZ2V0TXVsdGlwYXJ0Q29udGVudFR5cGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm11bHRpcGFydENvbnRlbnRUeXBlOwogICAgICAgIH07CiAgICAgICAgSW5uZXJCYXRjaFJlcXVlc3QucHJvdG90eXBlLmdldFN1YlJlcXVlc3RzID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5zdWJSZXF1ZXN0czsKICAgICAgICB9OwogICAgICAgIHJldHVybiBJbm5lckJhdGNoUmVxdWVzdDsKICAgIH0oKSk7CiAgICB2YXIgQmF0Y2hSZXF1ZXN0QXNzZW1ibGVQb2xpY3kgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CiAgICAgICAgX19leHRlbmRzKEJhdGNoUmVxdWVzdEFzc2VtYmxlUG9saWN5LCBfc3VwZXIpOwogICAgICAgIGZ1bmN0aW9uIEJhdGNoUmVxdWVzdEFzc2VtYmxlUG9saWN5KGJhdGNoUmVxdWVzdCwgbmV4dFBvbGljeSwgb3B0aW9ucykgewogICAgICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBuZXh0UG9saWN5LCBvcHRpb25zKSB8fCB0aGlzOwogICAgICAgICAgICBfdGhpcy5kdW1teVJlc3BvbnNlID0gewogICAgICAgICAgICAgICAgcmVxdWVzdDogbmV3IFdlYlJlc291cmNlKCksCiAgICAgICAgICAgICAgICBzdGF0dXM6IDIwMCwKICAgICAgICAgICAgICAgIGhlYWRlcnM6IG5ldyBIdHRwSGVhZGVycygpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIF90aGlzLmJhdGNoUmVxdWVzdCA9IGJhdGNoUmVxdWVzdDsKICAgICAgICAgICAgcmV0dXJuIF90aGlzOwogICAgICAgIH0KICAgICAgICBCYXRjaFJlcXVlc3RBc3NlbWJsZVBvbGljeS5wcm90b3R5cGUuc2VuZFJlcXVlc3QgPSBmdW5jdGlvbiAocmVxdWVzdCkgewogICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6IHJldHVybiBbNCAvKnlpZWxkKi8sIHRoaXMuYmF0Y2hSZXF1ZXN0LmFwcGVuZFN1YlJlcXVlc3RUb0JvZHkocmVxdWVzdCldOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgdGhpcy5kdW1teVJlc3BvbnNlXTsgLy8gSW50ZXJjZXB0IHJlcXVlc3QgZnJvbSBnb2luZyB0byB3aXJlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgcmV0dXJuIEJhdGNoUmVxdWVzdEFzc2VtYmxlUG9saWN5OwogICAgfShCYXNlUmVxdWVzdFBvbGljeSkpOwogICAgdmFyIEJhdGNoUmVxdWVzdEFzc2VtYmxlUG9saWN5RmFjdG9yeSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBCYXRjaFJlcXVlc3RBc3NlbWJsZVBvbGljeUZhY3RvcnkoYmF0Y2hSZXF1ZXN0KSB7CiAgICAgICAgICAgIHRoaXMuYmF0Y2hSZXF1ZXN0ID0gYmF0Y2hSZXF1ZXN0OwogICAgICAgIH0KICAgICAgICBCYXRjaFJlcXVlc3RBc3NlbWJsZVBvbGljeUZhY3RvcnkucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uIChuZXh0UG9saWN5LCBvcHRpb25zKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgQmF0Y2hSZXF1ZXN0QXNzZW1ibGVQb2xpY3kodGhpcy5iYXRjaFJlcXVlc3QsIG5leHRQb2xpY3ksIG9wdGlvbnMpOwogICAgICAgIH07CiAgICAgICAgcmV0dXJuIEJhdGNoUmVxdWVzdEFzc2VtYmxlUG9saWN5RmFjdG9yeTsKICAgIH0oKSk7CiAgICB2YXIgQmF0Y2hIZWFkZXJGaWx0ZXJQb2xpY3kgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CiAgICAgICAgX19leHRlbmRzKEJhdGNoSGVhZGVyRmlsdGVyUG9saWN5LCBfc3VwZXIpOwogICAgICAgIGZ1bmN0aW9uIEJhdGNoSGVhZGVyRmlsdGVyUG9saWN5KG5leHRQb2xpY3ksIG9wdGlvbnMpIHsKICAgICAgICAgICAgcmV0dXJuIF9zdXBlci5jYWxsKHRoaXMsIG5leHRQb2xpY3ksIG9wdGlvbnMpIHx8IHRoaXM7CiAgICAgICAgfQogICAgICAgIEJhdGNoSGVhZGVyRmlsdGVyUG9saWN5LnByb3RvdHlwZS5zZW5kUmVxdWVzdCA9IGZ1bmN0aW9uIChyZXF1ZXN0KSB7CiAgICAgICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciB4TXNIZWFkZXJOYW1lLCBfaSwgX2EsIGhlYWRlcjsKICAgICAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2IpIHsKICAgICAgICAgICAgICAgICAgICB4TXNIZWFkZXJOYW1lID0gIiI7CiAgICAgICAgICAgICAgICAgICAgZm9yIChfaSA9IDAsIF9hID0gcmVxdWVzdC5oZWFkZXJzLmhlYWRlcnNBcnJheSgpOyBfaSA8IF9hLmxlbmd0aDsgX2krKykgewogICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXIgPSBfYVtfaV07CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpRXF1YWwoaGVhZGVyLm5hbWUsIEhlYWRlckNvbnN0YW50cy5YX01TX1ZFUlNJT04pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4TXNIZWFkZXJOYW1lID0gaGVhZGVyLm5hbWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHhNc0hlYWRlck5hbWUgIT09ICIiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuaGVhZGVycy5yZW1vdmUoeE1zSGVhZGVyTmFtZSk7IC8vIFRoZSBzdWJyZXF1ZXN0cyBzaG91bGQgbm90IGhhdmUgdGhlIHgtbXMtdmVyc2lvbiBoZWFkZXIuCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCB0aGlzLl9uZXh0UG9saWN5LnNlbmRSZXF1ZXN0KHJlcXVlc3QpXTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICAgIHJldHVybiBCYXRjaEhlYWRlckZpbHRlclBvbGljeTsKICAgIH0oQmFzZVJlcXVlc3RQb2xpY3kpKTsKICAgIHZhciBCYXRjaEhlYWRlckZpbHRlclBvbGljeUZhY3RvcnkgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CiAgICAgICAgZnVuY3Rpb24gQmF0Y2hIZWFkZXJGaWx0ZXJQb2xpY3lGYWN0b3J5KCkgewogICAgICAgIH0KICAgICAgICBCYXRjaEhlYWRlckZpbHRlclBvbGljeUZhY3RvcnkucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uIChuZXh0UG9saWN5LCBvcHRpb25zKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgQmF0Y2hIZWFkZXJGaWx0ZXJQb2xpY3kobmV4dFBvbGljeSwgb3B0aW9ucyk7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gQmF0Y2hIZWFkZXJGaWx0ZXJQb2xpY3lGYWN0b3J5OwogICAgfSgpKTsKCiAgICAvKioKICAgICAqIEJsb2NrQmxvYlVSTCBkZWZpbmVzIGEgc2V0IG9mIG9wZXJhdGlvbnMgYXBwbGljYWJsZSB0byBibG9jayBibG9icy4KICAgICAqCiAgICAgKiBAZXhwb3J0CiAgICAgKiBAY2xhc3MgQmxvY2tCbG9iVVJMCiAgICAgKiBAZXh0ZW5kcyB7U3RvcmFnZVVSTH0KICAgICAqLwogICAgdmFyIEJsb2NrQmxvYlVSTCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKICAgICAgICBfX2V4dGVuZHMoQmxvY2tCbG9iVVJMLCBfc3VwZXIpOwogICAgICAgIC8qKgogICAgICAgICAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgQmxvY2tCbG9iVVJMLgogICAgICAgICAqIFRoaXMgbWV0aG9kIGFjY2VwdHMgYW4gZW5jb2RlZCBVUkwgb3Igbm9uLWVuY29kZWQgVVJMIHBvaW50aW5nIHRvIGEgYmxvY2sgYmxvYi4KICAgICAgICAgKiBFbmNvZGVkIFVSTCBzdHJpbmcgd2lsbCBOT1QgYmUgZXNjYXBlZCB0d2ljZSwgb25seSBzcGVjaWFsIGNoYXJhY3RlcnMgaW4gVVJMIHBhdGggd2lsbCBiZSBlc2NhcGVkLgogICAgICAgICAqIElmIGEgYmxvYiBuYW1lIGluY2x1ZGVzID8gb3IgJSwgYmxvYiBuYW1lIG11c3QgYmUgZW5jb2RlZCBpbiB0aGUgVVJMLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHVybCBBIFVSTCBzdHJpbmcgcG9pbnRpbmcgdG8gQXp1cmUgU3RvcmFnZSBibG9jayBibG9iLCBzdWNoIGFzCiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICAiaHR0cHM6Ly9teWFjY291bnQuYmxvYi5jb3JlLndpbmRvd3MubmV0L215Y29udGFpbmVyL2Jsb2NrYmxvYiIuIFlvdSBjYW4KICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgIGFwcGVuZCBhIFNBUyBpZiB1c2luZyBBbm9ueW1vdXNDcmVkZW50aWFsLCBzdWNoIGFzCiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICAiaHR0cHM6Ly9teWFjY291bnQuYmxvYi5jb3JlLndpbmRvd3MubmV0L215Y29udGFpbmVyL2Jsb2NrYmxvYj9zYXNTdHJpbmciLgogICAgICAgICAqICAgICAgICAgICAgICAgICAgICAgVGhpcyBtZXRob2QgYWNjZXB0cyBhbiBlbmNvZGVkIFVSTCBvciBub24tZW5jb2RlZCBVUkwgcG9pbnRpbmcgdG8gYSBibG9iLgogICAgICAgICAqICAgICAgICAgICAgICAgICAgICAgRW5jb2RlZCBVUkwgc3RyaW5nIHdpbGwgTk9UIGJlIGVzY2FwZWQgdHdpY2UsIG9ubHkgc3BlY2lhbCBjaGFyYWN0ZXJzIGluIFVSTCBwYXRoIHdpbGwgYmUgZXNjYXBlZC4KICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgIEhvd2V2ZXIsIGlmIGEgYmxvYiBuYW1lIGluY2x1ZGVzID8gb3IgJSwgYmxvYiBuYW1lIG11c3QgYmUgZW5jb2RlZCBpbiB0aGUgVVJMLgogICAgICAgICAqICAgICAgICAgICAgICAgICAgICAgU3VjaCBhcyBhIGJsb2IgbmFtZWQgIm15P2Jsb2IlIiwgdGhlIFVSTCBzaG91bGQgYmUgImh0dHBzOi8vbXlhY2NvdW50LmJsb2IuY29yZS53aW5kb3dzLm5ldC9teWNvbnRhaW5lci9teSUzRmJsb2IlMjUiLgogICAgICAgICAqIEBwYXJhbSB7UGlwZWxpbmV9IHBpcGVsaW5lIENhbGwgU3RvcmFnZVVSTC5uZXdQaXBlbGluZSgpIHRvIGNyZWF0ZSBhIGRlZmF1bHQKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaXBlbGluZSwgb3IgcHJvdmlkZSBhIGN1c3RvbWl6ZWQgcGlwZWxpbmUuCiAgICAgICAgICogQG1lbWJlcm9mIEJsb2NrQmxvYlVSTAogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIEJsb2NrQmxvYlVSTCh1cmwsIHBpcGVsaW5lKSB7CiAgICAgICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHVybCwgcGlwZWxpbmUpIHx8IHRoaXM7CiAgICAgICAgICAgIF90aGlzLmJsb2NrQmxvYkNvbnRleHQgPSBuZXcgQmxvY2tCbG9iKF90aGlzLnN0b3JhZ2VDbGllbnRDb250ZXh0KTsKICAgICAgICAgICAgcmV0dXJuIF90aGlzOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGVzIGEgQmxvY2tCbG9iVVJMIG9iamVjdCBmcm9tIENvbnRhaW5lclVSTCBpbnN0YW5jZS4KICAgICAgICAgKgogICAgICAgICAqIEBzdGF0aWMKICAgICAgICAgKiBAcGFyYW0ge0NvbnRhaW5lclVSTH0gY29udGFpbmVyVVJMIEEgQ29udGFpbmVyVVJMIG9iamVjdAogICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBibG9iTmFtZSBBIGJsb2NrIGJsb2IgbmFtZQogICAgICAgICAqIEByZXR1cm5zIHtCbG9ja0Jsb2JVUkx9CiAgICAgICAgICogQG1lbWJlcm9mIEJsb2NrQmxvYlVSTAogICAgICAgICAqLwogICAgICAgIEJsb2NrQmxvYlVSTC5mcm9tQ29udGFpbmVyVVJMID0gZnVuY3Rpb24gKGNvbnRhaW5lclVSTCwgYmxvYk5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBCbG9ja0Jsb2JVUkwoYXBwZW5kVG9VUkxQYXRoKGNvbnRhaW5lclVSTC51cmwsIGVuY29kZVVSSUNvbXBvbmVudChibG9iTmFtZSkpLCBjb250YWluZXJVUkwucGlwZWxpbmUpOwogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogQ3JlYXRlcyBhIEJsb2NrQmxvYlVSTCBvYmplY3QgZnJvbSBCbG9iVVJMIGluc3RhbmNlLgogICAgICAgICAqCiAgICAgICAgICogQHN0YXRpYwogICAgICAgICAqIEBwYXJhbSB7QmxvYlVSTH0gYmxvYlVSTAogICAgICAgICAqIEByZXR1cm5zIHtCbG9ja0Jsb2JVUkx9CiAgICAgICAgICogQG1lbWJlcm9mIEJsb2NrQmxvYlVSTAogICAgICAgICAqLwogICAgICAgIEJsb2NrQmxvYlVSTC5mcm9tQmxvYlVSTCA9IGZ1bmN0aW9uIChibG9iVVJMKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgQmxvY2tCbG9iVVJMKGJsb2JVUkwudXJsLCBibG9iVVJMLnBpcGVsaW5lKTsKICAgICAgICB9OwogICAgICAgIC8qKgogICAgICAgICAqIENyZWF0ZXMgYSBuZXcgQmxvY2tCbG9iVVJMIG9iamVjdCBpZGVudGljYWwgdG8gdGhlIHNvdXJjZSBidXQgd2l0aCB0aGUKICAgICAgICAgKiBzcGVjaWZpZWQgcmVxdWVzdCBwb2xpY3kgcGlwZWxpbmUuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge1BpcGVsaW5lfSBwaXBlbGluZQogICAgICAgICAqIEByZXR1cm5zIHtCbG9ja0Jsb2JVUkx9CiAgICAgICAgICogQG1lbWJlcm9mIEJsb2NrQmxvYlVSTAogICAgICAgICAqLwogICAgICAgIEJsb2NrQmxvYlVSTC5wcm90b3R5cGUud2l0aFBpcGVsaW5lID0gZnVuY3Rpb24gKHBpcGVsaW5lKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgQmxvY2tCbG9iVVJMKHRoaXMudXJsLCBwaXBlbGluZSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGVzIGEgbmV3IEJsb2NrQmxvYlVSTCBvYmplY3QgaWRlbnRpY2FsIHRvIHRoZSBzb3VyY2UgYnV0IHdpdGggdGhlCiAgICAgICAgICogc3BlY2lmaWVkIHNuYXBzaG90IHRpbWVzdGFtcC4KICAgICAgICAgKiBQcm92aWRlICIiIHdpbGwgcmVtb3ZlIHRoZSBzbmFwc2hvdCBhbmQgcmV0dXJuIGEgVVJMIHRvIHRoZSBiYXNlIGJsb2IuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gc25hcHNob3QKICAgICAgICAgKiBAcmV0dXJucyB7QmxvY2tCbG9iVVJMfQogICAgICAgICAqIEBtZW1iZXJvZiBCbG9ja0Jsb2JVUkwKICAgICAgICAgKi8KICAgICAgICBCbG9ja0Jsb2JVUkwucHJvdG90eXBlLndpdGhTbmFwc2hvdCA9IGZ1bmN0aW9uIChzbmFwc2hvdCkgewogICAgICAgICAgICByZXR1cm4gbmV3IEJsb2NrQmxvYlVSTChzZXRVUkxQYXJhbWV0ZXIodGhpcy51cmwsIFVSTENvbnN0YW50cy5QYXJhbWV0ZXJzLlNOQVBTSE9ULCBzbmFwc2hvdC5sZW5ndGggPT09IDAgPyB1bmRlZmluZWQgOiBzbmFwc2hvdCksIHRoaXMucGlwZWxpbmUpOwogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogQ3JlYXRlcyBhIG5ldyBibG9jayBibG9iLCBvciB1cGRhdGVzIHRoZSBjb250ZW50IG9mIGFuIGV4aXN0aW5nIGJsb2NrIGJsb2IuCiAgICAgICAgICogVXBkYXRpbmcgYW4gZXhpc3RpbmcgYmxvY2sgYmxvYiBvdmVyd3JpdGVzIGFueSBleGlzdGluZyBtZXRhZGF0YSBvbiB0aGUgYmxvYi4KICAgICAgICAgKiBQYXJ0aWFsIHVwZGF0ZXMgYXJlIG5vdCBzdXBwb3J0ZWQ7IHRoZSBjb250ZW50IG9mIHRoZSBleGlzdGluZyBibG9iIGlzCiAgICAgICAgICogb3ZlcndyaXR0ZW4gd2l0aCB0aGUgbmV3IGNvbnRlbnQuIFRvIHBlcmZvcm0gYSBwYXJ0aWFsIHVwZGF0ZSBvZiBhIGJsb2NrIGJsb2IncywKICAgICAgICAgKiB1c2Ugc3RhZ2VCbG9jayBhbmQgY29tbWl0QmxvY2tMaXN0LgogICAgICAgICAqCiAgICAgICAgICogVGhpcyBpcyBhIG5vbi1wYXJhbGxlbCB1cGxvYWRpbmcgbWV0aG9kLCBwbGVhc2UgdXNlIHVwbG9hZEZpbGVUb0Jsb2NrQmxvYigpLAogICAgICAgICAqIHVwbG9hZFN0cmVhbVRvQmxvY2tCbG9iKCkgb3IgdXBsb2FkQnJvd3NlckRhdGFUb0Jsb2NrQmxvYigpIGZvciBiZXR0ZXIgcGVyZm9ybWFuY2UKICAgICAgICAgKiB3aXRoIGNvbmN1cnJlbmN5IHVwbG9hZGluZy4KICAgICAgICAgKgogICAgICAgICAqIEBzZWUgaHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vcmVzdC9hcGkvc3RvcmFnZXNlcnZpY2VzL3B1dC1ibG9iCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge0Fib3J0ZXJ9IGFib3J0ZXIgQ3JlYXRlIGEgbmV3IEFib3J0ZXIgaW5zdGFuY2Ugd2l0aCBBYm9ydGVyLm5vbmUgb3IgQWJvcnRlci50aW1lb3V0KCksCiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgIGdvdG8gZG9jdW1lbnRzIG9mIEFib3J0ZXIgZm9yIG1vcmUgZXhhbXBsZXMgYWJvdXQgcmVxdWVzdCBjYW5jZWxsYXRpb24KICAgICAgICAgKiBAcGFyYW0ge0h0dHBSZXF1ZXN0Qm9keX0gYm9keSBCbG9iLCBzdHJpbmcsIEFycmF5QnVmZmVyLCBBcnJheUJ1ZmZlclZpZXcgb3IgYSBmdW5jdGlvbgogICAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWNoIHJldHVybnMgYSBuZXcgUmVhZGFibGUgc3RyZWFtIHdob3NlIG9mZnNldCBpcyBmcm9tIGRhdGEgc291cmNlIGJlZ2lubmluZy4KICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gY29udGVudExlbmd0aCBMZW5ndGggb2YgYm9keSBpbiBieXRlcy4gVXNlIEJ1ZmZlci5ieXRlTGVuZ3RoKCkgdG8gY2FsY3VsYXRlIGJvZHkgbGVuZ3RoIGZvciBhCiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nIGluY2x1ZGluZyBub24gbm9uLUJhc2U2NC9IZXgtZW5jb2RlZCBjaGFyYWN0ZXJzLgogICAgICAgICAqIEBwYXJhbSB7SUJsb2NrQmxvYlVwbG9hZE9wdGlvbnN9IFtvcHRpb25zXQogICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlPE1vZGVscy5CbG9ja0Jsb2JVcGxvYWRSZXNwb25zZT59CiAgICAgICAgICogQG1lbWJlcm9mIEJsb2NrQmxvYlVSTAogICAgICAgICAqLwogICAgICAgIEJsb2NrQmxvYlVSTC5wcm90b3R5cGUudXBsb2FkID0gZnVuY3Rpb24gKGFib3J0ZXIsIGJvZHksIGNvbnRlbnRMZW5ndGgsIG9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgeyBvcHRpb25zID0ge307IH0KICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkgewogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYWNjZXNzQ29uZGl0aW9ucyA9IG9wdGlvbnMuYWNjZXNzQ29uZGl0aW9ucyB8fCB7fTsKICAgICAgICAgICAgICAgICAgICBlbnN1cmVDcGtJZlNwZWNpZmllZChvcHRpb25zLmN1c3RvbWVyUHJvdmlkZWRLZXksIHRoaXMuaXNIdHRwcyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHRoaXMuYmxvY2tCbG9iQ29udGV4dC51cGxvYWQoYm9keSwgY29udGVudExlbmd0aCwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWJvcnRTaWduYWw6IGFib3J0ZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBibG9iSFRUUEhlYWRlcnM6IG9wdGlvbnMuYmxvYkhUVFBIZWFkZXJzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVhc2VBY2Nlc3NDb25kaXRpb25zOiBvcHRpb25zLmFjY2Vzc0NvbmRpdGlvbnMubGVhc2VBY2Nlc3NDb25kaXRpb25zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGE6IG9wdGlvbnMubWV0YWRhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RpZmllZEFjY2Vzc0NvbmRpdGlvbnM6IG9wdGlvbnMuYWNjZXNzQ29uZGl0aW9ucy5tb2RpZmllZEFjY2Vzc0NvbmRpdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblVwbG9hZFByb2dyZXNzOiBvcHRpb25zLnByb2dyZXNzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3BrSW5mbzogb3B0aW9ucy5jdXN0b21lclByb3ZpZGVkS2V5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGllcjogdG9BY2Nlc3NUaWVyKG9wdGlvbnMudGllcikKICAgICAgICAgICAgICAgICAgICAgICAgfSldOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogVXBsb2FkcyB0aGUgc3BlY2lmaWVkIGJsb2NrIHRvIHRoZSBibG9jayBibG9iJ3MgInN0YWdpbmcgYXJlYSIgdG8gYmUgbGF0ZXIKICAgICAgICAgKiBjb21taXR0ZWQgYnkgYSBjYWxsIHRvIGNvbW1pdEJsb2NrTGlzdC4KICAgICAgICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5taWNyb3NvZnQuY29tL3Jlc3QvYXBpL3N0b3JhZ2VzZXJ2aWNlcy9wdXQtYmxvY2sKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7QWJvcnRlcn0gYWJvcnRlciBDcmVhdGUgYSBuZXcgQWJvcnRlciBpbnN0YW5jZSB3aXRoIEFib3J0ZXIubm9uZSBvciBBYm9ydGVyLnRpbWVvdXQoKSwKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgZ290byBkb2N1bWVudHMgb2YgQWJvcnRlciBmb3IgbW9yZSBleGFtcGxlcyBhYm91dCByZXF1ZXN0IGNhbmNlbGxhdGlvbgogICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBibG9ja0lkIEEgNjQtYnl0ZSB2YWx1ZSB0aGF0IGlzIGJhc2U2NC1lbmNvZGVkCiAgICAgICAgICogQHBhcmFtIHtIdHRwUmVxdWVzdEJvZHl9IGJvZHkKICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gY29udGVudExlbmd0aAogICAgICAgICAqIEBwYXJhbSB7SUJsb2NrQmxvYlN0YWdlQmxvY2tPcHRpb25zfSBbb3B0aW9uc10KICAgICAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxNb2RlbHMuQmxvY2tCbG9iU3RhZ2VCbG9ja1Jlc3BvbnNlPn0KICAgICAgICAgKiBAbWVtYmVyb2YgQmxvY2tCbG9iVVJMCiAgICAgICAgICovCiAgICAgICAgQmxvY2tCbG9iVVJMLnByb3RvdHlwZS5zdGFnZUJsb2NrID0gZnVuY3Rpb24gKGFib3J0ZXIsIGJsb2NrSWQsIGJvZHksIGNvbnRlbnRMZW5ndGgsIG9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgeyBvcHRpb25zID0ge307IH0KICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkgewogICAgICAgICAgICAgICAgICAgIGVuc3VyZUNwa0lmU3BlY2lmaWVkKG9wdGlvbnMuY3VzdG9tZXJQcm92aWRlZEtleSwgdGhpcy5pc0h0dHBzKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgdGhpcy5ibG9ja0Jsb2JDb250ZXh0LnN0YWdlQmxvY2soYmxvY2tJZCwgY29udGVudExlbmd0aCwgYm9keSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWJvcnRTaWduYWw6IGFib3J0ZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWFzZUFjY2Vzc0NvbmRpdGlvbnM6IG9wdGlvbnMubGVhc2VBY2Nlc3NDb25kaXRpb25zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb25VcGxvYWRQcm9ncmVzczogb3B0aW9ucy5wcm9ncmVzcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uYWxDb250ZW50TUQ1OiBvcHRpb25zLnRyYW5zYWN0aW9uYWxDb250ZW50TUQ1LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25hbENvbnRlbnRDcmM2NDogb3B0aW9ucy50cmFuc2FjdGlvbmFsQ29udGVudENyYzY0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3BrSW5mbzogb3B0aW9ucy5jdXN0b21lclByb3ZpZGVkS2V5CiAgICAgICAgICAgICAgICAgICAgICAgIH0pXTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICAgIC8qKgogICAgICAgICAqIFRoZSBTdGFnZSBCbG9jayBGcm9tIFVSTCBvcGVyYXRpb24gY3JlYXRlcyBhIG5ldyBibG9jayB0byBiZSBjb21taXR0ZWQgYXMgcGFydAogICAgICAgICAqIG9mIGEgYmxvYiB3aGVyZSB0aGUgY29udGVudHMgYXJlIHJlYWQgZnJvbSBhIFVSTC4KICAgICAgICAgKiBUaGlzIEFQSSBpcyBhdmFpbGFibGUgc3RhcnRpbmcgaW4gdmVyc2lvbiAyMDE4LTAzLTI4LgogICAgICAgICAqIEBzZWUgaHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvcmVzdC9hcGkvc3RvcmFnZXNlcnZpY2VzL3B1dC1ibG9jay1mcm9tLXVybAogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtBYm9ydGVyfSBhYm9ydGVyIENyZWF0ZSBhIG5ldyBBYm9ydGVyIGluc3RhbmNlIHdpdGggQWJvcnRlci5ub25lIG9yIEFib3J0ZXIudGltZW91dCgpLAogICAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICBnb3RvIGRvY3VtZW50cyBvZiBBYm9ydGVyIGZvciBtb3JlIGV4YW1wbGVzIGFib3V0IHJlcXVlc3QgY2FuY2VsbGF0aW9uCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IGJsb2NrSWQgQSA2NC1ieXRlIHZhbHVlIHRoYXQgaXMgYmFzZTY0LWVuY29kZWQKICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gc291cmNlVVJMIFNwZWNpZmllcyB0aGUgVVJMIG9mIHRoZSBibG9iLiBUaGUgdmFsdWUKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heSBiZSBhIFVSTCBvZiB1cCB0byAyIEtCIGluIGxlbmd0aCB0aGF0IHNwZWNpZmllcyBhIGJsb2IuCiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICBUaGUgdmFsdWUgc2hvdWxkIGJlIFVSTC1lbmNvZGVkIGFzIGl0IHdvdWxkIGFwcGVhcgogICAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgaW4gYSByZXF1ZXN0IFVSSS4gVGhlIHNvdXJjZSBibG9iIG11c3QgZWl0aGVyIGJlIHB1YmxpYwogICAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgb3IgbXVzdCBiZSBhdXRoZW50aWNhdGVkIHZpYSBhIHNoYXJlZCBhY2Nlc3Mgc2lnbmF0dXJlLgogICAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgSWYgdGhlIHNvdXJjZSBibG9iIGlzIHB1YmxpYywgbm8gYXV0aGVudGljYXRpb24gaXMgcmVxdWlyZWQKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvIHBlcmZvcm0gdGhlIG9wZXJhdGlvbi4gSGVyZSBhcmUgc29tZSBleGFtcGxlcyBvZiBzb3VyY2Ugb2JqZWN0IFVSTHM6CiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAtIGh0dHBzOi8vbXlhY2NvdW50LmJsb2IuY29yZS53aW5kb3dzLm5ldC9teWNvbnRhaW5lci9teWJsb2IKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgIC0gaHR0cHM6Ly9teWFjY291bnQuYmxvYi5jb3JlLndpbmRvd3MubmV0L215Y29udGFpbmVyL215YmxvYj9zbmFwc2hvdD08RGF0ZVRpbWU+CiAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IG9mZnNldCBGcm9tIHdoaWNoIHBvc2l0aW9uIG9mIHRoZSBibG9iIHRvIGRvd25sb2FkLCA+PSAwCiAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IFtjb3VudF0gSG93IG11Y2ggZGF0YSB0byBiZSBkb3dubG9hZGVkLCA+IDAuIFdpbGwgZG93bmxvYWQgdG8gdGhlIGVuZCB3aGVuIHVuZGVmaW5lZAogICAgICAgICAqIEBwYXJhbSB7SUJsb2NrQmxvYlN0YWdlQmxvY2tGcm9tVVJMT3B0aW9uc30gW29wdGlvbnM9e31dCiAgICAgICAgICogQHJldHVybnMge1Byb21pc2U8TW9kZWxzLkJsb2NrQmxvYlN0YWdlQmxvY2tGcm9tVVJMUmVzcG9uc2U+fQogICAgICAgICAqIEBtZW1iZXJvZiBCbG9ja0Jsb2JVUkwKICAgICAgICAgKi8KICAgICAgICBCbG9ja0Jsb2JVUkwucHJvdG90eXBlLnN0YWdlQmxvY2tGcm9tVVJMID0gZnVuY3Rpb24gKGFib3J0ZXIsIGJsb2NrSWQsIHNvdXJjZVVSTCwgb2Zmc2V0LCBjb3VudCwgb3B0aW9ucykgewogICAgICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7IG9wdGlvbnMgPSB7fTsgfQogICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7CiAgICAgICAgICAgICAgICAgICAgZW5zdXJlQ3BrSWZTcGVjaWZpZWQob3B0aW9ucy5jdXN0b21lclByb3ZpZGVkS2V5LCB0aGlzLmlzSHR0cHMpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCB0aGlzLmJsb2NrQmxvYkNvbnRleHQuc3RhZ2VCbG9ja0Zyb21VUkwoYmxvY2tJZCwgMCwgc291cmNlVVJMLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYm9ydFNpZ25hbDogYWJvcnRlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlYXNlQWNjZXNzQ29uZGl0aW9uczogb3B0aW9ucy5sZWFzZUFjY2Vzc0NvbmRpdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VDb250ZW50TUQ1OiBvcHRpb25zLnNvdXJjZUNvbnRlbnRNRDUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VDb250ZW50Q3JjNjQ6IG9wdGlvbnMuc291cmNlQ29udGVudENyYzY0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlUmFuZ2U6IG9mZnNldCA9PT0gMCAmJiAhY291bnQgPyB1bmRlZmluZWQgOiByYW5nZVRvU3RyaW5nKHsgb2Zmc2V0OiBvZmZzZXQsIGNvdW50OiBjb3VudCB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNwa0luZm86IG9wdGlvbnMuY3VzdG9tZXJQcm92aWRlZEtleQogICAgICAgICAgICAgICAgICAgICAgICB9KV07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBXcml0ZXMgYSBibG9iIGJ5IHNwZWNpZnlpbmcgdGhlIGxpc3Qgb2YgYmxvY2sgSURzIHRoYXQgbWFrZSB1cCB0aGUgYmxvYi4KICAgICAgICAgKiBJbiBvcmRlciB0byBiZSB3cml0dGVuIGFzIHBhcnQgb2YgYSBibG9iLCBhIGJsb2NrIG11c3QgaGF2ZSBiZWVuIHN1Y2Nlc3NmdWxseSB3cml0dGVuCiAgICAgICAgICogdG8gdGhlIHNlcnZlciBpbiBhIHByaW9yIHN0YWdlQmxvY2sgb3BlcmF0aW9uLiBZb3UgY2FuIGNhbGwgY29tbWl0QmxvY2tMaXN0IHRvIHVwZGF0ZSBhIGJsb2IKICAgICAgICAgKiBieSB1cGxvYWRpbmcgb25seSB0aG9zZSBibG9ja3MgdGhhdCBoYXZlIGNoYW5nZWQsIHRoZW4gY29tbWl0dGluZyB0aGUgbmV3IGFuZCBleGlzdGluZwogICAgICAgICAqIGJsb2NrcyB0b2dldGhlci4gQW55IGJsb2NrcyBub3Qgc3BlY2lmaWVkIGluIHRoZSBibG9jayBsaXN0IGFuZCBwZXJtYW5lbnRseSBkZWxldGVkLgogICAgICAgICAqIEBzZWUgaHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vcmVzdC9hcGkvc3RvcmFnZXNlcnZpY2VzL3B1dC1ibG9jay1saXN0CiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge0Fib3J0ZXJ9IGFib3J0ZXIgQ3JlYXRlIGEgbmV3IEFib3J0ZXIgaW5zdGFuY2Ugd2l0aCBBYm9ydGVyLm5vbmUgb3IgQWJvcnRlci50aW1lb3V0KCksCiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgIGdvdG8gZG9jdW1lbnRzIG9mIEFib3J0ZXIgZm9yIG1vcmUgZXhhbXBsZXMgYWJvdXQgcmVxdWVzdCBjYW5jZWxsYXRpb24KICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ1tdfSBibG9ja3MgIEFycmF5IG9mIDY0LWJ5dGUgdmFsdWUgdGhhdCBpcyBiYXNlNjQtZW5jb2RlZAogICAgICAgICAqIEBwYXJhbSB7SUJsb2NrQmxvYkNvbW1pdEJsb2NrTGlzdE9wdGlvbnN9IFtvcHRpb25zXQogICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlPE1vZGVscy5CbG9ja0Jsb2JDb21taXRCbG9ja0xpc3RSZXNwb25zZT59CiAgICAgICAgICogQG1lbWJlcm9mIEJsb2NrQmxvYlVSTAogICAgICAgICAqLwogICAgICAgIEJsb2NrQmxvYlVSTC5wcm90b3R5cGUuY29tbWl0QmxvY2tMaXN0ID0gZnVuY3Rpb24gKGFib3J0ZXIsIGJsb2Nrcywgb3B0aW9ucykgewogICAgICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7IG9wdGlvbnMgPSB7fTsgfQogICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7CiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5hY2Nlc3NDb25kaXRpb25zID0gb3B0aW9ucy5hY2Nlc3NDb25kaXRpb25zIHx8IHt9OwogICAgICAgICAgICAgICAgICAgIGVuc3VyZUNwa0lmU3BlY2lmaWVkKG9wdGlvbnMuY3VzdG9tZXJQcm92aWRlZEtleSwgdGhpcy5pc0h0dHBzKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgdGhpcy5ibG9ja0Jsb2JDb250ZXh0LmNvbW1pdEJsb2NrTGlzdCh7IGxhdGVzdDogYmxvY2tzIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFib3J0U2lnbmFsOiBhYm9ydGVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxvYkhUVFBIZWFkZXJzOiBvcHRpb25zLmJsb2JIVFRQSGVhZGVycywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlYXNlQWNjZXNzQ29uZGl0aW9uczogb3B0aW9ucy5hY2Nlc3NDb25kaXRpb25zLmxlYXNlQWNjZXNzQ29uZGl0aW9ucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhOiBvcHRpb25zLm1ldGFkYXRhLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zOiBvcHRpb25zLmFjY2Vzc0NvbmRpdGlvbnMubW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3BrSW5mbzogb3B0aW9ucy5jdXN0b21lclByb3ZpZGVkS2V5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGllcjogdG9BY2Nlc3NUaWVyKG9wdGlvbnMudGllcikKICAgICAgICAgICAgICAgICAgICAgICAgfSldOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJucyB0aGUgbGlzdCBvZiBibG9ja3MgdGhhdCBoYXZlIGJlZW4gdXBsb2FkZWQgYXMgcGFydCBvZiBhIGJsb2NrIGJsb2IKICAgICAgICAgKiB1c2luZyB0aGUgc3BlY2lmaWVkIGJsb2NrIGxpc3QgZmlsdGVyLgogICAgICAgICAqIEBzZWUgaHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vcmVzdC9hcGkvc3RvcmFnZXNlcnZpY2VzL2dldC1ibG9jay1saXN0CiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge0Fib3J0ZXJ9IGFib3J0ZXIgQ3JlYXRlIGEgbmV3IEFib3J0ZXIgaW5zdGFuY2Ugd2l0aCBBYm9ydGVyLm5vbmUgb3IgQWJvcnRlci50aW1lb3V0KCksCiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgIGdvdG8gZG9jdW1lbnRzIG9mIEFib3J0ZXIgZm9yIG1vcmUgZXhhbXBsZXMgYWJvdXQgcmVxdWVzdCBjYW5jZWxsYXRpb24KICAgICAgICAgKiBAcGFyYW0ge01vZGVscy5CbG9ja0xpc3RUeXBlfSBsaXN0VHlwZQogICAgICAgICAqIEBwYXJhbSB7SUJsb2NrQmxvYkdldEJsb2NrTGlzdE9wdGlvbnN9IFtvcHRpb25zXQogICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlPE1vZGVscy5CbG9ja0Jsb2JHZXRCbG9ja0xpc3RSZXNwb25zZT59CiAgICAgICAgICogQG1lbWJlcm9mIEJsb2NrQmxvYlVSTAogICAgICAgICAqLwogICAgICAgIEJsb2NrQmxvYlVSTC5wcm90b3R5cGUuZ2V0QmxvY2tMaXN0ID0gZnVuY3Rpb24gKGFib3J0ZXIsIGxpc3RUeXBlLCBvcHRpb25zKSB7CiAgICAgICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsgb3B0aW9ucyA9IHt9OyB9CiAgICAgICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciByZXM7CiAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6IHJldHVybiBbNCAvKnlpZWxkKi8sIHRoaXMuYmxvY2tCbG9iQ29udGV4dC5nZXRCbG9ja0xpc3QobGlzdFR5cGUsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYm9ydFNpZ25hbDogYWJvcnRlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWFzZUFjY2Vzc0NvbmRpdGlvbnM6IG9wdGlvbnMubGVhc2VBY2Nlc3NDb25kaXRpb25zCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KV07CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcyA9IF9hLnNlbnQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzLmNvbW1pdHRlZEJsb2NrcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcy5jb21taXR0ZWRCbG9ja3MgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzLnVuY29tbWl0dGVkQmxvY2tzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzLnVuY29tbWl0dGVkQmxvY2tzID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgcmVzXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gQmxvY2tCbG9iVVJMOwogICAgfShCbG9iVVJMKSk7CgogICAgLyoqCiAgICAgKiBBIENvbnRhaW5lclVSTCByZXByZXNlbnRzIGEgVVJMIHRvIHRoZSBBenVyZSBTdG9yYWdlIGNvbnRhaW5lciBhbGxvd2luZyB5b3UgdG8gbWFuaXB1bGF0ZSBpdHMgYmxvYnMuCiAgICAgKgogICAgICogQGV4cG9ydAogICAgICogQGNsYXNzIENvbnRhaW5lclVSTAogICAgICogQGV4dGVuZHMge1N0b3JhZ2VVUkx9CiAgICAgKi8KICAgIHZhciBDb250YWluZXJVUkwgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CiAgICAgICAgX19leHRlbmRzKENvbnRhaW5lclVSTCwgX3N1cGVyKTsKICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIENvbnRhaW5lclVSTC4KICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsIEEgVVJMIHN0cmluZyBwb2ludGluZyB0byBBenVyZSBTdG9yYWdlIGJsb2IgY29udGFpbmVyLCBzdWNoIGFzCiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICAiaHR0cHM6Ly9teWFjY291bnQuYmxvYi5jb3JlLndpbmRvd3MubmV0L215Y29udGFpbmVyIi4gWW91IGNhbgogICAgICAgICAqICAgICAgICAgICAgICAgICAgICAgYXBwZW5kIGEgU0FTIGlmIHVzaW5nIEFub255bW91c0NyZWRlbnRpYWwsIHN1Y2ggYXMKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICJodHRwczovL215YWNjb3VudC5ibG9iLmNvcmUud2luZG93cy5uZXQvbXljb250YWluZXI/c2FzU3RyaW5nIi4KICAgICAgICAgKiBAcGFyYW0ge1BpcGVsaW5lfSBwaXBlbGluZSBDYWxsIFN0b3JhZ2VVUkwubmV3UGlwZWxpbmUoKSB0byBjcmVhdGUgYSBkZWZhdWx0CiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGlwZWxpbmUsIG9yIHByb3ZpZGUgYSBjdXN0b21pemVkIHBpcGVsaW5lLgogICAgICAgICAqIEBtZW1iZXJvZiBDb250YWluZXJVUkwKICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBDb250YWluZXJVUkwodXJsLCBwaXBlbGluZSkgewogICAgICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCB1cmwsIHBpcGVsaW5lKSB8fCB0aGlzOwogICAgICAgICAgICBfdGhpcy5jb250YWluZXJDb250ZXh0ID0gbmV3IENvbnRhaW5lcihfdGhpcy5zdG9yYWdlQ2xpZW50Q29udGV4dCk7CiAgICAgICAgICAgIHJldHVybiBfdGhpczsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQ3JlYXRlcyBhIENvbnRhaW5lclVSTCBvYmplY3QgZnJvbSBTZXJ2aWNlVVJMCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gc2VydmljZVVSTCBBIFNlcnZpY2VVUkwgb2JqZWN0CiAgICAgICAgICogQHBhcmFtIGNvbnRhaW5lck5hbWUgQSBjb250YWluZXIgbmFtZQogICAgICAgICAqLwogICAgICAgIENvbnRhaW5lclVSTC5mcm9tU2VydmljZVVSTCA9IGZ1bmN0aW9uIChzZXJ2aWNlVVJMLCBjb250YWluZXJOYW1lKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgQ29udGFpbmVyVVJMKGFwcGVuZFRvVVJMUGF0aChzZXJ2aWNlVVJMLnVybCwgZW5jb2RlVVJJQ29tcG9uZW50KGNvbnRhaW5lck5hbWUpKSwgc2VydmljZVVSTC5waXBlbGluZSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGVzIGEgbmV3IENvbnRhaW5lclVSTCBvYmplY3QgaWRlbnRpY2FsIHRvIHRoZSBzb3VyY2UgYnV0IHdpdGggdGhlCiAgICAgICAgICogc3BlY2lmaWVkIHJlcXVlc3QgcG9saWN5IHBpcGVsaW5lLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtQaXBlbGluZX0gcGlwZWxpbmUKICAgICAgICAgKiBAcmV0dXJucyB7Q29udGFpbmVyVVJMfQogICAgICAgICAqIEBtZW1iZXJvZiBDb250YWluZXJVUkwKICAgICAgICAgKi8KICAgICAgICBDb250YWluZXJVUkwucHJvdG90eXBlLndpdGhQaXBlbGluZSA9IGZ1bmN0aW9uIChwaXBlbGluZSkgewogICAgICAgICAgICByZXR1cm4gbmV3IENvbnRhaW5lclVSTCh0aGlzLnVybCwgcGlwZWxpbmUpOwogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogQ3JlYXRlcyBhIG5ldyBjb250YWluZXIgdW5kZXIgdGhlIHNwZWNpZmllZCBhY2NvdW50LiBJZiB0aGUgY29udGFpbmVyIHdpdGgKICAgICAgICAgKiB0aGUgc2FtZSBuYW1lIGFscmVhZHkgZXhpc3RzLCB0aGUgb3BlcmF0aW9uIGZhaWxzLgogICAgICAgICAqIEBzZWUgaHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvcmVzdC9hcGkvc3RvcmFnZXNlcnZpY2VzL2NyZWF0ZS1jb250YWluZXIKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7QWJvcnRlcn0gYWJvcnRlciBDcmVhdGUgYSBuZXcgQWJvcnRlciBpbnN0YW5jZSB3aXRoIEFib3J0ZXIubm9uZSBvciBBYm9ydGVyLnRpbWVvdXQoKSwKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgZ290byBkb2N1bWVudHMgb2YgQWJvcnRlciBmb3IgbW9yZSBleGFtcGxlcyBhYm91dCByZXF1ZXN0IGNhbmNlbGxhdGlvbgogICAgICAgICAqIEBwYXJhbSB7SUNvbnRhaW5lckNyZWF0ZU9wdGlvbnN9IFtvcHRpb25zXQogICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlPE1vZGVscy5Db250YWluZXJDcmVhdGVSZXNwb25zZT59CiAgICAgICAgICogQG1lbWJlcm9mIENvbnRhaW5lclVSTAogICAgICAgICAqLwogICAgICAgIENvbnRhaW5lclVSTC5wcm90b3R5cGUuY3JlYXRlID0gZnVuY3Rpb24gKGFib3J0ZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgeyBvcHRpb25zID0ge307IH0KICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkgewogICAgICAgICAgICAgICAgICAgIC8vIFNwcmVhZCBvcGVyYXRvciBpbiBkZXN0cnVjdHVyaW5nIGFzc2lnbm1lbnRzLAogICAgICAgICAgICAgICAgICAgIC8vIHRoaXMgd2lsbCBmaWx0ZXIgb3V0IHVud2FudGVkIHByb3BlcnRpZXMgZnJvbSB0aGUgcmVzcG9uc2Ugb2JqZWN0IGludG8gcmVzdWx0IG9iamVjdAogICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCB0aGlzLmNvbnRhaW5lckNvbnRleHQuY3JlYXRlKF9fYXNzaWduKHt9LCBvcHRpb25zLCB7IGFib3J0U2lnbmFsOiBhYm9ydGVyIH0pKV07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm5zIGFsbCB1c2VyLWRlZmluZWQgbWV0YWRhdGEgYW5kIHN5c3RlbSBwcm9wZXJ0aWVzIGZvciB0aGUgc3BlY2lmaWVkCiAgICAgICAgICogY29udGFpbmVyLiBUaGUgZGF0YSByZXR1cm5lZCBkb2VzIG5vdCBpbmNsdWRlIHRoZSBjb250YWluZXIncyBsaXN0IG9mIGJsb2JzLgogICAgICAgICAqIEBzZWUgaHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvcmVzdC9hcGkvc3RvcmFnZXNlcnZpY2VzL2dldC1jb250YWluZXItcHJvcGVydGllcwogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtBYm9ydGVyfSBhYm9ydGVyIENyZWF0ZSBhIG5ldyBBYm9ydGVyIGluc3RhbmNlIHdpdGggQWJvcnRlci5ub25lIG9yIEFib3J0ZXIudGltZW91dCgpLAogICAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICBnb3RvIGRvY3VtZW50cyBvZiBBYm9ydGVyIGZvciBtb3JlIGV4YW1wbGVzIGFib3V0IHJlcXVlc3QgY2FuY2VsbGF0aW9uCiAgICAgICAgICogQHBhcmFtIHtJQ29udGFpbmVyc0dldFByb3BlcnRpZXNPcHRpb25zfSBbb3B0aW9uc10KICAgICAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxNb2RlbHMuQ29udGFpbmVyR2V0UHJvcGVydGllc1Jlc3BvbnNlPn0KICAgICAgICAgKiBAbWVtYmVyb2YgQ29udGFpbmVyVVJMCiAgICAgICAgICovCiAgICAgICAgQ29udGFpbmVyVVJMLnByb3RvdHlwZS5nZXRQcm9wZXJ0aWVzID0gZnVuY3Rpb24gKGFib3J0ZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgeyBvcHRpb25zID0ge307IH0KICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkgewogICAgICAgICAgICAgICAgICAgIGlmICghb3B0aW9ucy5sZWFzZUFjY2Vzc0NvbmRpdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5sZWFzZUFjY2Vzc0NvbmRpdGlvbnMgPSB7fTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHRoaXMuY29udGFpbmVyQ29udGV4dC5nZXRQcm9wZXJ0aWVzKF9fYXNzaWduKHsgYWJvcnRTaWduYWw6IGFib3J0ZXIgfSwgb3B0aW9ucy5sZWFzZUFjY2Vzc0NvbmRpdGlvbnMpKV07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBNYXJrcyB0aGUgc3BlY2lmaWVkIGNvbnRhaW5lciBmb3IgZGVsZXRpb24uIFRoZSBjb250YWluZXIgYW5kIGFueSBibG9icwogICAgICAgICAqIGNvbnRhaW5lZCB3aXRoaW4gaXQgYXJlIGxhdGVyIGRlbGV0ZWQgZHVyaW5nIGdhcmJhZ2UgY29sbGVjdGlvbi4KICAgICAgICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5taWNyb3NvZnQuY29tL2VuLXVzL3Jlc3QvYXBpL3N0b3JhZ2VzZXJ2aWNlcy9kZWxldGUtY29udGFpbmVyCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge0Fib3J0ZXJ9IGFib3J0ZXIgQ3JlYXRlIGEgbmV3IEFib3J0ZXIgaW5zdGFuY2Ugd2l0aCBBYm9ydGVyLm5vbmUgb3IgQWJvcnRlci50aW1lb3V0KCksCiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgIGdvdG8gZG9jdW1lbnRzIG9mIEFib3J0ZXIgZm9yIG1vcmUgZXhhbXBsZXMgYWJvdXQgcmVxdWVzdCBjYW5jZWxsYXRpb24KICAgICAgICAgKiBAcGFyYW0ge01vZGVscy5Db250YWluZXJzRGVsZXRlTWV0aG9kT3B0aW9uYWxQYXJhbXN9IFtvcHRpb25zXQogICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlPE1vZGVscy5Db250YWluZXJEZWxldGVSZXNwb25zZT59CiAgICAgICAgICogQG1lbWJlcm9mIENvbnRhaW5lclVSTAogICAgICAgICAqLwogICAgICAgIENvbnRhaW5lclVSTC5wcm90b3R5cGUuZGVsZXRlID0gZnVuY3Rpb24gKGFib3J0ZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgeyBvcHRpb25zID0ge307IH0KICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkgewogICAgICAgICAgICAgICAgICAgIGlmICghb3B0aW9ucy5jb250YWluZXJBY2Nlc3NDb25kaXRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuY29udGFpbmVyQWNjZXNzQ29uZGl0aW9ucyA9IHt9OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoIW9wdGlvbnMuY29udGFpbmVyQWNjZXNzQ29uZGl0aW9ucy5tb2RpZmllZEFjY2Vzc0NvbmRpdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5jb250YWluZXJBY2Nlc3NDb25kaXRpb25zLm1vZGlmaWVkQWNjZXNzQ29uZGl0aW9ucyA9IHt9OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoIW9wdGlvbnMuY29udGFpbmVyQWNjZXNzQ29uZGl0aW9ucy5sZWFzZUFjY2Vzc0NvbmRpdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5jb250YWluZXJBY2Nlc3NDb25kaXRpb25zLmxlYXNlQWNjZXNzQ29uZGl0aW9ucyA9IHt9OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoKG9wdGlvbnMuY29udGFpbmVyQWNjZXNzQ29uZGl0aW9ucy5tb2RpZmllZEFjY2Vzc0NvbmRpdGlvbnMuaWZNYXRjaCAmJgogICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmNvbnRhaW5lckFjY2Vzc0NvbmRpdGlvbnMubW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zLmlmTWF0Y2ggIT09IEVUYWdOb25lKSB8fAogICAgICAgICAgICAgICAgICAgICAgICAob3B0aW9ucy5jb250YWluZXJBY2Nlc3NDb25kaXRpb25zLm1vZGlmaWVkQWNjZXNzQ29uZGl0aW9ucy5pZk5vbmVNYXRjaCAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5jb250YWluZXJBY2Nlc3NDb25kaXRpb25zLm1vZGlmaWVkQWNjZXNzQ29uZGl0aW9ucy5pZk5vbmVNYXRjaCAhPT0gRVRhZ05vbmUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCJ0aGUgSWZNYXRjaCBhbmQgSWZOb25lTWF0Y2ggYWNjZXNzIGNvbmRpdGlvbnMgbXVzdCBoYXZlIHRoZWlyIGRlZmF1bHRcCiAgICAgICAgdmFsdWVzIGJlY2F1c2UgdGhleSBhcmUgaWdub3JlZCBieSB0aGUgc2VydmljZSIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgdGhpcy5jb250YWluZXJDb250ZXh0LmRlbGV0ZU1ldGhvZCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYm9ydFNpZ25hbDogYWJvcnRlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlYXNlQWNjZXNzQ29uZGl0aW9uczogb3B0aW9ucy5jb250YWluZXJBY2Nlc3NDb25kaXRpb25zLmxlYXNlQWNjZXNzQ29uZGl0aW9ucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGlmaWVkQWNjZXNzQ29uZGl0aW9uczogb3B0aW9ucy5jb250YWluZXJBY2Nlc3NDb25kaXRpb25zLm1vZGlmaWVkQWNjZXNzQ29uZGl0aW9ucwogICAgICAgICAgICAgICAgICAgICAgICB9KV07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBTZXRzIG9uZSBvciBtb3JlIHVzZXItZGVmaW5lZCBuYW1lLXZhbHVlIHBhaXJzIGZvciB0aGUgc3BlY2lmaWVkIGNvbnRhaW5lci4KICAgICAgICAgKgogICAgICAgICAqIElmIG5vIG9wdGlvbiBwcm92aWRlZCwgb3Igbm8gbWV0YWRhdGEgZGVmaW5lZCBpbiB0aGUgcGFyYW1ldGVyLCB0aGUgY29udGFpbmVyCiAgICAgICAgICogbWV0YWRhdGEgd2lsbCBiZSByZW1vdmVkLgogICAgICAgICAqCiAgICAgICAgICogQHNlZSBodHRwczovL2RvY3MubWljcm9zb2Z0LmNvbS9lbi11cy9yZXN0L2FwaS9zdG9yYWdlc2VydmljZXMvc2V0LWNvbnRhaW5lci1tZXRhZGF0YQogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtBYm9ydGVyfSBhYm9ydGVyIENyZWF0ZSBhIG5ldyBBYm9ydGVyIGluc3RhbmNlIHdpdGggQWJvcnRlci5ub25lIG9yIEFib3J0ZXIudGltZW91dCgpLAogICAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICBnb3RvIGRvY3VtZW50cyBvZiBBYm9ydGVyIGZvciBtb3JlIGV4YW1wbGVzIGFib3V0IHJlcXVlc3QgY2FuY2VsbGF0aW9uCiAgICAgICAgICogQHBhcmFtIHtJTWV0YWRhdGF9IFttZXRhZGF0YV0gUmVwbGFjZSBleGlzdGluZyBtZXRhZGF0YSB3aXRoIHRoaXMgdmFsdWUuCiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSWYgbm8gdmFsdWUgcHJvdmlkZWQgdGhlIGV4aXN0aW5nIG1ldGFkYXRhIHdpbGwgYmUgcmVtb3ZlZC4KICAgICAgICAgKiBAcGFyYW0ge0lDb250YWluZXJTZXRNZXRhZGF0YU9wdGlvbnN9IFtvcHRpb25zXQogICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlPE1vZGVscy5Db250YWluZXJTZXRNZXRhZGF0YVJlc3BvbnNlPn0KICAgICAgICAgKiBAbWVtYmVyb2YgQ29udGFpbmVyVVJMCiAgICAgICAgICovCiAgICAgICAgQ29udGFpbmVyVVJMLnByb3RvdHlwZS5zZXRNZXRhZGF0YSA9IGZ1bmN0aW9uIChhYm9ydGVyLCBtZXRhZGF0YSwgb3B0aW9ucykgewogICAgICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7IG9wdGlvbnMgPSB7fTsgfQogICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFvcHRpb25zLmNvbnRhaW5lckFjY2Vzc0NvbmRpdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5jb250YWluZXJBY2Nlc3NDb25kaXRpb25zID0ge307CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICghb3B0aW9ucy5jb250YWluZXJBY2Nlc3NDb25kaXRpb25zLm1vZGlmaWVkQWNjZXNzQ29uZGl0aW9ucykgewogICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmNvbnRhaW5lckFjY2Vzc0NvbmRpdGlvbnMubW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zID0ge307CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICghb3B0aW9ucy5jb250YWluZXJBY2Nlc3NDb25kaXRpb25zLmxlYXNlQWNjZXNzQ29uZGl0aW9ucykgewogICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmNvbnRhaW5lckFjY2Vzc0NvbmRpdGlvbnMubGVhc2VBY2Nlc3NDb25kaXRpb25zID0ge307CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmNvbnRhaW5lckFjY2Vzc0NvbmRpdGlvbnMubW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zLmlmVW5tb2RpZmllZFNpbmNlIHx8CiAgICAgICAgICAgICAgICAgICAgICAgIChvcHRpb25zLmNvbnRhaW5lckFjY2Vzc0NvbmRpdGlvbnMubW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zLmlmTWF0Y2ggJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuY29udGFpbmVyQWNjZXNzQ29uZGl0aW9ucy5tb2RpZmllZEFjY2Vzc0NvbmRpdGlvbnMuaWZNYXRjaCAhPT0gRVRhZ05vbmUpIHx8CiAgICAgICAgICAgICAgICAgICAgICAgIChvcHRpb25zLmNvbnRhaW5lckFjY2Vzc0NvbmRpdGlvbnMubW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zLmlmTm9uZU1hdGNoICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmNvbnRhaW5lckFjY2Vzc0NvbmRpdGlvbnMubW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zLmlmTm9uZU1hdGNoICE9PSBFVGFnTm9uZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoInRoZSBJZlVubW9kaWZpZWRTaW5jZSwgSWZNYXRjaCwgYW5kIElmTm9uZU1hdGNoIG11c3QgaGF2ZSB0aGVpciBkZWZhdWx0IHZhbHVlc1wKICAgICAgICBiZWNhdXNlIHRoZXkgYXJlIGlnbm9yZWQgYnkgdGhlIGJsb2Igc2VydmljZSIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgdGhpcy5jb250YWluZXJDb250ZXh0LnNldE1ldGFkYXRhKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFib3J0U2lnbmFsOiBhYm9ydGVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVhc2VBY2Nlc3NDb25kaXRpb25zOiBvcHRpb25zLmNvbnRhaW5lckFjY2Vzc0NvbmRpdGlvbnMubGVhc2VBY2Nlc3NDb25kaXRpb25zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGE6IG1ldGFkYXRhLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zOiBvcHRpb25zLmNvbnRhaW5lckFjY2Vzc0NvbmRpdGlvbnMubW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zCiAgICAgICAgICAgICAgICAgICAgICAgIH0pXTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICAgIC8qKgogICAgICAgICAqIEdldHMgdGhlIHBlcm1pc3Npb25zIGZvciB0aGUgc3BlY2lmaWVkIGNvbnRhaW5lci4gVGhlIHBlcm1pc3Npb25zIGluZGljYXRlCiAgICAgICAgICogd2hldGhlciBjb250YWluZXIgZGF0YSBtYXkgYmUgYWNjZXNzZWQgcHVibGljbHkuCiAgICAgICAgICoKICAgICAgICAgKiBXQVJOSU5HOiBKYXZhU2NyaXB0IERhdGUgd2lsbCBwb3RlbnRpYWwgbG9zdCBwcmVjaXNpb24gd2hlbiBwYXJzaW5nIHN0YXJ0IGFuZCBleHBpcnkgc3RyaW5nLgogICAgICAgICAqIEZvciBleGFtcGxlLCBuZXcgRGF0ZSgiMjAxOC0xMi0zMVQwMzo0NDoyMy44ODI3ODkxWiIpLnRvSVNPU3RyaW5nKCkgd2lsbCBnZXQgIjIwMTgtMTItMzFUMDM6NDQ6MjMuODgyWiIuCiAgICAgICAgICoKICAgICAgICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5taWNyb3NvZnQuY29tL2VuLXVzL3Jlc3QvYXBpL3N0b3JhZ2VzZXJ2aWNlcy9nZXQtY29udGFpbmVyLWFjbAogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtBYm9ydGVyfSBhYm9ydGVyIENyZWF0ZSBhIG5ldyBBYm9ydGVyIGluc3RhbmNlIHdpdGggQWJvcnRlci5ub25lIG9yIEFib3J0ZXIudGltZW91dCgpLAogICAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICBnb3RvIGRvY3VtZW50cyBvZiBBYm9ydGVyIGZvciBtb3JlIGV4YW1wbGVzIGFib3V0IHJlcXVlc3QgY2FuY2VsbGF0aW9uCiAgICAgICAgICogQHBhcmFtIHtJQ29udGFpbmVyR2V0QWNjZXNzUG9saWN5T3B0aW9uc30gW29wdGlvbnNdCiAgICAgICAgICogQHJldHVybnMge1Byb21pc2U8Q29udGFpbmVyR2V0QWNjZXNzUG9saWN5UmVzcG9uc2U+fQogICAgICAgICAqIEBtZW1iZXJvZiBDb250YWluZXJVUkwKICAgICAgICAgKi8KICAgICAgICBDb250YWluZXJVUkwucHJvdG90eXBlLmdldEFjY2Vzc1BvbGljeSA9IGZ1bmN0aW9uIChhYm9ydGVyLCBvcHRpb25zKSB7CiAgICAgICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsgb3B0aW9ucyA9IHt9OyB9CiAgICAgICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSwgcmVzLCBfaSwgcmVzcG9uc2VfMSwgaWRlbnRpZmllciwgYWNjZXNzUG9saWN5OwogICAgICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFvcHRpb25zLmxlYXNlQWNjZXNzQ29uZGl0aW9ucykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMubGVhc2VBY2Nlc3NDb25kaXRpb25zID0ge307CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCB0aGlzLmNvbnRhaW5lckNvbnRleHQuZ2V0QWNjZXNzUG9saWN5KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWJvcnRTaWduYWw6IGFib3J0ZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlYXNlQWNjZXNzQ29uZGl0aW9uczogb3B0aW9ucy5sZWFzZUFjY2Vzc0NvbmRpdGlvbnMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KV07CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gX2Euc2VudCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9yZXNwb25zZTogcmVzcG9uc2UuX3Jlc3BvbnNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsb2JQdWJsaWNBY2Nlc3M6IHJlc3BvbnNlLmJsb2JQdWJsaWNBY2Nlc3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZTogcmVzcG9uc2UuZGF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlVGFnOiByZXNwb25zZS5lVGFnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yQ29kZTogcmVzcG9uc2UuZXJyb3JDb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RNb2RpZmllZDogcmVzcG9uc2UubGFzdE1vZGlmaWVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3RJZDogcmVzcG9uc2UucmVxdWVzdElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudFJlcXVlc3RJZDogcmVzcG9uc2UuY2xpZW50UmVxdWVzdElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25lZElkZW50aWZpZXJzOiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ZXJzaW9uOiByZXNwb25zZS52ZXJzaW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChfaSA9IDAsIHJlc3BvbnNlXzEgPSByZXNwb25zZTsgX2kgPCByZXNwb25zZV8xLmxlbmd0aDsgX2krKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkZW50aWZpZXIgPSByZXNwb25zZV8xW19pXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2Nlc3NQb2xpY3kgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBlcm1pc3Npb246IGlkZW50aWZpZXIuYWNjZXNzUG9saWN5LnBlcm1pc3Npb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWRlbnRpZmllci5hY2Nlc3NQb2xpY3kuZXhwaXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY2Vzc1BvbGljeS5leHBpcnkgPSBuZXcgRGF0ZShpZGVudGlmaWVyLmFjY2Vzc1BvbGljeS5leHBpcnkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWRlbnRpZmllci5hY2Nlc3NQb2xpY3kuc3RhcnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjZXNzUG9saWN5LnN0YXJ0ID0gbmV3IERhdGUoaWRlbnRpZmllci5hY2Nlc3NQb2xpY3kuc3RhcnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXMuc2lnbmVkSWRlbnRpZmllcnMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY2Vzc1BvbGljeTogYWNjZXNzUG9saWN5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogaWRlbnRpZmllci5pZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHJlc107CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogU2V0cyB0aGUgcGVybWlzc2lvbnMgZm9yIHRoZSBzcGVjaWZpZWQgY29udGFpbmVyLiBUaGUgcGVybWlzc2lvbnMgaW5kaWNhdGUKICAgICAgICAgKiB3aGV0aGVyIGJsb2JzIGluIGEgY29udGFpbmVyIG1heSBiZSBhY2Nlc3NlZCBwdWJsaWNseS4KICAgICAgICAgKgogICAgICAgICAqIFdoZW4geW91IHNldCBwZXJtaXNzaW9ucyBmb3IgYSBjb250YWluZXIsIHRoZSBleGlzdGluZyBwZXJtaXNzaW9ucyBhcmUgcmVwbGFjZWQuCiAgICAgICAgICogSWYgbm8gYWNjZXNzIG9yIGNvbnRhaW5lckFjbCBwcm92aWRlZCwgdGhlIGV4aXN0aW5nIGNvbnRhaW5lciBBQ0wgd2lsbCBiZQogICAgICAgICAqIHJlbW92ZWQuCiAgICAgICAgICogQHNlZSBodHRwczovL2RvY3MubWljcm9zb2Z0LmNvbS9lbi11cy9yZXN0L2FwaS9zdG9yYWdlc2VydmljZXMvc2V0LWNvbnRhaW5lci1hY2wKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7QWJvcnRlcn0gYWJvcnRlciBDcmVhdGUgYSBuZXcgQWJvcnRlciBpbnN0YW5jZSB3aXRoIEFib3J0ZXIubm9uZSBvciBBYm9ydGVyLnRpbWVvdXQoKSwKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgZ290byBkb2N1bWVudHMgb2YgQWJvcnRlciBmb3IgbW9yZSBleGFtcGxlcyBhYm91dCByZXF1ZXN0IGNhbmNlbGxhdGlvbgogICAgICAgICAqIEBwYXJhbSB7UHVibGljQWNjZXNzVHlwZX0gW2FjY2Vzc10KICAgICAgICAgKiBAcGFyYW0ge0lTaWduZWRJZGVudGlmaWVyW119IFtjb250YWluZXJBY2xdCiAgICAgICAgICogQHBhcmFtIHtJQ29udGFpbmVyU2V0QWNjZXNzUG9saWN5T3B0aW9uc30gW29wdGlvbnNdCiAgICAgICAgICogQHJldHVybnMge1Byb21pc2U8TW9kZWxzLkNvbnRhaW5lclNldEFjY2Vzc1BvbGljeVJlc3BvbnNlPn0KICAgICAgICAgKiBAbWVtYmVyb2YgQ29udGFpbmVyVVJMCiAgICAgICAgICovCiAgICAgICAgQ29udGFpbmVyVVJMLnByb3RvdHlwZS5zZXRBY2Nlc3NQb2xpY3kgPSBmdW5jdGlvbiAoYWJvcnRlciwgYWNjZXNzLCBjb250YWluZXJBY2wsIG9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgeyBvcHRpb25zID0ge307IH0KICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIGFjbCwgX2ksIF9hLCBpZGVudGlmaWVyOwogICAgICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYikgewogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuY29udGFpbmVyQWNjZXNzQ29uZGl0aW9ucyA9IG9wdGlvbnMuY29udGFpbmVyQWNjZXNzQ29uZGl0aW9ucyB8fCB7fTsKICAgICAgICAgICAgICAgICAgICBhY2wgPSBbXTsKICAgICAgICAgICAgICAgICAgICBmb3IgKF9pID0gMCwgX2EgPSBjb250YWluZXJBY2wgfHwgW107IF9pIDwgX2EubGVuZ3RoOyBfaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlkZW50aWZpZXIgPSBfYVtfaV07CiAgICAgICAgICAgICAgICAgICAgICAgIGFjbC5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY2Vzc1BvbGljeTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cGlyeTogaWRlbnRpZmllci5hY2Nlc3NQb2xpY3kuZXhwaXJ5ID8gdHJ1bmNhdGVkSVNPODA2MURhdGUoaWRlbnRpZmllci5hY2Nlc3NQb2xpY3kuZXhwaXJ5KSA6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBlcm1pc3Npb246IGlkZW50aWZpZXIuYWNjZXNzUG9saWN5LnBlcm1pc3Npb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IGlkZW50aWZpZXIuYWNjZXNzUG9saWN5LnN0YXJ0ID8gdHJ1bmNhdGVkSVNPODA2MURhdGUoaWRlbnRpZmllci5hY2Nlc3NQb2xpY3kuc3RhcnQpIDogIiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogaWRlbnRpZmllci5pZAogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHRoaXMuY29udGFpbmVyQ29udGV4dC5zZXRBY2Nlc3NQb2xpY3koewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWJvcnRTaWduYWw6IGFib3J0ZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2Nlc3M6IGFjY2VzcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lckFjbDogYWNsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVhc2VBY2Nlc3NDb25kaXRpb25zOiBvcHRpb25zLmNvbnRhaW5lckFjY2Vzc0NvbmRpdGlvbnMubGVhc2VBY2Nlc3NDb25kaXRpb25zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zOiBvcHRpb25zLmNvbnRhaW5lckFjY2Vzc0NvbmRpdGlvbnMubW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zCiAgICAgICAgICAgICAgICAgICAgICAgIH0pXTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICAgIC8qKgogICAgICAgICAqIEVzdGFibGlzaGVzIGFuZCBtYW5hZ2VzIGEgbG9jayBvbiBhIGNvbnRhaW5lciBmb3IgZGVsZXRlIG9wZXJhdGlvbnMuCiAgICAgICAgICogVGhlIGxvY2sgZHVyYXRpb24gY2FuIGJlIDE1IHRvIDYwIHNlY29uZHMsIG9yIGNhbiBiZSBpbmZpbml0ZS4KICAgICAgICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5taWNyb3NvZnQuY29tL2VuLXVzL3Jlc3QvYXBpL3N0b3JhZ2VzZXJ2aWNlcy9sZWFzZS1jb250YWluZXIKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7QWJvcnRlcn0gYWJvcnRlciBDcmVhdGUgYSBuZXcgQWJvcnRlciBpbnN0YW5jZSB3aXRoIEFib3J0ZXIubm9uZSBvciBBYm9ydGVyLnRpbWVvdXQoKSwKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgZ290byBkb2N1bWVudHMgb2YgQWJvcnRlciBmb3IgbW9yZSBleGFtcGxlcyBhYm91dCByZXF1ZXN0IGNhbmNlbGxhdGlvbgogICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBwcm9wb3NlZExlYXNlSWQgQ2FuIGJlIHNwZWNpZmllZCBpbiBhbnkgdmFsaWQgR1VJRCBzdHJpbmcgZm9ybWF0CiAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IGR1cmF0aW9uIE11c3QgYmUgYmV0d2VlbiAxNSB0byA2MCBzZWNvbmRzLCBvciBpbmZpbml0ZSAoLTEpCiAgICAgICAgICogQHBhcmFtIHtJQ29udGFpbmVyQWNxdWlyZUxlYXNlT3B0aW9uc30gW29wdGlvbnNdCiAgICAgICAgICogQHJldHVybnMge1Byb21pc2U8TW9kZWxzLkNvbnRhaW5lckFjcXVpcmVMZWFzZVJlc3BvbnNlPn0KICAgICAgICAgKiBAbWVtYmVyb2YgQ29udGFpbmVyVVJMCiAgICAgICAgICovCiAgICAgICAgQ29udGFpbmVyVVJMLnByb3RvdHlwZS5hY3F1aXJlTGVhc2UgPSBmdW5jdGlvbiAoYWJvcnRlciwgcHJvcG9zZWRMZWFzZUlkLCBkdXJhdGlvbiwgb3B0aW9ucykgewogICAgICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7IG9wdGlvbnMgPSB7fTsgfQogICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHRoaXMuY29udGFpbmVyQ29udGV4dC5hY3F1aXJlTGVhc2UoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWJvcnRTaWduYWw6IGFib3J0ZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RpZmllZEFjY2Vzc0NvbmRpdGlvbnM6IG9wdGlvbnMubW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcG9zZWRMZWFzZUlkOiBwcm9wb3NlZExlYXNlSWQKICAgICAgICAgICAgICAgICAgICAgICAgfSldOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogVG8gZnJlZSB0aGUgbGVhc2UgaWYgaXQgaXMgbm8gbG9uZ2VyIG5lZWRlZCBzbyB0aGF0IGFub3RoZXIgY2xpZW50IG1heQogICAgICAgICAqIGltbWVkaWF0ZWx5IGFjcXVpcmUgYSBsZWFzZSBhZ2FpbnN0IHRoZSBjb250YWluZXIuCiAgICAgICAgICogQHNlZSBodHRwczovL2RvY3MubWljcm9zb2Z0LmNvbS9lbi11cy9yZXN0L2FwaS9zdG9yYWdlc2VydmljZXMvbGVhc2UtY29udGFpbmVyCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge0Fib3J0ZXJ9IGFib3J0ZXIgQ3JlYXRlIGEgbmV3IEFib3J0ZXIgaW5zdGFuY2Ugd2l0aCBBYm9ydGVyLm5vbmUgb3IgQWJvcnRlci50aW1lb3V0KCksCiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgIGdvdG8gZG9jdW1lbnRzIG9mIEFib3J0ZXIgZm9yIG1vcmUgZXhhbXBsZXMgYWJvdXQgcmVxdWVzdCBjYW5jZWxsYXRpb24KICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gbGVhc2VJZAogICAgICAgICAqIEBwYXJhbSB7SUNvbnRhaW5lclJlbGVhc2VMZWFzZU9wdGlvbnN9IFtvcHRpb25zXQogICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlPE1vZGVscy5Db250YWluZXJSZWxlYXNlTGVhc2VSZXNwb25zZT59CiAgICAgICAgICogQG1lbWJlcm9mIENvbnRhaW5lclVSTAogICAgICAgICAqLwogICAgICAgIENvbnRhaW5lclVSTC5wcm90b3R5cGUucmVsZWFzZUxlYXNlID0gZnVuY3Rpb24gKGFib3J0ZXIsIGxlYXNlSWQsIG9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgeyBvcHRpb25zID0ge307IH0KICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCB0aGlzLmNvbnRhaW5lckNvbnRleHQucmVsZWFzZUxlYXNlKGxlYXNlSWQsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFib3J0U2lnbmFsOiBhYm9ydGVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zOiBvcHRpb25zLm1vZGlmaWVkQWNjZXNzQ29uZGl0aW9ucwogICAgICAgICAgICAgICAgICAgICAgICB9KV07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBUbyByZW5ldyBhbiBleGlzdGluZyBsZWFzZS4KICAgICAgICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5taWNyb3NvZnQuY29tL2VuLXVzL3Jlc3QvYXBpL3N0b3JhZ2VzZXJ2aWNlcy9sZWFzZS1jb250YWluZXIKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7QWJvcnRlcn0gYWJvcnRlciBDcmVhdGUgYSBuZXcgQWJvcnRlciBpbnN0YW5jZSB3aXRoIEFib3J0ZXIubm9uZSBvciBBYm9ydGVyLnRpbWVvdXQoKSwKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgZ290byBkb2N1bWVudHMgb2YgQWJvcnRlciBmb3IgbW9yZSBleGFtcGxlcyBhYm91dCByZXF1ZXN0IGNhbmNlbGxhdGlvbgogICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBsZWFzZUlkCiAgICAgICAgICogQHBhcmFtIHtJQ29udGFpbmVyUmVuZXdMZWFzZU9wdGlvbnN9IFtvcHRpb25zXQogICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlPE1vZGVscy5Db250YWluZXJSZW5ld0xlYXNlUmVzcG9uc2U+fQogICAgICAgICAqIEBtZW1iZXJvZiBDb250YWluZXJVUkwKICAgICAgICAgKi8KICAgICAgICBDb250YWluZXJVUkwucHJvdG90eXBlLnJlbmV3TGVhc2UgPSBmdW5jdGlvbiAoYWJvcnRlciwgbGVhc2VJZCwgb3B0aW9ucykgewogICAgICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7IG9wdGlvbnMgPSB7fTsgfQogICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHRoaXMuY29udGFpbmVyQ29udGV4dC5yZW5ld0xlYXNlKGxlYXNlSWQsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFib3J0U2lnbmFsOiBhYm9ydGVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zOiBvcHRpb25zLm1vZGlmaWVkQWNjZXNzQ29uZGl0aW9ucwogICAgICAgICAgICAgICAgICAgICAgICB9KV07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBUbyBlbmQgdGhlIGxlYXNlIGJ1dCBlbnN1cmUgdGhhdCBhbm90aGVyIGNsaWVudCBjYW5ub3QgYWNxdWlyZSBhIG5ldyBsZWFzZQogICAgICAgICAqIHVudGlsIHRoZSBjdXJyZW50IGxlYXNlIHBlcmlvZCBoYXMgZXhwaXJlZC4KICAgICAgICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5taWNyb3NvZnQuY29tL2VuLXVzL3Jlc3QvYXBpL3N0b3JhZ2VzZXJ2aWNlcy9sZWFzZS1jb250YWluZXIKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7QWJvcnRlcn0gYWJvcnRlciBDcmVhdGUgYSBuZXcgQWJvcnRlciBpbnN0YW5jZSB3aXRoIEFib3J0ZXIubm9uZSBvciBBYm9ydGVyLnRpbWVvdXQoKSwKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgZ290byBkb2N1bWVudHMgb2YgQWJvcnRlciBmb3IgbW9yZSBleGFtcGxlcyBhYm91dCByZXF1ZXN0IGNhbmNlbGxhdGlvbgogICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBwZXJpb2QgYnJlYWsgcGVyaW9kCiAgICAgICAgICogQHBhcmFtIHtJQ29udGFpbmVyQnJlYWtMZWFzZU9wdGlvbnN9IFtvcHRpb25zXQogICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlPE1vZGVscy5Db250YWluZXJCcmVha0xlYXNlUmVzcG9uc2U+fQogICAgICAgICAqIEBtZW1iZXJvZiBDb250YWluZXJVUkwKICAgICAgICAgKi8KICAgICAgICBDb250YWluZXJVUkwucHJvdG90eXBlLmJyZWFrTGVhc2UgPSBmdW5jdGlvbiAoYWJvcnRlciwgcGVyaW9kLCBvcHRpb25zKSB7CiAgICAgICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsgb3B0aW9ucyA9IHt9OyB9CiAgICAgICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgdGhpcy5jb250YWluZXJDb250ZXh0LmJyZWFrTGVhc2UoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWJvcnRTaWduYWw6IGFib3J0ZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVha1BlcmlvZDogcGVyaW9kLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zOiBvcHRpb25zLm1vZGlmaWVkQWNjZXNzQ29uZGl0aW9ucwogICAgICAgICAgICAgICAgICAgICAgICB9KV07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBUbyBjaGFuZ2UgdGhlIElEIG9mIGFuIGV4aXN0aW5nIGxlYXNlLgogICAgICAgICAqIEBzZWUgaHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvcmVzdC9hcGkvc3RvcmFnZXNlcnZpY2VzL2xlYXNlLWNvbnRhaW5lcgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtBYm9ydGVyfSBhYm9ydGVyIENyZWF0ZSBhIG5ldyBBYm9ydGVyIGluc3RhbmNlIHdpdGggQWJvcnRlci5ub25lIG9yIEFib3J0ZXIudGltZW91dCgpLAogICAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICBnb3RvIGRvY3VtZW50cyBvZiBBYm9ydGVyIGZvciBtb3JlIGV4YW1wbGVzIGFib3V0IHJlcXVlc3QgY2FuY2VsbGF0aW9uCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IGxlYXNlSWQKICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gcHJvcG9zZWRMZWFzZUlkCiAgICAgICAgICogQHBhcmFtIHtJQ29udGFpbmVyQ2hhbmdlTGVhc2VPcHRpb25zfSBbb3B0aW9uc10KICAgICAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxNb2RlbHMuQ29udGFpbmVyQ2hhbmdlTGVhc2VSZXNwb25zZT59CiAgICAgICAgICogQG1lbWJlcm9mIENvbnRhaW5lclVSTAogICAgICAgICAqLwogICAgICAgIENvbnRhaW5lclVSTC5wcm90b3R5cGUuY2hhbmdlTGVhc2UgPSBmdW5jdGlvbiAoYWJvcnRlciwgbGVhc2VJZCwgcHJvcG9zZWRMZWFzZUlkLCBvcHRpb25zKSB7CiAgICAgICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsgb3B0aW9ucyA9IHt9OyB9CiAgICAgICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgdGhpcy5jb250YWluZXJDb250ZXh0LmNoYW5nZUxlYXNlKGxlYXNlSWQsIHByb3Bvc2VkTGVhc2VJZCwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWJvcnRTaWduYWw6IGFib3J0ZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RpZmllZEFjY2Vzc0NvbmRpdGlvbnM6IG9wdGlvbnMubW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zCiAgICAgICAgICAgICAgICAgICAgICAgIH0pXTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICAgIC8qKgogICAgICAgICAqIGxpc3RCbG9iRmxhdFNlZ21lbnQgcmV0dXJucyBhIHNpbmdsZSBzZWdtZW50IG9mIGJsb2JzIHN0YXJ0aW5nIGZyb20gdGhlCiAgICAgICAgICogc3BlY2lmaWVkIE1hcmtlci4gVXNlIGFuIGVtcHR5IE1hcmtlciB0byBzdGFydCBlbnVtZXJhdGlvbiBmcm9tIHRoZSBiZWdpbm5pbmcuCiAgICAgICAgICogQWZ0ZXIgZ2V0dGluZyBhIHNlZ21lbnQsIHByb2Nlc3MgaXQsIGFuZCB0aGVuIGNhbGwgTGlzdEJsb2JzRmxhdFNlZ21lbnQgYWdhaW4KICAgICAgICAgKiAocGFzc2luZyB0aGUgdGhlIHByZXZpb3VzbHktcmV0dXJuZWQgTWFya2VyKSB0byBnZXQgdGhlIG5leHQgc2VnbWVudC4KICAgICAgICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5taWNyb3NvZnQuY29tL3Jlc3QvYXBpL3N0b3JhZ2VzZXJ2aWNlcy9saXN0LWJsb2JzCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge0Fib3J0ZXJ9IGFib3J0ZXIgQ3JlYXRlIGEgbmV3IEFib3J0ZXIgaW5zdGFuY2Ugd2l0aCBBYm9ydGVyLm5vbmUgb3IgQWJvcnRlci50aW1lb3V0KCksCiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgIGdvdG8gZG9jdW1lbnRzIG9mIEFib3J0ZXIgZm9yIG1vcmUgZXhhbXBsZXMgYWJvdXQgcmVxdWVzdCBjYW5jZWxsYXRpb24KICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gW21hcmtlcl0KICAgICAgICAgKiBAcGFyYW0ge0lDb250YWluZXJMaXN0QmxvYnNTZWdtZW50T3B0aW9uc30gW29wdGlvbnNdCiAgICAgICAgICogQHJldHVybnMge1Byb21pc2U8TW9kZWxzLkNvbnRhaW5lckxpc3RCbG9iRmxhdFNlZ21lbnRSZXNwb25zZT59CiAgICAgICAgICogQG1lbWJlcm9mIENvbnRhaW5lclVSTAogICAgICAgICAqLwogICAgICAgIENvbnRhaW5lclVSTC5wcm90b3R5cGUubGlzdEJsb2JGbGF0U2VnbWVudCA9IGZ1bmN0aW9uIChhYm9ydGVyLCBtYXJrZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgeyBvcHRpb25zID0ge307IH0KICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCB0aGlzLmNvbnRhaW5lckNvbnRleHQubGlzdEJsb2JGbGF0U2VnbWVudChfX2Fzc2lnbih7IGFib3J0U2lnbmFsOiBhYm9ydGVyLCBtYXJrZXI6IG1hcmtlciB9LCBvcHRpb25zKSldOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogbGlzdEJsb2JIaWVyYXJjaHlTZWdtZW50IHJldHVybnMgYSBzaW5nbGUgc2VnbWVudCBvZiBibG9icyBzdGFydGluZyBmcm9tCiAgICAgICAgICogdGhlIHNwZWNpZmllZCBNYXJrZXIuIFVzZSBhbiBlbXB0eSBNYXJrZXIgdG8gc3RhcnQgZW51bWVyYXRpb24gZnJvbSB0aGUKICAgICAgICAgKiBiZWdpbm5pbmcuIEFmdGVyIGdldHRpbmcgYSBzZWdtZW50LCBwcm9jZXNzIGl0LCBhbmQgdGhlbiBjYWxsIExpc3RCbG9ic0hpZXJhcmNoaWNhbFNlZ21lbnQKICAgICAgICAgKiBhZ2FpbiAocGFzc2luZyB0aGUgdGhlIHByZXZpb3VzbHktcmV0dXJuZWQgTWFya2VyKSB0byBnZXQgdGhlIG5leHQgc2VnbWVudC4KICAgICAgICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5taWNyb3NvZnQuY29tL3Jlc3QvYXBpL3N0b3JhZ2VzZXJ2aWNlcy9saXN0LWJsb2JzCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge0Fib3J0ZXJ9IGFib3J0ZXIgQ3JlYXRlIGEgbmV3IEFib3J0ZXIgaW5zdGFuY2Ugd2l0aCBBYm9ydGVyLm5vbmUgb3IgQWJvcnRlci50aW1lb3V0KCksCiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgIGdvdG8gZG9jdW1lbnRzIG9mIEFib3J0ZXIgZm9yIG1vcmUgZXhhbXBsZXMgYWJvdXQgcmVxdWVzdCBjYW5jZWxsYXRpb24KICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gZGVsaW1pdGVyCiAgICAgICAgICogQHBhcmFtIHtJQ29udGFpbmVyTGlzdEJsb2JzU2VnbWVudE9wdGlvbnN9IFtvcHRpb25zXQogICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlPE1vZGVscy5Db250YWluZXJMaXN0QmxvYkhpZXJhcmNoeVNlZ21lbnRSZXNwb25zZT59CiAgICAgICAgICogQG1lbWJlcm9mIENvbnRhaW5lclVSTAogICAgICAgICAqLwogICAgICAgIENvbnRhaW5lclVSTC5wcm90b3R5cGUubGlzdEJsb2JIaWVyYXJjaHlTZWdtZW50ID0gZnVuY3Rpb24gKGFib3J0ZXIsIGRlbGltaXRlciwgbWFya2VyLCBvcHRpb25zKSB7CiAgICAgICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsgb3B0aW9ucyA9IHt9OyB9CiAgICAgICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgdGhpcy5jb250YWluZXJDb250ZXh0Lmxpc3RCbG9iSGllcmFyY2h5U2VnbWVudChkZWxpbWl0ZXIsIF9fYXNzaWduKHsgYWJvcnRTaWduYWw6IGFib3J0ZXIsIG1hcmtlcjogbWFya2VyIH0sIG9wdGlvbnMpKV07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gQ29udGFpbmVyVVJMOwogICAgfShTdG9yYWdlVVJMKSk7CgogICAgLyoqCiAgICAgKiBUb2tlbkNyZWRlbnRpYWxQb2xpY3kgaXMgYSBwb2xpY3kgdXNlZCB0byBzaWduIEhUVFAgcmVxdWVzdCB3aXRoIGEgdG9rZW4uCiAgICAgKiBTdWNoIGFzIGFuIE9BdXRoIGJlYXJlciB0b2tlbi4KICAgICAqCiAgICAgKiBAZXhwb3J0CiAgICAgKiBAY2xhc3MgVG9rZW5DcmVkZW50aWFsUG9saWN5CiAgICAgKiBAZXh0ZW5kcyB7Q3JlZGVudGlhbFBvbGljeX0KICAgICAqLwogICAgdmFyIFRva2VuQ3JlZGVudGlhbFBvbGljeSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKICAgICAgICBfX2V4dGVuZHMoVG9rZW5DcmVkZW50aWFsUG9saWN5LCBfc3VwZXIpOwogICAgICAgIC8qKgogICAgICAgICAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgVG9rZW5DcmVkZW50aWFsUG9saWN5LgogICAgICAgICAqIEBwYXJhbSB7UmVxdWVzdFBvbGljeX0gbmV4dFBvbGljeQogICAgICAgICAqIEBwYXJhbSB7UmVxdWVzdFBvbGljeU9wdGlvbnN9IG9wdGlvbnMKICAgICAgICAgKiBAcGFyYW0ge1Rva2VuQ3JlZGVudGlhbH0gdG9rZW5DcmVkZW50aWFsCiAgICAgICAgICogQG1lbWJlcm9mIFRva2VuQ3JlZGVudGlhbFBvbGljeQogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIFRva2VuQ3JlZGVudGlhbFBvbGljeShuZXh0UG9saWN5LCBvcHRpb25zLCB0b2tlbkNyZWRlbnRpYWwpIHsKICAgICAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgbmV4dFBvbGljeSwgb3B0aW9ucykgfHwgdGhpczsKICAgICAgICAgICAgX3RoaXMudG9rZW5DcmVkZW50aWFsID0gdG9rZW5DcmVkZW50aWFsOwogICAgICAgICAgICBfdGhpcy5hdXRob3JpemF0aW9uU2NoZW1lID0gSGVhZGVyQ29uc3RhbnRzLkFVVEhPUklaQVRJT05fU0NIRU1FOwogICAgICAgICAgICByZXR1cm4gX3RoaXM7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNpZ24gcmVxdWVzdCB3aXRoIHRva2VuLgogICAgICAgICAqCiAgICAgICAgICogQHByb3RlY3RlZAogICAgICAgICAqIEBwYXJhbSB7V2ViUmVzb3VyY2V9IHJlcXVlc3QKICAgICAgICAgKiBAcmV0dXJucyB7V2ViUmVzb3VyY2V9CiAgICAgICAgICogQG1lbWJlcm9mIFRva2VuQ3JlZGVudGlhbFBvbGljeQogICAgICAgICAqLwogICAgICAgIFRva2VuQ3JlZGVudGlhbFBvbGljeS5wcm90b3R5cGUuc2lnblJlcXVlc3QgPSBmdW5jdGlvbiAocmVxdWVzdCkgewogICAgICAgICAgICBpZiAoIXJlcXVlc3QuaGVhZGVycykgewogICAgICAgICAgICAgICAgcmVxdWVzdC5oZWFkZXJzID0gbmV3IEh0dHBIZWFkZXJzKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVxdWVzdC5oZWFkZXJzLnNldChIZWFkZXJDb25zdGFudHMuQVVUSE9SSVpBVElPTiwgdGhpcy5hdXRob3JpemF0aW9uU2NoZW1lICsgIiAiICsgdGhpcy50b2tlbkNyZWRlbnRpYWwudG9rZW4pOwogICAgICAgICAgICByZXR1cm4gcmVxdWVzdDsKICAgICAgICB9OwogICAgICAgIHJldHVybiBUb2tlbkNyZWRlbnRpYWxQb2xpY3k7CiAgICB9KENyZWRlbnRpYWxQb2xpY3kpKTsKCiAgICAvKioKICAgICAqIFRva2VuQ3JlZGVudGlhbCBpcyBhIENyZWRlbnRpYWwgdXNlZCB0byBnZW5lcmF0ZSBhIFRva2VuQ3JlZGVudGlhbFBvbGljeS4KICAgICAqIFJlbmV3IHRva2VuIGJ5IHNldHRpbmcgYSBuZXcgdG9rZW4gc3RyaW5nIHZhbHVlIHRvIHRva2VuIHByb3BlcnR5LgogICAgICoKICAgICAqIEBleGFtcGxlCiAgICAgKiAgY29uc3QgdG9rZW5DcmVkZW50aWFsID0gbmV3IFRva2VuQ3JlZGVudGlhbCgidG9rZW4iKTsKICAgICAqICBjb25zdCBwaXBlbGluZSA9IFN0b3JhZ2VVUkwubmV3UGlwZWxpbmUodG9rZW5DcmVkZW50aWFsKTsKICAgICAqCiAgICAgKiAgLy8gTGlzdCBjb250YWluZXJzCiAgICAgKiAgY29uc3Qgc2VydmljZVVSTCA9IG5ldyBTZXJ2aWNlVVJMKCJodHRwczovL215c3RvcmFnZWFjY291bnQuYmxvYi5jb3JlLndpbmRvd3MubmV0IiwgcGlwZWxpbmUpOwogICAgICoKICAgICAqICAvLyBTZXQgdXAgYSB0aW1lciB0byByZWZyZXNoIHRoZSB0b2tlbgogICAgICogIGNvbnN0IHRpbWVySUQgPSBzZXRJbnRlcnZhbCgoKSA9PiB7CiAgICAgKiAgICAvLyBVcGRhdGUgdG9rZW4gYnkgYWNjZXNzaW5nIHRvIHB1YmxpYyB0b2tlbkNyZWRlbnRpYWwudG9rZW4KICAgICAqICAgIHRva2VuQ3JlZGVudGlhbC50b2tlbiA9ICJ1cGRhdGVkVG9rZW4iOwogICAgICogICAgLy8gV0FSTklORzogVGltZXIgbXVzdCBiZSBtYW51YWxseSBzdG9wcGVkISBJdCB3aWxsIGZvcmJpZCBHQyBvZiB0b2tlbkNyZWRlbnRpYWwKICAgICAqICAgIGlmIChzaG91bGRTdG9wKCkpIHsKICAgICAqICAgICAgY2xlYXJJbnRlcnZhbCh0aW1lcklEKTsKICAgICAqICAgIH0KICAgICAqICB9LCA2MCAqIDYwICogMTAwMCk7IC8vIFNldCBhbiBpbnRlcnZhbCB0aW1lIGJlZm9yZSB5b3VyIHRva2VuIGV4cGlyZWQKICAgICAqIEBleHBvcnQKICAgICAqIEBjbGFzcyBUb2tlbkNyZWRlbnRpYWwKICAgICAqIEBleHRlbmRzIHtDcmVkZW50aWFsfQogICAgICoKICAgICAqLwogICAgdmFyIFRva2VuQ3JlZGVudGlhbCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKICAgICAgICBfX2V4dGVuZHMoVG9rZW5DcmVkZW50aWFsLCBfc3VwZXIpOwogICAgICAgIC8qKgogICAgICAgICAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgVG9rZW5DcmVkZW50aWFsLgogICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0b2tlbgogICAgICAgICAqIEBtZW1iZXJvZiBUb2tlbkNyZWRlbnRpYWwKICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBUb2tlbkNyZWRlbnRpYWwodG9rZW4pIHsKICAgICAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcykgfHwgdGhpczsKICAgICAgICAgICAgX3RoaXMudG9rZW4gPSB0b2tlbjsKICAgICAgICAgICAgcmV0dXJuIF90aGlzOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGVzIGEgVG9rZW5DcmVkZW50aWFsUG9saWN5IG9iamVjdC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7UmVxdWVzdFBvbGljeX0gbmV4dFBvbGljeQogICAgICAgICAqIEBwYXJhbSB7UmVxdWVzdFBvbGljeU9wdGlvbnN9IG9wdGlvbnMKICAgICAgICAgKiBAcmV0dXJucyB7VG9rZW5DcmVkZW50aWFsUG9saWN5fQogICAgICAgICAqIEBtZW1iZXJvZiBUb2tlbkNyZWRlbnRpYWwKICAgICAgICAgKi8KICAgICAgICBUb2tlbkNyZWRlbnRpYWwucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uIChuZXh0UG9saWN5LCBvcHRpb25zKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgVG9rZW5DcmVkZW50aWFsUG9saWN5KG5leHRQb2xpY3ksIG9wdGlvbnMsIHRoaXMpOwogICAgICAgIH07CiAgICAgICAgcmV0dXJuIFRva2VuQ3JlZGVudGlhbDsKICAgIH0oQ3JlZGVudGlhbCkpOwoKICAgIC8vIENvcHlyaWdodCBKb3llbnQsIEluYy4gYW5kIG90aGVyIE5vZGUgY29udHJpYnV0b3JzLgoKICAgIHZhciBSID0gdHlwZW9mIFJlZmxlY3QgPT09ICdvYmplY3QnID8gUmVmbGVjdCA6IG51bGw7CiAgICB2YXIgUmVmbGVjdEFwcGx5ID0gUiAmJiB0eXBlb2YgUi5hcHBseSA9PT0gJ2Z1bmN0aW9uJwogICAgICA/IFIuYXBwbHkKICAgICAgOiBmdW5jdGlvbiBSZWZsZWN0QXBwbHkodGFyZ2V0LCByZWNlaXZlciwgYXJncykgewogICAgICAgIHJldHVybiBGdW5jdGlvbi5wcm90b3R5cGUuYXBwbHkuY2FsbCh0YXJnZXQsIHJlY2VpdmVyLCBhcmdzKTsKICAgICAgfTsKCiAgICB2YXIgUmVmbGVjdE93bktleXM7CiAgICBpZiAoUiAmJiB0eXBlb2YgUi5vd25LZXlzID09PSAnZnVuY3Rpb24nKSB7CiAgICAgIFJlZmxlY3RPd25LZXlzID0gUi5vd25LZXlzOwogICAgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7CiAgICAgIFJlZmxlY3RPd25LZXlzID0gZnVuY3Rpb24gUmVmbGVjdE93bktleXModGFyZ2V0KSB7CiAgICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHRhcmdldCkKICAgICAgICAgIC5jb25jYXQoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyh0YXJnZXQpKTsKICAgICAgfTsKICAgIH0gZWxzZSB7CiAgICAgIFJlZmxlY3RPd25LZXlzID0gZnVuY3Rpb24gUmVmbGVjdE93bktleXModGFyZ2V0KSB7CiAgICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHRhcmdldCk7CiAgICAgIH07CiAgICB9CgogICAgZnVuY3Rpb24gUHJvY2Vzc0VtaXRXYXJuaW5nKHdhcm5pbmcpIHsKICAgICAgaWYgKGNvbnNvbGUgJiYgY29uc29sZS53YXJuKSBjb25zb2xlLndhcm4od2FybmluZyk7CiAgICB9CgogICAgdmFyIE51bWJlcklzTmFOID0gTnVtYmVyLmlzTmFOIHx8IGZ1bmN0aW9uIE51bWJlcklzTmFOKHZhbHVlKSB7CiAgICAgIHJldHVybiB2YWx1ZSAhPT0gdmFsdWU7CiAgICB9OwoKICAgIGZ1bmN0aW9uIEV2ZW50RW1pdHRlcigpIHsKICAgICAgRXZlbnRFbWl0dGVyLmluaXQuY2FsbCh0aGlzKTsKICAgIH0KICAgIHZhciBldmVudHMgPSBFdmVudEVtaXR0ZXI7CgogICAgLy8gQmFja3dhcmRzLWNvbXBhdCB3aXRoIG5vZGUgMC4xMC54CiAgICBFdmVudEVtaXR0ZXIuRXZlbnRFbWl0dGVyID0gRXZlbnRFbWl0dGVyOwoKICAgIEV2ZW50RW1pdHRlci5wcm90b3R5cGUuX2V2ZW50cyA9IHVuZGVmaW5lZDsKICAgIEV2ZW50RW1pdHRlci5wcm90b3R5cGUuX2V2ZW50c0NvdW50ID0gMDsKICAgIEV2ZW50RW1pdHRlci5wcm90b3R5cGUuX21heExpc3RlbmVycyA9IHVuZGVmaW5lZDsKCiAgICAvLyBCeSBkZWZhdWx0IEV2ZW50RW1pdHRlcnMgd2lsbCBwcmludCBhIHdhcm5pbmcgaWYgbW9yZSB0aGFuIDEwIGxpc3RlbmVycyBhcmUKICAgIC8vIGFkZGVkIHRvIGl0LiBUaGlzIGlzIGEgdXNlZnVsIGRlZmF1bHQgd2hpY2ggaGVscHMgZmluZGluZyBtZW1vcnkgbGVha3MuCiAgICB2YXIgZGVmYXVsdE1heExpc3RlbmVycyA9IDEwOwoKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShFdmVudEVtaXR0ZXIsICdkZWZhdWx0TWF4TGlzdGVuZXJzJywgewogICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBkZWZhdWx0TWF4TGlzdGVuZXJzOwogICAgICB9LAogICAgICBzZXQ6IGZ1bmN0aW9uKGFyZykgewogICAgICAgIGlmICh0eXBlb2YgYXJnICE9PSAnbnVtYmVyJyB8fCBhcmcgPCAwIHx8IE51bWJlcklzTmFOKGFyZykpIHsKICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdUaGUgdmFsdWUgb2YgImRlZmF1bHRNYXhMaXN0ZW5lcnMiIGlzIG91dCBvZiByYW5nZS4gSXQgbXVzdCBiZSBhIG5vbi1uZWdhdGl2ZSBudW1iZXIuIFJlY2VpdmVkICcgKyBhcmcgKyAnLicpOwogICAgICAgIH0KICAgICAgICBkZWZhdWx0TWF4TGlzdGVuZXJzID0gYXJnOwogICAgICB9CiAgICB9KTsKCiAgICBFdmVudEVtaXR0ZXIuaW5pdCA9IGZ1bmN0aW9uKCkgewoKICAgICAgaWYgKHRoaXMuX2V2ZW50cyA9PT0gdW5kZWZpbmVkIHx8CiAgICAgICAgICB0aGlzLl9ldmVudHMgPT09IE9iamVjdC5nZXRQcm90b3R5cGVPZih0aGlzKS5fZXZlbnRzKSB7CiAgICAgICAgdGhpcy5fZXZlbnRzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICB0aGlzLl9ldmVudHNDb3VudCA9IDA7CiAgICAgIH0KCiAgICAgIHRoaXMuX21heExpc3RlbmVycyA9IHRoaXMuX21heExpc3RlbmVycyB8fCB1bmRlZmluZWQ7CiAgICB9OwoKICAgIC8vIE9idmlvdXNseSBub3QgYWxsIEVtaXR0ZXJzIHNob3VsZCBiZSBsaW1pdGVkIHRvIDEwLiBUaGlzIGZ1bmN0aW9uIGFsbG93cwogICAgLy8gdGhhdCB0byBiZSBpbmNyZWFzZWQuIFNldCB0byB6ZXJvIGZvciB1bmxpbWl0ZWQuCiAgICBFdmVudEVtaXR0ZXIucHJvdG90eXBlLnNldE1heExpc3RlbmVycyA9IGZ1bmN0aW9uIHNldE1heExpc3RlbmVycyhuKSB7CiAgICAgIGlmICh0eXBlb2YgbiAhPT0gJ251bWJlcicgfHwgbiA8IDAgfHwgTnVtYmVySXNOYU4obikpIHsKICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignVGhlIHZhbHVlIG9mICJuIiBpcyBvdXQgb2YgcmFuZ2UuIEl0IG11c3QgYmUgYSBub24tbmVnYXRpdmUgbnVtYmVyLiBSZWNlaXZlZCAnICsgbiArICcuJyk7CiAgICAgIH0KICAgICAgdGhpcy5fbWF4TGlzdGVuZXJzID0gbjsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwoKICAgIGZ1bmN0aW9uICRnZXRNYXhMaXN0ZW5lcnModGhhdCkgewogICAgICBpZiAodGhhdC5fbWF4TGlzdGVuZXJzID09PSB1bmRlZmluZWQpCiAgICAgICAgcmV0dXJuIEV2ZW50RW1pdHRlci5kZWZhdWx0TWF4TGlzdGVuZXJzOwogICAgICByZXR1cm4gdGhhdC5fbWF4TGlzdGVuZXJzOwogICAgfQoKICAgIEV2ZW50RW1pdHRlci5wcm90b3R5cGUuZ2V0TWF4TGlzdGVuZXJzID0gZnVuY3Rpb24gZ2V0TWF4TGlzdGVuZXJzKCkgewogICAgICByZXR1cm4gJGdldE1heExpc3RlbmVycyh0aGlzKTsKICAgIH07CgogICAgRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5lbWl0ID0gZnVuY3Rpb24gZW1pdCh0eXBlKSB7CiAgICAgIHZhciBhcmdzID0gW107CiAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSBhcmdzLnB1c2goYXJndW1lbnRzW2ldKTsKICAgICAgdmFyIGRvRXJyb3IgPSAodHlwZSA9PT0gJ2Vycm9yJyk7CgogICAgICB2YXIgZXZlbnRzID0gdGhpcy5fZXZlbnRzOwogICAgICBpZiAoZXZlbnRzICE9PSB1bmRlZmluZWQpCiAgICAgICAgZG9FcnJvciA9IChkb0Vycm9yICYmIGV2ZW50cy5lcnJvciA9PT0gdW5kZWZpbmVkKTsKICAgICAgZWxzZSBpZiAoIWRvRXJyb3IpCiAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgLy8gSWYgdGhlcmUgaXMgbm8gJ2Vycm9yJyBldmVudCBsaXN0ZW5lciB0aGVuIHRocm93LgogICAgICBpZiAoZG9FcnJvcikgewogICAgICAgIHZhciBlcjsKICAgICAgICBpZiAoYXJncy5sZW5ndGggPiAwKQogICAgICAgICAgZXIgPSBhcmdzWzBdOwogICAgICAgIGlmIChlciBpbnN0YW5jZW9mIEVycm9yKSB7CiAgICAgICAgICAvLyBOb3RlOiBUaGUgY29tbWVudHMgb24gdGhlIGB0aHJvd2AgbGluZXMgYXJlIGludGVudGlvbmFsLCB0aGV5IHNob3cKICAgICAgICAgIC8vIHVwIGluIE5vZGUncyBvdXRwdXQgaWYgdGhpcyByZXN1bHRzIGluIGFuIHVuaGFuZGxlZCBleGNlcHRpb24uCiAgICAgICAgICB0aHJvdyBlcjsgLy8gVW5oYW5kbGVkICdlcnJvcicgZXZlbnQKICAgICAgICB9CiAgICAgICAgLy8gQXQgbGVhc3QgZ2l2ZSBzb21lIGtpbmQgb2YgY29udGV4dCB0byB0aGUgdXNlcgogICAgICAgIHZhciBlcnIgPSBuZXcgRXJyb3IoJ1VuaGFuZGxlZCBlcnJvci4nICsgKGVyID8gJyAoJyArIGVyLm1lc3NhZ2UgKyAnKScgOiAnJykpOwogICAgICAgIGVyci5jb250ZXh0ID0gZXI7CiAgICAgICAgdGhyb3cgZXJyOyAvLyBVbmhhbmRsZWQgJ2Vycm9yJyBldmVudAogICAgICB9CgogICAgICB2YXIgaGFuZGxlciA9IGV2ZW50c1t0eXBlXTsKCiAgICAgIGlmIChoYW5kbGVyID09PSB1bmRlZmluZWQpCiAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgaWYgKHR5cGVvZiBoYW5kbGVyID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgUmVmbGVjdEFwcGx5KGhhbmRsZXIsIHRoaXMsIGFyZ3MpOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBsZW4gPSBoYW5kbGVyLmxlbmd0aDsKICAgICAgICB2YXIgbGlzdGVuZXJzID0gYXJyYXlDbG9uZShoYW5kbGVyLCBsZW4pOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyArK2kpCiAgICAgICAgICBSZWZsZWN0QXBwbHkobGlzdGVuZXJzW2ldLCB0aGlzLCBhcmdzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9OwoKICAgIGZ1bmN0aW9uIF9hZGRMaXN0ZW5lcih0YXJnZXQsIHR5cGUsIGxpc3RlbmVyLCBwcmVwZW5kKSB7CiAgICAgIHZhciBtOwogICAgICB2YXIgZXZlbnRzOwogICAgICB2YXIgZXhpc3Rpbmc7CgogICAgICBpZiAodHlwZW9mIGxpc3RlbmVyICE9PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignVGhlICJsaXN0ZW5lciIgYXJndW1lbnQgbXVzdCBiZSBvZiB0eXBlIEZ1bmN0aW9uLiBSZWNlaXZlZCB0eXBlICcgKyB0eXBlb2YgbGlzdGVuZXIpOwogICAgICB9CgogICAgICBldmVudHMgPSB0YXJnZXQuX2V2ZW50czsKICAgICAgaWYgKGV2ZW50cyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgZXZlbnRzID0gdGFyZ2V0Ll9ldmVudHMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgIHRhcmdldC5fZXZlbnRzQ291bnQgPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRvIGF2b2lkIHJlY3Vyc2lvbiBpbiB0aGUgY2FzZSB0aGF0IHR5cGUgPT09ICJuZXdMaXN0ZW5lciIhIEJlZm9yZQogICAgICAgIC8vIGFkZGluZyBpdCB0byB0aGUgbGlzdGVuZXJzLCBmaXJzdCBlbWl0ICJuZXdMaXN0ZW5lciIuCiAgICAgICAgaWYgKGV2ZW50cy5uZXdMaXN0ZW5lciAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB0YXJnZXQuZW1pdCgnbmV3TGlzdGVuZXInLCB0eXBlLAogICAgICAgICAgICAgICAgICAgICAgbGlzdGVuZXIubGlzdGVuZXIgPyBsaXN0ZW5lci5saXN0ZW5lciA6IGxpc3RlbmVyKTsKCiAgICAgICAgICAvLyBSZS1hc3NpZ24gYGV2ZW50c2AgYmVjYXVzZSBhIG5ld0xpc3RlbmVyIGhhbmRsZXIgY291bGQgaGF2ZSBjYXVzZWQgdGhlCiAgICAgICAgICAvLyB0aGlzLl9ldmVudHMgdG8gYmUgYXNzaWduZWQgdG8gYSBuZXcgb2JqZWN0CiAgICAgICAgICBldmVudHMgPSB0YXJnZXQuX2V2ZW50czsKICAgICAgICB9CiAgICAgICAgZXhpc3RpbmcgPSBldmVudHNbdHlwZV07CiAgICAgIH0KCiAgICAgIGlmIChleGlzdGluZyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgLy8gT3B0aW1pemUgdGhlIGNhc2Ugb2Ygb25lIGxpc3RlbmVyLiBEb24ndCBuZWVkIHRoZSBleHRyYSBhcnJheSBvYmplY3QuCiAgICAgICAgZXhpc3RpbmcgPSBldmVudHNbdHlwZV0gPSBsaXN0ZW5lcjsKICAgICAgICArK3RhcmdldC5fZXZlbnRzQ291bnQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHR5cGVvZiBleGlzdGluZyA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgLy8gQWRkaW5nIHRoZSBzZWNvbmQgZWxlbWVudCwgbmVlZCB0byBjaGFuZ2UgdG8gYXJyYXkuCiAgICAgICAgICBleGlzdGluZyA9IGV2ZW50c1t0eXBlXSA9CiAgICAgICAgICAgIHByZXBlbmQgPyBbbGlzdGVuZXIsIGV4aXN0aW5nXSA6IFtleGlzdGluZywgbGlzdGVuZXJdOwogICAgICAgICAgLy8gSWYgd2UndmUgYWxyZWFkeSBnb3QgYW4gYXJyYXksIGp1c3QgYXBwZW5kLgogICAgICAgIH0gZWxzZSBpZiAocHJlcGVuZCkgewogICAgICAgICAgZXhpc3RpbmcudW5zaGlmdChsaXN0ZW5lcik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGV4aXN0aW5nLnB1c2gobGlzdGVuZXIpOwogICAgICAgIH0KCiAgICAgICAgLy8gQ2hlY2sgZm9yIGxpc3RlbmVyIGxlYWsKICAgICAgICBtID0gJGdldE1heExpc3RlbmVycyh0YXJnZXQpOwogICAgICAgIGlmIChtID4gMCAmJiBleGlzdGluZy5sZW5ndGggPiBtICYmICFleGlzdGluZy53YXJuZWQpIHsKICAgICAgICAgIGV4aXN0aW5nLndhcm5lZCA9IHRydWU7CiAgICAgICAgICAvLyBObyBlcnJvciBjb2RlIGZvciB0aGlzIHNpbmNlIGl0IGlzIGEgV2FybmluZwogICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXJlc3RyaWN0ZWQtc3ludGF4CiAgICAgICAgICB2YXIgdyA9IG5ldyBFcnJvcignUG9zc2libGUgRXZlbnRFbWl0dGVyIG1lbW9yeSBsZWFrIGRldGVjdGVkLiAnICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhpc3RpbmcubGVuZ3RoICsgJyAnICsgU3RyaW5nKHR5cGUpICsgJyBsaXN0ZW5lcnMgJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhZGRlZC4gVXNlIGVtaXR0ZXIuc2V0TWF4TGlzdGVuZXJzKCkgdG8gJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdpbmNyZWFzZSBsaW1pdCcpOwogICAgICAgICAgdy5uYW1lID0gJ01heExpc3RlbmVyc0V4Y2VlZGVkV2FybmluZyc7CiAgICAgICAgICB3LmVtaXR0ZXIgPSB0YXJnZXQ7CiAgICAgICAgICB3LnR5cGUgPSB0eXBlOwogICAgICAgICAgdy5jb3VudCA9IGV4aXN0aW5nLmxlbmd0aDsKICAgICAgICAgIFByb2Nlc3NFbWl0V2FybmluZyh3KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CgogICAgRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5hZGRMaXN0ZW5lciA9IGZ1bmN0aW9uIGFkZExpc3RlbmVyKHR5cGUsIGxpc3RlbmVyKSB7CiAgICAgIHJldHVybiBfYWRkTGlzdGVuZXIodGhpcywgdHlwZSwgbGlzdGVuZXIsIGZhbHNlKTsKICAgIH07CgogICAgRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5vbiA9IEV2ZW50RW1pdHRlci5wcm90b3R5cGUuYWRkTGlzdGVuZXI7CgogICAgRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5wcmVwZW5kTGlzdGVuZXIgPQogICAgICAgIGZ1bmN0aW9uIHByZXBlbmRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICAgICAgcmV0dXJuIF9hZGRMaXN0ZW5lcih0aGlzLCB0eXBlLCBsaXN0ZW5lciwgdHJ1ZSk7CiAgICAgICAgfTsKCiAgICBmdW5jdGlvbiBvbmNlV3JhcHBlcigpIHsKICAgICAgdmFyIGFyZ3MgPSBbXTsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIGFyZ3MucHVzaChhcmd1bWVudHNbaV0pOwogICAgICBpZiAoIXRoaXMuZmlyZWQpIHsKICAgICAgICB0aGlzLnRhcmdldC5yZW1vdmVMaXN0ZW5lcih0aGlzLnR5cGUsIHRoaXMud3JhcEZuKTsKICAgICAgICB0aGlzLmZpcmVkID0gdHJ1ZTsKICAgICAgICBSZWZsZWN0QXBwbHkodGhpcy5saXN0ZW5lciwgdGhpcy50YXJnZXQsIGFyZ3MpOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gX29uY2VXcmFwKHRhcmdldCwgdHlwZSwgbGlzdGVuZXIpIHsKICAgICAgdmFyIHN0YXRlID0geyBmaXJlZDogZmFsc2UsIHdyYXBGbjogdW5kZWZpbmVkLCB0YXJnZXQ6IHRhcmdldCwgdHlwZTogdHlwZSwgbGlzdGVuZXI6IGxpc3RlbmVyIH07CiAgICAgIHZhciB3cmFwcGVkID0gb25jZVdyYXBwZXIuYmluZChzdGF0ZSk7CiAgICAgIHdyYXBwZWQubGlzdGVuZXIgPSBsaXN0ZW5lcjsKICAgICAgc3RhdGUud3JhcEZuID0gd3JhcHBlZDsKICAgICAgcmV0dXJuIHdyYXBwZWQ7CiAgICB9CgogICAgRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5vbmNlID0gZnVuY3Rpb24gb25jZSh0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodHlwZW9mIGxpc3RlbmVyICE9PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignVGhlICJsaXN0ZW5lciIgYXJndW1lbnQgbXVzdCBiZSBvZiB0eXBlIEZ1bmN0aW9uLiBSZWNlaXZlZCB0eXBlICcgKyB0eXBlb2YgbGlzdGVuZXIpOwogICAgICB9CiAgICAgIHRoaXMub24odHlwZSwgX29uY2VXcmFwKHRoaXMsIHR5cGUsIGxpc3RlbmVyKSk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfTsKCiAgICBFdmVudEVtaXR0ZXIucHJvdG90eXBlLnByZXBlbmRPbmNlTGlzdGVuZXIgPQogICAgICAgIGZ1bmN0aW9uIHByZXBlbmRPbmNlTGlzdGVuZXIodHlwZSwgbGlzdGVuZXIpIHsKICAgICAgICAgIGlmICh0eXBlb2YgbGlzdGVuZXIgIT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignVGhlICJsaXN0ZW5lciIgYXJndW1lbnQgbXVzdCBiZSBvZiB0eXBlIEZ1bmN0aW9uLiBSZWNlaXZlZCB0eXBlICcgKyB0eXBlb2YgbGlzdGVuZXIpOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5wcmVwZW5kTGlzdGVuZXIodHlwZSwgX29uY2VXcmFwKHRoaXMsIHR5cGUsIGxpc3RlbmVyKSk7CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9OwoKICAgIC8vIEVtaXRzIGEgJ3JlbW92ZUxpc3RlbmVyJyBldmVudCBpZiBhbmQgb25seSBpZiB0aGUgbGlzdGVuZXIgd2FzIHJlbW92ZWQuCiAgICBFdmVudEVtaXR0ZXIucHJvdG90eXBlLnJlbW92ZUxpc3RlbmVyID0KICAgICAgICBmdW5jdGlvbiByZW1vdmVMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICAgICAgdmFyIGxpc3QsIGV2ZW50cywgcG9zaXRpb24sIGksIG9yaWdpbmFsTGlzdGVuZXI7CgogICAgICAgICAgaWYgKHR5cGVvZiBsaXN0ZW5lciAhPT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdUaGUgImxpc3RlbmVyIiBhcmd1bWVudCBtdXN0IGJlIG9mIHR5cGUgRnVuY3Rpb24uIFJlY2VpdmVkIHR5cGUgJyArIHR5cGVvZiBsaXN0ZW5lcik7CiAgICAgICAgICB9CgogICAgICAgICAgZXZlbnRzID0gdGhpcy5fZXZlbnRzOwogICAgICAgICAgaWYgKGV2ZW50cyA9PT0gdW5kZWZpbmVkKQogICAgICAgICAgICByZXR1cm4gdGhpczsKCiAgICAgICAgICBsaXN0ID0gZXZlbnRzW3R5cGVdOwogICAgICAgICAgaWYgKGxpc3QgPT09IHVuZGVmaW5lZCkKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CgogICAgICAgICAgaWYgKGxpc3QgPT09IGxpc3RlbmVyIHx8IGxpc3QubGlzdGVuZXIgPT09IGxpc3RlbmVyKSB7CiAgICAgICAgICAgIGlmICgtLXRoaXMuX2V2ZW50c0NvdW50ID09PSAwKQogICAgICAgICAgICAgIHRoaXMuX2V2ZW50cyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIGRlbGV0ZSBldmVudHNbdHlwZV07CiAgICAgICAgICAgICAgaWYgKGV2ZW50cy5yZW1vdmVMaXN0ZW5lcikKICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgncmVtb3ZlTGlzdGVuZXInLCB0eXBlLCBsaXN0Lmxpc3RlbmVyIHx8IGxpc3RlbmVyKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgbGlzdCAhPT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICBwb3NpdGlvbiA9IC0xOwoKICAgICAgICAgICAgZm9yIChpID0gbGlzdC5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgICAgIGlmIChsaXN0W2ldID09PSBsaXN0ZW5lciB8fCBsaXN0W2ldLmxpc3RlbmVyID09PSBsaXN0ZW5lcikgewogICAgICAgICAgICAgICAgb3JpZ2luYWxMaXN0ZW5lciA9IGxpc3RbaV0ubGlzdGVuZXI7CiAgICAgICAgICAgICAgICBwb3NpdGlvbiA9IGk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChwb3NpdGlvbiA8IDApCiAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CgogICAgICAgICAgICBpZiAocG9zaXRpb24gPT09IDApCiAgICAgICAgICAgICAgbGlzdC5zaGlmdCgpOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICBzcGxpY2VPbmUobGlzdCwgcG9zaXRpb24pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAobGlzdC5sZW5ndGggPT09IDEpCiAgICAgICAgICAgICAgZXZlbnRzW3R5cGVdID0gbGlzdFswXTsKCiAgICAgICAgICAgIGlmIChldmVudHMucmVtb3ZlTGlzdGVuZXIgIT09IHVuZGVmaW5lZCkKICAgICAgICAgICAgICB0aGlzLmVtaXQoJ3JlbW92ZUxpc3RlbmVyJywgdHlwZSwgb3JpZ2luYWxMaXN0ZW5lciB8fCBsaXN0ZW5lcik7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfTsKCiAgICBFdmVudEVtaXR0ZXIucHJvdG90eXBlLm9mZiA9IEV2ZW50RW1pdHRlci5wcm90b3R5cGUucmVtb3ZlTGlzdGVuZXI7CgogICAgRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5yZW1vdmVBbGxMaXN0ZW5lcnMgPQogICAgICAgIGZ1bmN0aW9uIHJlbW92ZUFsbExpc3RlbmVycyh0eXBlKSB7CiAgICAgICAgICB2YXIgbGlzdGVuZXJzLCBldmVudHMsIGk7CgogICAgICAgICAgZXZlbnRzID0gdGhpcy5fZXZlbnRzOwogICAgICAgICAgaWYgKGV2ZW50cyA9PT0gdW5kZWZpbmVkKQogICAgICAgICAgICByZXR1cm4gdGhpczsKCiAgICAgICAgICAvLyBub3QgbGlzdGVuaW5nIGZvciByZW1vdmVMaXN0ZW5lciwgbm8gbmVlZCB0byBlbWl0CiAgICAgICAgICBpZiAoZXZlbnRzLnJlbW92ZUxpc3RlbmVyID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICB0aGlzLl9ldmVudHMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgICAgICAgIHRoaXMuX2V2ZW50c0NvdW50ID0gMDsKICAgICAgICAgICAgfSBlbHNlIGlmIChldmVudHNbdHlwZV0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIGlmICgtLXRoaXMuX2V2ZW50c0NvdW50ID09PSAwKQogICAgICAgICAgICAgICAgdGhpcy5fZXZlbnRzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBkZWxldGUgZXZlbnRzW3R5cGVdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIGVtaXQgcmVtb3ZlTGlzdGVuZXIgZm9yIGFsbCBsaXN0ZW5lcnMgb24gYWxsIGV2ZW50cwogICAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhldmVudHMpOwogICAgICAgICAgICB2YXIga2V5OwogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7ICsraSkgewogICAgICAgICAgICAgIGtleSA9IGtleXNbaV07CiAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ3JlbW92ZUxpc3RlbmVyJykgY29udGludWU7CiAgICAgICAgICAgICAgdGhpcy5yZW1vdmVBbGxMaXN0ZW5lcnMoa2V5KTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnJlbW92ZUFsbExpc3RlbmVycygncmVtb3ZlTGlzdGVuZXInKTsKICAgICAgICAgICAgdGhpcy5fZXZlbnRzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICAgICAgdGhpcy5fZXZlbnRzQ291bnQgPSAwOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgIH0KCiAgICAgICAgICBsaXN0ZW5lcnMgPSBldmVudHNbdHlwZV07CgogICAgICAgICAgaWYgKHR5cGVvZiBsaXN0ZW5lcnMgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgdGhpcy5yZW1vdmVMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcnMpOwogICAgICAgICAgfSBlbHNlIGlmIChsaXN0ZW5lcnMgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAvLyBMSUZPIG9yZGVyCiAgICAgICAgICAgIGZvciAoaSA9IGxpc3RlbmVycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgICAgIHRoaXMucmVtb3ZlTGlzdGVuZXIodHlwZSwgbGlzdGVuZXJzW2ldKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH07CgogICAgZnVuY3Rpb24gX2xpc3RlbmVycyh0YXJnZXQsIHR5cGUsIHVud3JhcCkgewogICAgICB2YXIgZXZlbnRzID0gdGFyZ2V0Ll9ldmVudHM7CgogICAgICBpZiAoZXZlbnRzID09PSB1bmRlZmluZWQpCiAgICAgICAgcmV0dXJuIFtdOwoKICAgICAgdmFyIGV2bGlzdGVuZXIgPSBldmVudHNbdHlwZV07CiAgICAgIGlmIChldmxpc3RlbmVyID09PSB1bmRlZmluZWQpCiAgICAgICAgcmV0dXJuIFtdOwoKICAgICAgaWYgKHR5cGVvZiBldmxpc3RlbmVyID09PSAnZnVuY3Rpb24nKQogICAgICAgIHJldHVybiB1bndyYXAgPyBbZXZsaXN0ZW5lci5saXN0ZW5lciB8fCBldmxpc3RlbmVyXSA6IFtldmxpc3RlbmVyXTsKCiAgICAgIHJldHVybiB1bndyYXAgPwogICAgICAgIHVud3JhcExpc3RlbmVycyhldmxpc3RlbmVyKSA6IGFycmF5Q2xvbmUoZXZsaXN0ZW5lciwgZXZsaXN0ZW5lci5sZW5ndGgpOwogICAgfQoKICAgIEV2ZW50RW1pdHRlci5wcm90b3R5cGUubGlzdGVuZXJzID0gZnVuY3Rpb24gbGlzdGVuZXJzKHR5cGUpIHsKICAgICAgcmV0dXJuIF9saXN0ZW5lcnModGhpcywgdHlwZSwgdHJ1ZSk7CiAgICB9OwoKICAgIEV2ZW50RW1pdHRlci5wcm90b3R5cGUucmF3TGlzdGVuZXJzID0gZnVuY3Rpb24gcmF3TGlzdGVuZXJzKHR5cGUpIHsKICAgICAgcmV0dXJuIF9saXN0ZW5lcnModGhpcywgdHlwZSwgZmFsc2UpOwogICAgfTsKCiAgICBFdmVudEVtaXR0ZXIubGlzdGVuZXJDb3VudCA9IGZ1bmN0aW9uKGVtaXR0ZXIsIHR5cGUpIHsKICAgICAgaWYgKHR5cGVvZiBlbWl0dGVyLmxpc3RlbmVyQ291bnQgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICByZXR1cm4gZW1pdHRlci5saXN0ZW5lckNvdW50KHR5cGUpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBsaXN0ZW5lckNvdW50LmNhbGwoZW1pdHRlciwgdHlwZSk7CiAgICAgIH0KICAgIH07CgogICAgRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5saXN0ZW5lckNvdW50ID0gbGlzdGVuZXJDb3VudDsKICAgIGZ1bmN0aW9uIGxpc3RlbmVyQ291bnQodHlwZSkgewogICAgICB2YXIgZXZlbnRzID0gdGhpcy5fZXZlbnRzOwoKICAgICAgaWYgKGV2ZW50cyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdmFyIGV2bGlzdGVuZXIgPSBldmVudHNbdHlwZV07CgogICAgICAgIGlmICh0eXBlb2YgZXZsaXN0ZW5lciA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgfSBlbHNlIGlmIChldmxpc3RlbmVyICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHJldHVybiBldmxpc3RlbmVyLmxlbmd0aDsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiAwOwogICAgfQoKICAgIEV2ZW50RW1pdHRlci5wcm90b3R5cGUuZXZlbnROYW1lcyA9IGZ1bmN0aW9uIGV2ZW50TmFtZXMoKSB7CiAgICAgIHJldHVybiB0aGlzLl9ldmVudHNDb3VudCA+IDAgPyBSZWZsZWN0T3duS2V5cyh0aGlzLl9ldmVudHMpIDogW107CiAgICB9OwoKICAgIGZ1bmN0aW9uIGFycmF5Q2xvbmUoYXJyLCBuKSB7CiAgICAgIHZhciBjb3B5ID0gbmV3IEFycmF5KG4pOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG47ICsraSkKICAgICAgICBjb3B5W2ldID0gYXJyW2ldOwogICAgICByZXR1cm4gY29weTsKICAgIH0KCiAgICBmdW5jdGlvbiBzcGxpY2VPbmUobGlzdCwgaW5kZXgpIHsKICAgICAgZm9yICg7IGluZGV4ICsgMSA8IGxpc3QubGVuZ3RoOyBpbmRleCsrKQogICAgICAgIGxpc3RbaW5kZXhdID0gbGlzdFtpbmRleCArIDFdOwogICAgICBsaXN0LnBvcCgpOwogICAgfQoKICAgIGZ1bmN0aW9uIHVud3JhcExpc3RlbmVycyhhcnIpIHsKICAgICAgdmFyIHJldCA9IG5ldyBBcnJheShhcnIubGVuZ3RoKTsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByZXQubGVuZ3RoOyArK2kpIHsKICAgICAgICByZXRbaV0gPSBhcnJbaV0ubGlzdGVuZXIgfHwgYXJyW2ldOwogICAgICB9CiAgICAgIHJldHVybiByZXQ7CiAgICB9CiAgICB2YXIgZXZlbnRzXzEgPSBldmVudHMuRXZlbnRFbWl0dGVyOwoKICAgIC8qKgogICAgICogU3RhdGVzIGZvciBCYXRjaC4KICAgICAqCiAgICAgKiBAZW51bSB7bnVtYmVyfQogICAgICovCiAgICB2YXIgQmF0Y2hTdGF0ZXM7CiAgICAoZnVuY3Rpb24gKEJhdGNoU3RhdGVzKSB7CiAgICAgICAgQmF0Y2hTdGF0ZXNbQmF0Y2hTdGF0ZXNbIkdvb2QiXSA9IDBdID0gIkdvb2QiOwogICAgICAgIEJhdGNoU3RhdGVzW0JhdGNoU3RhdGVzWyJFcnJvciJdID0gMV0gPSAiRXJyb3IiOwogICAgfSkoQmF0Y2hTdGF0ZXMgfHwgKEJhdGNoU3RhdGVzID0ge30pKTsKICAgIC8qKgogICAgICogQmF0Y2ggcHJvdmlkZXMgYmFzaWMgcGFyYWxsZWwgZXhlY3V0aW9uIHdpdGggY29uY3VycmVuY3kgbGltaXRzLgogICAgICogV2lsbCBzdG9wIGV4ZWN1dGUgbGVmdCBvcGVyYXRpb25zIHdoZW4gb25lIG9mIHRoZSBleGVjdXRlZCBvcGVyYXRpb24gdGhyb3dzIGFuIGVycm9yLgogICAgICogQnV0IEJhdGNoIGNhbm5vdCBjYW5jZWwgb25nb2luZyBvcGVyYXRpb25zLCB5b3UgbmVlZCB0byBjYW5jZWwgdGhlbSBieSB5b3Vyc2VsZi4KICAgICAqCiAgICAgKiBAZXhwb3J0CiAgICAgKiBAY2xhc3MgQmF0Y2gKICAgICAqLwogICAgdmFyIEJhdGNoID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewogICAgICAgIC8qKgogICAgICAgICAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgQmF0Y2guCiAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IFtjb25jdXJyZW5jeT01XQogICAgICAgICAqIEBtZW1iZXJvZiBCYXRjaAogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIEJhdGNoKGNvbmN1cnJlbmN5KSB7CiAgICAgICAgICAgIGlmIChjb25jdXJyZW5jeSA9PT0gdm9pZCAwKSB7IGNvbmN1cnJlbmN5ID0gNTsgfQogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogTnVtYmVyIG9mIGFjdGl2ZSBvcGVyYXRpb25zIHVuZGVyIGV4ZWN1dGlvbi4KICAgICAgICAgICAgICoKICAgICAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgICAgICogQHR5cGUge251bWJlcn0KICAgICAgICAgICAgICogQG1lbWJlcm9mIEJhdGNoCiAgICAgICAgICAgICAqLwogICAgICAgICAgICB0aGlzLmFjdGl2ZXMgPSAwOwogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogTnVtYmVyIG9mIGNvbXBsZXRlZCBvcGVyYXRpb25zIHVuZGVyIGV4ZWN1dGlvbi4KICAgICAgICAgICAgICoKICAgICAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgICAgICogQHR5cGUge251bWJlcn0KICAgICAgICAgICAgICogQG1lbWJlcm9mIEJhdGNoCiAgICAgICAgICAgICAqLwogICAgICAgICAgICB0aGlzLmNvbXBsZXRlZCA9IDA7CiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBPZmZzZXQgb2YgbmV4dCBvcGVyYXRpb24gdG8gYmUgZXhlY3V0ZWQuCiAgICAgICAgICAgICAqCiAgICAgICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgICAgICAgICAqIEBtZW1iZXJvZiBCYXRjaAogICAgICAgICAgICAgKi8KICAgICAgICAgICAgdGhpcy5vZmZzZXQgPSAwOwogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogT3BlcmF0aW9uIGFycmF5IHRvIGJlIGV4ZWN1dGVkLgogICAgICAgICAgICAgKgogICAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICAgKiBAdHlwZSB7T3BlcmF0aW9uW119CiAgICAgICAgICAgICAqIEBtZW1iZXJvZiBCYXRjaAogICAgICAgICAgICAgKi8KICAgICAgICAgICAgdGhpcy5vcGVyYXRpb25zID0gW107CiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBTdGF0ZXMgb2YgQmF0Y2guIFdoZW4gYW4gZXJyb3IgaGFwcGVucywgc3RhdGUgd2lsbCB0dXJuIGludG8gZXJyb3IuCiAgICAgICAgICAgICAqIEJhdGNoIHdpbGwgc3RvcCBleGVjdXRlIGxlZnQgb3BlcmF0aW9ucy4KICAgICAgICAgICAgICoKICAgICAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgICAgICogQHR5cGUge0JhdGNoU3RhdGVzfQogICAgICAgICAgICAgKiBAbWVtYmVyb2YgQmF0Y2gKICAgICAgICAgICAgICovCiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSBCYXRjaFN0YXRlcy5Hb29kOwogICAgICAgICAgICBpZiAoY29uY3VycmVuY3kgPCAxKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiY29uY3VycmVuY3kgbXVzdCBiZSBsYXJnZXIgdGhhbiAwIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5jb25jdXJyZW5jeSA9IGNvbmN1cnJlbmN5OwogICAgICAgICAgICB0aGlzLmVtaXR0ZXIgPSBuZXcgZXZlbnRzXzEoKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQWRkIGEgb3BlcmF0aW9uIGludG8gcXVldWUuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge09wZXJhdGlvbn0gb3BlcmF0aW9uCiAgICAgICAgICogQG1lbWJlcm9mIEJhdGNoCiAgICAgICAgICovCiAgICAgICAgQmF0Y2gucHJvdG90eXBlLmFkZE9wZXJhdGlvbiA9IGZ1bmN0aW9uIChvcGVyYXRpb24pIHsKICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICAgICAgdGhpcy5vcGVyYXRpb25zLnB1c2goZnVuY3Rpb24gKCkgeyByZXR1cm4gX19hd2FpdGVyKF90aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIGVycm9yXzE7CiAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfYS50cnlzLnB1c2goWzAsIDIsICwgM10pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVzKys7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBvcGVyYXRpb24oKV07CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlcy0tOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb21wbGV0ZWQrKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGFyYWxsZWxFeGVjdXRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzMgLypicmVhayovLCAzXTsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JfMSA9IF9hLnNlbnQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdHRlci5lbWl0KCJlcnJvciIsIGVycm9yXzEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgM107CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMzogcmV0dXJuIFsyIC8qcmV0dXJuKi9dOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsgfSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBTdGFydCBleGVjdXRlIG9wZXJhdGlvbnMgaW4gdGhlIHF1ZXVlLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybnMge1Byb21pc2U8dm9pZD59CiAgICAgICAgICogQG1lbWJlcm9mIEJhdGNoCiAgICAgICAgICovCiAgICAgICAgQmF0Y2gucHJvdG90eXBlLmRvID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMucGFyYWxsZWxFeGVjdXRlKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmVtaXR0ZXIub24oImZpbmlzaCIsIHJlc29sdmUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZW1pdHRlci5vbigiZXJyb3IiLCBmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5zdGF0ZSA9IEJhdGNoU3RhdGVzLkVycm9yOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSldOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogR2V0IG5leHQgb3BlcmF0aW9uIHRvIGJlIGV4ZWN1dGVkLiBSZXR1cm4gbnVsbCB3aGVuIHJlYWNoaW5nIGVuZHMuCiAgICAgICAgICoKICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAqIEByZXR1cm5zIHsoT3BlcmF0aW9uIHwgbnVsbCl9CiAgICAgICAgICogQG1lbWJlcm9mIEJhdGNoCiAgICAgICAgICovCiAgICAgICAgQmF0Y2gucHJvdG90eXBlLm5leHRPcGVyYXRpb24gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLm9mZnNldCA8IHRoaXMub3BlcmF0aW9ucy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm9wZXJhdGlvbnNbdGhpcy5vZmZzZXQrK107CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBTdGFydCBleGVjdXRlIG9wZXJhdGlvbnMuIE9uZSBvbmUgdGhlIG1vc3QgaW1wb3J0YW50IGRpZmZlcmVuY2UgYmV0d2VlbgogICAgICAgICAqIHRoaXMgbWV0aG9kIHdpdGggZG8oKSBpcyB0aGF0IGRvKCkgd3JhcHMgYXMgYW4gc3luYyBtZXRob2QuCiAgICAgICAgICoKICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAqIEByZXR1cm5zIHt2b2lkfQogICAgICAgICAqIEBtZW1iZXJvZiBCYXRjaAogICAgICAgICAqLwogICAgICAgIEJhdGNoLnByb3RvdHlwZS5wYXJhbGxlbEV4ZWN1dGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlID09PSBCYXRjaFN0YXRlcy5FcnJvcikgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLmNvbXBsZXRlZCA+PSB0aGlzLm9wZXJhdGlvbnMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmVtaXR0ZXIuZW1pdCgiZmluaXNoIik7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgd2hpbGUgKHRoaXMuYWN0aXZlcyA8IHRoaXMuY29uY3VycmVuY3kpIHsKICAgICAgICAgICAgICAgIHZhciBvcGVyYXRpb24gPSB0aGlzLm5leHRPcGVyYXRpb24oKTsKICAgICAgICAgICAgICAgIGlmIChvcGVyYXRpb24pIHsKICAgICAgICAgICAgICAgICAgICBvcGVyYXRpb24oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgcmV0dXJuIEJhdGNoOwogICAgfSgpKTsKCiAgICAvKioKICAgICAqIE9OTFkgQVZBSUxBQkxFIElOIEJST1dTRVJTLgogICAgICoKICAgICAqIFVwbG9hZHMgYSBicm93c2VyIEJsb2IvRmlsZS9BcnJheUJ1ZmZlci9BcnJheUJ1ZmZlclZpZXcgb2JqZWN0IHRvIGJsb2NrIGJsb2IuCiAgICAgKgogICAgICogV2hlbiBidWZmZXIgbGVuZ3RoIDw9IDI1Nk1CLCB0aGlzIG1ldGhvZCB3aWxsIHVzZSAxIHVwbG9hZCBjYWxsIHRvIGZpbmlzaCB0aGUgdXBsb2FkLgogICAgICogT3RoZXJ3aXNlLCB0aGlzIG1ldGhvZCB3aWxsIGNhbGwgc3RhZ2VCbG9jayB0byB1cGxvYWQgYmxvY2tzLCBhbmQgZmluYWxseSBjYWxsIGNvbW1pdEJsb2NrTGlzdAogICAgICogdG8gY29tbWl0IHRoZSBibG9jayBsaXN0LgogICAgICoKICAgICAqIEBleHBvcnQKICAgICAqIEBwYXJhbSB7QWJvcnRlcn0gYWJvcnRlciBDcmVhdGUgYSBuZXcgQWJvcnRlciBpbnN0YW5jZSB3aXRoIEFib3J0ZXIubm9uZSBvciBBYm9ydGVyLnRpbWVvdXQoKSwKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICBnb3RvIGRvY3VtZW50cyBvZiBBYm9ydGVyIGZvciBtb3JlIGV4YW1wbGVzIGFib3V0IHJlcXVlc3QgY2FuY2VsbGF0aW9uCiAgICAgKiBAcGFyYW0ge0Jsb2IgfCBBcnJheUJ1ZmZlciB8IEFycmF5QnVmZmVyVmlld30gYnJvd3NlckRhdGEgQmxvYiwgRmlsZSwgQXJyYXlCdWZmZXIgb3IgQXJyYXlCdWZmZXJWaWV3CiAgICAgKiBAcGFyYW0ge0Jsb2NrQmxvYlVSTH0gYmxvY2tCbG9iVVJMCiAgICAgKiBAcGFyYW0ge0lVcGxvYWRUb0Jsb2NrQmxvYk9wdGlvbnN9IFtvcHRpb25zXQogICAgICogQHJldHVybnMge1Byb21pc2U8QmxvYlVwbG9hZENvbW1vblJlc3BvbnNlPn0KICAgICAqLwogICAgZnVuY3Rpb24gdXBsb2FkQnJvd3NlckRhdGFUb0Jsb2NrQmxvYihhYm9ydGVyLCBicm93c2VyRGF0YSwgYmxvY2tCbG9iVVJMLCBvcHRpb25zKSB7CiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgYnJvd3NlckJsb2I7CiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHsKICAgICAgICAgICAgICAgIGJyb3dzZXJCbG9iID0gbmV3IEJsb2IoW2Jyb3dzZXJEYXRhXSk7CiAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgVXBsb2FkU2Vla2FibGVCbG9iVG9CbG9ja0Jsb2IoYWJvcnRlciwgZnVuY3Rpb24gKG9mZnNldCwgc2l6ZSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYnJvd3NlckJsb2Iuc2xpY2Uob2Zmc2V0LCBvZmZzZXQgKyBzaXplKTsKICAgICAgICAgICAgICAgICAgICB9LCBicm93c2VyQmxvYi5zaXplLCBibG9ja0Jsb2JVUkwsIG9wdGlvbnMpXTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9CiAgICAvKioKICAgICAqIE9OTFkgQVZBSUxBQkxFIElOIEJST1dTRVJTLgogICAgICoKICAgICAqIFVwbG9hZHMgYSBicm93c2VyIEJsb2Igb2JqZWN0IHRvIGJsb2NrIGJsb2IuIFJlcXVpcmVzIGEgYmxvYkZhY3RvcnkgYXMgdGhlIGRhdGEgc291cmNlLAogICAgICogd2hpY2ggbmVlZCB0byByZXR1cm4gYSBCbG9iIG9iamVjdCB3aXRoIHRoZSBvZmZzZXQgYW5kIHNpemUgcHJvdmlkZWQuCiAgICAgKgogICAgICogV2hlbiBidWZmZXIgbGVuZ3RoIDw9IDI1Nk1CLCB0aGlzIG1ldGhvZCB3aWxsIHVzZSAxIHVwbG9hZCBjYWxsIHRvIGZpbmlzaCB0aGUgdXBsb2FkLgogICAgICogT3RoZXJ3aXNlLCB0aGlzIG1ldGhvZCB3aWxsIGNhbGwgc3RhZ2VCbG9jayB0byB1cGxvYWQgYmxvY2tzLCBhbmQgZmluYWxseSBjYWxsIGNvbW1pdEJsb2NrTGlzdAogICAgICogdG8gY29tbWl0IHRoZSBibG9jayBsaXN0LgogICAgICoKICAgICAqIEBwYXJhbSB7QWJvcnRlcn0gYWJvcnRlciBDcmVhdGUgYSBuZXcgQWJvcnRlciBpbnN0YW5jZSB3aXRoIEFib3J0ZXIubm9uZSBvciBBYm9ydGVyLnRpbWVvdXQoKSwKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICBnb3RvIGRvY3VtZW50cyBvZiBBYm9ydGVyIGZvciBtb3JlIGV4YW1wbGVzIGFib3V0IHJlcXVlc3QgY2FuY2VsbGF0aW9uCiAgICAgKiBAcGFyYW0geyhvZmZzZXQ6IG51bWJlciwgc2l6ZTogbnVtYmVyKSA9PiBCbG9ifSBibG9iRmFjdG9yeQogICAgICogQHBhcmFtIHtudW1iZXJ9IHNpemUKICAgICAqIEBwYXJhbSB7QmxvY2tCbG9iVVJMfSBibG9ja0Jsb2JVUkwKICAgICAqIEBwYXJhbSB7SVVwbG9hZFRvQmxvY2tCbG9iT3B0aW9uc30gW29wdGlvbnNdCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxCbG9iVXBsb2FkQ29tbW9uUmVzcG9uc2U+fQogICAgICovCiAgICBmdW5jdGlvbiBVcGxvYWRTZWVrYWJsZUJsb2JUb0Jsb2NrQmxvYihhYm9ydGVyLCBibG9iRmFjdG9yeSwgc2l6ZSwgYmxvY2tCbG9iVVJMLCBvcHRpb25zKSB7CiAgICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgeyBvcHRpb25zID0ge307IH0KICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBudW1CbG9ja3MsIGJsb2NrTGlzdCwgYmxvY2tJRFByZWZpeCwgdHJhbnNmZXJQcm9ncmVzcywgYmF0Y2gsIF9sb29wXzEsIGk7CiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghb3B0aW9ucy5ibG9ja1NpemUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYmxvY2tTaXplID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5ibG9ja1NpemUgPCAwIHx8IG9wdGlvbnMuYmxvY2tTaXplID4gQkxPQ0tfQkxPQl9NQVhfU1RBR0VfQkxPQ0tfQllURVMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCJibG9ja1NpemUgb3B0aW9uIG11c3QgYmUgPj0gMCBhbmQgPD0gIiArIEJMT0NLX0JMT0JfTUFYX1NUQUdFX0JMT0NLX0JZVEVTKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5tYXhTaW5nbGVTaG90U2l6ZSAhPT0gMCAmJiAhb3B0aW9ucy5tYXhTaW5nbGVTaG90U2l6ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5tYXhTaW5nbGVTaG90U2l6ZSA9IEJMT0NLX0JMT0JfTUFYX1VQTE9BRF9CTE9CX0JZVEVTOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLm1heFNpbmdsZVNob3RTaXplIDwgMCB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5tYXhTaW5nbGVTaG90U2l6ZSA+IEJMT0NLX0JMT0JfTUFYX1VQTE9BRF9CTE9CX0JZVEVTKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigibWF4U2luZ2xlU2hvdFNpemUgb3B0aW9uIG11c3QgYmUgPj0gMCBhbmQgPD0gIiArIEJMT0NLX0JMT0JfTUFYX1VQTE9BRF9CTE9CX0JZVEVTKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5ibG9ja1NpemUgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzaXplID4gQkxPQ0tfQkxPQl9NQVhfU1RBR0VfQkxPQ0tfQllURVMgKiBCTE9DS19CTE9CX01BWF9CTE9DS1MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcihzaXplICsgIiBpcyB0b28gbGFyZ2VyIHRvIHVwbG9hZCB0byBhIGJsb2NrIGJsb2IuIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2l6ZSA+IG9wdGlvbnMubWF4U2luZ2xlU2hvdFNpemUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmJsb2NrU2l6ZSA9IE1hdGguY2VpbChzaXplIC8gQkxPQ0tfQkxPQl9NQVhfQkxPQ0tTKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5ibG9ja1NpemUgPCBERUZBVUxUX0JMT0JfRE9XTkxPQURfQkxPQ0tfQllURVMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5ibG9ja1NpemUgPSBERUZBVUxUX0JMT0JfRE9XTkxPQURfQkxPQ0tfQllURVM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghb3B0aW9ucy5ibG9iSFRUUEhlYWRlcnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYmxvYkhUVFBIZWFkZXJzID0ge307CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFvcHRpb25zLmJsb2JBY2Nlc3NDb25kaXRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmJsb2JBY2Nlc3NDb25kaXRpb25zID0ge307CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNpemUgPD0gb3B0aW9ucy5tYXhTaW5nbGVTaG90U2l6ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIGJsb2NrQmxvYlVSTC51cGxvYWQoYWJvcnRlciwgYmxvYkZhY3RvcnkoMCwgc2l6ZSksIHNpemUsIG9wdGlvbnMpXTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBudW1CbG9ja3MgPSBNYXRoLmZsb29yKChzaXplIC0gMSkgLyBvcHRpb25zLmJsb2NrU2l6ZSkgKyAxOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAobnVtQmxvY2tzID4gQkxPQ0tfQkxPQl9NQVhfQkxPQ0tTKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiVGhlIGJ1ZmZlcidzIHNpemUgaXMgdG9vIGJpZyBvciB0aGUgQmxvY2tTaXplIGlzIHRvbyBzbWFsbDsiICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoInRoZSBudW1iZXIgb2YgYmxvY2tzIG11c3QgYmUgPD0gIiArIEJMT0NLX0JMT0JfTUFYX0JMT0NLUykpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrTGlzdCA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICBibG9ja0lEUHJlZml4ID0gZ2VuZXJhdGVVdWlkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zZmVyUHJvZ3Jlc3MgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBiYXRjaCA9IG5ldyBCYXRjaChvcHRpb25zLnBhcmFsbGVsaXNtKTsKICAgICAgICAgICAgICAgICAgICAgICAgX2xvb3BfMSA9IGZ1bmN0aW9uIChpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYXRjaC5hZGRPcGVyYXRpb24oZnVuY3Rpb24gKCkgeyByZXR1cm4gX19hd2FpdGVyKF90aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBibG9ja0lELCBzdGFydCwgZW5kLCBjb250ZW50TGVuZ3RoOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrSUQgPSBnZW5lcmF0ZUJsb2NrSUQoYmxvY2tJRFByZWZpeCwgaSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQgPSBvcHRpb25zLmJsb2NrU2l6ZSAqIGk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kID0gaSA9PT0gbnVtQmxvY2tzIC0gMSA/IHNpemUgOiBzdGFydCArIG9wdGlvbnMuYmxvY2tTaXplOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRMZW5ndGggPSBlbmQgLSBzdGFydDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBibG9ja0xpc3QucHVzaChibG9ja0lEKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBibG9ja0Jsb2JVUkwuc3RhZ2VCbG9jayhhYm9ydGVyLCBibG9ja0lELCBibG9iRmFjdG9yeShzdGFydCwgY29udGVudExlbmd0aCksIGNvbnRlbnRMZW5ndGgsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlYXNlQWNjZXNzQ29uZGl0aW9uczogb3B0aW9ucy5ibG9iQWNjZXNzQ29uZGl0aW9ucy5sZWFzZUFjY2Vzc0NvbmRpdGlvbnMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSldOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgcHJvZ3Jlc3MgYWZ0ZXIgYmxvY2sgaXMgc3VjY2Vzc2Z1bGx5IHVwbG9hZGVkIHRvIHNlcnZlciwgaW4gY2FzZSBvZiBibG9jayB0cnlpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUT0RPOiBIb29rIHdpdGggY29udmVuaWVuY2UgbGF5ZXIgcHJvZ3Jlc3MgZXZlbnQgaW4gZmluZXIgbGV2ZWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2ZlclByb2dyZXNzICs9IGNvbnRlbnRMZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMucHJvZ3Jlc3MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5wcm9ncmVzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkZWRCeXRlczogdHJhbnNmZXJQcm9ncmVzcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBudW1CbG9ja3M7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2xvb3BfMShpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBiYXRjaC5kbygpXTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIGJsb2NrQmxvYlVSTC5jb21taXRCbG9ja0xpc3QoYWJvcnRlciwgYmxvY2tMaXN0LCBvcHRpb25zKV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogUGFnZUJsb2JVUkwgZGVmaW5lcyBhIHNldCBvZiBvcGVyYXRpb25zIGFwcGxpY2FibGUgdG8gcGFnZSBibG9icy4KICAgICAqCiAgICAgKiBAZXhwb3J0CiAgICAgKiBAY2xhc3MgUGFnZUJsb2JVUkwKICAgICAqIEBleHRlbmRzIHtTdG9yYWdlVVJMfQogICAgICovCiAgICB2YXIgUGFnZUJsb2JVUkwgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CiAgICAgICAgX19leHRlbmRzKFBhZ2VCbG9iVVJMLCBfc3VwZXIpOwogICAgICAgIC8qKgogICAgICAgICAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgUGFnZUJsb2JVUkwuCiAgICAgICAgICogVGhpcyBtZXRob2QgYWNjZXB0cyBhbiBlbmNvZGVkIFVSTCBvciBub24tZW5jb2RlZCBVUkwgcG9pbnRpbmcgdG8gYSBwYWdlIGJsb2IuCiAgICAgICAgICogRW5jb2RlZCBVUkwgc3RyaW5nIHdpbGwgTk9UIGJlIGVzY2FwZWQgdHdpY2UsIG9ubHkgc3BlY2lhbCBjaGFyYWN0ZXJzIGluIFVSTCBwYXRoIHdpbGwgYmUgZXNjYXBlZC4KICAgICAgICAgKiBJZiBhIGJsb2IgbmFtZSBpbmNsdWRlcyA/IG9yICUsIGJsb2IgbmFtZSBtdXN0IGJlIGVuY29kZWQgaW4gdGhlIFVSTC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgQSBVUkwgc3RyaW5nIHBvaW50aW5nIHRvIEF6dXJlIFN0b3JhZ2UgcGFnZSBibG9iLCBzdWNoIGFzCiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICAiaHR0cHM6Ly9teWFjY291bnQuYmxvYi5jb3JlLndpbmRvd3MubmV0L215Y29udGFpbmVyL3BhZ2VibG9iIi4gWW91IGNhbgogICAgICAgICAqICAgICAgICAgICAgICAgICAgICAgYXBwZW5kIGEgU0FTIGlmIHVzaW5nIEFub255bW91c0NyZWRlbnRpYWwsIHN1Y2ggYXMKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICJodHRwczovL215YWNjb3VudC5ibG9iLmNvcmUud2luZG93cy5uZXQvbXljb250YWluZXIvcGFnZWJsb2I/c2FzU3RyaW5nIi4KICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgIFRoaXMgbWV0aG9kIGFjY2VwdHMgYW4gZW5jb2RlZCBVUkwgb3Igbm9uLWVuY29kZWQgVVJMIHBvaW50aW5nIHRvIGEgYmxvYi4KICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgIEVuY29kZWQgVVJMIHN0cmluZyB3aWxsIE5PVCBiZSBlc2NhcGVkIHR3aWNlLCBvbmx5IHNwZWNpYWwgY2hhcmFjdGVycyBpbiBVUkwgcGF0aCB3aWxsIGJlIGVzY2FwZWQuCiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICBIb3dldmVyLCBpZiBhIGJsb2IgbmFtZSBpbmNsdWRlcyA/IG9yICUsIGJsb2IgbmFtZSBtdXN0IGJlIGVuY29kZWQgaW4gdGhlIFVSTC4KICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgIFN1Y2ggYXMgYSBibG9iIG5hbWVkICJteT9ibG9iJSIsIHRoZSBVUkwgc2hvdWxkIGJlICJodHRwczovL215YWNjb3VudC5ibG9iLmNvcmUud2luZG93cy5uZXQvbXljb250YWluZXIvbXklM0ZibG9iJTI1Ii4KICAgICAgICAgKiBAcGFyYW0ge1BpcGVsaW5lfSBwaXBlbGluZSBDYWxsIFN0b3JhZ2VVUkwubmV3UGlwZWxpbmUoKSB0byBjcmVhdGUgYSBkZWZhdWx0CiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGlwZWxpbmUsIG9yIHByb3ZpZGUgYSBjdXN0b21pemVkIHBpcGVsaW5lLgogICAgICAgICAqIEBtZW1iZXJvZiBQYWdlQmxvYlVSTAogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIFBhZ2VCbG9iVVJMKHVybCwgcGlwZWxpbmUpIHsKICAgICAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgdXJsLCBwaXBlbGluZSkgfHwgdGhpczsKICAgICAgICAgICAgX3RoaXMucGFnZUJsb2JDb250ZXh0ID0gbmV3IFBhZ2VCbG9iKF90aGlzLnN0b3JhZ2VDbGllbnRDb250ZXh0KTsKICAgICAgICAgICAgcmV0dXJuIF90aGlzOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGVzIGEgUGFnZUJsb2JVUkwgb2JqZWN0IGZyb20gQ29udGFpbmVyVVJMIGluc3RhbmNlLgogICAgICAgICAqCiAgICAgICAgICogQHN0YXRpYwogICAgICAgICAqIEBwYXJhbSB7Q29udGFpbmVyVVJMfSBjb250YWluZXJVUkwgQSBDb250YWluZXJVUkwgb2JqZWN0CiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IGJsb2JOYW1lIEEgcGFnZSBibG9iIG5hbWUKICAgICAgICAgKiBAcmV0dXJucyB7UGFnZUJsb2JVUkx9CiAgICAgICAgICogQG1lbWJlcm9mIFBhZ2VCbG9iVVJMCiAgICAgICAgICovCiAgICAgICAgUGFnZUJsb2JVUkwuZnJvbUNvbnRhaW5lclVSTCA9IGZ1bmN0aW9uIChjb250YWluZXJVUkwsIGJsb2JOYW1lKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgUGFnZUJsb2JVUkwoYXBwZW5kVG9VUkxQYXRoKGNvbnRhaW5lclVSTC51cmwsIGVuY29kZVVSSUNvbXBvbmVudChibG9iTmFtZSkpLCBjb250YWluZXJVUkwucGlwZWxpbmUpOwogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogQ3JlYXRlcyBhIFBhZ2VCbG9iVVJMIG9iamVjdCBmcm9tIEJsb2JVUkwgaW5zdGFuY2UuCiAgICAgICAgICoKICAgICAgICAgKiBAc3RhdGljCiAgICAgICAgICogQHBhcmFtIHtCbG9iVVJMfSBibG9iVVJMCiAgICAgICAgICogQHJldHVybnMge1BhZ2VCbG9iVVJMfQogICAgICAgICAqIEBtZW1iZXJvZiBQYWdlQmxvYlVSTAogICAgICAgICAqLwogICAgICAgIFBhZ2VCbG9iVVJMLmZyb21CbG9iVVJMID0gZnVuY3Rpb24gKGJsb2JVUkwpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBQYWdlQmxvYlVSTChibG9iVVJMLnVybCwgYmxvYlVSTC5waXBlbGluZSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGVzIGEgbmV3IFBhZ2VCbG9iVVJMIG9iamVjdCBpZGVudGljYWwgdG8gdGhlIHNvdXJjZSBidXQgd2l0aCB0aGUKICAgICAgICAgKiBzcGVjaWZpZWQgcmVxdWVzdCBwb2xpY3kgcGlwZWxpbmUuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge1BpcGVsaW5lfSBwaXBlbGluZQogICAgICAgICAqIEByZXR1cm5zIHtQYWdlQmxvYlVSTH0KICAgICAgICAgKiBAbWVtYmVyb2YgUGFnZUJsb2JVUkwKICAgICAgICAgKi8KICAgICAgICBQYWdlQmxvYlVSTC5wcm90b3R5cGUud2l0aFBpcGVsaW5lID0gZnVuY3Rpb24gKHBpcGVsaW5lKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgUGFnZUJsb2JVUkwodGhpcy51cmwsIHBpcGVsaW5lKTsKICAgICAgICB9OwogICAgICAgIC8qKgogICAgICAgICAqIENyZWF0ZXMgYSBuZXcgUGFnZUJsb2JVUkwgb2JqZWN0IGlkZW50aWNhbCB0byB0aGUgc291cmNlIGJ1dCB3aXRoIHRoZQogICAgICAgICAqIHNwZWNpZmllZCBzbmFwc2hvdCB0aW1lc3RhbXAuCiAgICAgICAgICogUHJvdmlkZSAiIiB3aWxsIHJlbW92ZSB0aGUgc25hcHNob3QgYW5kIHJldHVybiBhIFVSTCB0byB0aGUgYmFzZSBibG9iLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHNuYXBzaG90CiAgICAgICAgICogQHJldHVybnMge1BhZ2VCbG9iVVJMfQogICAgICAgICAqIEBtZW1iZXJvZiBQYWdlQmxvYlVSTAogICAgICAgICAqLwogICAgICAgIFBhZ2VCbG9iVVJMLnByb3RvdHlwZS53aXRoU25hcHNob3QgPSBmdW5jdGlvbiAoc25hcHNob3QpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBQYWdlQmxvYlVSTChzZXRVUkxQYXJhbWV0ZXIodGhpcy51cmwsIFVSTENvbnN0YW50cy5QYXJhbWV0ZXJzLlNOQVBTSE9ULCBzbmFwc2hvdC5sZW5ndGggPT09IDAgPyB1bmRlZmluZWQgOiBzbmFwc2hvdCksIHRoaXMucGlwZWxpbmUpOwogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogQ3JlYXRlcyBhIHBhZ2UgYmxvYiBvZiB0aGUgc3BlY2lmaWVkIGxlbmd0aC4gQ2FsbCB1cGxvYWRQYWdlcyB0byB1cGxvYWQgZGF0YQogICAgICAgICAqIGRhdGEgdG8gYSBwYWdlIGJsb2IuCiAgICAgICAgICogQHNlZSBodHRwczovL2RvY3MubWljcm9zb2Z0LmNvbS9yZXN0L2FwaS9zdG9yYWdlc2VydmljZXMvcHV0LWJsb2IKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7QWJvcnRlcn0gYWJvcnRlciBDcmVhdGUgYSBuZXcgQWJvcnRlciBpbnN0YW5jZSB3aXRoIEFib3J0ZXIubm9uZSBvciBBYm9ydGVyLnRpbWVvdXQoKSwKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgZ290byBkb2N1bWVudHMgb2YgQWJvcnRlciBmb3IgbW9yZSBleGFtcGxlcyBhYm91dCByZXF1ZXN0IGNhbmNlbGxhdGlvbgogICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBzaXplCiAgICAgICAgICogQHBhcmFtIHtJUGFnZUJsb2JDcmVhdGVPcHRpb25zfSBbb3B0aW9uc10KICAgICAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxNb2RlbHMuUGFnZUJsb2JDcmVhdGVSZXNwb25zZT59CiAgICAgICAgICogQG1lbWJlcm9mIFBhZ2VCbG9iVVJMCiAgICAgICAgICovCiAgICAgICAgUGFnZUJsb2JVUkwucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uIChhYm9ydGVyLCBzaXplLCBvcHRpb25zKSB7CiAgICAgICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsgb3B0aW9ucyA9IHt9OyB9CiAgICAgICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHsKICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmFjY2Vzc0NvbmRpdGlvbnMgPSBvcHRpb25zLmFjY2Vzc0NvbmRpdGlvbnMgfHwge307CiAgICAgICAgICAgICAgICAgICAgZW5zdXJlQ3BrSWZTcGVjaWZpZWQob3B0aW9ucy5jdXN0b21lclByb3ZpZGVkS2V5LCB0aGlzLmlzSHR0cHMpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCB0aGlzLnBhZ2VCbG9iQ29udGV4dC5jcmVhdGUoMCwgc2l6ZSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWJvcnRTaWduYWw6IGFib3J0ZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBibG9iSFRUUEhlYWRlcnM6IG9wdGlvbnMuYmxvYkhUVFBIZWFkZXJzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxvYlNlcXVlbmNlTnVtYmVyOiBvcHRpb25zLmJsb2JTZXF1ZW5jZU51bWJlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlYXNlQWNjZXNzQ29uZGl0aW9uczogb3B0aW9ucy5hY2Nlc3NDb25kaXRpb25zLmxlYXNlQWNjZXNzQ29uZGl0aW9ucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhOiBvcHRpb25zLm1ldGFkYXRhLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zOiBvcHRpb25zLmFjY2Vzc0NvbmRpdGlvbnMubW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3BrSW5mbzogb3B0aW9ucy5jdXN0b21lclByb3ZpZGVkS2V5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGllcjogdG9BY2Nlc3NUaWVyKG9wdGlvbnMudGllcikKICAgICAgICAgICAgICAgICAgICAgICAgfSldOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogV3JpdGVzIDEgb3IgbW9yZSBwYWdlcyB0byB0aGUgcGFnZSBibG9iLiBUaGUgc3RhcnQgYW5kIGVuZCBvZmZzZXRzIG11c3QgYmUgYSBtdWx0aXBsZSBvZiA1MTIuCiAgICAgICAgICogQHNlZSBodHRwczovL2RvY3MubWljcm9zb2Z0LmNvbS9yZXN0L2FwaS9zdG9yYWdlc2VydmljZXMvcHV0LXBhZ2UKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7QWJvcnRlcn0gYWJvcnRlciBDcmVhdGUgYSBuZXcgQWJvcnRlciBpbnN0YW5jZSB3aXRoIEFib3J0ZXIubm9uZSBvciBBYm9ydGVyLnRpbWVvdXQoKSwKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgZ290byBkb2N1bWVudHMgb2YgQWJvcnRlciBmb3IgbW9yZSBleGFtcGxlcyBhYm91dCByZXF1ZXN0IGNhbmNlbGxhdGlvbgogICAgICAgICAqIEBwYXJhbSB7SHR0cFJlcXVlc3RCb2R5fSBib2R5CiAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IG9mZnNldCBPZmZzZXQgb2YgZGVzdGluYXRpb24gcGFnZSBibG9iCiAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IGNvdW50IENvbnRlbnQgbGVuZ3RoIG9mIHRoZSBib2R5LCBhbHNvIG51bWJlciBvZiBieXRlcyB0byBiZSB1cGxvYWRlZAogICAgICAgICAqIEBwYXJhbSB7SVBhZ2VCbG9iVXBsb2FkUGFnZXNPcHRpb25zfSBbb3B0aW9uc10KICAgICAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxNb2RlbHMuUGFnZUJsb2JzVXBsb2FkUGFnZXNSZXNwb25zZT59CiAgICAgICAgICogQG1lbWJlcm9mIFBhZ2VCbG9iVVJMCiAgICAgICAgICovCiAgICAgICAgUGFnZUJsb2JVUkwucHJvdG90eXBlLnVwbG9hZFBhZ2VzID0gZnVuY3Rpb24gKGFib3J0ZXIsIGJvZHksIG9mZnNldCwgY291bnQsIG9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgeyBvcHRpb25zID0ge307IH0KICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkgewogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYWNjZXNzQ29uZGl0aW9ucyA9IG9wdGlvbnMuYWNjZXNzQ29uZGl0aW9ucyB8fCB7fTsKICAgICAgICAgICAgICAgICAgICBlbnN1cmVDcGtJZlNwZWNpZmllZChvcHRpb25zLmN1c3RvbWVyUHJvdmlkZWRLZXksIHRoaXMuaXNIdHRwcyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHRoaXMucGFnZUJsb2JDb250ZXh0LnVwbG9hZFBhZ2VzKGJvZHksIGNvdW50LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYm9ydFNpZ25hbDogYWJvcnRlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlYXNlQWNjZXNzQ29uZGl0aW9uczogb3B0aW9ucy5hY2Nlc3NDb25kaXRpb25zLmxlYXNlQWNjZXNzQ29uZGl0aW9ucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGlmaWVkQWNjZXNzQ29uZGl0aW9uczogb3B0aW9ucy5hY2Nlc3NDb25kaXRpb25zLm1vZGlmaWVkQWNjZXNzQ29uZGl0aW9ucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uVXBsb2FkUHJvZ3Jlc3M6IG9wdGlvbnMucHJvZ3Jlc3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByYW5nZTogcmFuZ2VUb1N0cmluZyh7IG9mZnNldDogb2Zmc2V0LCBjb3VudDogY291bnQgfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXF1ZW5jZU51bWJlckFjY2Vzc0NvbmRpdGlvbnM6IG9wdGlvbnMuYWNjZXNzQ29uZGl0aW9ucy5zZXF1ZW5jZU51bWJlckFjY2Vzc0NvbmRpdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbmFsQ29udGVudE1ENTogb3B0aW9ucy50cmFuc2FjdGlvbmFsQ29udGVudE1ENSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uYWxDb250ZW50Q3JjNjQ6IG9wdGlvbnMudHJhbnNhY3Rpb25hbENvbnRlbnRDcmM2NCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNwa0luZm86IG9wdGlvbnMuY3VzdG9tZXJQcm92aWRlZEtleQogICAgICAgICAgICAgICAgICAgICAgICB9KV07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBUaGUgVXBsb2FkIFBhZ2VzIG9wZXJhdGlvbiB3cml0ZXMgYSByYW5nZSBvZiBwYWdlcyB0byBhIHBhZ2UgYmxvYiB3aGVyZSB0aGUKICAgICAgICAgKiBjb250ZW50cyBhcmUgcmVhZCBmcm9tIGEgVVJMLgogICAgICAgICAqIEBzZWUgaHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvcmVzdC9hcGkvc3RvcmFnZXNlcnZpY2VzL3B1dC1wYWdlLWZyb20tdXJsCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge0Fib3J0ZXJ9IGFib3J0ZXIgQ3JlYXRlIGEgbmV3IEFib3J0ZXIgaW5zdGFuY2Ugd2l0aCBBYm9ydGVyLm5vbmUgb3IgQWJvcnRlci50aW1lb3V0KCksCiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgIGdvdG8gZG9jdW1lbnRzIG9mIEFib3J0ZXIgZm9yIG1vcmUgZXhhbXBsZXMgYWJvdXQgcmVxdWVzdCBjYW5jZWxsYXRpb24KICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gc291cmNlVVJMIFNwZWNpZnkgYSBVUkwgdG8gdGhlIGNvcHkgc291cmNlLCBTaGFyZWQgQWNjZXNzIFNpZ25hdHVyZShTQVMpIG1heWJlIG5lZWRlZCBmb3IgYXV0aGVudGljYXRpb24KICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gc291cmNlT2Zmc2V0IFRoZSBzb3VyY2Ugb2Zmc2V0IHRvIGNvcHkgZnJvbS4gUGFzcyAwIHRvIGNvcHkgZnJvbSB0aGUgYmVnaW5uaW5nIG9mIHNvdXJjZSBwYWdlIGJsb2IKICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gZGVzdE9mZnNldCBPZmZzZXQgb2YgZGVzdGluYXRpb24gcGFnZSBibG9iCiAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IGNvdW50IE51bWJlciBvZiBieXRlcyB0byBiZSB1cGxvYWRlZCBmcm9tIHNvdXJjZSBwYWdlIGJsb2IKICAgICAgICAgKiBAcGFyYW0ge0lQYWdlQmxvYlVwbG9hZFBhZ2VzRnJvbVVSTE9wdGlvbnN9IFtvcHRpb25zPXt9XQogICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlPE1vZGVscy5QYWdlQmxvYlVwbG9hZFBhZ2VzRnJvbVVSTFJlc3BvbnNlPn0KICAgICAgICAgKiBAbWVtYmVyb2YgUGFnZUJsb2JVUkwKICAgICAgICAgKi8KICAgICAgICBQYWdlQmxvYlVSTC5wcm90b3R5cGUudXBsb2FkUGFnZXNGcm9tVVJMID0gZnVuY3Rpb24gKGFib3J0ZXIsIHNvdXJjZVVSTCwgc291cmNlT2Zmc2V0LCBkZXN0T2Zmc2V0LCBjb3VudCwgb3B0aW9ucykgewogICAgICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7IG9wdGlvbnMgPSB7fTsgfQogICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7CiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5hY2Nlc3NDb25kaXRpb25zID0gb3B0aW9ucy5hY2Nlc3NDb25kaXRpb25zIHx8IHt9OwogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuc291cmNlTW9kaWZpZWRBY2Nlc3NDb25kaXRpb25zID0gb3B0aW9ucy5zb3VyY2VNb2RpZmllZEFjY2Vzc0NvbmRpdGlvbnMgfHwge307CiAgICAgICAgICAgICAgICAgICAgZW5zdXJlQ3BrSWZTcGVjaWZpZWQob3B0aW9ucy5jdXN0b21lclByb3ZpZGVkS2V5LCB0aGlzLmlzSHR0cHMpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCB0aGlzLnBhZ2VCbG9iQ29udGV4dC51cGxvYWRQYWdlc0Zyb21VUkwoc291cmNlVVJMLCByYW5nZVRvU3RyaW5nKHsgb2Zmc2V0OiBzb3VyY2VPZmZzZXQsIGNvdW50OiBjb3VudCB9KSwgMCwgcmFuZ2VUb1N0cmluZyh7IG9mZnNldDogZGVzdE9mZnNldCwgY291bnQ6IGNvdW50IH0pLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYm9ydFNpZ25hbDogYWJvcnRlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZUNvbnRlbnRNRDU6IG9wdGlvbnMuc291cmNlQ29udGVudE1ENSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZUNvbnRlbnRDcmM2NDogb3B0aW9ucy5zb3VyY2VDb250ZW50Q3JjNjQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWFzZUFjY2Vzc0NvbmRpdGlvbnM6IG9wdGlvbnMuYWNjZXNzQ29uZGl0aW9ucy5sZWFzZUFjY2Vzc0NvbmRpdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXF1ZW5jZU51bWJlckFjY2Vzc0NvbmRpdGlvbnM6IG9wdGlvbnMuYWNjZXNzQ29uZGl0aW9ucy5zZXF1ZW5jZU51bWJlckFjY2Vzc0NvbmRpdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RpZmllZEFjY2Vzc0NvbmRpdGlvbnM6IG9wdGlvbnMuYWNjZXNzQ29uZGl0aW9ucy5tb2RpZmllZEFjY2Vzc0NvbmRpdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VNb2RpZmllZEFjY2Vzc0NvbmRpdGlvbnM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VJZk1hdGNoOiBvcHRpb25zLnNvdXJjZU1vZGlmaWVkQWNjZXNzQ29uZGl0aW9ucy5pZk1hdGNoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZUlmTW9kaWZpZWRTaW5jZTogb3B0aW9ucy5zb3VyY2VNb2RpZmllZEFjY2Vzc0NvbmRpdGlvbnMuaWZNb2RpZmllZFNpbmNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZUlmTm9uZU1hdGNoOiBvcHRpb25zLnNvdXJjZU1vZGlmaWVkQWNjZXNzQ29uZGl0aW9ucy5pZk5vbmVNYXRjaCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VJZlVubW9kaWZpZWRTaW5jZTogb3B0aW9ucy5zb3VyY2VNb2RpZmllZEFjY2Vzc0NvbmRpdGlvbnMuaWZVbm1vZGlmaWVkU2luY2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcGtJbmZvOiBvcHRpb25zLmN1c3RvbWVyUHJvdmlkZWRLZXkKICAgICAgICAgICAgICAgICAgICAgICAgfSldOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogRnJlZXMgdGhlIHNwZWNpZmllZCBwYWdlcyBmcm9tIHRoZSBwYWdlIGJsb2IuCiAgICAgICAgICogQHNlZSBodHRwczovL2RvY3MubWljcm9zb2Z0LmNvbS9yZXN0L2FwaS9zdG9yYWdlc2VydmljZXMvcHV0LXBhZ2UKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7QWJvcnRlcn0gYWJvcnRlciBDcmVhdGUgYSBuZXcgQWJvcnRlciBpbnN0YW5jZSB3aXRoIEFib3J0ZXIubm9uZSBvciBBYm9ydGVyLnRpbWVvdXQoKSwKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgZ290byBkb2N1bWVudHMgb2YgQWJvcnRlciBmb3IgbW9yZSBleGFtcGxlcyBhYm91dCByZXF1ZXN0IGNhbmNlbGxhdGlvbgogICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBvZmZzZXQKICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gY291bnQKICAgICAgICAgKiBAcGFyYW0ge0lQYWdlQmxvYkNsZWFyUGFnZXNPcHRpb25zfSBbb3B0aW9uc10KICAgICAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxNb2RlbHMuUGFnZUJsb2JDbGVhclBhZ2VzUmVzcG9uc2U+fQogICAgICAgICAqIEBtZW1iZXJvZiBQYWdlQmxvYlVSTAogICAgICAgICAqLwogICAgICAgIFBhZ2VCbG9iVVJMLnByb3RvdHlwZS5jbGVhclBhZ2VzID0gZnVuY3Rpb24gKGFib3J0ZXIsIG9mZnNldCwgY291bnQsIG9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgeyBvcHRpb25zID0ge307IH0KICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkgewogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYWNjZXNzQ29uZGl0aW9ucyA9IG9wdGlvbnMuYWNjZXNzQ29uZGl0aW9ucyB8fCB7fTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgdGhpcy5wYWdlQmxvYkNvbnRleHQuY2xlYXJQYWdlcygwLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYm9ydFNpZ25hbDogYWJvcnRlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlYXNlQWNjZXNzQ29uZGl0aW9uczogb3B0aW9ucy5hY2Nlc3NDb25kaXRpb25zLmxlYXNlQWNjZXNzQ29uZGl0aW9ucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGlmaWVkQWNjZXNzQ29uZGl0aW9uczogb3B0aW9ucy5hY2Nlc3NDb25kaXRpb25zLm1vZGlmaWVkQWNjZXNzQ29uZGl0aW9ucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhbmdlOiByYW5nZVRvU3RyaW5nKHsgb2Zmc2V0OiBvZmZzZXQsIGNvdW50OiBjb3VudCB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlcXVlbmNlTnVtYmVyQWNjZXNzQ29uZGl0aW9uczogb3B0aW9ucy5hY2Nlc3NDb25kaXRpb25zLnNlcXVlbmNlTnVtYmVyQWNjZXNzQ29uZGl0aW9ucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNwa0luZm86IG9wdGlvbnMuY3VzdG9tZXJQcm92aWRlZEtleQogICAgICAgICAgICAgICAgICAgICAgICB9KV07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm5zIHRoZSBsaXN0IG9mIHZhbGlkIHBhZ2UgcmFuZ2VzIGZvciBhIHBhZ2UgYmxvYiBvciBzbmFwc2hvdCBvZiBhIHBhZ2UgYmxvYi4KICAgICAgICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5taWNyb3NvZnQuY29tL3Jlc3QvYXBpL3N0b3JhZ2VzZXJ2aWNlcy9nZXQtcGFnZS1yYW5nZXMKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7QWJvcnRlcn0gYWJvcnRlciBDcmVhdGUgYSBuZXcgQWJvcnRlciBpbnN0YW5jZSB3aXRoIEFib3J0ZXIubm9uZSBvciBBYm9ydGVyLnRpbWVvdXQoKSwKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgZ290byBkb2N1bWVudHMgb2YgQWJvcnRlciBmb3IgbW9yZSBleGFtcGxlcyBhYm91dCByZXF1ZXN0IGNhbmNlbGxhdGlvbgogICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBvZmZzZXQKICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gY291bnQKICAgICAgICAgKiBAcGFyYW0ge0lQYWdlQmxvYkdldFBhZ2VSYW5nZXNPcHRpb25zfSBbb3B0aW9uc10KICAgICAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxNb2RlbHMuUGFnZUJsb2JHZXRQYWdlUmFuZ2VzUmVzcG9uc2U+fQogICAgICAgICAqIEBtZW1iZXJvZiBQYWdlQmxvYlVSTAogICAgICAgICAqLwogICAgICAgIFBhZ2VCbG9iVVJMLnByb3RvdHlwZS5nZXRQYWdlUmFuZ2VzID0gZnVuY3Rpb24gKGFib3J0ZXIsIG9mZnNldCwgY291bnQsIG9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgeyBvcHRpb25zID0ge307IH0KICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkgewogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYWNjZXNzQ29uZGl0aW9ucyA9IG9wdGlvbnMuYWNjZXNzQ29uZGl0aW9ucyB8fCB7fTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgdGhpcy5wYWdlQmxvYkNvbnRleHQuZ2V0UGFnZVJhbmdlcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYm9ydFNpZ25hbDogYWJvcnRlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlYXNlQWNjZXNzQ29uZGl0aW9uczogb3B0aW9ucy5hY2Nlc3NDb25kaXRpb25zLmxlYXNlQWNjZXNzQ29uZGl0aW9ucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGlmaWVkQWNjZXNzQ29uZGl0aW9uczogb3B0aW9ucy5hY2Nlc3NDb25kaXRpb25zLm1vZGlmaWVkQWNjZXNzQ29uZGl0aW9ucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhbmdlOiByYW5nZVRvU3RyaW5nKHsgb2Zmc2V0OiBvZmZzZXQsIGNvdW50OiBjb3VudCB9KQogICAgICAgICAgICAgICAgICAgICAgICB9KV07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBHZXRzIHRoZSBjb2xsZWN0aW9uIG9mIHBhZ2UgcmFuZ2VzIHRoYXQgZGlmZmVyIGJldHdlZW4gYSBzcGVjaWZpZWQgc25hcHNob3QgYW5kIHRoaXMgcGFnZSBibG9iLgogICAgICAgICAqIEBzZWUgaHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vcmVzdC9hcGkvc3RvcmFnZXNlcnZpY2VzL2dldC1wYWdlLXJhbmdlcwogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtBYm9ydGVyfSBhYm9ydGVyIENyZWF0ZSBhIG5ldyBBYm9ydGVyIGluc3RhbmNlIHdpdGggQWJvcnRlci5ub25lIG9yIEFib3J0ZXIudGltZW91dCgpLAogICAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICBnb3RvIGRvY3VtZW50cyBvZiBBYm9ydGVyIGZvciBtb3JlIGV4YW1wbGVzIGFib3V0IHJlcXVlc3QgY2FuY2VsbGF0aW9uCiAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IG9mZnNldAogICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBjb3VudAogICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBwcmV2U25hcHNob3QKICAgICAgICAgKiBAcGFyYW0ge0lQYWdlQmxvYkdldFBhZ2VSYW5nZXNEaWZmT3B0aW9uc30gW29wdGlvbnNdCiAgICAgICAgICogQHJldHVybnMge1Byb21pc2U8TW9kZWxzLlBhZ2VCbG9iR2V0UGFnZVJhbmdlc0RpZmZSZXNwb25zZT59CiAgICAgICAgICogQG1lbWJlcm9mIFBhZ2VCbG9iVVJMCiAgICAgICAgICovCiAgICAgICAgUGFnZUJsb2JVUkwucHJvdG90eXBlLmdldFBhZ2VSYW5nZXNEaWZmID0gZnVuY3Rpb24gKGFib3J0ZXIsIG9mZnNldCwgY291bnQsIHByZXZTbmFwc2hvdCwgb3B0aW9ucykgewogICAgICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7IG9wdGlvbnMgPSB7fTsgfQogICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7CiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5hY2Nlc3NDb25kaXRpb25zID0gb3B0aW9ucy5hY2Nlc3NDb25kaXRpb25zIHx8IHt9OwogICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCB0aGlzLnBhZ2VCbG9iQ29udGV4dC5nZXRQYWdlUmFuZ2VzRGlmZih7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYm9ydFNpZ25hbDogYWJvcnRlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlYXNlQWNjZXNzQ29uZGl0aW9uczogb3B0aW9ucy5hY2Nlc3NDb25kaXRpb25zLmxlYXNlQWNjZXNzQ29uZGl0aW9ucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGlmaWVkQWNjZXNzQ29uZGl0aW9uczogb3B0aW9ucy5hY2Nlc3NDb25kaXRpb25zLm1vZGlmaWVkQWNjZXNzQ29uZGl0aW9ucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZXZzbmFwc2hvdDogcHJldlNuYXBzaG90LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFuZ2U6IHJhbmdlVG9TdHJpbmcoeyBvZmZzZXQ6IG9mZnNldCwgY291bnQ6IGNvdW50IH0pCiAgICAgICAgICAgICAgICAgICAgICAgIH0pXTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICAgIC8qKgogICAgICAgICAqIFJlc2l6ZXMgdGhlIHBhZ2UgYmxvYiB0byB0aGUgc3BlY2lmaWVkIHNpemUgKHdoaWNoIG11c3QgYmUgYSBtdWx0aXBsZSBvZiA1MTIpLgogICAgICAgICAqIEBzZWUgaHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vcmVzdC9hcGkvc3RvcmFnZXNlcnZpY2VzL3NldC1ibG9iLXByb3BlcnRpZXMKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7QWJvcnRlcn0gYWJvcnRlciBDcmVhdGUgYSBuZXcgQWJvcnRlciBpbnN0YW5jZSB3aXRoIEFib3J0ZXIubm9uZSBvciBBYm9ydGVyLnRpbWVvdXQoKSwKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgZ290byBkb2N1bWVudHMgb2YgQWJvcnRlciBmb3IgbW9yZSBleGFtcGxlcyBhYm91dCByZXF1ZXN0IGNhbmNlbGxhdGlvbgogICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBzaXplCiAgICAgICAgICogQHBhcmFtIHtJUGFnZUJsb2JSZXNpemVPcHRpb25zfSBbb3B0aW9uc10KICAgICAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxNb2RlbHMuUGFnZUJsb2JSZXNpemVSZXNwb25zZT59CiAgICAgICAgICogQG1lbWJlcm9mIFBhZ2VCbG9iVVJMCiAgICAgICAgICovCiAgICAgICAgUGFnZUJsb2JVUkwucHJvdG90eXBlLnJlc2l6ZSA9IGZ1bmN0aW9uIChhYm9ydGVyLCBzaXplLCBvcHRpb25zKSB7CiAgICAgICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsgb3B0aW9ucyA9IHt9OyB9CiAgICAgICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHsKICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmFjY2Vzc0NvbmRpdGlvbnMgPSBvcHRpb25zLmFjY2Vzc0NvbmRpdGlvbnMgfHwge307CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHRoaXMucGFnZUJsb2JDb250ZXh0LnJlc2l6ZShzaXplLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYm9ydFNpZ25hbDogYWJvcnRlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlYXNlQWNjZXNzQ29uZGl0aW9uczogb3B0aW9ucy5hY2Nlc3NDb25kaXRpb25zLmxlYXNlQWNjZXNzQ29uZGl0aW9ucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGlmaWVkQWNjZXNzQ29uZGl0aW9uczogb3B0aW9ucy5hY2Nlc3NDb25kaXRpb25zLm1vZGlmaWVkQWNjZXNzQ29uZGl0aW9ucwogICAgICAgICAgICAgICAgICAgICAgICB9KV07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBTZXRzIGEgcGFnZSBibG9iJ3Mgc2VxdWVuY2UgbnVtYmVyLgogICAgICAgICAqIEBzZWUgaHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvcmVzdC9hcGkvc3RvcmFnZXNlcnZpY2VzL3NldC1ibG9iLXByb3BlcnRpZXMKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7QWJvcnRlcn0gYWJvcnRlciBDcmVhdGUgYSBuZXcgQWJvcnRlciBpbnN0YW5jZSB3aXRoIEFib3J0ZXIubm9uZSBvciBBYm9ydGVyLnRpbWVvdXQoKSwKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgZ290byBkb2N1bWVudHMgb2YgQWJvcnRlciBmb3IgbW9yZSBleGFtcGxlcyBhYm91dCByZXF1ZXN0IGNhbmNlbGxhdGlvbgogICAgICAgICAqIEBwYXJhbSB7TW9kZWxzLlNlcXVlbmNlTnVtYmVyQWN0aW9uVHlwZX0gc2VxdWVuY2VOdW1iZXJBY3Rpb24KICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gW3NlcXVlbmNlTnVtYmVyXSBSZXF1aXJlZCBpZiBzZXF1ZW5jZU51bWJlckFjdGlvbiBpcyBtYXggb3IgdXBkYXRlCiAgICAgICAgICogQHBhcmFtIHtJUGFnZUJsb2JVcGRhdGVTZXF1ZW5jZU51bWJlck9wdGlvbnN9IFtvcHRpb25zXQogICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlPE1vZGVscy5QYWdlQmxvYlVwZGF0ZVNlcXVlbmNlTnVtYmVyUmVzcG9uc2U+fQogICAgICAgICAqIEBtZW1iZXJvZiBQYWdlQmxvYlVSTAogICAgICAgICAqLwogICAgICAgIFBhZ2VCbG9iVVJMLnByb3RvdHlwZS51cGRhdGVTZXF1ZW5jZU51bWJlciA9IGZ1bmN0aW9uIChhYm9ydGVyLCBzZXF1ZW5jZU51bWJlckFjdGlvbiwgc2VxdWVuY2VOdW1iZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgeyBvcHRpb25zID0ge307IH0KICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkgewogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYWNjZXNzQ29uZGl0aW9ucyA9IG9wdGlvbnMuYWNjZXNzQ29uZGl0aW9ucyB8fCB7fTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgdGhpcy5wYWdlQmxvYkNvbnRleHQudXBkYXRlU2VxdWVuY2VOdW1iZXIoc2VxdWVuY2VOdW1iZXJBY3Rpb24sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFib3J0U2lnbmFsOiBhYm9ydGVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxvYlNlcXVlbmNlTnVtYmVyOiBzZXF1ZW5jZU51bWJlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlYXNlQWNjZXNzQ29uZGl0aW9uczogb3B0aW9ucy5hY2Nlc3NDb25kaXRpb25zLmxlYXNlQWNjZXNzQ29uZGl0aW9ucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGlmaWVkQWNjZXNzQ29uZGl0aW9uczogb3B0aW9ucy5hY2Nlc3NDb25kaXRpb25zLm1vZGlmaWVkQWNjZXNzQ29uZGl0aW9ucwogICAgICAgICAgICAgICAgICAgICAgICB9KV07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBCZWdpbnMgYW4gb3BlcmF0aW9uIHRvIHN0YXJ0IGFuIGluY3JlbWVudGFsIGNvcHkgZnJvbSBvbmUgcGFnZSBibG9iJ3Mgc25hcHNob3QgdG8gdGhpcyBwYWdlIGJsb2IuCiAgICAgICAgICogVGhlIHNuYXBzaG90IGlzIGNvcGllZCBzdWNoIHRoYXQgb25seSB0aGUgZGlmZmVyZW50aWFsIGNoYW5nZXMgYmV0d2VlbiB0aGUgcHJldmlvdXNseQogICAgICAgICAqIGNvcGllZCBzbmFwc2hvdCBhcmUgdHJhbnNmZXJyZWQgdG8gdGhlIGRlc3RpbmF0aW9uLgogICAgICAgICAqIFRoZSBjb3BpZWQgc25hcHNob3RzIGFyZSBjb21wbGV0ZSBjb3BpZXMgb2YgdGhlIG9yaWdpbmFsIHNuYXBzaG90IGFuZCBjYW4gYmUgcmVhZCBvciBjb3BpZWQgZnJvbSBhcyB1c3VhbC4KICAgICAgICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5taWNyb3NvZnQuY29tL3Jlc3QvYXBpL3N0b3JhZ2VzZXJ2aWNlcy9pbmNyZW1lbnRhbC1jb3B5LWJsb2IKICAgICAgICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5taWNyb3NvZnQuY29tL2VuLXVzL2F6dXJlL3ZpcnR1YWwtbWFjaGluZXMvd2luZG93cy9pbmNyZW1lbnRhbC1zbmFwc2hvdHMKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7QWJvcnRlcn0gYWJvcnRlciBDcmVhdGUgYSBuZXcgQWJvcnRlciBpbnN0YW5jZSB3aXRoIEFib3J0ZXIubm9uZSBvciBBYm9ydGVyLnRpbWVvdXQoKSwKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgZ290byBkb2N1bWVudHMgb2YgQWJvcnRlciBmb3IgbW9yZSBleGFtcGxlcyBhYm91dCByZXF1ZXN0IGNhbmNlbGxhdGlvbgogICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBjb3B5U291cmNlIFNwZWNpZmllcyB0aGUgbmFtZSBvZiB0aGUgc291cmNlIHBhZ2UgYmxvYiBzbmFwc2hvdC4gRm9yIGV4YW1wbGUsCiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgaHR0cHM6Ly9teWFjY291bnQuYmxvYi5jb3JlLndpbmRvd3MubmV0L215Y29udGFpbmVyL215YmxvYj9zbmFwc2hvdD08RGF0ZVRpbWU+CiAgICAgICAgICogQHBhcmFtIHtJUGFnZUJsb2JTdGFydENvcHlJbmNyZW1lbnRhbE9wdGlvbnN9IFtvcHRpb25zXQogICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlPE1vZGVscy5QYWdlQmxvYkNvcHlJbmNyZW1lbnRhbFJlc3BvbnNlPn0KICAgICAgICAgKiBAbWVtYmVyb2YgUGFnZUJsb2JVUkwKICAgICAgICAgKi8KICAgICAgICBQYWdlQmxvYlVSTC5wcm90b3R5cGUuc3RhcnRDb3B5SW5jcmVtZW50YWwgPSBmdW5jdGlvbiAoYWJvcnRlciwgY29weVNvdXJjZSwgb3B0aW9ucykgewogICAgICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7IG9wdGlvbnMgPSB7fTsgfQogICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHRoaXMucGFnZUJsb2JDb250ZXh0LmNvcHlJbmNyZW1lbnRhbChjb3B5U291cmNlLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYm9ydFNpZ25hbDogYWJvcnRlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGlmaWVkQWNjZXNzQ29uZGl0aW9uczogb3B0aW9ucy5tb2RpZmllZEFjY2Vzc0NvbmRpdGlvbnMKICAgICAgICAgICAgICAgICAgICAgICAgfSldOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgcmV0dXJuIFBhZ2VCbG9iVVJMOwogICAgfShCbG9iVVJMKSk7CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IGEgQnJvd3NlciBCbG9iIG9iamVjdCBpbnRvIHN0cmluZy4KICAgICAqCiAgICAgKiBAZXhwb3J0CiAgICAgKiBAcGFyYW0ge0Jsb2J9IGJsb2IKICAgICAqIEByZXR1cm5zIHtQcm9taXNlPEFycmF5QnVmZmVyPn0KICAgICAqLwogICAgZnVuY3Rpb24gYmxvYlRvU3RyaW5nKGJsb2IpIHsKICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBmaWxlUmVhZGVyOwogICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7CiAgICAgICAgICAgICAgICBmaWxlUmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVSZWFkZXIub25sb2FkZW5kID0gZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGV2LnRhcmdldC5yZXN1bHQpOwogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICBmaWxlUmVhZGVyLm9uZXJyb3IgPSByZWplY3Q7CiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVSZWFkZXIucmVhZEFzVGV4dChibG9iKTsKICAgICAgICAgICAgICAgICAgICB9KV07CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEJvZHlBc1RleHQoYmF0Y2hSZXNwb25zZSkgewogICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGJsb2I7CiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIDA6IHJldHVybiBbNCAvKnlpZWxkKi8sIGJhdGNoUmVzcG9uc2UuYmxvYkJvZHldOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgICAgICAgICAgYmxvYiA9IChfYS5zZW50KCkpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBibG9iVG9TdHJpbmcoYmxvYildOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjogcmV0dXJuIFsyIC8qcmV0dXJuKi8sIF9hLnNlbnQoKV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfQogICAgZnVuY3Rpb24gdXRmOEJ5dGVMZW5ndGgoc3RyKSB7CiAgICAgICAgcmV0dXJuIG5ldyBCbG9iKFtzdHJdKS5zaXplOwogICAgfQoKICAgIHZhciBIVFRQX0hFQURFUl9ERUxJTUlURVIgPSAiOiAiOwogICAgdmFyIFNQQUNFX0RFTElNSVRFUiA9ICIgIjsKICAgIHZhciBOT1RfRk9VTkQgPSAtMTsKICAgIC8qKgogICAgICogVXRpbCBjbGFzcyBmb3IgcGFyc2luZyBiYXRjaCByZXNwb25zZS4KICAgICAqLwogICAgdmFyIEJhdGNoUmVzcG9uc2VQYXJzZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CiAgICAgICAgZnVuY3Rpb24gQmF0Y2hSZXNwb25zZVBhcnNlcihiYXRjaFJlc3BvbnNlLCBzdWJSZXF1ZXN0cykgewogICAgICAgICAgICBpZiAoIWJhdGNoUmVzcG9uc2UgfHwgIWJhdGNoUmVzcG9uc2UuY29udGVudFR5cGUpIHsKICAgICAgICAgICAgICAgIC8vIEluIHNwZWNpYWwgY2FzZShyZXBvcnRlZCksIHNlcnZlciBtYXkgcmV0dXJuIGludmFsaWQgY29udGVudC10eXBlIHdoaWNoIGNvdWxkIG5vdCBiZSBwYXJzZWQuCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiYmF0Y2hSZXNwb25zZSBpcyBtYWxmb3JtZWQgb3IgZG9lc24ndCBjb250YWluIHZhbGlkIGNvbnRlbnQtdHlwZS4iKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIXN1YlJlcXVlc3RzIHx8IHN1YlJlcXVlc3RzLnNpemUgPT09IDApIHsKICAgICAgICAgICAgICAgIC8vIFRoaXMgc2hvdWxkIGJlIHByZXZlbnQgZHVyaW5nIGNvZGluZy4KICAgICAgICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCJJbnZhbGlkIHN0YXRlOiBzdWJSZXF1ZXN0cyBpcyBub3QgcHJvdmlkZWQgb3Igc2l6ZSBpcyAwLiIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuYmF0Y2hSZXNwb25zZSA9IGJhdGNoUmVzcG9uc2U7CiAgICAgICAgICAgIHRoaXMuc3ViUmVxdWVzdHMgPSBzdWJSZXF1ZXN0czsKICAgICAgICAgICAgdGhpcy5yZXNwb25zZUJhdGNoQm91bmRhcnkgPSB0aGlzLmJhdGNoUmVzcG9uc2UuY29udGVudFR5cGUuc3BsaXQoIj0iKVsxXTsKICAgICAgICAgICAgdGhpcy5wZXJSZXNwb25zZVByZWZpeCA9ICItLSIgKyB0aGlzLnJlc3BvbnNlQmF0Y2hCb3VuZGFyeSArIEhUVFBfTElORV9FTkRJTkc7CiAgICAgICAgICAgIHRoaXMuYmF0Y2hSZXNwb25zZUVuZGluZyA9ICItLSIgKyB0aGlzLnJlc3BvbnNlQmF0Y2hCb3VuZGFyeSArICItLSI7CiAgICAgICAgfQogICAgICAgIC8vIEZvciBleGFtcGxlIG9mIHJlc3BvbnNlLCBwbGVhc2UgcmVmZXIgdG8gaHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvcmVzdC9hcGkvc3RvcmFnZXNlcnZpY2VzL2Jsb2ItYmF0Y2gjcmVzcG9uc2UKICAgICAgICBCYXRjaFJlc3BvbnNlUGFyc2VyLnByb3RvdHlwZS5wYXJzZUJhdGNoUmVzcG9uc2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciByZXNwb25zZUJvZHlBc1RleHQsIHN1YlJlc3BvbnNlcywgc3ViUmVzcG9uc2VDb3VudCwgZGVzZXJpYWxpemVkU3ViUmVzcG9uc2VzLCBzdWJSZXNwb25zZXNTdWNjZWVkZWRDb3VudCwgc3ViUmVzcG9uc2VzRmFpbGVkQ291bnQsIGluZGV4LCBzdWJSZXNwb25zZSwgZGVzZXJpYWxpemVkU3ViUmVzcG9uc2UsIHJlc3BvbnNlTGluZXMsIHN1YlJlc3BIZWFkZXJTdGFydEZvdW5kLCBzdWJSZXNwSGVhZGVyRW5kRm91bmQsIHN1YlJlc3BGYWlsZWQsIGNvbnRlbnRJZCwgX2ksIHJlc3BvbnNlTGluZXNfMSwgcmVzcG9uc2VMaW5lLCB0b2tlbnMsIHRva2VuczsKICAgICAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdoZW4gbG9naWMgcmVhY2ggaGVyZSwgc3VwcG9zZSBiYXRjaCByZXF1ZXN0IGhhcyBhbHJlYWR5IHN1Y2NlZWRlZCB3aXRoIDIwMiwgc28gd2UgY2FuIGZ1cnRoZXIgcGFyc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN1YiByZXF1ZXN0J3MgcmVzcG9uc2UuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5iYXRjaFJlc3BvbnNlLl9yZXNwb25zZS5zdGF0dXMgIT0gSFRUUFVSTENvbm5lY3Rpb24uSFRUUF9BQ0NFUFRFRCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBzdGF0ZTogYmF0Y2ggcmVxdWVzdCBmYWlsZWQgd2l0aCBzdGF0dXM6ICciICsgdGhpcy5iYXRjaFJlc3BvbnNlLl9yZXNwb25zZS5zdGF0dXMgKyAiJy4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIGdldEJvZHlBc1RleHQodGhpcy5iYXRjaFJlc3BvbnNlKV07CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlQm9keUFzVGV4dCA9IF9hLnNlbnQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YlJlc3BvbnNlcyA9IHJlc3BvbnNlQm9keUFzVGV4dAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zcGxpdCh0aGlzLmJhdGNoUmVzcG9uc2VFbmRpbmcpWzBdIC8vIHN0cmluZyBhZnRlciBlbmRpbmcgaXMgdXNlbGVzcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zcGxpdCh0aGlzLnBlclJlc3BvbnNlUHJlZml4KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zbGljZSgxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YlJlc3BvbnNlQ291bnQgPSBzdWJSZXNwb25zZXMubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRGVmZW5zaXZlIGNvZGluZyBpbiBjYXNlIG9mIHBvdGVudGlhbCBlcnJvciBwYXJzaW5nLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTm90ZTogc3ViUmVzcG9uc2VDb3VudCA9PSAxIGlzIHNwZWNpYWwgY2FzZSB3aGVyZSBzdWIgcmVxdWVzdCBpcyBpbnZhbGlkLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gV2UgdHJ5IHRvIHByZXZlbnQgc3VjaCBjYXNlcyB0aHJvdWdoIGVhcmx5IHZhbGlkYXRpb24sIGUuZy4gdmFsaWRhdGUgc3ViIHJlcXVlc3QgY291bnQgPj0gMS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdoaWxlIGluIHVuZXhwZWN0ZWQgc3ViIHJlcXVlc3QgaW52YWxpZCBjYXNlLCB3ZSBhbGxvdyBzdWIgcmVzcG9uc2UgdG8gYmUgcGFyc2VkIGFuZCByZXR1cm4gdG8gdXNlci4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdWJSZXNwb25zZUNvdW50ICE9IHRoaXMuc3ViUmVxdWVzdHMuc2l6ZSAmJiBzdWJSZXNwb25zZUNvdW50ICE9IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgc3RhdGU6IHN1YiByZXNwb25zZXMnIGNvdW50IGlzIG5vdCBlcXVhbCB0byBzdWIgcmVxdWVzdHMnIGNvdW50LiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzZXJpYWxpemVkU3ViUmVzcG9uc2VzID0gbmV3IEFycmF5KHN1YlJlc3BvbnNlQ291bnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ViUmVzcG9uc2VzU3VjY2VlZGVkQ291bnQgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ViUmVzcG9uc2VzRmFpbGVkQ291bnQgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUGFyc2Ugc3ViIHN1YlJlc3BvbnNlcy4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaW5kZXggPSAwOyBpbmRleCA8IHN1YlJlc3BvbnNlQ291bnQ7IGluZGV4KyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJSZXNwb25zZSA9IHN1YlJlc3BvbnNlc1tpbmRleF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzZXJpYWxpemVkU3ViUmVzcG9uc2VzW2luZGV4XSA9IHt9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2VyaWFsaXplZFN1YlJlc3BvbnNlID0gZGVzZXJpYWxpemVkU3ViUmVzcG9uc2VzW2luZGV4XTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNlcmlhbGl6ZWRTdWJSZXNwb25zZS5oZWFkZXJzID0gbmV3IEh0dHBIZWFkZXJzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VMaW5lcyA9IHN1YlJlc3BvbnNlLnNwbGl0KCIiICsgSFRUUF9MSU5FX0VORElORyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ViUmVzcEhlYWRlclN0YXJ0Rm91bmQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJSZXNwSGVhZGVyRW5kRm91bmQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJSZXNwRmFpbGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudElkID0gTk9UX0ZPVU5EOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoX2kgPSAwLCByZXNwb25zZUxpbmVzXzEgPSByZXNwb25zZUxpbmVzOyBfaSA8IHJlc3BvbnNlTGluZXNfMS5sZW5ndGg7IF9pKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VMaW5lID0gcmVzcG9uc2VMaW5lc18xW19pXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzdWJSZXNwSGVhZGVyU3RhcnRGb3VuZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ29udmVudGlvbiBsaW5lIHRvIGluZGljYXRlIGNvbnRlbnQgSUQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZUxpbmUuc3RhcnRzV2l0aChIZWFkZXJDb25zdGFudHMuQ09OVEVOVF9JRCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50SWQgPSBwYXJzZUludChyZXNwb25zZUxpbmUuc3BsaXQoSFRUUF9IRUFERVJfREVMSU1JVEVSKVsxXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBIdHRwIHZlcnNpb24gbGluZSB3aXRoIHN0YXR1cyBjb2RlIGluZGljYXRlcyB0aGUgc3RhcnQgb2Ygc3ViIHJlcXVlc3QncyByZXNwb25zZS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEV4YW1wbGU6IEhUVFAvMS4xIDIwMiBBY2NlcHRlZCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZUxpbmUuc3RhcnRzV2l0aChIVFRQX1ZFUlNJT05fMV8xKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YlJlc3BIZWFkZXJTdGFydEZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbnMgPSByZXNwb25zZUxpbmUuc3BsaXQoU1BBQ0VfREVMSU1JVEVSKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNlcmlhbGl6ZWRTdWJSZXNwb25zZS5zdGF0dXMgPSBwYXJzZUludCh0b2tlbnNbMV0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2VyaWFsaXplZFN1YlJlc3BvbnNlLnN0YXR1c01lc3NhZ2UgPSB0b2tlbnMuc2xpY2UoMikuam9pbihTUEFDRV9ERUxJTUlURVIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7IC8vIFNraXAgY29udmVudGlvbiBoZWFkZXJzIG5vdCBzcGVjaWZpY2FsbHkgZm9yIHN1YiByZXF1ZXN0IGkuZS4gQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9odHRwIGFuZCBDb250ZW50LUlEOiAqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlTGluZS50cmltKCkgPT09ICIiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTdWIgcmVzcG9uc2UncyBoZWFkZXIgc3RhcnQgbGluZSBhbHJlYWR5IGZvdW5kLCBhbmQgdGhlIGZpcnN0IGVtcHR5IGxpbmUgaW5kaWNhdGVzIGhlYWRlciBlbmQgbGluZSBmb3VuZC4gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXN1YlJlc3BIZWFkZXJFbmRGb3VuZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YlJlc3BIZWFkZXJFbmRGb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsgLy8gU2tpcCBlbXB0eSBsaW5lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTm90ZTogd2hlbiBjb2RlIHJlYWNoIGhlcmUsIGl0IGluZGljYXRlcyBzdWJSZXNwSGVhZGVyU3RhcnRGb3VuZCA9PSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc3ViUmVzcEhlYWRlckVuZEZvdW5kKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2VMaW5lLmluZGV4T2YoSFRUUF9IRUFERVJfREVMSU1JVEVSKSA9PT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBEZWZlbnNpdmUgY29kaW5nIHRvIHByZXZlbnQgZnJvbSBtaXNzaW5nIHZhbHVhYmxlIGxpbmVzLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBzdGF0ZTogZmluZCBub24tZW1wdHkgbGluZSAnIiArIHJlc3BvbnNlTGluZSArICInIHdpdGhvdXQgSFRUUCBoZWFkZXIgZGVsaW1pdGVyICciICsgSFRUUF9IRUFERVJfREVMSU1JVEVSICsgIicuIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbnMgPSByZXNwb25zZUxpbmUuc3BsaXQoSFRUUF9IRUFERVJfREVMSU1JVEVSKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2VyaWFsaXplZFN1YlJlc3BvbnNlLmhlYWRlcnMuc2V0KHRva2Vuc1swXSwgdG9rZW5zWzFdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b2tlbnNbMF0gPT09IEhlYWRlckNvbnN0YW50cy5YX01TX0VSUk9SX0NPREUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNlcmlhbGl6ZWRTdWJSZXNwb25zZS5lcnJvckNvZGUgPSB0b2tlbnNbMV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ViUmVzcEZhaWxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBc3NlbWJsZSBib2R5IG9mIHN1YiByZXNwb25zZS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZGVzZXJpYWxpemVkU3ViUmVzcG9uc2UuYm9keUFzVGV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2VyaWFsaXplZFN1YlJlc3BvbnNlLmJvZHlBc1RleHQgPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2VyaWFsaXplZFN1YlJlc3BvbnNlLmJvZHlBc1RleHQgKz0gcmVzcG9uc2VMaW5lOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSAvLyBJbm5lciBmb3IgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRlbnRJZCAhPSBOT1RfRk9VTkQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzZXJpYWxpemVkU3ViUmVzcG9uc2UuX3JlcXVlc3QgPSB0aGlzLnN1YlJlcXVlc3RzLmdldChjb250ZW50SWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3ViUmVzcEZhaWxlZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJSZXNwb25zZXNGYWlsZWRDb3VudCsrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ViUmVzcG9uc2VzU3VjY2VlZGVkQ291bnQrKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJSZXNwb25zZXM6IGRlc2VyaWFsaXplZFN1YlJlc3BvbnNlcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ViUmVzcG9uc2VzU3VjY2VlZGVkQ291bnQ6IHN1YlJlc3BvbnNlc1N1Y2NlZWRlZENvdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJSZXNwb25zZXNGYWlsZWRDb3VudDogc3ViUmVzcG9uc2VzRmFpbGVkQ291bnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gQmF0Y2hSZXNwb25zZVBhcnNlcjsKICAgIH0oKSk7CgogICAgLyoqCiAgICAgKiBBIFNlcnZpY2VVUkwgcmVwcmVzZW50cyBhIFVSTCB0byB0aGUgQXp1cmUgU3RvcmFnZSBCbG9iIHNlcnZpY2UgYWxsb3dpbmcgeW91CiAgICAgKiB0byBtYW5pcHVsYXRlIGJsb2IgY29udGFpbmVycy4KICAgICAqCiAgICAgKiBAZXhwb3J0CiAgICAgKiBAY2xhc3MgU2VydmljZVVSTAogICAgICogQGV4dGVuZHMge1N0b3JhZ2VVUkx9CiAgICAgKi8KICAgIHZhciBTZXJ2aWNlVVJMID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewogICAgICAgIF9fZXh0ZW5kcyhTZXJ2aWNlVVJMLCBfc3VwZXIpOwogICAgICAgIC8qKgogICAgICAgICAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgU2VydmljZVVSTC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgQSBVUkwgc3RyaW5nIHBvaW50aW5nIHRvIEF6dXJlIFN0b3JhZ2UgYmxvYiBzZXJ2aWNlLCBzdWNoIGFzCiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICAiaHR0cHM6Ly9teWFjY291bnQuYmxvYi5jb3JlLndpbmRvd3MubmV0Ii4gWW91IGNhbiBhcHBlbmQgYSBTQVMKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgIGlmIHVzaW5nIEFub255bW91c0NyZWRlbnRpYWwsIHN1Y2ggYXMgImh0dHBzOi8vbXlhY2NvdW50LmJsb2IuY29yZS53aW5kb3dzLm5ldD9zYXNTdHJpbmciLgogICAgICAgICAqIEBwYXJhbSB7UGlwZWxpbmV9IHBpcGVsaW5lIENhbGwgU3RvcmFnZVVSTC5uZXdQaXBlbGluZSgpIHRvIGNyZWF0ZSBhIGRlZmF1bHQKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaXBlbGluZSwgb3IgcHJvdmlkZSBhIGN1c3RvbWl6ZWQgcGlwZWxpbmUuCiAgICAgICAgICogQG1lbWJlcm9mIFNlcnZpY2VVUkwKICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBTZXJ2aWNlVVJMKHVybCwgcGlwZWxpbmUpIHsKICAgICAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgdXJsLCBwaXBlbGluZSkgfHwgdGhpczsKICAgICAgICAgICAgX3RoaXMuc2VydmljZUNvbnRleHQgPSBuZXcgU2VydmljZShfdGhpcy5zdG9yYWdlQ2xpZW50Q29udGV4dCk7CiAgICAgICAgICAgIHJldHVybiBfdGhpczsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQ3JlYXRlcyBhIG5ldyBTZXJ2aWNlVVJMIG9iamVjdCBpZGVudGljYWwgdG8gdGhlIHNvdXJjZSBidXQgd2l0aCB0aGUKICAgICAgICAgKiBzcGVjaWZpZWQgcmVxdWVzdCBwb2xpY3kgcGlwZWxpbmUuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge1BpcGVsaW5lfSBwaXBlbGluZQogICAgICAgICAqIEByZXR1cm5zIHtTZXJ2aWNlVVJMfQogICAgICAgICAqIEBtZW1iZXJvZiBTZXJ2aWNlVVJMCiAgICAgICAgICovCiAgICAgICAgU2VydmljZVVSTC5wcm90b3R5cGUud2l0aFBpcGVsaW5lID0gZnVuY3Rpb24gKHBpcGVsaW5lKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgU2VydmljZVVSTCh0aGlzLnVybCwgcGlwZWxpbmUpOwogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogR2V0cyB0aGUgcHJvcGVydGllcyBvZiBhIHN0b3JhZ2UgYWNjb3VudOKAmXMgQmxvYiBzZXJ2aWNlLCBpbmNsdWRpbmcgcHJvcGVydGllcwogICAgICAgICAqIGZvciBTdG9yYWdlIEFuYWx5dGljcyBhbmQgQ09SUyAoQ3Jvc3MtT3JpZ2luIFJlc291cmNlIFNoYXJpbmcpIHJ1bGVzLgogICAgICAgICAqIEBzZWUgaHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvcmVzdC9hcGkvc3RvcmFnZXNlcnZpY2VzL2dldC1ibG9iLXNlcnZpY2UtcHJvcGVydGllc30KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7QWJvcnRlcn0gYWJvcnRlciBDcmVhdGUgYSBuZXcgQWJvcnRlciBpbnN0YW5jZSB3aXRoIEFib3J0ZXIubm9uZSBvciBBYm9ydGVyLnRpbWVvdXQoKSwKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgZ290byBkb2N1bWVudHMgb2YgQWJvcnRlciBmb3IgbW9yZSBleGFtcGxlcyBhYm91dCByZXF1ZXN0IGNhbmNlbGxhdGlvbgogICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlPE1vZGVscy5TZXJ2aWNlR2V0UHJvcGVydGllc1Jlc3BvbnNlPn0KICAgICAgICAgKiBAbWVtYmVyb2YgU2VydmljZVVSTAogICAgICAgICAqLwogICAgICAgIFNlcnZpY2VVUkwucHJvdG90eXBlLmdldFByb3BlcnRpZXMgPSBmdW5jdGlvbiAoYWJvcnRlcikgewogICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHRoaXMuc2VydmljZUNvbnRleHQuZ2V0UHJvcGVydGllcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYm9ydFNpZ25hbDogYWJvcnRlcgogICAgICAgICAgICAgICAgICAgICAgICB9KV07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBTZXRzIHByb3BlcnRpZXMgZm9yIGEgc3RvcmFnZSBhY2NvdW504oCZcyBCbG9iIHNlcnZpY2UgZW5kcG9pbnQsIGluY2x1ZGluZyBwcm9wZXJ0aWVzCiAgICAgICAgICogZm9yIFN0b3JhZ2UgQW5hbHl0aWNzLCBDT1JTIChDcm9zcy1PcmlnaW4gUmVzb3VyY2UgU2hhcmluZykgcnVsZXMgYW5kIHNvZnQgZGVsZXRlIHNldHRpbmdzLgogICAgICAgICAqIEBzZWUgaHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvcmVzdC9hcGkvc3RvcmFnZXNlcnZpY2VzL3NldC1ibG9iLXNlcnZpY2UtcHJvcGVydGllc30KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7QWJvcnRlcn0gYWJvcnRlciBDcmVhdGUgYSBuZXcgQWJvcnRlciBpbnN0YW5jZSB3aXRoIEFib3J0ZXIubm9uZSBvciBBYm9ydGVyLnRpbWVvdXQoKSwKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgZ290byBkb2N1bWVudHMgb2YgQWJvcnRlciBmb3IgbW9yZSBleGFtcGxlcyBhYm91dCByZXF1ZXN0IGNhbmNlbGxhdGlvbgogICAgICAgICAqIEBwYXJhbSB7TW9kZWxzLlN0b3JhZ2VTZXJ2aWNlUHJvcGVydGllc30gcHJvcGVydGllcwogICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlPE1vZGVscy5TZXJ2aWNlU2V0UHJvcGVydGllc1Jlc3BvbnNlPn0KICAgICAgICAgKiBAbWVtYmVyb2YgU2VydmljZVVSTAogICAgICAgICAqLwogICAgICAgIFNlcnZpY2VVUkwucHJvdG90eXBlLnNldFByb3BlcnRpZXMgPSBmdW5jdGlvbiAoYWJvcnRlciwgcHJvcGVydGllcykgewogICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHRoaXMuc2VydmljZUNvbnRleHQuc2V0UHJvcGVydGllcyhwcm9wZXJ0aWVzLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYm9ydFNpZ25hbDogYWJvcnRlcgogICAgICAgICAgICAgICAgICAgICAgICB9KV07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBSZXRyaWV2ZXMgc3RhdGlzdGljcyByZWxhdGVkIHRvIHJlcGxpY2F0aW9uIGZvciB0aGUgQmxvYiBzZXJ2aWNlLiBJdCBpcyBvbmx5CiAgICAgICAgICogYXZhaWxhYmxlIG9uIHRoZSBzZWNvbmRhcnkgbG9jYXRpb24gZW5kcG9pbnQgd2hlbiByZWFkLWFjY2VzcyBnZW8tcmVkdW5kYW50CiAgICAgICAgICogcmVwbGljYXRpb24gaXMgZW5hYmxlZCBmb3IgdGhlIHN0b3JhZ2UgYWNjb3VudC4KICAgICAgICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5taWNyb3NvZnQuY29tL2VuLXVzL3Jlc3QvYXBpL3N0b3JhZ2VzZXJ2aWNlcy9nZXQtYmxvYi1zZXJ2aWNlLXN0YXRzfQogICAgICAgICAqCiAgICAgICAgICogIEBwYXJhbSB7QWJvcnRlcn0gYWJvcnRlciBDcmVhdGUgYSBuZXcgQWJvcnRlciBpbnN0YW5jZSB3aXRoIEFib3J0ZXIubm9uZSBvciBBYm9ydGVyLnRpbWVvdXQoKSwKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgZ290byBkb2N1bWVudHMgb2YgQWJvcnRlciBmb3IgbW9yZSBleGFtcGxlcyBhYm91dCByZXF1ZXN0IGNhbmNlbGxhdGlvbgogICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlPE1vZGVscy5TZXJ2aWNlR2V0U3RhdGlzdGljc1Jlc3BvbnNlPn0KICAgICAgICAgKiBAbWVtYmVyb2YgU2VydmljZVVSTAogICAgICAgICAqLwogICAgICAgIFNlcnZpY2VVUkwucHJvdG90eXBlLmdldFN0YXRpc3RpY3MgPSBmdW5jdGlvbiAoYWJvcnRlcikgewogICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHRoaXMuc2VydmljZUNvbnRleHQuZ2V0U3RhdGlzdGljcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYm9ydFNpZ25hbDogYWJvcnRlcgogICAgICAgICAgICAgICAgICAgICAgICB9KV07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBUaGUgR2V0IEFjY291bnQgSW5mb3JtYXRpb24gb3BlcmF0aW9uIHJldHVybnMgdGhlIHNrdSBuYW1lIGFuZCBhY2NvdW50IGtpbmQKICAgICAgICAgKiBmb3IgdGhlIHNwZWNpZmllZCBhY2NvdW50LgogICAgICAgICAqIFRoZSBHZXQgQWNjb3VudCBJbmZvcm1hdGlvbiBvcGVyYXRpb24gaXMgYXZhaWxhYmxlIG9uIHNlcnZpY2UgdmVyc2lvbnMgYmVnaW5uaW5nCiAgICAgICAgICogd2l0aCB2ZXJzaW9uIDIwMTgtMDMtMjguCiAgICAgICAgICogQHNlZSBodHRwczovL2RvY3MubWljcm9zb2Z0LmNvbS9lbi11cy9yZXN0L2FwaS9zdG9yYWdlc2VydmljZXMvZ2V0LWFjY291bnQtaW5mb3JtYXRpb24KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7QWJvcnRlcn0gYWJvcnRlciBDcmVhdGUgYSBuZXcgQWJvcnRlciBpbnN0YW5jZSB3aXRoIEFib3J0ZXIubm9uZSBvciBBYm9ydGVyLnRpbWVvdXQoKSwKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgZ290byBkb2N1bWVudHMgb2YgQWJvcnRlciBmb3IgbW9yZSBleGFtcGxlcyBhYm91dCByZXF1ZXN0IGNhbmNlbGxhdGlvbgogICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlPE1vZGVscy5TZXJ2aWNlR2V0QWNjb3VudEluZm9SZXNwb25zZT59CiAgICAgICAgICogQG1lbWJlcm9mIFNlcnZpY2VVUkwKICAgICAgICAgKi8KICAgICAgICBTZXJ2aWNlVVJMLnByb3RvdHlwZS5nZXRBY2NvdW50SW5mbyA9IGZ1bmN0aW9uIChhYm9ydGVyKSB7CiAgICAgICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgdGhpcy5zZXJ2aWNlQ29udGV4dC5nZXRBY2NvdW50SW5mbyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYm9ydFNpZ25hbDogYWJvcnRlcgogICAgICAgICAgICAgICAgICAgICAgICB9KV07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm5zIGEgbGlzdCBvZiB0aGUgY29udGFpbmVycyB1bmRlciB0aGUgc3BlY2lmaWVkIGFjY291bnQuCiAgICAgICAgICogQHNlZSBodHRwczovL2RvY3MubWljcm9zb2Z0LmNvbS9lbi11cy9yZXN0L2FwaS9zdG9yYWdlc2VydmljZXMvbGlzdC1jb250YWluZXJzMgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtBYm9ydGVyfSBhYm9ydGVyIENyZWF0ZSBhIG5ldyBBYm9ydGVyIGluc3RhbmNlIHdpdGggQWJvcnRlci5ub25lIG9yIEFib3J0ZXIudGltZW91dCgpLAogICAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICBnb3RvIGRvY3VtZW50cyBvZiBBYm9ydGVyIGZvciBtb3JlIGV4YW1wbGVzIGFib3V0IHJlcXVlc3QgY2FuY2VsbGF0aW9uCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IFttYXJrZXJdIEEgc3RyaW5nIHZhbHVlIHRoYXQgaWRlbnRpZmllcyB0aGUgcG9ydGlvbiBvZgogICAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICB0aGUgbGlzdCBvZiBjb250YWluZXJzIHRvIGJlIHJldHVybmVkIHdpdGggdGhlIG5leHQgbGlzdGluZyBvcGVyYXRpb24uIFRoZQogICAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVyYXRpb24gcmV0dXJucyB0aGUgTmV4dE1hcmtlciB2YWx1ZSB3aXRoaW4gdGhlIHJlc3BvbnNlIGJvZHkgaWYgdGhlCiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3Rpbmcgb3BlcmF0aW9uIGRpZCBub3QgcmV0dXJuIGFsbCBjb250YWluZXJzIHJlbWFpbmluZyB0byBiZSBsaXN0ZWQKICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCB0aGUgY3VycmVudCBwYWdlLiBUaGUgTmV4dE1hcmtlciB2YWx1ZSBjYW4gYmUgdXNlZCBhcyB0aGUgdmFsdWUgZm9yCiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgIHRoZSBtYXJrZXIgcGFyYW1ldGVyIGluIGEgc3Vic2VxdWVudCBjYWxsIHRvIHJlcXVlc3QgdGhlIG5leHQgcGFnZSBvZiBsaXN0CiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zLiBUaGUgbWFya2VyIHZhbHVlIGlzIG9wYXF1ZSB0byB0aGUgY2xpZW50LgogICAgICAgICAqIEBwYXJhbSB7SVNlcnZpY2VMaXN0Q29udGFpbmVyc1NlZ21lbnRPcHRpb25zfSBbb3B0aW9uc10KICAgICAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxNb2RlbHMuU2VydmljZUxpc3RDb250YWluZXJzU2VnbWVudFJlc3BvbnNlPn0KICAgICAgICAgKiBAbWVtYmVyb2YgU2VydmljZVVSTAogICAgICAgICAqLwogICAgICAgIFNlcnZpY2VVUkwucHJvdG90eXBlLmxpc3RDb250YWluZXJzU2VnbWVudCA9IGZ1bmN0aW9uIChhYm9ydGVyLCBtYXJrZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgeyBvcHRpb25zID0ge307IH0KICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCB0aGlzLnNlcnZpY2VDb250ZXh0Lmxpc3RDb250YWluZXJzU2VnbWVudChfX2Fzc2lnbih7IGFib3J0U2lnbmFsOiBhYm9ydGVyLCBtYXJrZXI6IG1hcmtlciB9LCBvcHRpb25zKSldOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICogT05MWSBBVkFJTEFCTEUgV0hFTiBVU0lORyBCRUFSRVIgVE9LRU4gQVVUSEVOVElDQVRJT04gKFRva2VuQ3JlZGVudGlhbCkuCiAgICAgICAgICoKICAgICAgICAgKiBSZXRyaWV2ZXMgYSB1c2VyIGRlbGVnYXRpb24ga2V5IGZvciB0aGUgQmxvYiBzZXJ2aWNlLiBUaGlzIGlzIG9ubHkgYSB2YWxpZCBvcGVyYXRpb24gd2hlbiB1c2luZwogICAgICAgICAqIGJlYXJlciB0b2tlbiBhdXRoZW50aWNhdGlvbi4KICAgICAgICAgKgogICAgICAgICAqIEBzZWUgaHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvcmVzdC9hcGkvc3RvcmFnZXNlcnZpY2VzL2dldC11c2VyLWRlbGVnYXRpb24ta2V5CiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge0Fib3J0ZXJ9IGFib3J0ZXIgQ3JlYXRlIGEgbmV3IEFib3J0ZXIgaW5zdGFuY2Ugd2l0aCBBYm9ydGVyLm5vbmUgb3IgQWJvcnRlci50aW1lb3V0KCksCiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgIGdvdG8gZG9jdW1lbnRzIG9mIEFib3J0ZXIgZm9yIG1vcmUgZXhhbXBsZXMgYWJvdXQgcmVxdWVzdCBjYW5jZWxsYXRpb24KICAgICAgICAgKiBAcGFyYW0ge0RhdGV9IHN0YXJ0ICAgICAgVGhlIHN0YXJ0IHRpbWUgZm9yIHRoZSB1c2VyIGRlbGVnYXRpb24gU0FTLiBNdXN0IGJlIHdpdGhpbiA3IGRheXMgb2YgdGhlIGN1cnJlbnQgdGltZQogICAgICAgICAqIEBwYXJhbSB7RGF0ZX0gZXhwaXJ5ICAgICBUaGUgZW5kIHRpbWUgZm9yIHRoZSB1c2VyIGRlbGVnYXRpb24gU0FTLiBNdXN0IGJlIHdpdGhpbiA3IGRheXMgb2YgdGhlIGN1cnJlbnQgdGltZQogICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlPFNlcnZpY2VHZXRVc2VyRGVsZWdhdGlvbktleVJlc3BvbnNlPn0KICAgICAgICAgKiBAbWVtYmVyb2YgU2VydmljZVVSTAogICAgICAgICAqLwogICAgICAgIFNlcnZpY2VVUkwucHJvdG90eXBlLmdldFVzZXJEZWxlZ2F0aW9uS2V5ID0gZnVuY3Rpb24gKGFib3J0ZXIsIHN0YXJ0LCBleHBpcnkpIHsKICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlLCB1c2VyRGVsZWdhdGlvbktleSwgcmVzOwogICAgICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOiByZXR1cm4gWzQgLyp5aWVsZCovLCB0aGlzLnNlcnZpY2VDb250ZXh0LmdldFVzZXJEZWxlZ2F0aW9uS2V5KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydDogdHJ1bmNhdGVkSVNPODA2MURhdGUoc3RhcnQsIGZhbHNlKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHBpcnk6IHRydW5jYXRlZElTTzgwNjFEYXRlKGV4cGlyeSwgZmFsc2UpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWJvcnRTaWduYWw6IGFib3J0ZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXTsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBfYS5zZW50KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyRGVsZWdhdGlvbktleSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaWduZWRPaWQ6IHJlc3BvbnNlLnNpZ25lZE9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaWduZWRUaWQ6IHJlc3BvbnNlLnNpZ25lZFRpZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaWduZWRTdGFydDogbmV3IERhdGUocmVzcG9uc2Uuc2lnbmVkU3RhcnQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25lZEV4cGlyeTogbmV3IERhdGUocmVzcG9uc2Uuc2lnbmVkRXhwaXJ5KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaWduZWRTZXJ2aWNlOiByZXNwb25zZS5zaWduZWRTZXJ2aWNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25lZFZlcnNpb246IHJlc3BvbnNlLnNpZ25lZFZlcnNpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHJlc3BvbnNlLnZhbHVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzID0gX19hc3NpZ24oeyBfcmVzcG9uc2U6IHJlc3BvbnNlLl9yZXNwb25zZSwgcmVxdWVzdElkOiByZXNwb25zZS5yZXF1ZXN0SWQsIGNsaWVudFJlcXVlc3RJZDogcmVzcG9uc2UuY2xpZW50UmVxdWVzdElkLCB2ZXJzaW9uOiByZXNwb25zZS52ZXJzaW9uLCBkYXRlOiByZXNwb25zZS5kYXRlLCBlcnJvckNvZGU6IHJlc3BvbnNlLmVycm9yQ29kZSB9LCB1c2VyRGVsZWdhdGlvbktleSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgcmVzXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiBTdWJtaXQgYmF0Y2ggcmVxdWVzdCB3aGljaCBjb25zaXN0cyBvZiBtdWx0aXBsZSBzdWJyZXF1ZXN0cy4KICAgICAgICAgKgogICAgICAgICAqIEBleGFtcGxlCiAgICAgICAgICogbGV0IGJhdGNoRGVsZXRlUmVxdWVzdCA9IG5ldyBCYXRjaERlbGV0ZVJlcXVlc3QoKTsKICAgICAgICAgKiBhd2FpdCBiYXRjaERlbGV0ZVJlcXVlc3QuYWRkU3ViUmVxdWVzdCh1cmxJblN0cmluZzAsIGNyZWRlbnRpYWwwKTsKICAgICAgICAgKiBhd2FpdCBiYXRjaERlbGV0ZVJlcXVlc3QuYWRkU3ViUmVxdWVzdCh1cmxJblN0cmluZzEsIGNyZWRlbnRpYWwxLCB7CiAgICAgICAgICogIGRlbGV0ZVNuYXBzaG90czogImluY2x1ZGUiCiAgICAgICAgICogfSk7CiAgICAgICAgICogY29uc3QgZGVsZXRlQmF0Y2hSZXNwID0gYXdhaXQgc2VydmljZVVSTC5zdWJtaXRCYXRjaChBYm9ydGVyLm5vbmUsIGJhdGNoRGVsZXRlUmVxdWVzdCk7CiAgICAgICAgICogY29uc29sZS5sb2coZGVsZXRlQmF0Y2hSZXNwLnN1YlJlc3BvbnNlc1N1Y2NlZWRlZENvdW50KTsKICAgICAgICAgKgogICAgICAgICAqIEBleGFtcGxlCiAgICAgICAgICogbGV0IGJhdGNoU2V0VGllclJlcXVlc3QgPSBuZXcgQmF0Y2hTZXRUaWVyUmVxdWVzdCgpOwogICAgICAgICAqIGF3YWl0IGJhdGNoU2V0VGllclJlcXVlc3QuYWRkU3ViUmVxdWVzdChibG9ja0Jsb2JVUkwwLCAiQ29vbCIpOwogICAgICAgICAqIGF3YWl0IGJhdGNoU2V0VGllclJlcXVlc3QuYWRkU3ViUmVxdWVzdChibG9ja0Jsb2JVUkwxLCAiQ29vbCIsIHsKICAgICAgICAgKiAgbGVhc2VBY2Nlc3NDb25kaXRpb25zOiB7IGxlYXNlSWQ6IGxlYXNlSWQgfQogICAgICAgICAqIH0pOwogICAgICAgICAqIGNvbnN0IHNldFRpZXJCYXRjaFJlc3AgPSBhd2FpdCBzZXJ2aWNlVVJMLnN1Ym1pdEJhdGNoKEFib3J0ZXIubm9uZSwgYmF0Y2hTZXRUaWVyUmVxdWVzdCk7CiAgICAgICAgICogY29uc29sZS5sb2coc2V0VGllckJhdGNoUmVzcC5zdWJSZXNwb25zZXNTdWNjZWVkZWRDb3VudCk7CiAgICAgICAgICoKICAgICAgICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5taWNyb3NvZnQuY29tL2VuLXVzL3Jlc3QvYXBpL3N0b3JhZ2VzZXJ2aWNlcy9ibG9iLWJhdGNoCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge0Fib3J0ZXJ9IGFib3J0ZXIgQ3JlYXRlIGEgbmV3IEFib3J0ZXIgaW5zdGFuY2Ugd2l0aCBBYm9ydGVyLm5vbmUgb3IgQWJvcnRlci50aW1lb3V0KCksCiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgIGdvdG8gZG9jdW1lbnRzIG9mIEFib3J0ZXIgZm9yIG1vcmUgZXhhbXBsZXMgYWJvdXQgcmVxdWVzdCBjYW5jZWxsYXRpb24uCiAgICAgICAgICogQHBhcmFtIHtCYXRjaFJlcXVlc3R9IGJhdGNoUmVxdWVzdCBTdXBwb3J0ZWQgYmF0Y2ggcmVxdWVzdDogQmF0Y2hEZWxldGVSZXF1ZXN0IG9yIEJhdGNoU2V0VGllclJlcXVlc3QuCiAgICAgICAgICogQHBhcmFtIHtNb2RlbHMuU2VydmljZVN1Ym1pdEJhdGNoT3B0aW9uYWxQYXJhbXN9IFtvcHRpb25zXQogICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlPFNlcnZpY2VTdWJtaXRCYXRjaFJlc3BvbnNlPn0KICAgICAgICAgKiBAbWVtYmVyb2YgU2VydmljZVVSTAogICAgICAgICAqLwogICAgICAgIFNlcnZpY2VVUkwucHJvdG90eXBlLnN1Ym1pdEJhdGNoID0gZnVuY3Rpb24gKGFib3J0ZXIsIGJhdGNoUmVxdWVzdCwgb3B0aW9ucykgewogICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgYmF0Y2hSZXF1ZXN0Qm9keSwgcmF3QmF0Y2hSZXNwb25zZSwgYmF0Y2hSZXNwb25zZVBhcnNlciwgcmVzcG9uc2VTdW1tYXJ5LCByZXM7CiAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWJhdGNoUmVxdWVzdCB8fCBiYXRjaFJlcXVlc3QuZ2V0U3ViUmVxdWVzdHMoKS5zaXplID09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiQmF0Y2ggcmVxdWVzdCBzaG91bGQgY29udGFpbiBvbmUgb3IgbW9yZSBzdWIgcmVxdWVzdHMuIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYXRjaFJlcXVlc3RCb2R5ID0gYmF0Y2hSZXF1ZXN0LmdldEh0dHBSZXF1ZXN0Qm9keSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgdGhpcy5zZXJ2aWNlQ29udGV4dC5zdWJtaXRCYXRjaChiYXRjaFJlcXVlc3RCb2R5LCB1dGY4Qnl0ZUxlbmd0aChiYXRjaFJlcXVlc3RCb2R5KSwgYmF0Y2hSZXF1ZXN0LmdldE11bHRpUGFydENvbnRlbnRUeXBlKCksIF9fYXNzaWduKHsgYWJvcnRTaWduYWw6IGFib3J0ZXIgfSwgb3B0aW9ucykpXTsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmF3QmF0Y2hSZXNwb25zZSA9IF9hLnNlbnQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhdGNoUmVzcG9uc2VQYXJzZXIgPSBuZXcgQmF0Y2hSZXNwb25zZVBhcnNlcihyYXdCYXRjaFJlc3BvbnNlLCBiYXRjaFJlcXVlc3QuZ2V0U3ViUmVxdWVzdHMoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBiYXRjaFJlc3BvbnNlUGFyc2VyLnBhcnNlQmF0Y2hSZXNwb25zZSgpXTsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VTdW1tYXJ5ID0gX2Euc2VudCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9yZXNwb25zZTogcmF3QmF0Y2hSZXNwb25zZS5fcmVzcG9uc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudFR5cGU6IHJhd0JhdGNoUmVzcG9uc2UuY29udGVudFR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JDb2RlOiByYXdCYXRjaFJlc3BvbnNlLmVycm9yQ29kZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0SWQ6IHJhd0JhdGNoUmVzcG9uc2UucmVxdWVzdElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudFJlcXVlc3RJZDogcmF3QmF0Y2hSZXNwb25zZS5jbGllbnRSZXF1ZXN0SWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVyc2lvbjogcmF3QmF0Y2hSZXNwb25zZS52ZXJzaW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YlJlc3BvbnNlczogcmVzcG9uc2VTdW1tYXJ5LnN1YlJlc3BvbnNlcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJSZXNwb25zZXNTdWNjZWVkZWRDb3VudDogcmVzcG9uc2VTdW1tYXJ5LnN1YlJlc3BvbnNlc1N1Y2NlZWRlZENvdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YlJlc3BvbnNlc0ZhaWxlZENvdW50OiByZXNwb25zZVN1bW1hcnkuc3ViUmVzcG9uc2VzRmFpbGVkQ291bnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgcmVzXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gU2VydmljZVVSTDsKICAgIH0oU3RvcmFnZVVSTCkpOwoKICAgIGV4cG9ydHMuQWJvcnRlciA9IEFib3J0ZXI7CiAgICBleHBvcnRzLkFub255bW91c0NyZWRlbnRpYWwgPSBBbm9ueW1vdXNDcmVkZW50aWFsOwogICAgZXhwb3J0cy5Bbm9ueW1vdXNDcmVkZW50aWFsUG9saWN5ID0gQW5vbnltb3VzQ3JlZGVudGlhbFBvbGljeTsKICAgIGV4cG9ydHMuQXBwZW5kQmxvYlVSTCA9IEFwcGVuZEJsb2JVUkw7CiAgICBleHBvcnRzLkJhc2VSZXF1ZXN0UG9saWN5ID0gQmFzZVJlcXVlc3RQb2xpY3k7CiAgICBleHBvcnRzLkJhdGNoRGVsZXRlUmVxdWVzdCA9IEJhdGNoRGVsZXRlUmVxdWVzdDsKICAgIGV4cG9ydHMuQmF0Y2hSZXF1ZXN0ID0gQmF0Y2hSZXF1ZXN0OwogICAgZXhwb3J0cy5CYXRjaFNldFRpZXJSZXF1ZXN0ID0gQmF0Y2hTZXRUaWVyUmVxdWVzdDsKICAgIGV4cG9ydHMuQmxvYlVSTCA9IEJsb2JVUkw7CiAgICBleHBvcnRzLkJsb2NrQmxvYlVSTCA9IEJsb2NrQmxvYlVSTDsKICAgIGV4cG9ydHMuQnJvd3NlclBvbGljeUZhY3RvcnkgPSBCcm93c2VyUG9saWN5RmFjdG9yeTsKICAgIGV4cG9ydHMuQ29udGFpbmVyVVJMID0gQ29udGFpbmVyVVJMOwogICAgZXhwb3J0cy5DcmVkZW50aWFsID0gQ3JlZGVudGlhbDsKICAgIGV4cG9ydHMuQ3JlZGVudGlhbFBvbGljeSA9IENyZWRlbnRpYWxQb2xpY3k7CiAgICBleHBvcnRzLkh0dHBIZWFkZXJzID0gSHR0cEhlYWRlcnM7CiAgICBleHBvcnRzLkxvZ2dpbmdQb2xpY3lGYWN0b3J5ID0gTG9nZ2luZ1BvbGljeUZhY3Rvcnk7CiAgICBleHBvcnRzLk1vZGVscyA9IGluZGV4OwogICAgZXhwb3J0cy5QYWdlQmxvYlVSTCA9IFBhZ2VCbG9iVVJMOwogICAgZXhwb3J0cy5QaXBlbGluZSA9IFBpcGVsaW5lOwogICAgZXhwb3J0cy5SZXF1ZXN0UG9saWN5T3B0aW9ucyA9IFJlcXVlc3RQb2xpY3lPcHRpb25zOwogICAgZXhwb3J0cy5SZXN0RXJyb3IgPSBSZXN0RXJyb3I7CiAgICBleHBvcnRzLlJldHJ5UG9saWN5RmFjdG9yeSA9IFJldHJ5UG9saWN5RmFjdG9yeTsKICAgIGV4cG9ydHMuU2VydmljZVVSTCA9IFNlcnZpY2VVUkw7CiAgICBleHBvcnRzLlN0b3JhZ2VVUkwgPSBTdG9yYWdlVVJMOwogICAgZXhwb3J0cy5UZWxlbWV0cnlQb2xpY3lGYWN0b3J5ID0gVGVsZW1ldHJ5UG9saWN5RmFjdG9yeTsKICAgIGV4cG9ydHMuVG9rZW5DcmVkZW50aWFsID0gVG9rZW5DcmVkZW50aWFsOwogICAgZXhwb3J0cy5Ub2tlbkNyZWRlbnRpYWxQb2xpY3kgPSBUb2tlbkNyZWRlbnRpYWxQb2xpY3k7CiAgICBleHBvcnRzLlVuaXF1ZVJlcXVlc3RJRFBvbGljeUZhY3RvcnkgPSBVbmlxdWVSZXF1ZXN0SURQb2xpY3lGYWN0b3J5OwogICAgZXhwb3J0cy5XZWJSZXNvdXJjZSA9IFdlYlJlc291cmNlOwogICAgZXhwb3J0cy5kZXNlcmlhbGl6YXRpb25Qb2xpY3kgPSBkZXNlcmlhbGl6YXRpb25Qb2xpY3k7CiAgICBleHBvcnRzLnVwbG9hZEJyb3dzZXJEYXRhVG9CbG9ja0Jsb2IgPSB1cGxvYWRCcm93c2VyRGF0YVRvQmxvY2tCbG9iOwoKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7Cgp9KSk7Ci8vIyBzb3VyY2VNYXBwaW5nVVJMPWF6dXJlLXN0b3JhZ2UtYmxvYi5qcy5tYXAK,
    id: '1670780390186292414832975.1793'}
  - {name: standard-page.html, content: PGxpbmsgaHJlZj0iaHR0cHM6Ly9mb250cy5nb29nbGVhcGlzLmNvbS9jc3M/ZmFtaWx5PVJvYm90bzozMDAsNDAwLDUwMCIgcmVsPSJzdHlsZXNoZWV0IiByZWw9InByZWxvYWQiIGFzPSJmb250IiBjcm9zc29yaWdpbj0iYW5vbnltb3VzIj4KCjxkaXYgY2xhc3M9InN0cnVjdHVyZSI+CiAgPGRpdiBjbGFzcz0iYXBwLWJhciIgYW52aWwtZHJvcC1jb250YWluZXI9Ii5hbnZpbC1jb250YWluZXIiIGFudmlsLWRyb3AtcmVkaXJlY3Q9Ii5wbGFjZWhvbGRlciI+CiAgICA8YSBjbGFzcz0ic2lkZWJhci10b2dnbGUiIGFudmlsLWlmLXNsb3QtZW1wdHk9InRvcC1sZWZ0LWJ0biIgYW52aWwtaGlkZS1pZi1zbG90LWVtcHR5PSJsZWZ0LW5hdiIgYW52aWwtZHJvcC1zbG90PSJ0b3AtbGVmdC1idG4iIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSI+PGkgY2xhc3M9ImZhIGZhLWJhcnMiPjwvaT48L2E+CiAgICA8YSBjbGFzcz0ic2lkZWJhci10b2dnbGUgYW52aWwtZGVzaWduZXItb25seSIgYW52aWwtaWYtc2xvdC1lbXB0eT0idG9wLWxlZnQtYnRuIiBhbnZpbC1pZi1zbG90LWVtcHR5PSJsZWZ0LW5hdiIgYW52aWwtZHJvcC1zbG90PSJ0b3AtbGVmdC1idG4iPjxpIGNsYXNzPSJmYSBmYS1ibGFuayI+PC9pPjwvYT4KICAgIDxkaXYgY2xhc3M9InRvcC1sZWZ0LWJ0biIgYW52aWwtc2xvdD0idG9wLWxlZnQtYnRuIj48L2Rpdj4KICAgIDxkaXYgY2xhc3M9InRpdGxlIiBhbnZpbC1zbG90PSJ0aXRsZSI+CiAgICAgIDxkaXYgY2xhc3M9InBsYWNlaG9sZGVyIGFudmlsLWRlc2lnbmVyLW9ubHkiIGFudmlsLWlmLXNsb3QtZW1wdHk9InRpdGxlIiBhbnZpbC1kcm9wLWhlcmU+RHJvcCB0aXRsZSBoZXJlPC9kaXY+CiAgICA8L2Rpdj4KICAgIDxkaXYgY2xhc3M9ImFwcC1iYXItbmF2IiBhbnZpbC1zbG90PSJuYXYtcmlnaHQiPgogICAgICA8ZGl2IGNsYXNzPSJwbGFjZWhvbGRlciBhbnZpbC1kZXNpZ25lci1vbmx5IiBhbnZpbC1pZi1zbG90LWVtcHR5PSJuYXYtcmlnaHQiIGFudmlsLWRyb3AtaGVyZT5Ecm9wIGEgRmxvd1BhbmVsIGhlcmU8L2Rpdj4KICAgIDwvZGl2PgogICAgPGRpdiBzdHlsZT0iY2xlYXI6Ym90aCI+PC9kaXY+CiAgPC9kaXY+CgogIDxkaXYgY2xhc3M9Im5hdi1ob2xkZXIiPgogICAgPGRpdiBjbGFzcz0ibGVmdC1uYXYgYW52aWwtbWVhc3VyZS10aGlzIiBhbnZpbC1zbG90LXJlcGVhdD0ibGVmdC1uYXYiIGFudmlsLWRyb3AtY29udGFpbmVyPSI+LmFudmlsLWNvbnRhaW5lciI+CiAgICA8L2Rpdj4KICAgIDxkaXYgY2xhc3M9ImxlZnQtbmF2LXBsYWNlaG9sZGVyIGFudmlsLWRlc2lnbmVyLW9ubHkiIGFudmlsLWlmLXNsb3QtZW1wdHk9ImxlZnQtbmF2IiBhbnZpbC1kcm9wLXNsb3Q9ImxlZnQtbmF2Ij4KICAgICAgPGRpdiBjbGFzcz0icHJvbXB0Ij5UbyBhZGQgYSBzaWRlYmFyLCBkcm9wIGEgQ29sdW1uUGFuZWwgaGVyZS48L2Rpdj4KICAgIDwvZGl2PgogICAgCiAgICA8ZGl2IGNsYXNzPSJjb250ZW50Ij4KICAgICAgPGRpdiBhbnZpbC1zbG90LXJlcGVhdD0iZGVmYXVsdCIgY2xhc3M9ImFudmlsLW1lYXN1cmUtdGhpcyI+PC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9InBsYWNlaG9sZGVyIGRyb3AtaGVyZSIgYW52aWwtaWYtc2xvdC1lbXB0eT0iZGVmYXVsdCIgYW52aWwtZHJvcC1zbG90PSJkZWZhdWx0Ij5Ecm9wIGEgQ29sdW1uUGFuZWwgaGVyZS48L2Rpdj4KICAgIDwvZGl2PgogIDwvZGl2PgoKICA8ZGl2IGNsYXNzPSJuYXYtc2hpZWxkIj48L2Rpdj4KPC9kaXY+CjxkaXYgYW52aWwtZHJvcC1kZWZhdWx0IGFudmlsLWRyb3AtcmVkaXJlY3Q9Ii5wbGFjZWhvbGRlciIgYW52aWwtZHJvcC1jb250YWluZXI9Ii5hbnZpbC1jb250YWluZXIiPjwvZGl2PgogCjxzY3JpcHQ+CiAgdmFyIGxuID0gJCgnLnN0cnVjdHVyZSA+IC5uYXYtaG9sZGVyID4gLmxlZnQtbmF2Jyk7CiAgdmFyIGxucCA9ICQoJy5zdHJ1Y3R1cmUgPiAubmF2LWhvbGRlciA+IC5sZWZ0LW5hdi1wbGFjZWhvbGRlcicpOwogIHZhciBhcHBCYXIgPSAkKCcuYXBwLWJhcicpWzBdOwogIAogIGZ1bmN0aW9uIGhpZGVTaWRlYmFyKCkgewogICAgbG4uYW5pbWF0ZSh7bGVmdDogLWxuLm91dGVyV2lkdGgoKX0sIGZ1bmN0aW9uKCkgewogICAgICBsbi5yZW1vdmVDbGFzcygiaW4tdHJhbnNpdGlvbiBzaG93biIpLmFkZENsYXNzKCJoaWRkZW4iKTsKICAgICAgJCgnLm5hdi1zaGllbGQnKS5yZW1vdmVDbGFzcygic2hvd24iKTsKICAgICAgJCh3aW5kb3cpLnRyaWdnZXIoJ3Jlc2l6ZScpOwogICAgfSk7CiAgICBpZiAod2luZG93LmlubmVyV2lkdGggPiA5OTgpIHsgCiAgICAgICQoJy5jb250ZW50JykuYW5pbWF0ZSh7J21hcmdpbi1sZWZ0JzowfSwgZnVuY3Rpb24oKXt9KQogICAgfQogIH0KICAKICBmdW5jdGlvbiBzaG93U2lkZWJhcigpIHsKICAgICQoJy5uYXYtc2hpZWxkJykuYWRkQ2xhc3MoInNob3duIik7CiAgICBsbi5hZGRDbGFzcygic2hvd24iKS5yZW1vdmVDbGFzcygiaGlkZGVuIikuY3NzKHtsZWZ0OiAiLTEwMCUifSkuY3NzKHtsZWZ0OiAtbG4ub3V0ZXJXaWR0aCgpfSkuYW5pbWF0ZSh7bGVmdDogMH0sIGZ1bmN0aW9uKCkgewogICAgICBsbi5yZW1vdmVDbGFzcygiaW4tdHJhbnNpdGlvbiIpOwogICAgfSk7CiAgICAkKHdpbmRvdykudHJpZ2dlcigncmVzaXplJyk7CiAgICBpZiAod2luZG93LmlubmVyV2lkdGggPiA5OTgpIHsKICAgICAgJCgnLmNvbnRlbnQnKS5hbmltYXRlKHsnbWFyZ2luLWxlZnQnOiBsbi5vdXRlcldpZHRoKCkudG9TdHJpbmcoKSArICdweCd9LCBmdW5jdGlvbigpe30pCiAgICB9IAogIH0KICAKICAkKCcuc2lkZWJhci10b2dnbGUsIC5uYXYtc2hpZWxkJykub2ZmKCdjbGljaycpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkgeyAKICAgIGlmIChsbi5pcygiOnZpc2libGUiKSB8fCAkKCcubmF2LXNoaWVsZCcpLmlzKCIuc2hvd24iKSkgewogICAgICBoaWRlU2lkZWJhcigpOwogICAgfSBlbHNlIGlmKCFsbi5pcygiOmVtcHR5IikpIHsKICAgICAgc2hvd1NpZGViYXIoKTsKICAgIH0KICB9KTsKICAkKCcubGVmdC1uYXYnKS5vZmYoJ2NsaWNrJykub24oJ2NsaWNrJywgJ2EsIGJ1dHRvbicsIGZ1bmN0aW9uKCkgewogICAgaWYgKCQoJy5uYXYtc2hpZWxkJykuaXMoIjp2aXNpYmxlIikpIHsKICAgICAgJCgnLm5hdi1zaGllbGQnKS50cmlnZ2VyKCdjbGljaycpOwogICAgfQogIH0pOwogIAogIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICBpZiAoYXBwQmFyLmNsYXNzTGlzdC5jb250YWlucygnc2Nyb2xsZWQnKSkgewogICAgICBpZiAod2luZG93LnNjcm9sbFkgPT09IDApIHsKICAgICAgICBhcHBCYXIuY2xhc3NMaXN0LnJlbW92ZSgnc2Nyb2xsZWQnKQogICAgCX0gCiAgICB9CiAgICBlbHNlIHsKICAgICAgYXBwQmFyLmNsYXNzTGlzdC5hZGQoJ3Njcm9sbGVkJykKICAgIH0KICB9KTsKCiAgZnVuY3Rpb24gYWRkTWFyZ2luVG9Db250ZW50KCkgewogICAgLy9jaGVjayBpZiB0aGVyZSBpcyBhIGZyZWUgYmFubmVyIGFuZCBzZXQgdGhlIHRvcCBtYXJnaW4gYWNjb3JkaW5pbmdseQogICAgaWYgKCQoJyNhbnZpbC1oZWFkZXInKS5jc3MoJ2Rpc3BsYXknKSA9PSAnYmxvY2snKSB7CiAgICAgIHZhciB0b3BNYXJnaW4gPSBhcHBCYXIuY2xpZW50SGVpZ2h0ICsgNTAKICAgIH0gZWxzZSB7CiAgICAgIHZhciB0b3BNYXJnaW4gPSBhcHBCYXIuY2xpZW50SGVpZ2h0CiAgICB9CiAgICAvL3RoZSBsZWZ0LW5hdi1wbGFjZWhvbGRlciBpbiB0aGUgZGVzaWduZXIgbmVlZHMgdG8gc2hpZnQgZG93biBmb3IgdGhlIGFwcCBiYXIKICAgIGxucC5jc3Moeyd0b3AnOiBhcHBCYXIuY2xpZW50SGVpZ2h0LnRvU3RyaW5nKCkgKyAncHgnfSkKCiAgICAvL2lmIHRoZSB3aW5kb3cgaXMgc21hbGwKICAgIGlmICh3aW5kb3cuaW5uZXJXaWR0aCA8IDk5OSkgewogICAgICAvL2lmIGluIEFudmlsIGRlc2lnbmVyCiAgICAgIGlmICh3aW5kb3cuYW52aWxJbkRlc2lnbmVyKSB7CiAgICAgICAgLy9hZGQgbGVmdCBtYXJnaW4gdG8gY29udGVudCB0byBtYWtlIHJvb20gZm9yIGxlZnQtbmF2IG9yIGxlZnQtbmF2LXBsYWNlaG9sZGVyCiAgICAgICAgJCgnLmNvbnRlbnQnKS5jc3MoeydtYXJnaW4tbGVmdCc6IE1hdGgubWF4KGxuLm91dGVyV2lkdGgoKSwgbG5wLm91dGVyV2lkdGgoKSkudG9TdHJpbmcoKSArICdweCd9KTsKICAgICAgICAkKCcuY29udGVudCcpLmNzcyh7J21hcmdpbi10b3AnOiBhcHBCYXIuY2xpZW50SGVpZ2h0LnRvU3RyaW5nKCkgKyAncHgnfSkKICAgICAgICBsbi5jc3Moeyd0b3AnOiB0b3BNYXJnaW4udG9TdHJpbmcoKSArICdweCd9KQogICAgICB9IGVsc2UgewogICAgICAgIC8vaWYgbm90IGluIEFudmlsIGRlc2lnbmVyLCBjb250ZW50IGdldHMgbm8gbGVmdCBtYXJnaW4gYmVjYXVzZSBsZWZ0LW5hdiB3aWxsIGJlIGEgbW9kYWwgb3ZlcmxheQogICAgICAgICQoJy5jb250ZW50JykuY3NzKHsnbWFyZ2luLWxlZnQnOiAnMHB4J30pOwogICAgICAgIGxuLmNzcyh7J3RvcCc6ICcwcHgnfSkKICAgICAgICAvL2FkZCB0b3AgbWFyZ2luIHRvIGNvbnRlbnQKICAgICAgICAkKCcuY29udGVudCcpLmNzcyh7J21hcmdpbi10b3AnOiB0b3BNYXJnaW4udG9TdHJpbmcoKSArICdweCd9KTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgLy9pZiB0aGUgd2luZG93IGlzIGJpZywgYWRkIG1hcmdpbiB0byBjb250ZW50IGFuZCBsZWZ0LW5hdiBmb3IgYXBwIGJhcgogICAgICAkKCcuY29udGVudCcpLmNzcyh7J21hcmdpbi10b3AnOiBhcHBCYXIuY2xpZW50SGVpZ2h0LnRvU3RyaW5nKCkgKyAncHgnfSk7CiAgICAgIGxuLmNzcyh7J3RvcCc6IHRvcE1hcmdpbi50b1N0cmluZygpICsgJ3B4J30pCiAgICAgIGlmICh3aW5kb3cuYW52aWxJbkRlc2lnbmVyKSB7CiAgICAgICAgLy9pZiBpbiB0aGUgZGVzaWduZXIsIGFkZCBsZWZ0IG1hcmdpbiBmb3IgZWl0aGVyIHRoZSBsZWZ0LW5hdiBvciB0aGUgcGxhY2Vob2xkZXIKICAgICAgICAkKCcuY29udGVudCcpLmNzcyh7J21hcmdpbi1sZWZ0JzogTWF0aC5tYXgobG4ub3V0ZXJXaWR0aCgpLCBsbnAub3V0ZXJXaWR0aCgpKS50b1N0cmluZygpICsgJ3B4J30pOwogICAgICB9IGVsc2UgewogICAgICAgIC8vaWYgbm90IGluIHRoZSBkZXNpZ25lciwgb25seSBhZGQgbWFyZ2luIGZvciB0aGUgbGVmdC1uYXYgYmVjYXVzZSBwbGFjZWhvbGRlciBzdGlsbCBoYXMgYSB3aWR0aCBvdXRzaWRlIG9mIGRlc2lnbmVyCiAgICAgICAgJCgnLmNvbnRlbnQnKS5jc3MoeydtYXJnaW4tbGVmdCc6IGxuLm91dGVyV2lkdGgoKSArICdweCd9KTsKICAgICAgfQogICAgfQogIH0KICAKICBhZGRNYXJnaW5Ub0NvbnRlbnQoKQogIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBhZGRNYXJnaW5Ub0NvbnRlbnQpOwogCjwvc2NyaXB0Pg==,
    id: 37AQTKKKZQA7S5VAK4PTPFB45HYVG4RS}
  - {name: theme.css, content: LyoqCiBUaGlzIENTUyBpbXBsZW1lbnRzIHRoZSBNYXRlcmlhbCBEZXNpZ24gMyBsb29rIGFuZCBmZWVsIGZvciBBbnZpbCBhcHBzLgogKiovCgovKiBTdG9wIHBhbmVsLWNvbHMgY3V0dGluZyBvZmYgZHJvcCBzaGFkb3dzICovCi5hbnZpbC1wYW5lbC1jb2wgewogIHBhZGRpbmctYm90dG9tOiAxMHB4OwogIG1hcmdpbi1ib3R0b206IC0xMHB4Owp9CgouY29udGVudCA+IC5wbGFjZWhvbGRlciB7CiAgbWFyZ2luOiAxNnB4OwogIGNvbG9yOiAjODg4OwogIGZvbnQtc2l6ZTogMThweDsKICBvdXRsaW5lOiAxcHggZG90dGVkOwogIHBhZGRpbmc6IDE2cHg7CiAgdGV4dC1hbGlnbjogY2VudGVyOwp9CgovKiBQdXQgdGhpbmdzIG9uIGEgNHB4IGdyaWQgKG5vbmUgb2YgdGhpcyA3cHggbm9uc2Vuc2UpICovCi5oYXMtdGV4dCAuYW52aWwtY29tcG9uZW50LWljb24ubGVmdC1pY29uIHsgbWFyZ2luLXJpZ2h0OiA4cHg7IH0KLmhhcy10ZXh0IC5hbnZpbC1jb21wb25lbnQtaWNvbi5yaWdodC1pY29uIHsgbWFyZ2luLWxlZnQ6IDhweDsgfQoKYT4uYW52aWwtY29tcG9uZW50LWljb24ubGVmdF9lZGdlLWljb24sCmE+LmFudmlsLWNvbXBvbmVudC1pY29uLnJpZ2h0X2VkZ2UtaWNvbiwKLmFudmlsLWxhYmVsPi5hbnZpbC1jb21wb25lbnQtaWNvbi5sZWZ0X2VkZ2UtaWNvbiwKLmFudmlsLWxhYmVsPi5hbnZpbC1jb21wb25lbnQtaWNvbi5yaWdodF9lZGdlLWljb24gewogIHBhZGRpbmctdG9wOiA4cHg7CiAgcGFkZGluZy1ib3R0b206IDhweDsKfQouYW52aWwtbGFiZWw+LmxhYmVsLXRleHQsIGE+LmxpbmstdGV4dCB7CiAgcGFkZGluZy10b3A6IDhweDsKICBwYWRkaW5nLWJvdHRvbTogOHB4Owp9Ci5maWxlLWxvYWRlcj5sYWJlbCB7CiAgICBwYWRkaW5nOiA4cHg7Cn0KLmNoZWNrYm94IGxhYmVsLCAucmFkaW8gbGFiZWwgewogICAgcGFkZGluZy10b3A6IDhweDsgcGFkZGluZy1yaWdodDogOHB4OyBwYWRkaW5nLWJvdHRvbTogOHB4Owp9CgovKlRPRE86IHNlZSBpZiB0aGlzIHNwYWNpbmcgc3R1ZmYgbmVlZHMgdG8gYmUgY2hhbmdlZCovCi5hbnZpbC1zcGFjaW5nLWFib3ZlLW5vbmUgeyBtYXJnaW4tdG9wOiAwcHg7IH0KLmFudmlsLXNwYWNpbmctYWJvdmUtc21hbGwgeyBtYXJnaW4tdG9wOiA0cHg7IH0KLmFudmlsLXNwYWNpbmctYWJvdmUtbWVkaXVtIHsgbWFyZ2luLXRvcDogOHB4OyB9Ci5hbnZpbC1zcGFjaW5nLWFib3ZlLWxhcmdlIHsgbWFyZ2luLXRvcDogMTZweDsgfQouYW52aWwtc3BhY2luZy1iZWxvdy1ub25lIHsgbWFyZ2luLWJvdHRvbTogMHB4OyB9Ci5hbnZpbC1zcGFjaW5nLWJlbG93LXNtYWxsIHsgbWFyZ2luLWJvdHRvbTogNHB4OyB9Ci5hbnZpbC1zcGFjaW5nLWJlbG93LW1lZGl1bSB7IG1hcmdpbi1ib3R0b206IDhweDsgfQouYW52aWwtc3BhY2luZy1iZWxvdy1sYXJnZSB7IG1hcmdpbi1ib3R0b206IDE2cHg7IH0KCgouY29sLXBhZGRpbmcuY29sLXBhZGRpbmctdGlueSB7IHBhZGRpbmc6IDAgMnB4OyB9Ci5jb2x1bW4tcGFuZWwuY29sLXBhZGRpbmctdGlueSA+IC5hbnZpbC1wYW5lbC1zZWN0aW9uID4gLmFudmlsLXBhbmVsLXNlY3Rpb24tY29udGFpbmVyID4gLmFudmlsLXBhbmVsLXNlY3Rpb24tZ3V0dGVyIHsgbWFyZ2luOiAwIC0ycHg7IH0KCi5jb2wtcGFkZGluZy5jb2wtcGFkZGluZy1zbWFsbCB7IHBhZGRpbmc6IDAgNHB4OyB9Ci5jb2x1bW4tcGFuZWwuY29sLXBhZGRpbmctc21hbGwgPiAuYW52aWwtcGFuZWwtc2VjdGlvbiA+IC5hbnZpbC1wYW5lbC1zZWN0aW9uLWNvbnRhaW5lciA+IC5hbnZpbC1wYW5lbC1zZWN0aW9uLWd1dHRlciB7IG1hcmdpbjogMCAtNHB4OyB9CgouY29sLXBhZGRpbmcuY29sLXBhZGRpbmctbWVkaXVtIHsgcGFkZGluZzogMCA4cHg7IH0KLmNvbHVtbi1wYW5lbC5jb2wtcGFkZGluZy1tZWRpdW0gPiAuYW52aWwtcGFuZWwtc2VjdGlvbiA+IC5hbnZpbC1wYW5lbC1zZWN0aW9uLWNvbnRhaW5lciA+IC5hbnZpbC1wYW5lbC1zZWN0aW9uLWd1dHRlciB7IG1hcmdpbjogMCAtOHB4OyB9CgouY29sLXBhZGRpbmcuY29sLXBhZGRpbmctbGFyZ2UgeyBwYWRkaW5nOiAwIDEycHg7IH0KLmNvbHVtbi1wYW5lbC5jb2wtcGFkZGluZy1sYXJnZSA+IC5hbnZpbC1wYW5lbC1zZWN0aW9uID4gLmFudmlsLXBhbmVsLXNlY3Rpb24tY29udGFpbmVyID4gLmFudmlsLXBhbmVsLXNlY3Rpb24tZ3V0dGVyIHsgbWFyZ2luOiAwIC0xMnB4OyB9CgouY29sLXBhZGRpbmcuY29sLXBhZGRpbmctaHVnZSB7IHBhZGRpbmc6IDAgMjBweDsgfQouY29sdW1uLXBhbmVsLmNvbC1wYWRkaW5nLWh1Z2UgPiAuYW52aWwtcGFuZWwtc2VjdGlvbiA+IC5hbnZpbC1wYW5lbC1zZWN0aW9uLWNvbnRhaW5lciA+IC5hbnZpbC1wYW5lbC1zZWN0aW9uLWd1dHRlciB7IG1hcmdpbjogMCAtMjBweDsgfQoKLmZsb3ctcGFuZWwuZmxvdy1zcGFjaW5nLXRpbnkgPiAuZmxvdy1wYW5lbC1ndXR0ZXIgeyBtYXJnaW46IDAgLTJweDsgfQouZmxvdy1wYW5lbC5mbG93LXNwYWNpbmctdGlueSA+IC5mbG93LXBhbmVsLWd1dHRlciA+IC5mbG93LXBhbmVsLWl0ZW0geyAKICBtYXJnaW4tbGVmdDogMnB4OwogIG1hcmdpbi1yaWdodDogMnB4Owp9CgouZmxvdy1wYW5lbC5mbG93LXNwYWNpbmctc21hbGwgPiAuZmxvdy1wYW5lbC1ndXR0ZXIgeyBtYXJnaW46IDAgLTRweDsgfQouZmxvdy1wYW5lbC5mbG93LXNwYWNpbmctc21hbGwgPiAuZmxvdy1wYW5lbC1ndXR0ZXIgPiAuZmxvdy1wYW5lbC1pdGVtIHsgCiAgbWFyZ2luLWxlZnQ6IDRweDsKICBtYXJnaW4tcmlnaHQ6IDRweDsKfQoKLmZsb3ctcGFuZWwuZmxvdy1zcGFjaW5nLW1lZGl1bSA+IC5mbG93LXBhbmVsLWd1dHRlciB7IG1hcmdpbjogMCAtOHB4OyB9Ci5mbG93LXBhbmVsLmZsb3ctc3BhY2luZy1tZWRpdW0gPiAuZmxvdy1wYW5lbC1ndXR0ZXIgPiAuZmxvdy1wYW5lbC1pdGVtIHsgCiAgbWFyZ2luLWxlZnQ6IDhweDsKICBtYXJnaW4tcmlnaHQ6IDhweDsKfQoKLmZsb3ctcGFuZWwuZmxvdy1zcGFjaW5nLWxhcmdlID4gLmZsb3ctcGFuZWwtZ3V0dGVyIHsgbWFyZ2luOiAwIC0xMnB4OyB9Ci5mbG93LXBhbmVsLmZsb3ctc3BhY2luZy1sYXJnZSA+IC5mbG93LXBhbmVsLWd1dHRlciA+IC5mbG93LXBhbmVsLWl0ZW0geyAKICBtYXJnaW4tbGVmdDogMTJweDsKICBtYXJnaW4tcmlnaHQ6IDEycHg7Cn0KCi5mbG93LXBhbmVsLmZsb3ctc3BhY2luZy1odWdlID4gLmZsb3ctcGFuZWwtZ3V0dGVyIHsgbWFyZ2luOiAwIC0yMHB4OyB9Ci5mbG93LXBhbmVsLmZsb3ctc3BhY2luZy1odWdlID4gLmZsb3ctcGFuZWwtZ3V0dGVyID4gLmZsb3ctcGFuZWwtaXRlbXsgCiAgbWFyZ2luLWxlZnQ6IDIwcHg7CiAgbWFyZ2luLXJpZ2h0OiAyMHB4Owp9CgoKLyogVHlwb2dyYXBoeSAqLwpib2R5IHsKICBmb250LWZhbWlseTogUm9ib3RvLCBOb3RvLCBBcmlhbCwgc2Fucy1zZXJpZjsKICBmb250LXNpemU6IDE0cHg7CiAgbGluZS1oZWlnaHQ6IDEuNDI4NjsKICBjb2xvcjogJWNvbG9yOk9uIFN1cmZhY2UlOwogIGJhY2tncm91bmQtY29sb3I6ICVjb2xvcjpCYWNrZ3JvdW5kJTsKICBtaW4taGVpZ2h0OiBjYWxjKDEwMHZoIC0gNTZweCkKfQoKQG1lZGlhIHByaW50IHsKICBib2R5IHsKICAgIGJhY2tncm91bmQtY29sb3I6IHdoaXRlOwogIH0KfQoKYSwgYTpmb2N1cyB7CiAgdGV4dC1kZWNvcmF0aW9uOiBub25lOwogIGNvbG9yOiAlY29sb3I6UHJpbWFyeSU7Cn0KCmE6aG92ZXIsIGE6YWN0aXZlIHsKY29sb3I6ICVjb2xvcjpPbiBQcmltYXJ5IENvbnRhaW5lciU7Cn0KCi5hbnZpbC1yb2xlLWRpc3BsYXkgewogIGZvbnQtc2l6ZTogNTdweDsKICBsaW5lLWhlaWdodDogNjRweDsKICBmb250LXdlaWdodDogNDAwOwp9CgouYW52aWwtcm9sZS1oZWFkbGluZSB7CiAgZm9udC1zaXplOiAzMnB4OwogIGxpbmUtaGVpZ2h0OiA0MHB4OwogIGZvbnQtd2VpZ2h0OiA0MDA7Cn0KCi5hbnZpbC1yb2xlLXRpdGxlIHsKICBmb250LXNpemU6IDIycHg7CiAgbGluZS1oZWlnaHQ6IDI4cHg7CiAgZm9udC13ZWlnaHQ6IDUwMDsKfQoKLmFudmlsLXJvbGUtYm9keSB7CiAgZm9udC1zaXplOiAxNHB4OwogIGxpbmUtaGVpZ2h0OiAyMHB4OwogIGZvbnQtd2VpZ2h0OiA0MDA7Cn0KCi5hbnZpbC1yb2xlLWlucHV0LXByb21wdCB7CiAgZm9udC1zaXplOiAxNnB4OwogIGxpbmUtaGVpZ2h0OiAxLjU7Cn0KCi5hbnZpbC1yb2xlLWJvZHkgPiAubGFiZWwtdGV4dCwgLmFudmlsLXJvbGUtYm9keSAubGluay10ZXh0IHsKICBwYWRkaW5nLXRvcDogMDsKICBwYWRkaW5nLWJvdHRvbTogMDsKfQoKLyogUGFnZSBzdHJ1Y3R1cmU6IEFwcCBiYXIgd2l0aCBvcHRpb25hbCBsZWZ0IG5hdiAqLwouc3RydWN0dXJlIHsKLyogICBkaXNwbGF5OiBmbGV4OwogIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47ICovCiAgbWluLWhlaWdodDogMTAwdmg7CiAgbWluLWhlaWdodDogY2FsYygxMDB2aCAtICVhbnZpbC1iYW5uZXItaGVpZ2h0JSk7Ci8qICAgaGVpZ2h0OiAwOyAvKiBUbyBtYWtlIGZsZXgtZ3JvdyB3b3JrIGluIElFICovCn0KCi8qIEhvd2V2ZXIsIHRoaXMgYnJlYWtzIHRoZSBkZXNpZ25lcidzIGhlaWdodCBtZWFzdXJlbWVudC4gSUUgaXNuJ3Qgc3VwcG9ydGVkIGZvciB0aGUgZGVzaWduZXIsIHNvIHNldCBpdCBiYWNrLiAqLwouZGVzaWduZXIgLnN0cnVjdHVyZSB7CiAgaGVpZ2h0OiBpbml0aWFsOwp9CgouYXBwLWJhciB7CiAgei1pbmRleDogMTAwMDsKICBwb3NpdGlvbjogZml4ZWQ7CiAgdG9wOiAwOwogIHRvcDogJWFudmlsLWJhbm5lci1oZWlnaHQlOwogIHJpZ2h0OiAwOwogIGxlZnQ6IDA7Ci8qICAgZmxleDogMCAwOwogIGZsZXgtYmFzaXM6IGF1dG87CiAgZmxleC1iYXNpczogY29udGVudDsgKi8KfQoKLm5hdi1ob2xkZXIgewogIGRpc3BsYXk6IGZsZXg7Ci8qICAgZmxleC1ncm93OiAxOwogIG92ZXJmbG93LXk6IGluaXRpYWw7ICovCn0KCkBtZWRpYSBwcmludCB7CiAgLm5hdi1ob2xkZXIgewogICAgb3ZlcmZsb3cteTogaW5pdGlhbDsKICB9Cn0KCgovKiBNb2JpbGUgYW5kIGRlc2t0b3AgbWFyZ2lucyBmb3IgY29udGVudCAqLwouY29udGVudCA+ICogPiAuYW52aWwtY29udGFpbmVyIHsKICBwYWRkaW5nOiA4cHg7Cn0KCkBtZWRpYShtaW4td2lkdGg6OTkxcHgpIHsKICAuY29udGVudCA+ICogPiAuYW52aWwtY29udGFpbmVyIHsKICAgIHBhZGRpbmc6IDE2cHggMjRweDsKICB9Cn0KCi5jb250ZW50IC5hbnZpbC1tZWFzdXJlLXRoaXMgewogIHBhZGRpbmctYm90dG9tOiAxcHg7IC8qIFByZXZlbnQgbWFyZ2luIGNvbGxhcHNlIG1lc3NpbmcgdXAgZW1iZWRkaW5nICovCn0KCi8qIEFsbG93IG92ZXJmbG93cyB0byBzaG93IGRyb3Agc2hhZG93cyBpbiBDb2x1bW5QYW5lbHMKICAgVGhpcyBjYW4gY3JlYXRlIHVud2FudGVkIHNjcm9sbGJhcnM7IHdlIGNvbXBlbnNhdGUgZm9yIHRoaXMgYXQgdGhlIHRvcCBsZXZlbCB3aXRoIC5uYXYtaG9sZGVyIC5jb250ZW50IHtvdmVyZmxvdy14OiBoaWRkZW47fQoqLwouYW52aWwtY29udGFpbmVyLW92ZXJmbG93IHsKICBvdmVyZmxvdy14OiB2aXNpYmxlOwogIG92ZXJmbG93LXk6IHZpc2libGU7Cn0KCi8qIERlc2t0b3A6IE5hdiBiYXIgcGlubmVkICovCgoubmF2LWhvbGRlciB7CiAgZGlzcGxheTogZmxleDsKICBmbGV4LWRpcmVjdGlvbjogcm93Owp9CgoubmF2LWhvbGRlciAubGVmdC1uYXYgewogIHBvc2l0aW9uOiBmaXhlZDsKLyogICB0b3A6IDA7ICovCiAgbGVmdDogMDsKICBmbGV4LXNocmluazogMDsKICBtaW4td2lkdGg6IDI0MHB4OwogIG1heC13aWR0aDogNDAwcHg7Cn0KCi5uYXYtc2hpZWxkIHsKICBkaXNwbGF5OiBub25lOwp9CgovKiBNb2JpbGU6IE5hdiBiYXIgaXMgYSBtb2RhbCBvdmVybGF5ICovCgpAbWVkaWEobWF4LXdpZHRoOjk5OHB4KSB7CiAgaHRtbDpub3QoLmRlc2lnbmVyKSAubmF2LWhvbGRlciB7CiAgICBkaXNwbGF5OiBibG9jazsKICB9CiAgaHRtbDpub3QoLmRlc2lnbmVyKSAubmF2LWhvbGRlciAubGVmdC1uYXYgewogICAgdG9wOiAwOwogICAgYm90dG9tOiAwOwogICAgd2lkdGg6IGNhbGMoMTAwJSAtIDU2cHgpOwogICAgbWF4LXdpZHRoOiAzNjBweDsKICAgIHotaW5kZXg6IDM7CiAgICBib3JkZXItcmlnaHQ6IG5vbmU7CiAgICBib3JkZXItcmFkaXVzOiAwIDIwcHggMjBweCAwOwogIC8qIDE2ZHAgKi8gYm94LXNoYWRvdzogMCAxNnB4IDI0cHggMnB4IHJnYmEoMCwgMCwgMCwgMC4xNCksIDAgNnB4IDMwcHggNXB4IHJnYmEoMCwgMCwgMCwgMC4xMiksIDAgOHB4IDEwcHggLTVweCByZ2JhKDAsIDAsIDAsIDAuMik7CgogICAgZGlzcGxheTogbm9uZTsKICAgIHRyYW5zaXRpb246IHJpZ2h0IDAuNXM7CiAgICBoZWlnaHQ6IDEwMCU7CiAgfQogIAogIGh0bWw6bm90KC5kZXNpZ25lcikgLm5hdi1ob2xkZXIgLmxlZnQtbmF2LnNob3duIHsKICAgIGRpc3BsYXk6IGJsb2NrOwogIH0KICAubmF2LXNoaWVsZC5zaG93biB7CiAgICBkaXNwbGF5OiBibG9jazsKICAgIHBvc2l0aW9uOiBmaXhlZDsKICAgIHRvcDogMDsKICAgIGJvdHRvbTogMDsKICAgIGxlZnQ6IDA7CiAgICByaWdodDogMDsKICAgIHotaW5kZXg6IDI7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDAsMCwwLDAuMik7CiAgfQogfQoKLm5hdi1ob2xkZXIgLmxlZnQtbmF2LCAubGVmdC1uYXYtcGxhY2Vob2xkZXIgewogIGRpc3BsYXk6IGZsZXg7CiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMGRlZywgJWNvbG9yOlByaW1hcnkgT3ZlcmxheSAxJSwgJWNvbG9yOlByaW1hcnkgT3ZlcmxheSAxJSksICVjb2xvcjpCYWNrZ3JvdW5kJTsKLyogICBib3JkZXItcmlnaHQ6IDFweCBzb2xpZCAjZTBlMGUwOyAqLwogIGZvbnQtc2l6ZTogMTRweDsKICBmb250LXdlaWdodDogNTAwOwogIGNvbG9yOiAlY29sb3I6T24gU3VyZmFjZSBWYXJpYW50JTsKICBvdmVyZmxvdy14OiBoaWRkZW47CiAgb3ZlcmZsb3cteTogYXV0bzsKICBwb3NpdGlvbjogZml4ZWQ7Ci8qICAgdG9wOiA1NHB4OyAqLwogIGhlaWdodDogY2FsYygxMDAlIC0gNTRweCk7IC8qdG9kbzogZml4IG9uIG1vYmlsZSovCn0KCgoubGVmdC1uYXYtcGxhY2Vob2xkZXIgewogIGRpc3BsYXk6IGJsb2NrOwogIHBhZGRpbmc6IDhweDsKICBsaW5lLWhlaWdodDogMTsKICB3aWR0aDogNThweDsKfQoubGVmdC1uYXYtcGxhY2Vob2xkZXIgLnByb21wdCB7CiAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogIHdoaXRlLXNwYWNlOiBub3dyYXA7CiAgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwwKSByb3RhdGUoLTkwZGVnKSB0cmFuc2xhdGUoLTUwJSwwKSB0cmFuc2xhdGUoMTVweCwxNnB4KTsKICBwYWRkaW5nOiAxNnB4IDE2cHg7CiAgY29sb3I6ICM4ODg7CiAgb3V0bGluZTogMXB4IGRvdHRlZCAjODg4OwogIHZpc2liaWxpdHk6IGhpZGRlbjsKfQouYW52aWwtaGlnaGxpZ2h0IC5sZWZ0LW5hdi1wbGFjZWhvbGRlciAucHJvbXB0IHsKICB2aXNpYmlsaXR5OiB2aXNpYmxlOwp9CgoubGVmdC1uYXYgPiAuY29sdW1uLXBhbmVsIHsKICBwYWRkaW5nOiAyNHB4IDA7Cn0KLmxlZnQtbmF2ID4gLmNvbHVtbi1wYW5lbCA+IC5hbnZpbC1wYW5lbC1zZWN0aW9uID4gLmFudmlsLXBhbmVsLXNlY3Rpb24tY29udGFpbmVyOm5vdCguZnVsbC13aWR0aC1yb3cpIHsKICBtYXJnaW46IDAgMTZweDsKICB3aWR0aDogaW5pdGlhbDsKICBtYXgtd2lkdGg6IGluaXRpYWw7CiAgb3ZlcmZsb3cteDogdmlzaWJsZTsKfQoubGVmdC1uYXYgPiAuY29sdW1uLXBhbmVsID4gLmFudmlsLXBhbmVsLXNlY3Rpb246Zmlyc3QtY2hpbGQgPiAuYW52aWwtcGFuZWwtc2VjdGlvbi1jb250YWluZXIuZnVsbC13aWR0aC1yb3cgewogIG1hcmdpbi10b3A6IC0yNHB4Owp9Ci5sZWZ0LW5hdiA+IC5jb2x1bW4tcGFuZWwgPiAuYW52aWwtcGFuZWwtc2VjdGlvbiA+IC5hbnZpbC1wYW5lbC1zZWN0aW9uLWNvbnRhaW5lciA+IC5hbnZpbC1wYW5lbC1zZWN0aW9uLWd1dHRlciA+IC5hbnZpbC1wYW5lbC1yb3cgPiAuYW52aWwtcGFuZWwtY29sIHsKICBvdmVyZmxvdy14OiB2aXNpYmxlOwp9CgovKiBNYWtlIGFsbCB0aGUgc2lkZWJhciBpY29ucyBsb29rIG5pY2UgKi8KCi5sZWZ0LW5hdiAuYW52aWwtY29tcG9uZW50LWljb24ubGVmdC1pY29uIHsKICB3aWR0aDogMDsKICBtYXJnaW4tcmlnaHQ6IDI0cHg7CiAgcG9zaXRpb246IHJlbGF0aXZlOwp9CgoubGVmdC1uYXYgLmFudmlsLWNvbXBvbmVudC1pY29uLmxlZnRfZWRnZS1pY29uLCAubGVmdC1uYXYgLmFudmlsLWNvbXBvbmVudC1pY29uLnJpZ2h0X2VkZ2UtaWNvbiB7CiAgbGVmdDogMTZweDsKICBwYWRkaW5nLXRvcDogMnB4OwogIHdpZHRoOiAwOwp9CgoubGVmdC1uYXYgLmFudmlsLWNvbXBvbmVudC1pY29uLnJpZ2h0X2VkZ2UtaWNvbiB7CiAgbGVmdDogaW5pdGlhbDsKICByaWdodDogMTZweDsKICB0b3A6IDA7CiAgcGFkZGluZy10b3A6IDJweDsKfQoKLyogU2lkZWJhciBsaW5rcyAoYW5kIGxhYmVscyB3aXRoIGVkZ2UgaWNvbnMpIGdvICsxNnB4IHdpZGVyCiAgIChUb3AtbGV2ZWwgY29sdW1ucyBpbiBDb2x1bW5QYW5lbHMgZ2V0IG92ZXJmbG93LXggdmlzaWJsZSBbc2VlIGFib3ZlXXRvIGVuYWJsZSB0aGlzKQoqLwoKLmxlZnQtbmF2IGEsIC5sZWZ0LW5hdiAuYW52aWwtbGFiZWwsIC5sZWZ0LW5hdiAuYW52aWwtbGFiZWwubGVmdF9lZGdlLWljb24sIC5sZWZ0LW5hdiAuYW52aWwtbGFiZWwucmlnaHRfZWRnZS1pY29uIHsKICBjb2xvcjogJWNvbG9yOk9uIFN1cmZhY2UgVmFyaWFudCU7CiAgbWFyZ2luOiAwIC04cHg7CiAgcGFkZGluZzogNHB4IDE2cHg7CiAgYm9yZGVyLXJhZGl1czogMTAwcHg7Cn0KCi5sZWZ0LW5hdiAuYW52aWwtY29tcG9uZW50LmxlZnRfZWRnZS1pY29uIHsKICBwYWRkaW5nLWxlZnQ6IDcycHg7Cn0KCi5sZWZ0LW5hdiBhOmhvdmVyLCAuYXBwLWJhciBhOmhvdmVyLCAuYXBwLWJhciBhOmFjdGl2ZSB7CiAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDBkZWcsICVjb2xvcjpEYXJrIE92ZXJsYXkgMSUsICVjb2xvcjpEYXJrIE92ZXJsYXkgMSUpLCBsaW5lYXItZ3JhZGllbnQoMGRlZywgJWNvbG9yOlByaW1hcnkgT3ZlcmxheSAxJSwgJWNvbG9yOlByaW1hcnkgT3ZlcmxheSAxJSksICVjb2xvcjpCYWNrZ3JvdW5kJTsKICBvcGFjaXR5OiAxMDAlOwp9CgoubGVmdC1uYXYgYS5hbnZpbC1yb2xlLXNlbGVjdGVkLCAuYXBwLWJhciBhLmFudmlsLXJvbGUtc2VsZWN0ZWQgIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiAlY29sb3I6U2Vjb25kYXJ5IENvbnRhaW5lciU7CiAgY29sb3I6ICVjb2xvcjpPbiBTZWNvbmRhcnkgQ29udGFpbmVyJTsKfQoKLmxlZnQtbmF2IGEuYW52aWwtcm9sZS1zZWxlY3RlZDpob3ZlciwgLmFwcC1iYXIgYS5hbnZpbC1yb2xlLXNlbGVjdGVkOmhvdmVyIHsKICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMGRlZywgJWNvbG9yOkRhcmsgT3ZlcmxheSAxJSwgJWNvbG9yOkRhcmsgT3ZlcmxheSAxJSksICVjb2xvcjpTZWNvbmRhcnkgQ29udGFpbmVyJTsKfQoKLmRlc2lnbmVyIC5uYXYtaG9sZGVyIC5sZWZ0LW5hdiB7CiAgbWluLXdpZHRoOiA1NnB4Owp9CgouZGVzaWduZXIgLm5hdi1ob2xkZXIgLmxlZnQtbmF2ID4gLmFudmlsLWNvbXBvbmVudCB7CiAgbWluLXdpZHRoOiAxNjBweDsKfQoKLm5hdi1ob2xkZXIgLmxlZnQtbmF2ID4gLmFudmlsLWNvbXBvbmVudCB7CiAgbWFyZ2luLXRvcDogMDsKICBtYXJnaW4tYm90dG9tOiAwOwp9CgoubmF2LWhvbGRlciB7CiAgZmxleDogMTsKfQoKLmNvbnRlbnQgewogIGZsZXg6IDE7CiAgb3ZlcmZsb3cteDogaGlkZGVuOwp9CgovKiBDb21wb25lbnRzOiBBcHAgQmFyICovCi5hcHAtYmFyIHsKICBtaW4taGVpZ2h0OiA1NnB4OwogIHBhZGRpbmc6IDAgMTZweCAwIDcycHg7CiAgcG9zaXRpb246IGZpeGVkOwogIHdpZHRoOiAxMDAlOwogIAogIGxpbmUtaGVpZ2h0OiA0MHB4OwogIGZvbnQtc2l6ZTogMjBweDsKCiAgYmFja2dyb3VuZC1jb2xvcjogJWNvbG9yOlN1cmZhY2UlOwogIHRyYW5zaXRpb246IGJhY2tncm91bmQtY29sb3IgMjUwbXM7CiAgLXdlYmtpdC10cmFuc2l0aW9uOiBiYWNrZ3JvdW5kLWNvbG9yIDI1MG1zOwogIC1tb3otdHJhbnNpdGlvbjogYmFja2dyb3VuZC1jb2xvciAyNTBtczsKICAtby10cmFuc2l0aW9uOiBiYWNrZ3JvdW5kLWNvbG9yIDI1MG1zOwogIAogIHotaW5kZXg6IDE7Cn0KCi5hcHAtYmFyLnNjcm9sbGVkIHsKICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMGRlZywgJWNvbG9yOlByaW1hcnkgT3ZlcmxheSAyJSwgJWNvbG9yOlByaW1hcnkgT3ZlcmxheSAyJSksICVjb2xvcjpCYWNrZ3JvdW5kJTsKICB0cmFuc2l0aW9uOiBiYWNrZ3JvdW5kIDI1MG1zOwogIC13ZWJraXQtdHJhbnNpdGlvbjogYmFja2dyb3VuZCAyNTBtczsKICAtbW96LXRyYW5zaXRpb246IGJhY2tncm91bmQgMjUwbXM7CiAgLW8tdHJhbnNpdGlvbjogYmFja2dyb3VuZCAyNTBtczsKfQoKLmFwcC1iYXIgLmFudmlsLWNvbXBvbmVudCB7CiAgbWFyZ2luLXRvcDogMDsKICBtYXJnaW4tYm90dG9tOiAwOwp9CgouYXBwLWJhciA+IC5zaWRlYmFyLXRvZ2dsZSB7IGRpc3BsYXk6YmxvY2s7IGZsb2F0OmxlZnQ7ICBtYXJnaW4tbGVmdDogLTYxcHg7IH0KLmFwcC1iYXIgPiAudG9wLWxlZnQtYnRuIHsgZmxvYXQ6IGxlZnQ7IG1hcmdpbi1sZWZ0OiAtNjBweDsgbWFyZ2luLXJpZ2h0OiAtNDBweDsgfQouYXBwLWJhciA+IC50aXRsZSB7IGZsb2F0OiBsZWZ0OyB9Ci5hcHAtYmFyID4gLnRpdGxlID4gLnBsYWNlaG9sZGVyIHsgb3V0bGluZTogMXB4IGRvdHRlZDsgcGFkZGluZy1sZWZ0OiAxNnB4OyBwYWRkaW5nLXJpZ2h0OiAxNnB4OyBtYXJnaW46IDhweCA4cHggMDsgZGlzcGxheTpub25lOyB9Ci5hcHAtYmFyID4gLmFwcC1iYXItbmF2IHsgZmxvYXQ6IHJpZ2h0OyBmb250LXdlaWdodDogbm9ybWFsOyB9Ci5hcHAtYmFyID4gLmFwcC1iYXItbmF2IC5wbGFjZWhvbGRlciB7IG1hcmdpbi10b3A6IDhweDsgcGFkZGluZzogMCA4cHg7IH0KLmFudmlsLWhpZ2hsaWdodCAuYXBwLWJhciA+IC5hcHAtYmFyLW5hdiAucGxhY2Vob2xkZXIgeyBvdXRsaW5lOiAxcHggZG90dGVkICNjY2M7IH0KLmFudmlsLWhpZ2hsaWdodCAuYXBwLWJhciA+IC50aXRsZSA+IC5wbGFjZWhvbGRlciB7IGRpc3BsYXk6YmxvY2s7IH0KCi5hcHAtYmFyIGEsIC5hcHAtYmFyIC5hbnZpbC1jb21wb25lbnQgewogIGRpc3BsYXk6IGJsb2NrOwogIGNvbG9yOiAlY29sb3I6T24gU3VyZmFjZSU7CiAgbGluZS1oZWlnaHQ6IDMwcHg7CiAgbWluLXdpZHRoOiAzMHB4OwogIG1pbi1oZWlnaHQ6IDMwcHg7CiAgbWFyZ2luOiA1cHggNHB4IDA7Cn0KCi5hcHAtYmFyIC50aXRsZSAuYW52aWwtY29tcG9uZW50IHsKICBtYXJnaW4tbGVmdDogMDsKfQoKLmFwcC1iYXIgaW5wdXQuYW52aWwtY29tcG9uZW50LCAuYXBwLWJhciAuYW52aWwtY29tcG9uZW50IGlucHV0IHsKICBsaW5lLWhlaWdodDogMzBweDsKICBjb2xvcjogd2hpdGU7Cn0KCi5hcHAtYmFyIHNlbGVjdC5mb3JtLWNvbnRyb2wgewogIGhlaWdodDogNDNweDsgLyogMzBweCBsaW5lIGhlaWdodCArIDEycHggcGFkZGluZyArIDFweCBib3JkZXIgKi8KfQoKLmFwcC1iYXIgLmFudmlsLWNvbXBvbmVudC1pY29uLXByZXNlbnQgLmFudmlsLWNvbXBvbmVudC1pY29uLCAuYXBwLWJhciAuc2lkZWJhci10b2dnbGUgLmZhIHsKICB3aWR0aDogMzBweDsKICB0ZXh0LWFsaWduOiBjZW50ZXI7Cn0KCi8qIERvbid0IHB1dCBzcGFjaW5nIG9uIHRoZSB0b3AtbGV2ZWwgY29udGFpbmVyIChlZyBGbG93UGFuZWwpICovCi5hcHAtYmFyLW5hdiA+IC5hbnZpbC1jb250YWluZXIgewogIG1hcmdpbjogMDsKICBwYWRkaW5nOiAwOwogIG1pbi1oZWlnaHQ6IDU2cHg7Cn0KCi5hbnZpbC1oaWdobGlnaHQgLmFwcC1iYXItbmF2ID4gLmFudmlsLWNvbnRhaW5lcjpub3QoLmhhcy1jb21wb25lbnRzKTpub3QoYSkgewogIG91dGxpbmU6IDFweCBkb3R0ZWQgI2ZmZjsKICBtYXJnaW4tdG9wOiA4cHg7CiAgbWluLWhlaWdodDogNDBweDsKICBwYWRkaW5nOiA1cHggOHB4Owp9CgouYW52aWwtaGlnaGxpZ2h0IC5hcHAtYmFyLW5hdiA+IC5hbnZpbC1jb250YWluZXI6bm90KC5oYXMtY29tcG9uZW50cyk6bm90KGEpOjphZnRlciB7ICAKICBjb250ZW50OiAiRHJvcCBMaW5rcyBoZXJlIgp9CgovKiBSZWppZyBtYXJnaW4gdnMgcGFkZGluZyB0byBnaXZlIGxpbmtzIHRoZSBoYWxvICovCi5hcHAtYmFyIGEsIC5hcHAtYmFyIGEuYW52aWwtY29tcG9uZW50IHsKICBwYWRkaW5nOiA1cHg7CiAgbWFyZ2luOiA4cHggMCAwOwogIGJvcmRlci1yYWRpdXM6IDIwcHg7Cn0KCi5hcHAtYmFyIGEgLmxpbmstdGV4dCB7CiAgcGFkZGluZzogMCA0cHg7Cn0KLmFwcC1iYXIgYS5oYXMtdGV4dCAuYW52aWwtY29tcG9uZW50LWljb24ubGVmdCB7CiAgbWFyZ2luLXJpZ2h0OiA0cHg7Cn0KLmFwcC1iYXIgYS5oYXMtdGV4dCAuYW52aWwtY29tcG9uZW50LWljb24ucmlnaHQgewogIG1hcmdpbi1sZWZ0OiA0cHg7Cn0KCgovKiBDb21wb25lbnQ6IERpYWxvZyAoYWxlcnQpLCBOb3RpZmljYXRpb24gKi8KLm1vZGFsLWNvbnRlbnQsIGJvZHk+ZGl2W2RhdGEtbm90aWZ5PSJjb250YWluZXIiXSB7CiAgYm9yZGVyLXJhZGl1czogMjhweDsKICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMGRlZywgJWNvbG9yOlByaW1hcnkgT3ZlcmxheSAzJSwgJWNvbG9yOlByaW1hcnkgT3ZlcmxheSAzJSksICVjb2xvcjpCYWNrZ3JvdW5kJTsKICBib3gtc2hhZG93OiBub25lOwogIGJvcmRlcjogbm9uZTsKfQoKLm1vZGFsLWhlYWRlciB7CiAgcGFkZGluZzogMjRweCAyNHB4IDBweDsKICBmb250LXNpemU6IDI0cHg7CiAgbGluZS1oZWlnaHQ6IDMycHg7CiAgYm9yZGVyOiAwOwogIGNvbG9yOiAlY29sb3I6T24gU3VyZmFjZSU7Cn0KCi5tb2RhbC1ib2R5IHsKICBwYWRkaW5nOiAyNHB4OwogIGZvbnQtc2l6ZTogMTZweDsKICBjb2xvcjogJWNvbG9yOk9uIFN1cmZhY2UgVmFyaWFudCU7Cn0KCi5tb2RhbC1mb290ZXIgewogIHBhZGRpbmc6IDBweCA4cHggMTRweCAyNHB4OwogIGJvcmRlcjogMDsKfQoKLm1vZGFsLWZvb3RlciAuYnRuLCAubW9kYWwtZm9vdGVyIC5idG46Zm9jdXMsIC5tb2RhbC1mb290ZXIgLmJ0bjphY3RpdmUgewogIGJveC1zaGFkb3c6IG5vbmU7CiAgdG9wOiAwOwp9CgovKiBOb3RpZmljYXRpb25zICovCmJvZHk+ZGl2W2RhdGEtbm90aWZ5PSJjb250YWluZXIiXSB7CiAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDBkZWcsICVjb2xvcjpQcmltYXJ5IE92ZXJsYXkgMyUsICVjb2xvcjpQcmltYXJ5IE92ZXJsYXkgMyUpLCAlY29sb3I6QmFja2dyb3VuZCU7CiAgYm9yZGVyOiBub25lOwogIHBhZGRpbmc6IDI0cHg7CiAgLyogMjRkcCAqLyBib3gtc2hhZG93OiAwIDlweCA0NnB4IDhweCByZ2JhKDAsIDAsIDAsIDAuMTQpLCAwIDExcHggMTVweCAtN3B4IHJnYmEoMCwgMCwgMCwgMC4xMiksIDAgMjRweCAzOHB4IDNweCByZ2JhKDAsIDAsIDAsIDAuMik7Cn0KCmJvZHk+ZGl2W2RhdGEtbm90aWZ5PSJjb250YWluZXIiXT5zcGFuW2RhdGEtbm90aWZ5PSJ0aXRsZSJdIHsKICBkaXNwbGF5OiBibG9jazsKICBmb250LXNpemU6IDE4cHg7CiAgZm9udC13ZWlnaHQ6IDUwMDsKICBjb2xvcjogJWNvbG9yOk9uIFN1cmZhY2UlOwp9Cgpib2R5PmRpdltkYXRhLW5vdGlmeT0iY29udGFpbmVyIl0+c3BhbltkYXRhLW5vdGlmeT0ibWVzc2FnZSJdIHsKICBkaXNwbGF5OiBibG9jazsKICBwYWRkaW5nOiAyMHB4IDAgMDsKICBmb250LXNpemU6IDE2cHg7CiAgY29sb3I6ICVjb2xvcjpPbiBTdXJmYWNlIFZhcmlhbnQlOyAgCn0KCmJvZHk+ZGl2W2RhdGEtbm90aWZ5PSJjb250YWluZXIiXS5hbGVydC1zdWNjZXNzewogIGJhY2tncm91bmQtY29sb3I6ICNkNGVkZGE7Cn0KCmJvZHk+ZGl2W2RhdGEtbm90aWZ5PSJjb250YWluZXIiXS5hbGVydC1zdWNjZXNzPnNwYW5bZGF0YS1ub3RpZnk9InRpdGxlIl17CiAgY29sb3I6ICMxNTU3MjQ7Cn0KCmJvZHk+ZGl2W2RhdGEtbm90aWZ5PSJjb250YWluZXIiXS5hbGVydC1kYW5nZXJ7CiAgYmFja2dyb3VuZC1jb2xvcjogI2Y4ZDdkYTsKfQoKYm9keT5kaXZbZGF0YS1ub3RpZnk9ImNvbnRhaW5lciJdLmFsZXJ0LWRhbmdlcj5zcGFuW2RhdGEtbm90aWZ5PSJ0aXRsZSJdewogIGNvbG9yOiAjNzIxYzI0Owp9Cgpib2R5PmRpdltkYXRhLW5vdGlmeT0iY29udGFpbmVyIl0uYWxlcnQtd2FybmluZ3sKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmM2NkOwp9Cgpib2R5PmRpdltkYXRhLW5vdGlmeT0iY29udGFpbmVyIl0uYWxlcnQtd2FybmluZz5zcGFuW2RhdGEtbm90aWZ5PSJ0aXRsZSJdewogIGNvbG9yOiAjODU2NDA0Owp9CgpidXR0b24uY2xvc2UgPiBzcGFuLCBidXR0b24uY2xvc2UgewogIGNvbG9yOiVjb2xvcjpPbiBCYWNrZ3JvdW5kJTsKICB0ZXh0LXNoYWRvdzogMCAxcHggMCAlY29sb3I6QmFja2dyb3VuZCU7Cn0KCi8qIENvbXBvbmVudDogQnV0dG9uICovCgouYnRuLCAuYnRuLWRlZmF1bHQsIC5maWxlLWxvYWRlcj5sYWJlbCB7CiAgYm9yZGVyLXJhZGl1czogMTAwcHg7CiAgZm9udC1zaXplOiAxNHB4OwogIGZvbnQtd2VpZ2h0OiA1MDA7CiAgcGFkZGluZzogMTBweCAyNHB4OwogIG1pbi1oZWlnaHQ6IDQwcHg7CiAgbGV0dGVyLXNwYWNpbmc6IDAuMXB4OwoKICBib3JkZXI6IDA7CiAgYmFja2dyb3VuZC1pbWFnZTogbm9uZTsKICBiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDsKICBjb2xvcjogJWNvbG9yOlByaW1hcnklOwogIHRleHQtc2hhZG93OiBub25lOwogIGJveC1zaGFkb3c6IG5vbmU7CiAgLXdlYmtpdC1ib3gtc2hhZG93OiBub25lOwogIAogIHBvc2l0aW9uOiByZWxhdGl2ZTsKfQoKLmJ0bjpob3ZlciwuZmlsZS1sb2FkZXI+bGFiZWw6aG92ZXIgewogIGJhY2tncm91bmQtY29sb3I6ICVjb2xvcjpMaWdodCBPdmVybGF5IDElOwogIGJhY2tncm91bmQtaW1hZ2U6IG5vbmU7CiAgb3V0bGluZTogbm9uZTsKICBjb2xvcjogJWNvbG9yOlByaW1hcnklOwp9CgouYnRuOmFjdGl2ZSwgLmJ0bjpmb2N1cywgLmJ0bjphY3RpdmU6Zm9jdXMsIC5maWxlLWxvYWRlcj5sYWJlbDphY3RpdmUsIC5maWxlLWxvYWRlcj5sYWJlbDpmb2N1cywgLmZpbGUtbG9hZGVyPmxhYmVsOmFjdGl2ZTpmb2N1cyB7CiAgYmFja2dyb3VuZC1jb2xvcjogJWNvbG9yOkxpZ2h0IE92ZXJsYXkgMiU7CiAgYmFja2dyb3VuZC1pbWFnZTogbm9uZTsKICBvdXRsaW5lOiBub25lOwogIGJveC1zaGFkb3c6IG5vbmU7CiAgY29sb3I6ICVjb2xvcjpQcmltYXJ5JTsKfQoKCi5hbnZpbC1yb2xlLW91dGxpbmVkLWJ1dHRvbiA+IC5idG4sIC5hbnZpbC1yb2xlLW91dGxpbmVkLWJ1dHRvbi5maWxlLWxvYWRlcj5sYWJlbCB7CiAgY29sb3I6ICVjb2xvcjpQcmltYXJ5JTsKICBib3JkZXI6IHNvbGlkIDFweCAlY29sb3I6T3V0bGluZSU7Cn0KCi5hbnZpbC1yb2xlLW91dGxpbmVkLWJ1dHRvbiA+IC5idG46aG92ZXIsIC5hbnZpbC1yb2xlLW91dGxpbmVkLWJ1dHRvbi5maWxlLWxvYWRlcj5sYWJlbDpob3ZlciB7CiAgYmFja2dyb3VuZC1jb2xvcjogJWNvbG9yOkxpZ2h0IE92ZXJsYXkgMSU7Cn0KCi5hbnZpbC1yb2xlLW91dGxpbmVkLWJ1dHRvbiA+IC5idG46Zm9jdXMsIC5hbnZpbC1yb2xlLW91dGxpbmVkLWJ1dHRvbiA+IC5idG46YWN0aXZlLCAKLmFudmlsLXJvbGUtb3V0bGluZWQtYnV0dG9uLmZpbGUtbG9hZGVyPmxhYmVsOmZvY3VzLCAuYW52aWwtcm9sZS1vdXRsaW5lZC1idXR0b24uZmlsZS1sb2FkZXI+bGFiZWw6YWN0aXZlewogIGJhY2tncm91bmQtY29sb3I6ICVjb2xvcjpMaWdodCBPdmVybGF5IDIlOwogIGNvbG9yOiAlY29sb3I6UHJpbWFyeSU7Cn0KCi5hbnZpbC1yb2xlLWZpbGxlZC1idXR0b24gPiAuYnRuLCAuYnRuLXByaW1hcnksIC5hbnZpbC1yb2xlLWZpbGxlZC1idXR0b24uZmlsZS1sb2FkZXI+bGFiZWwgewogIGJhY2tncm91bmQtY29sb3I6ICVjb2xvcjpQcmltYXJ5JTsKICBjb2xvcjogJWNvbG9yOk9uIFByaW1hcnklOyAKfQoKLmFudmlsLXJvbGUtZmlsbGVkLWJ1dHRvbiA+IC5idG46aG92ZXIsIC5idG4tcHJpbWFyeTpob3ZlciwgLmFudmlsLXJvbGUtZmlsbGVkLWJ1dHRvbi5maWxlLWxvYWRlcj5sYWJlbDpob3ZlciB7CiAgYm94LXNoYWRvdzogMCAxcHggMnB4IHJnYmEoMCwgMCwgMCwgMC4zKSwgMCAxcHggM3B4IDFweCByZ2JhKDAsIDAsIDAsIDAuMTUpOwogIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgwZGVnLCAlY29sb3I6TGlnaHQgT3ZlcmxheSAxJSwgJWNvbG9yOkxpZ2h0IE92ZXJsYXkgMSUpLCAlY29sb3I6UHJpbWFyeSU7CiAgY29sb3I6ICVjb2xvcjpPbiBQcmltYXJ5JTsgCn0KCi5hbnZpbC1yb2xlLWZpbGxlZC1idXR0b24gPiAuYnRuOmZvY3VzLCAuYnRuLXByaW1hcnk6Zm9jdXMsIC5hbnZpbC1yb2xlLWZpbGxlZC1idXR0b24gPiAuYnRuOmFjdGl2ZSwgCi5idG4tcHJpbWFyeTphY3RpdmUsIC5hbnZpbC1yb2xlLWZpbGxlZC1idXR0b24gPiAuYnRuOmFjdGl2ZTpob3ZlciwgLmJ0bi1wcmltYXJ5OmFjdGl2ZTpob3ZlciwKLmFudmlsLXJvbGUtZmlsbGVkLWJ1dHRvbi5maWxlLWxvYWRlcj5sYWJlbDpmb2N1cywgLmFudmlsLXJvbGUtZmlsbGVkLWJ1dHRvbi5maWxlLWxvYWRlcj5sYWJlbDphY3RpdmUsIAouYW52aWwtcm9sZS1maWxsZWQtYnV0dG9uLmZpbGUtbG9hZGVyPmxhYmVsOmFjdGl2ZTpmb2N1cwp7CiAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDBkZWcsICVjb2xvcjpMaWdodCBPdmVybGF5IDIlLCAlY29sb3I6TGlnaHQgT3ZlcmxheSAyJSksICVjb2xvcjpQcmltYXJ5JTsKICBjb2xvcjogJWNvbG9yOk9uIFByaW1hcnklOyAKfQoKLmFudmlsLXJvbGUtZWxldmF0ZWQtYnV0dG9uID4gLmJ0biwgLmFudmlsLXJvbGUtZWxldmF0ZWQtYnV0dG9uLmZpbGUtbG9hZGVyPmxhYmVsIHsKICBjb2xvcjogJWNvbG9yOlByaW1hcnklOwogIGJhY2tncm91bmQtY29sb3I6ICVjb2xvcjpTdXJmYWNlJTsKICBib3gtc2hhZG93OiAwIDFweCAycHggcmdiYSgwLCAwLCAwLCAwLjMpLCAwIDFweCAzcHggMXB4IHJnYmEoMCwgMCwgMCwgMC4xNSk7Cn0KCi5hbnZpbC1yb2xlLWVsZXZhdGVkLWJ1dHRvbiA+IC5idG46Zm9jdXMsIC5hbnZpbC1yb2xlLWVsZXZhdGVkLWJ1dHRvbiA+IC5idG46YWN0aXZlLCAKLmFudmlsLXJvbGUtZWxldmF0ZWQtYnV0dG9uID4gLmJ0bjphY3RpdmU6Zm9jdXMsIC5hbnZpbC1yb2xlLWVsZXZhdGVkLWJ1dHRvbi5maWxlLWxvYWRlcj5sYWJlbDpmb2N1cywgCi5hbnZpbC1yb2xlLWVsZXZhdGVkLWJ1dHRvbi5maWxlLWxvYWRlcj5sYWJlbDphY3RpdmUsIC5hbnZpbC1yb2xlLWVsZXZhdGVkLWJ1dHRvbi5maWxlLWxvYWRlcj5sYWJlbDphY3RpdmU6Zm9jdXMgewogIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgwZGVnLCAlY29sb3I6TGlnaHQgT3ZlcmxheSAyJSwgJWNvbG9yOkxpZ2h0IE92ZXJsYXkgMiUpLCAlY29sb3I6U3VyZmFjZSU7CiAgY29sb3I6ICVjb2xvcjpQcmltYXJ5JTsKICBib3gtc2hhZG93OiAwIDFweCAycHggcmdiYSgwLCAwLCAwLCAwLjMpLCAwIDFweCAzcHggMXB4IHJnYmEoMCwgMCwgMCwgMC4xNSk7Cn0KCi5hbnZpbC1yb2xlLWVsZXZhdGVkLWJ1dHRvbiA+IC5idG46aG92ZXIsIC5hbnZpbC1yb2xlLWVsZXZhdGVkLWJ1dHRvbi5maWxlLWxvYWRlcj5sYWJlbDpob3ZlciB7CiAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDBkZWcsICVjb2xvcjpMaWdodCBPdmVybGF5IDElLCAlY29sb3I6TGlnaHQgT3ZlcmxheSAxJSksICVjb2xvcjpTdXJmYWNlJTsKICBib3gtc2hhZG93OiAwIDFweCAycHggcmdiYSgwLCAwLCAwLCAwLjMpLCAwIDJweCA2cHggMnB4IHJnYmEoMCwgMCwgMCwgMC4xNSk7Cn0KCi5hbnZpbC1yb2xlLXRvbmFsLWJ1dHRvbiA+IC5idG4sIC5hbnZpbC1yb2xlLXRvbmFsLWJ1dHRvbi5maWxlLWxvYWRlcj5sYWJlbCB7CiAgY29sb3I6ICVjb2xvcjpPbiBTZWNvbmRhcnkgQ29udGFpbmVyJTsKICBiYWNrZ3JvdW5kLWNvbG9yOiAlY29sb3I6U2Vjb25kYXJ5IENvbnRhaW5lciU7Cn0KCi5hbnZpbC1yb2xlLXRvbmFsLWJ1dHRvbiA+IC5idG46Zm9jdXMsIC5hbnZpbC1yb2xlLXRvbmFsLWJ1dHRvbiA+IC5idG46YWN0aXZlLCAuYW52aWwtcm9sZS10b25hbC1idXR0b24gPiAuYnRuOmFjdGl2ZTpmb2N1cywgCi5hbnZpbC1yb2xlLXRvbmFsLWJ1dHRvbi5maWxlLWxvYWRlcj5sYWJlbDpmb2N1cywgLmFudmlsLXJvbGUtdG9uYWwtYnV0dG9uLmZpbGUtbG9hZGVyPmxhYmVsOmFjdGl2ZSwgLmFudmlsLXJvbGUtdG9uYWwtYnV0dG9uLmZpbGUtbG9hZGVyPmxhYmVsOmZvY3VzOmFjdGl2ZSB7CiAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDBkZWcsICVjb2xvcjpEYXJrIE92ZXJsYXkgMiUsICVjb2xvcjpEYXJrIE92ZXJsYXkgMiUpLCAlY29sb3I6U2Vjb25kYXJ5IENvbnRhaW5lciU7CiAgY29sb3I6ICVjb2xvcjpPbiBTZWNvbmRhcnkgQ29udGFpbmVyJTsKfQoKLmFudmlsLXJvbGUtdG9uYWwtYnV0dG9uID4gLmJ0bjpob3ZlciwgLmFudmlsLXJvbGUtdG9uYWwtYnV0dG9uLmZpbGUtbG9hZGVyPmxhYmVsOmhvdmVyewogIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgwZGVnLCAlY29sb3I6RGFyayBPdmVybGF5IDElLCAlY29sb3I6RGFyayBPdmVybGF5IDElKSwgJWNvbG9yOlNlY29uZGFyeSBDb250YWluZXIlOwogIGJveC1zaGFkb3c6IDAgMXB4IDJweCByZ2JhKDAsIDAsIDAsIDAuMyksIDAgMXB4IDNweCAxcHggcmdiYSgwLCAwLCAwLCAwLjE1KTsKICBjb2xvcjogJWNvbG9yOk9uIFNlY29uZGFyeSBDb250YWluZXIlOwp9CgouYnRuLWRlZmF1bHRbZGlzYWJsZWRdLCAuYnRuLWRlZmF1bHRbZGlzYWJsZWRdOmhvdmVyLCAuZmlsZS1sb2FkZXIuYW52aWwtZGlzYWJsZWQ+bGFiZWwsIC5maWxlLWxvYWRlci5hbnZpbC1kaXNhYmxlZD5sYWJlbDpob3ZlciB7CiAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7CiAgY29sb3I6ICVjb2xvcjpPbiBEaXNhYmxlZCU7Cn0KCi5hbnZpbC1yb2xlLXRvbmFsLWJ1dHRvbiA+IC5idG5bZGlzYWJsZWRdLCAuYW52aWwtcm9sZS10b25hbC1idXR0b24+IC5idG5bZGlzYWJsZWRdOmhvdmVyLCAKLmFudmlsLXJvbGUtdG9uYWwtYnV0dG9uLmZpbGUtbG9hZGVyLmFudmlsLWRpc2FibGVkPmxhYmVsLCAuYW52aWwtcm9sZS10b25hbC1idXR0b24uZmlsZS1sb2FkZXIuYW52aWwtZGlzYWJsZWQ+bGFiZWw6aG92ZXIsIAouYW52aWwtcm9sZS1maWxsZWQtYnV0dG9uID4gLmJ0bltkaXNhYmxlZF0sIC5hbnZpbC1yb2xlLWZpbGxlZC1idXR0b24gPiAuYnRuW2Rpc2FibGVkXTpob3ZlciwgCi5hbnZpbC1yb2xlLWZpbGxlZC1idXR0b24uZmlsZS1sb2FkZXIuYW52aWwtZGlzYWJsZWQ+bGFiZWwsIC5hbnZpbC1yb2xlLWZpbGxlZC1idXR0b24uZmlsZS1sb2FkZXIuYW52aWwtZGlzYWJsZWQ+bGFiZWw6aG92ZXIsIAouYW52aWwtcm9sZS1lbGV2YXRlZC1idXR0b24gPiAuYnRuW2Rpc2FibGVkXSwgLmFudmlsLXJvbGUtZWxldmF0ZWQtYnV0dG9uID4gLmJ0bltkaXNhYmxlZF06aG92ZXIsIAouYW52aWwtcm9sZS1lbGV2YXRlZC1idXR0b24uZmlsZS1sb2FkZXIuYW52aWwtZGlzYWJsZWQ+bGFiZWwsIC5hbnZpbC1yb2xlLWVsZXZhdGVkLWJ1dHRvbi5maWxlLWxvYWRlci5hbnZpbC1kaXNhYmxlZD5sYWJlbDpob3ZlciB7IAogIGJhY2tncm91bmQ6ICVjb2xvcjpEaXNhYmxlZCBDb250YWluZXIlOwogIGNvbG9yOiAlY29sb3I6T24gRGlzYWJsZWQlOwogIGJveC1zaGFkb3c6IG5vbmU7Cn0KCi5hbnZpbC1yb2xlLW91dGxpbmVkLWJ1dHRvbiA+IC5idG5bZGlzYWJsZWRdLCAuYW52aWwtcm9sZS1vdXRsaW5lZC1idXR0b24uZmlsZS1sb2FkZXIuYW52aWwtZGlzYWJsZWQ+bGFiZWwgewogIGJvcmRlci1jb2xvcjogJWNvbG9yOk9uIERpc2FibGVkJTsKICBiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDsKfQoKCi8qIENvbXBvbmVudDogQ2FyZCAqLwoKLmFudmlsLXJvbGUtb3V0bGluZWQtY2FyZCB7CiAgb3ZlcmZsb3c6IGhpZGRlbjsKICBib3JkZXItcmFkaXVzOiAxMnB4OwogIGJhY2tncm91bmQtY29sb3I6ICVjb2xvcjpTdXJmYWNlJTsKICBib3JkZXI6IHNvbGlkIDFweCAlY29sb3I6T3V0bGluZSU7CiAgcGFkZGluZzogMTVweDsKfQoKLmFudmlsLXJvbGUtZWxldmF0ZWQtY2FyZCB7CiAgb3ZlcmZsb3c6IGhpZGRlbjsKICBib3JkZXItcmFkaXVzOiAxMnB4OwogIGJhY2tncm91bmQtY29sb3I6ICVjb2xvcjpTdXJmYWNlJTsKICAvKiAyZHAgKi8gIGJveC1zaGFkb3c6IDAgMXB4IDJweCByZ2JhKDAsIDAsIDAsIDAuMyksIDAgMnB4IDZweCAycHggcmdiYSgwLCAwLCAwLCAwLjE1KTsKICBwYWRkaW5nOiAxNXB4Owp9CgouYW52aWwtcm9sZS10b25hbC1jYXJkIHsKICBvdmVyZmxvdzogaGlkZGVuOwogIGJvcmRlci1yYWRpdXM6IDEycHg7CiAgYmFja2dyb3VuZC1jb2xvcjogJWNvbG9yOlN1cmZhY2UgVmFyaWFudCU7CiAgcGFkZGluZzogMTVweDsKfQoKCi8qIGZ1bGxfd2lkdGhfcm93IHNlY3Rpb25zIGdvIGZ1bGwgYmxlZWQgKi8KLmNvbHVtbi1wYW5lbC5hbnZpbC1yb2xlLWNhcmQgPiAuYW52aWwtcGFuZWwtc2VjdGlvbiA+IC5hbnZpbC1wYW5lbC1zZWN0aW9uLWNvbnRhaW5lci5mdWxsLXdpZHRoLXJvdyB7CiAgbWFyZ2luLWxlZnQ6IC0xMnB4OwogIG1hcmdpbi1yaWdodDogLTEycHg7CiAgd2lkdGg6IGluaXRpYWw7CiAgbWF4LXdpZHRoOiBpbml0aWFsOwp9CgovKiBJZiB0aGUgZmlyc3Qgcm93IG9mIGEgY2FyZCBpcyBhIGZ1bGxfd2lkdGhfcm93LCBpdCBnb2VzIHRvIHRoZSB0b3AgKi8KLmNvbHVtbi1wYW5lbC5hbnZpbC1yb2xlLWNhcmQgPiAuYW52aWwtcGFuZWwtc2VjdGlvbjpmaXJzdC1jaGlsZCA+IC5hbnZpbC1wYW5lbC1zZWN0aW9uLWNvbnRhaW5lci5mdWxsLXdpZHRoLXJvdyB7CiAgbWFyZ2luLXRvcDogLThweDsKfQouY29sdW1uLXBhbmVsLmFudmlsLXJvbGUtY2FyZCA+IC5hbnZpbC1wYW5lbC1zZWN0aW9uOmxhc3QtY2hpbGQgPiAuYW52aWwtcGFuZWwtc2VjdGlvbi1jb250YWluZXIuZnVsbC13aWR0aC1yb3cgewogIG1hcmdpbi1ib3R0b206IC04cHg7Cn0KCgoKLyogQ29tcG9uZW50OiBUZXh0Qm94ICsgVGV4dEFyZWEgKi8KCi8qdGhpcyBhZmZlY3RzIGRyb3Bkb3ducywgdGV4dCBib3hlcyBhbmQgdGV4dCBhcmVhczoqLwppbnB1dC5hbnZpbC1jb21wb25lbnQsIHRleHRhcmVhLmFudmlsLWNvbXBvbmVudCwgLmFudmlsLWNvbXBvbmVudCBzZWxlY3QsIC5hbnZpbC1kYXRlcGlja2VyIGlucHV0IHsKICBmb250LXNpemU6IDE2cHg7CiAgbGluZS1oZWlnaHQ6IDEuNTsKICBib3JkZXItcmFkaXVzOiA0cHggNHB4IDAgMDsKICBiYWNrZ3JvdW5kLWNvbG9yOiAlY29sb3I6U3VyZmFjZSBWYXJpYW50JTsKICBjb2xvcjogJWNvbG9yOk9uIFN1cmZhY2UgVmFyaWFudCU7CiAgYm94LXNoYWRvdzogbm9uZTsKfQoKLmFudmlsLWRyb3Bkb3duIHsKICBmb250LXNpemU6IDE2cHg7Cn0KCi5hbnZpbC1kcm9wZG93biBzZWxlY3Qgb3B0aW9uIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiBncmVlbjsKfQoKLmFudmlsLWNvbXBvbmVudCBzZWxlY3QgewogIGZvbnQtc2l6ZTogaW5oZXJpdDsKfQoKaW5wdXQuYW52aWwtY29tcG9uZW50LCAuYW52aWwtY29tcG9uZW50IHNlbGVjdCwgLmFudmlsLWRhdGVwaWNrZXIgaW5wdXQsIHRleHRhcmVhLmFudmlsLWNvbXBvbmVudCB7CiAgcGFkZGluZzogOHB4IDE2cHg7CiAgYm9yZGVyOiAwOwogIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAlY29sb3I6T3V0bGluZSU7Cn0KCi5hbnZpbC1kcm9wZG93biBzZWxlY3QuZm9ybS1jb250cm9sIHsKICAKICAtd2Via2l0LWFwcGVhcmFuY2U6IG5vbmU7CiAgLW1vei1hcHBlYXJhbmNlOiBub25lOwovKiAgIHBhZGRpbmc6IDhweCAyZW0gNHB4IDA7ICovCiAgCiAgLyogZXcgZXcgZXcgLSBzZWxlY3QgZWxlbWVudHMgYXJlIHdlaXJkIGFuZCBkb24ndCBvYmV5IGxpbmUtaGVpZ2h0LCBzbyB3ZSBqdXN0CiAgICAgc2V0IHRoZSBoZWlnaHQgZXhwbGljaXRseS4gVWdoLiAqLwogIGhlaWdodDogY2FsYygxLjVlbSArIDEzcHgpOyAvKiA4cHggKyA0cHggcGFkZGluZyArIDFweCBib3JkZXIgPSAxM3B4ICovCn0KCi5hbnZpbC1kcm9wZG93biB7CiAgcG9zaXRpb246IHJlbGF0aXZlOwp9Ci8qIFNlbGVjdCBhcnJvdyBzdHlsaW5nICovCi5hbnZpbC1kcm9wZG93biBmb3JtOmJlZm9yZSB7CiAgICBjb250ZW50OiAiXDI1QkMiOwogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgcmlnaHQ6IDA7CiAgICBmb250LXNpemU6IDgwJTsKICAgIGxpbmUtaGVpZ2h0OiBjYWxjKDEuOGVtICsgOHB4KTsKICAgIGNvbG9yOiAlY29sb3I6T3V0bGluZSU7CiAgICBwb2ludGVyLWV2ZW50czpub25lOwogICAgcGFkZGluZzogNHB4IDRweDsKfQoKLmFudmlsLWNvbXBvbmVudCBzZWxlY3QsIC5hbnZpbC1kYXRlcGlja2VyIGlucHV0IHsgbWFyZ2luLWJvdHRvbTogNHB4OyB9CmlucHV0LmFudmlsLWNvbXBvbmVudC5hbnZpbC1zcGFjaW5nLWJlbG93LW5vbmUgeyBtYXJnaW4tYm90dG9tOiA0cHg7IH0KaW5wdXQuYW52aWwtY29tcG9uZW50LmFudmlsLXNwYWNpbmctYmVsb3ctc21hbGwgeyBtYXJnaW4tYm90dG9tOiA4cHg7IH0KaW5wdXQuYW52aWwtY29tcG9uZW50LmFudmlsLXNwYWNpbmctYmVsb3ctbWVkaXVtIHsgbWFyZ2luLWJvdHRvbTogMTJweDsgfQppbnB1dC5hbnZpbC1jb21wb25lbnQuYW52aWwtc3BhY2luZy1iZWxvdy1sYXJnZSB7IG1hcmdpbi1ib3R0b206IDIwcHg7IH0KCmlucHV0LmFudmlsLWNvbXBvbmVudDo6LXdlYmtpdC1pbnB1dC1wbGFjZWhvbGRlciwgdGV4dGFyZWEuYW52aWwtY29tcG9uZW50Ojotd2Via2l0LWlucHV0LXBsYWNlaG9sZGVyIHsKICBjb2xvcjogJWNvbG9yOk9uIFN1cmZhY2UlOwp9CmlucHV0LmFudmlsLWNvbXBvbmVudDo6LW1vei1wbGFjZWhvbGRlciwgdGV4dGFyZWEuYW52aWwtY29tcG9uZW50OjotbW96LXBsYWNlaG9sZGVyIHsKICBjb2xvcjogJWNvbG9yOk9uIFN1cmZhY2UlOwp9CmlucHV0LmFudmlsLWNvbXBvbmVudDo6cGxhY2Vob2xkZXIsIHRleHRhcmVhLmFudmlsLWNvbXBvbmVudDo6cGxhY2Vob2xkZXIgIHsKICBjb2xvcjogJWNvbG9yOk9uIFN1cmZhY2UlOwp9CgouYXBwLWJhciBpbnB1dC5hbnZpbC1jb21wb25lbnQ6Oi13ZWJraXQtaW5wdXQtcGxhY2Vob2xkZXIsIC5hcHAtYmFyIHRleHRhcmVhLmFudmlsLWNvbXBvbmVudDo6LXdlYmtpdC1pbnB1dC1wbGFjZWhvbGRlciB7CiAgY29sb3I6ICVjb2xvcjpPbiBTdXJmYWNlJTsKfQouYXBwLWJhciBpbnB1dC5hbnZpbC1jb21wb25lbnQ6Oi1tb3otcGxhY2Vob2xkZXIsIC5hcHAtYmFyIHRleHRhcmVhLmFudmlsLWNvbXBvbmVudDo6LW1vei1wbGFjZWhvbGRlciB7CiAgY29sb3I6ICVjb2xvcjpPbiBTdXJmYWNlJTsKfQouYXBwLWJhciBpbnB1dC5hbnZpbC1jb21wb25lbnQ6OnBsYWNlaG9sZGVyLCAuYXBwLWJhciB0ZXh0YXJlYS5hbnZpbC1jb21wb25lbnQ6OnBsYWNlaG9sZGVyICB7CiAgY29sb3I6ICVjb2xvcjpPbiBTdXJmYWNlJTsKfQoKaW5wdXQuYW52aWwtY29tcG9uZW50OmhvdmVyLCBpbnB1dC5hbnZpbC1jb21wb25lbnQ6Zm9jdXMsIHRleHRhcmVhLmFudmlsLWNvbXBvbmVudDpob3ZlciwgdGV4dGFyZWEuYW52aWwtY29tcG9uZW50OmZvY3VzLCAKLmFudmlsLWNvbXBvbmVudCBzZWxlY3Q6aG92ZXIsIC5hbnZpbC1jb21wb25lbnQgc2VsZWN0OmZvY3VzLCAuYW52aWwtZGF0ZXBpY2tlciBpbnB1dDpob3ZlciwgLmFudmlsLWRhdGVwaWNrZXIgaW5wdXQ6Zm9jdXMgewogIGJvcmRlci1ib3R0b206IDJweCBzb2xpZCAlY29sb3I6UHJpbWFyeSU7CiAgcGFkZGluZy1ib3R0b206IDdweDsKICBib3gtc2hhZG93OiBub25lOwp9CgoKaW5wdXQuYW52aWwtY29tcG9uZW50W2Rpc2FibGVkXSwgLmFudmlsLWNvbXBvbmVudCBzZWxlY3RbZGlzYWJsZWRdLCAuYW52aWwtZGF0ZXBpY2tlciBpbnB1dFtkaXNhYmxlZF0sIHRleHRhcmVhLmFudmlsLWNvbXBvbmVudFtkaXNhYmxlZF0sIAp0ZXh0YXJlYS5hbnZpbC1jb21wb25lbnQuYW52aWwtcm9sZS1pbnB1dC1lcnJvcltkaXNhYmxlZF0sIGlucHV0LmFudmlsLWNvbXBvbmVudC5hbnZpbC1yb2xlLWlucHV0LWVycm9yW2Rpc2FibGVkXSwgCi5hbnZpbC1jb21wb25lbnQuYW52aWwtcm9sZS1pbnB1dC1lcnJvciBzZWxlY3RbZGlzYWJsZWRdLCAuYW52aWwtZGF0ZXBpY2tlci5hbnZpbC1yb2xlLWlucHV0LWVycm9yIGlucHV0W2Rpc2FibGVkXSB7CiAgYmFja2dyb3VuZC1jb2xvcjogJWNvbG9yOkRhcmsgT3ZlcmxheSAxJTsKICBjb2xvcjogJWNvbG9yOk9uIERpc2FibGVkJTsKICBib3JkZXItYm90dG9tOiAxcHggc29saWQgJWNvbG9yOk9uIERpc2FibGVkJTsKICBwYWRkaW5nLWJvdHRvbTogOHB4Owp9CgouYW52aWwtY29tcG9uZW50IHNlbGVjdDpob3ZlciwgLmFudmlsLWNvbXBvbmVudCBzZWxlY3Q6Zm9jdXMgewogIHBhZGRpbmctYm90dG9tOiAzcHg7Cn0KCi8qIE91dGxpbmVkIHJvbGUgZm9yIHRleHQgYXJlYXMsIHRleHQgYm94ZXMsIGRyb3AgZG93bnMgYW5kIGRhdGUgcGlja2VycyAqLwp0ZXh0YXJlYS5hbnZpbC1jb21wb25lbnQuYW52aWwtcm9sZS1vdXRsaW5lZCwgaW5wdXQuYW52aWwtY29tcG9uZW50LmFudmlsLXJvbGUtb3V0bGluZWQsIAouYW52aWwtY29tcG9uZW50LmFudmlsLXJvbGUtb3V0bGluZWQgc2VsZWN0LCAuYW52aWwtZGF0ZXBpY2tlci5hbnZpbC1yb2xlLW91dGxpbmVkIGlucHV0IHsKICBiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDsKICBib3JkZXI6IDFweCBzb2xpZCAlY29sb3I6T3V0bGluZSU7CiAgYm9yZGVyLXJhZGl1czogNHB4OwogIGNvbG9yOiAlY29sb3I6T24gU3VyZmFjZSU7Cn0KCnRleHRhcmVhLmFudmlsLWNvbXBvbmVudC5hbnZpbC1yb2xlLW91dGxpbmVkOmhvdmVyLCB0ZXh0YXJlYS5hbnZpbC1jb21wb25lbnQuYW52aWwtcm9sZS1vdXRsaW5lZDpmb2N1cywgCmlucHV0LmFudmlsLWNvbXBvbmVudC5hbnZpbC1yb2xlLW91dGxpbmVkOmhvdmVyLCBpbnB1dC5hbnZpbC1jb21wb25lbnQuYW52aWwtcm9sZS1vdXRsaW5lZDpmb2N1cywKLmFudmlsLWNvbXBvbmVudC5hbnZpbC1yb2xlLW91dGxpbmVkIHNlbGVjdDpob3ZlciwgLmFudmlsLWNvbXBvbmVudC5hbnZpbC1yb2xlLW91dGxpbmVkIHNlbGVjdDpmb2N1cywKLmFudmlsLWRhdGVwaWNrZXIuYW52aWwtcm9sZS1vdXRsaW5lZCBpbnB1dDpob3ZlciwgLmFudmlsLWRhdGVwaWNrZXIuYW52aWwtcm9sZS1vdXRsaW5lZCBpbnB1dDpmb2N1c3sKICBib3JkZXI6IDJweCBzb2xpZCAlY29sb3I6UHJpbWFyeSU7CiAgcGFkZGluZzogN3B4IDE1cHg7Cn0KCnRleHRhcmVhLmFudmlsLWNvbXBvbmVudC5hbnZpbC1yb2xlLW91dGxpbmVkLWVycm9yOmhvdmVyLCB0ZXh0YXJlYS5hbnZpbC1jb21wb25lbnQuYW52aWwtcm9sZS1vdXRsaW5lZC1lcnJvcjpmb2N1cywgCmlucHV0LmFudmlsLWNvbXBvbmVudC5hbnZpbC1yb2xlLW91dGxpbmVkLWVycm9yOmhvdmVyLCBpbnB1dC5hbnZpbC1jb21wb25lbnQuYW52aWwtcm9sZS1vdXRsaW5lZC1lcnJvcjpmb2N1cywKLmFudmlsLWNvbXBvbmVudC5hbnZpbC1yb2xlLW91dGxpbmVkLWVycm9yIHNlbGVjdDpob3ZlciwgLmFudmlsLWNvbXBvbmVudC5hbnZpbC1yb2xlLW91dGxpbmVkLWVycm9yIHNlbGVjdDpmb2N1cywKLmFudmlsLWRhdGVwaWNrZXIuYW52aWwtcm9sZS1vdXRsaW5lZC1lcnJvciBpbnB1dDpob3ZlciwgLmFudmlsLWRhdGVwaWNrZXIuYW52aWwtcm9sZS1vdXRsaW5lZC1lcnJvciBpbnB1dDpmb2N1c3sKICBib3JkZXI6IDJweCBzb2xpZCAlY29sb3I6RXJyb3IlOwogIHBhZGRpbmctYm90dG9tOiA2cHg7Cn0KCnRleHRhcmVhLmFudmlsLWNvbXBvbmVudC5hbnZpbC1yb2xlLW91dGxpbmVkW2Rpc2FibGVkXSwgaW5wdXQuYW52aWwtY29tcG9uZW50LmFudmlsLXJvbGUtb3V0bGluZWRbZGlzYWJsZWRdLCAKLmFudmlsLWNvbXBvbmVudC5hbnZpbC1yb2xlLW91dGxpbmVkIHNlbGVjdFtkaXNhYmxlZF0sIC5hbnZpbC1kYXRlcGlja2VyLmFudmlsLXJvbGUtb3V0bGluZWQgaW5wdXRbZGlzYWJsZWRdLCAKdGV4dGFyZWEuYW52aWwtY29tcG9uZW50LmFudmlsLXJvbGUtb3V0bGluZWQtZXJyb3JbZGlzYWJsZWRdLCBpbnB1dC5hbnZpbC1jb21wb25lbnQuYW52aWwtcm9sZS1vdXRsaW5lZC1lcnJvcltkaXNhYmxlZF0sIAouYW52aWwtY29tcG9uZW50LmFudmlsLXJvbGUtb3V0bGluZWQtZXJyb3Igc2VsZWN0W2Rpc2FibGVkXSwgLmFudmlsLWRhdGVwaWNrZXIuYW52aWwtcm9sZS1vdXRsaW5lZC1lcnJvciBpbnB1dFtkaXNhYmxlZF0gewogIGJvcmRlcjogMXB4IHNvbGlkICVjb2xvcjpPbiBEaXNhYmxlZCU7CiAgY29sb3I6ICVjb2xvcjpPbiBEaXNhYmxlZCU7CiAgcGFkZGluZy1ib3R0b206IDhweDsKfQoKLmRhdGVyYW5nZXBpY2tlciB0ZC5hY3RpdmUgewogIGJhY2tncm91bmQ6ICVjb2xvcjpQcmltYXJ5JTsKfQoKLmRhdGVyYW5nZXBpY2tlciB0ZC5hdmFpbGFibGU6aG92ZXIgewogIGJhY2tncm91bmQ6ICVjb2xvcjpEYXJrIE92ZXJsYXkgMiU7Cn0KCi5kYXRlcmFuZ2VwaWNrZXIgdGQuYWN0aXZlOmhvdmVyIHsKICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMGRlZywgJWNvbG9yOkxpZ2h0IE92ZXJsYXkgMSUsICVjb2xvcjpMaWdodCBPdmVybGF5IDElKSwgJWNvbG9yOlByaW1hcnklOwp9CgouZGF0ZXJhbmdlcGlja2VyIHRkLm9mZiB7CiAgY29sb3I6ICVjb2xvcjpPbiBEaXNhYmxlZCU7Cn0KCnRleHRhcmVhLmFudmlsLWNvbXBvbmVudC5hbnZpbC1yb2xlLW91dGxpbmVkLWVycm9yLCBpbnB1dC5hbnZpbC1jb21wb25lbnQuYW52aWwtcm9sZS1vdXRsaW5lZC1lcnJvciwgCi5hbnZpbC1jb21wb25lbnQuYW52aWwtcm9sZS1vdXRsaW5lZC1lcnJvciBzZWxlY3QsIC5hbnZpbC1kYXRlcGlja2VyLmFudmlsLXJvbGUtb3V0bGluZWQtZXJyb3IgaW5wdXQgewogIGNvbG9yOiAlY29sb3I6RXJyb3IlOwogIGJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50OwogIGJvcmRlcjogMXB4IHNvbGlkICVjb2xvcjpFcnJvciU7OwogIGJvcmRlci1yYWRpdXM6IDRweDsKfQoKdGV4dGFyZWEuYW52aWwtY29tcG9uZW50LmFudmlsLXJvbGUtaW5wdXQtZXJyb3IsIGlucHV0LmFudmlsLWNvbXBvbmVudC5hbnZpbC1yb2xlLWlucHV0LWVycm9yLCAKLmFudmlsLWNvbXBvbmVudC5hbnZpbC1yb2xlLWlucHV0LWVycm9yIHNlbGVjdCwgLmFudmlsLWRhdGVwaWNrZXIuYW52aWwtcm9sZS1pbnB1dC1lcnJvciBpbnB1dCB7CiAgY29sb3I6ICVjb2xvcjpFcnJvciU7CiAgYm9yZGVyLWNvbG9yOiAlY29sb3I6RXJyb3IlOyAKfQoKLypUT0RPOiBmaWd1cmUgb3V0IHdoYXQgdGhpcyBpcyB1c2VkIGZvciovCi8qIC5kYXRlcmFuZ2VwaWNrZXIgLmJ0bi1zdWNjZXNzIHsKICBjb2xvcjogJWNvbG9yOlByaW1hcnkgNTAwJTsKfSAqLwoKLyogQ29tcG9uZW50OiBDaGVja0JveCwgUmFkaW9CdXR0b24gKi8KLmNoZWNrYm94IGlucHV0LCAucmFkaW8gaW5wdXQgewogIC13ZWJraXQtYXBwZWFyYW5jZTogbm9uZTsKICBhcHBlYXJhbmNlOiBub25lOwogIHdpZHRoOiAxNXB4OwogIGhlaWdodDogMTVweDsKICBib3JkZXItcmFkaXVzOiAxcHg7CiAgYmFja2dyb3VuZC1jb2xvcjogJWNvbG9yOlN1cmZhY2UgVmFyaWFudCU7IAovKiAgIGNvbG9yOiAlY29sb3I6T24gU3VyZmFjZSBWYXJpYW50JTsgKi8KfQoKLnJhZGlvIGlucHV0IHsKICBib3JkZXItcmFkaXVzIDogNTAlOwp9CgouY2hlY2tib3ggaW5wdXQ6aG92ZXIsIC5yYWRpbyBpbnB1dDpob3ZlciB7CiAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDBkZWcsICVjb2xvcjpMaWdodCBPdmVybGF5IDElLCAlY29sb3I6TGlnaHQgT3ZlcmxheSAxJSksICVjb2xvcjpTdXJmYWNlIFZhcmlhbnQlOwp9CgouY2hlY2tib3ggaW5wdXQ6Zm9jdXMsIC5yYWRpbyBpbnB1dDpmb2N1cyB7CiAgb3V0bGluZTogMDsKfQoKLnJhZGlvIGlucHV0OmZvY3VzIHsKICBib3JkZXItcmFkaXVzOiAxMHB4Owp9CgouY2hlY2tib3ggaW5wdXRbdHlwZT0iY2hlY2tib3giXVtkaXNhYmxlZF06aG92ZXIsIC5yYWRpbyBpbnB1dFt0eXBlPSJyYWRpbyJdW2Rpc2FibGVkXTpob3ZlciwgCi5jaGVja2JveCBpbnB1dFt0eXBlPSJjaGVja2JveCJdW2Rpc2FibGVkXSwgLnJhZGlvIGlucHV0W3R5cGU9InJhZGlvIl1bZGlzYWJsZWRdIHsKICBiYWNrZ3JvdW5kOiAlY29sb3I6RGlzYWJsZWQgQ29udGFpbmVyJTsgCn0KCmlucHV0W2Rpc2FibGVkXSB+IHNwYW4gewogIGN1cnNvcjogbm90LWFsbG93ZWQ7CiAgY29sb3I6ICVjb2xvcjpPbiBEaXNhYmxlZCU7Cn0KCi5jaGVja2JveCBpbnB1dCwgLnJhZGlvIGlucHV0IHsKICBkaXNwbGF5OiBmbGV4OwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7Cn0KCi5jaGVja2JveCBpbnB1dDpjaGVja2VkLCAucmFkaW8gaW5wdXQ6Y2hlY2tlZCB7CiAgYmFja2dyb3VuZC1jb2xvcjogJWNvbG9yOlByaW1hcnkgQ29udGFpbmVyJTsKICBjb2xvcjogJWNvbG9yOk9uIFByaW1hcnkgQ29udGFpbmVyJTsKfQoKLmNoZWNrYm94IGlucHV0OmNoZWNrZWQ6YmVmb3JlIHsKICBmb250LWZhbWlseTogIkZvbnRBd2Vzb21lIjsKICBjb250ZW50OiAiXGYwMGMiOwogIGZvbnQtc2l6ZTogMTBweDsKfQoKLnJhZGlvIGlucHV0OmNoZWNrZWQ6YmVmb3JlIHsKICBmb250LWZhbWlseTogIkZvbnRBd2Vzb21lIjsKICBjb250ZW50OiAiXGYxMTEiOwogIGZvbnQtc2l6ZTogOHB4Owp9CgouY2hlY2tib3gsIC5yYWRpbyB7CiAgZm9udC1zaXplOiAxNnB4Owp9CgovKiBEYXRhIEdyaWRzICovCi5hbnZpbC1yb2xlLXRvbmFsLWRhdGEtZ3JpZC5hbnZpbC1kYXRhLWdyaWQgPiAuZGF0YS1ncmlkLWNoaWxkLXBhbmVsPmRpdi5hdXRvLWdyaWQtaGVhZGVyIHsKICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMGRlZywgJWNvbG9yOlByaW1hcnkgT3ZlcmxheSAyJSwgJWNvbG9yOlByaW1hcnkgT3ZlcmxheSAyJSksICVjb2xvcjpCYWNrZ3JvdW5kJTsKICBib3JkZXItYm90dG9tOiAxcHggc29saWQgJWNvbG9yOlN1cmZhY2UgVmFyaWFudCU7CiAgYm9yZGVyLXJhZGl1czogMjRweCAyNHB4IDAgMDsKfQoKLmFudmlsLXJvbGUtdG9uYWwtZGF0YS1ncmlkLmFudmlsLWRhdGEtZ3JpZCA+IC5kYXRhLWdyaWQtY2hpbGQtcGFuZWw+ZGl2LmF1dG8tZ3JpZC1oZWFkZXIgZGl2LmRhdGEtcm93LWNvbCA+IGRpdiB7CiAgcGFkZGluZzogMTJweDsKICB0ZXh0LWFsaWduOiBjZW50ZXIgIWltcG9ydGFudDsKfQoKLmFudmlsLXJvbGUtdG9uYWwtZGF0YS1ncmlkLmFudmlsLWRhdGEtZ3JpZCB7CiAgYm9yZGVyLXJhZGl1czogMjRweDsKICBib3JkZXI6IDFweCBzb2xpZCAlY29sb3I6U3VyZmFjZSBWYXJpYW50JTsKfQoKLmFudmlsLXJvbGUtdG9uYWwtZGF0YS1ncmlkLmFudmlsLWRhdGEtZ3JpZCAuZGF0YS1ncmlkLWNoaWxkLXBhbmVsIGRpdi5kYXRhLXJvdy1jb2wgewogIGJvcmRlci1sZWZ0OiAxcHggc29saWQgJWNvbG9yOlN1cmZhY2UgVmFyaWFudCU7CiAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICVjb2xvcjpTdXJmYWNlIFZhcmlhbnQlOwp9CgouYW52aWwtcm9sZS10b25hbC1kYXRhLWdyaWQuYW52aWwtZGF0YS1ncmlkIC5kYXRhLWdyaWQtY2hpbGQtcGFuZWwgZGl2LmRhdGEtcm93LWNvbDpmaXJzdC1jaGlsZCB7CiAgYm9yZGVyLWxlZnQ6IDA7Cn0KCi5hbnZpbC1yb2xlLXRvbmFsLWRhdGEtZ3JpZC5hbnZpbC1kYXRhLWdyaWQgPiAuZGF0YS1ncmlkLWNoaWxkLXBhbmVsPmRpdi5hdXRvLWdyaWQtaGVhZGVyIGRpdi5kYXRhLXJvdy1jb2wgewogIGJvcmRlci10b3A6IDA7CiAgYm9yZGVyLWJvdHRvbTogMDsKICBib3JkZXItcmlnaHQ6IDA7Cn0KCgovKlBsb3RzKi8KCmRpdi5wbG90LWNvbnRhaW5lci5wbG90bHkgc3ZnLm1haW4tc3ZnIHsKICBib3JkZXI6IDFweCBzb2xpZCAlY29sb3I6U3VyZmFjZSBWYXJpYW50JTsKICBib3JkZXItcmFkaXVzOiAxMnB4Owp9CgoucGxvdC1jb250YWluZXIucGxvdGx5IC5tYWluLXN2ZyAucGFyY29vcmRzIC55LWF4aXMgLmF4aXMgLnRpY2sgPiB0ZXh0IHsKICB0ZXh0LXNoYWRvdzogbm9uZSAhaW1wb3J0YW50Owp9CgoucGxvdC1jb250YWluZXIucGxvdGx5IC5tYWluLXN2ZyAucGFyY29vcmRzIC55LWF4aXMgLmF4aXMgPiBwYXRoLmRvbWFpbiB7CiAgc3Ryb2tlOiAlY29sb3I6T3V0bGluZSU7Cn0KCiNsb2FkaW5nU3Bpbm5lciB7CiAgYmFja2dyb3VuZC1jb2xvcjogJWNvbG9yOlN1cmZhY2UgVmFyaWFudCU7CiAgYm94LXNoYWRvdzogMHB4IDBweCAxMDBweCAxMDBweCAlY29sb3I6U3VyZmFjZSBWYXJpYW50JTsKfQoKLmFudmlsLXJvbGUtd2lkZSAuZGF0YS1ncmlkLWNoaWxkLXBhbmVsIHsKICBvdmVyZmxvdy14OiBhdXRvOwp9CgouYW52aWwtcm9sZS13aWRlIC5hbnZpbC1kYXRhLXJvdy1wYW5lbCB7CiAgZmxleC13cmFwOiBub3dyYXA7CiAgbWluLXdpZHRoOiAtbW96LW1pbi1jb250ZW50OwogIG1pbi13aWR0aDogbWluLWNvbnRlbnQ7Cn0=,
    id: VUBUFQPFKPVPWXMZKEQPUZHP6CTMBJ55}
server_modules: []
renamed: true
